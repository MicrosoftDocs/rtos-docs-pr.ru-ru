---
title: Глава 1. Введение в сервер ОСРВ Azure NetX DHCP
description: Приложение устанавливает связь со своим сервером ОСРВ Azure NetX DHCP для динамического запроса и получения IP-адреса.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 17438a20ad3da64c88c3d6bb19a4887c2c6e354e
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104815248"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-dhcp-server"></a><span data-ttu-id="1b7af-103">Глава 1. Введение в сервер ОСРВ Azure NetX DHCP</span><span class="sxs-lookup"><span data-stu-id="1b7af-103">Chapter 1 - Introduction to Azure RTOS NetX DHCP Server</span></span>

<span data-ttu-id="1b7af-104">В NetX IP-адрес приложения является одним параметров, указываемых в вызове функции *nx_ip_create*.</span><span class="sxs-lookup"><span data-stu-id="1b7af-104">In NetX, the application's IP address is one of the supplied parameters to the *nx_ip_create* service call.</span></span> <span data-ttu-id="1b7af-105">Предоставление IP-адреса не вызывает проблем, если этот IP-адрес известен приложению, то есть назначен статически или посредством конфигурации пользователя.</span><span class="sxs-lookup"><span data-stu-id="1b7af-105">Supplying the IP address poses no problem if the IP address is known to the application, either statically or through user configuration.</span></span> <span data-ttu-id="1b7af-106">Однако существуют ситуации, в которых приложение не знает своего IP-адреса или он не важен.</span><span class="sxs-lookup"><span data-stu-id="1b7af-106">However, there are some instances where the application doesn't know or care what its IP address is.</span></span> <span data-ttu-id="1b7af-107">В таких ситуациях необходимо передать нулевой IP-адрес в функцию *nx_ip_create*, а приложению следует подключиться к серверу ОСРВ Azure NetX DHCP для динамического запроса и получения IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="1b7af-107">In such situations, a zero IP address should be supplied to the *nx_ip_create* function and the application establishes communication with its Azure RTOS NetX DHCP server to dynamically request and obtain an IP address.</span></span>

## <a name="dynamic-ip-address-assignment"></a><span data-ttu-id="1b7af-108">Динамическое назначение IP-адресов</span><span class="sxs-lookup"><span data-stu-id="1b7af-108">Dynamic IP Address Assignment</span></span>

<span data-ttu-id="1b7af-109">Основной службой, используемой для получения динамического IP-адреса из сети, является протокол RARP.</span><span class="sxs-lookup"><span data-stu-id="1b7af-109">The basic service used to obtain a dynamic IP address from the network is the Reverse Address Resolution Protocol (RARP).</span></span> <span data-ttu-id="1b7af-110">Этот протокол аналогичен протоколу ARP, за исключением того, что он предназначен для получения IP-адреса для себя, а не для поиска MAC-адреса для другого сетевого узла.</span><span class="sxs-lookup"><span data-stu-id="1b7af-110">This protocol is similar to ARP, except it is designed to obtain an IP address for itself instead of finding the MAC address for another network node.</span></span> <span data-ttu-id="1b7af-111">Сообщение низкого уровня RARP транслируется по локальной сети, и сервер в этой сети обязан отправить ответ RARP, который содержит динамически выделенный IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="1b7af-111">The low-level RARP message is broadcast on the local network and it is the responsibility of a server on the network to respond with an RARP response, which contains a dynamically allocated IP address.</span></span>

<span data-ttu-id="1b7af-112">Хотя протокол RARP предоставляет службу для динамического выделения IP-адресов, у него есть несколько недостатков.</span><span class="sxs-lookup"><span data-stu-id="1b7af-112">Although RARP provides a service for dynamic allocation of IP addresses, it has several shortcomings.</span></span> <span data-ttu-id="1b7af-113">Самый очевидный недостаток заключается в том, что протокол RARP обеспечивает динамическое выделение только IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="1b7af-113">The most glaring deficiency is that RARP only provides dynamic allocation of the IP address.</span></span> <span data-ttu-id="1b7af-114">В большинстве случаев для того, чтобы устройство правильно работало в сети, требуется дополнительная информация.</span><span class="sxs-lookup"><span data-stu-id="1b7af-114">In most situations, more information is necessary in order for a device to properly participate on a network.</span></span> <span data-ttu-id="1b7af-115">В дополнение к IP-адресу большинству устройств требуется маска сети и IP-адрес шлюза.</span><span class="sxs-lookup"><span data-stu-id="1b7af-115">In addition to an IP address, most devices need the network mask and the gateway IP address.</span></span> <span data-ttu-id="1b7af-116">Может также потребоваться IP-адрес DNS-сервера и другие сведения о сети.</span><span class="sxs-lookup"><span data-stu-id="1b7af-116">The IP address of a DNS server and other network information may also be needed.</span></span> <span data-ttu-id="1b7af-117">Протокол RARP не может предоставить эти сведения.</span><span class="sxs-lookup"><span data-stu-id="1b7af-117">RARP does not have the ability to provide this information.</span></span>

## <a name="rarp-alternatives"></a><span data-ttu-id="1b7af-118">Альтернативы протоколу RARP</span><span class="sxs-lookup"><span data-stu-id="1b7af-118">RARP Alternatives</span></span>

<span data-ttu-id="1b7af-119">Чтобы преодолеть недостатки протокола RARP, исследователи разработали более полный механизм выделения IP-адресов, называемый протоколом начальной загрузки (BOOTP).</span><span class="sxs-lookup"><span data-stu-id="1b7af-119">In order to overcome the deficiencies of RARP, researchers developed a more comprehensive IP address allocation mechanism called the Bootstrap Protocol (BOOTP).</span></span> <span data-ttu-id="1b7af-120">Этот протокол может динамически выделять IP-адреса, а также предоставлять важные дополнительные сведения о сети.</span><span class="sxs-lookup"><span data-stu-id="1b7af-120">This protocol has the ability to dynamically allocate an IP address and also provide additional important network information.</span></span> <span data-ttu-id="1b7af-121">Тем не менее, недостаток протокола BOOTP заключается в том, что он разработан для статических сетевых конфигураций.</span><span class="sxs-lookup"><span data-stu-id="1b7af-121">However, BOOTP has the drawback of being designed for static network configurations.</span></span> <span data-ttu-id="1b7af-122">Он не позволяет быстро или автоматически назначать адреса.</span><span class="sxs-lookup"><span data-stu-id="1b7af-122">It does not allow for quick or automated address assignment.</span></span>

<span data-ttu-id="1b7af-123">Именно здесь может оказаться очень полезным протокол DHCP.</span><span class="sxs-lookup"><span data-stu-id="1b7af-123">This is where the Dynamic Host Configuration Protocol (DHCP) is extremely useful.</span></span> <span data-ttu-id="1b7af-124">Протокол DHCP предназначен расширить основные функции BOOTP, включая полностью автоматизированное выделение IP-серверов и полностью динамическое выделение IP-адресов путем "аренды" IP-адреса клиенту на указанный период времени.</span><span class="sxs-lookup"><span data-stu-id="1b7af-124">DHCP is designed to extend the basic functionality of BOOTP to include completely automated IP server allocation and completely dynamic IP address allocation through "leasing" an IP address to a client for a specified period of time.</span></span> <span data-ttu-id="1b7af-125">Протокол DHCP можно также настроить для статического выделения IP-адресов, как в протоколе BOOTP.</span><span class="sxs-lookup"><span data-stu-id="1b7af-125">DHCP can also be configured to allocate IP addresses in a static manner like BOOTP.</span></span>

## <a name="dhcp-messages"></a><span data-ttu-id="1b7af-126">Сообщения DHCP</span><span class="sxs-lookup"><span data-stu-id="1b7af-126">DHCP Messages</span></span>

<span data-ttu-id="1b7af-127">Хотя протокол DHCP значительно расширяет функции протокола BOOTP, в DHCP используется тот же формат сообщений, что и в BOOTP, и поддерживаются те же варианты поставщиков, что и в BOOTP.</span><span class="sxs-lookup"><span data-stu-id="1b7af-127">Although DHCP greatly enhances the functionality of BOOTP, DHCP uses the same message format as BOOTP and supports the same vendor options as BOOTP.</span></span> <span data-ttu-id="1b7af-128">Для выполнения функций в протокол DHCP добавлены семь новых параметров, относящихся к DHCP:</span><span class="sxs-lookup"><span data-stu-id="1b7af-128">In order to perform its function, DHCP introduces seven new DHCP-specific options, as follows:</span></span>

| <span data-ttu-id="1b7af-129">Параметр</span><span class="sxs-lookup"><span data-stu-id="1b7af-129">Option</span></span>     | <span data-ttu-id="1b7af-130">Значение</span><span class="sxs-lookup"><span data-stu-id="1b7af-130">Value</span></span> | <span data-ttu-id="1b7af-131">Исходный домен</span><span class="sxs-lookup"><span data-stu-id="1b7af-131">Origin</span></span>                |
| ---------- | ----- | --------------------- |
| <span data-ttu-id="1b7af-132">DISCOVER</span><span class="sxs-lookup"><span data-stu-id="1b7af-132">DISCOVER</span></span>   | <span data-ttu-id="1b7af-133">(1)</span><span class="sxs-lookup"><span data-stu-id="1b7af-133">(1)</span></span>   | <span data-ttu-id="1b7af-134">(отправляется DHCP-клиентом)</span><span class="sxs-lookup"><span data-stu-id="1b7af-134">(sent by DHCP Client)</span></span> |
| <span data-ttu-id="1b7af-135">OFFER</span><span class="sxs-lookup"><span data-stu-id="1b7af-135">OFFER</span></span>      | <span data-ttu-id="1b7af-136">(2)</span><span class="sxs-lookup"><span data-stu-id="1b7af-136">(2)</span></span>   | <span data-ttu-id="1b7af-137">(отправляется DHCP-сервером)</span><span class="sxs-lookup"><span data-stu-id="1b7af-137">(sent by DHCP Server)</span></span> |
| <span data-ttu-id="1b7af-138">REQUEST</span><span class="sxs-lookup"><span data-stu-id="1b7af-138">REQUEST</span></span>    | <span data-ttu-id="1b7af-139">(3)</span><span class="sxs-lookup"><span data-stu-id="1b7af-139">(3)</span></span>   | <span data-ttu-id="1b7af-140">(отправляется DHCP-клиентом)</span><span class="sxs-lookup"><span data-stu-id="1b7af-140">(sent by DHCP Client)</span></span> |
| <span data-ttu-id="1b7af-141">DECLINE</span><span class="sxs-lookup"><span data-stu-id="1b7af-141">DECLINE</span></span>    | <span data-ttu-id="1b7af-142">(4)</span><span class="sxs-lookup"><span data-stu-id="1b7af-142">(4)</span></span>   | <span data-ttu-id="1b7af-143">(отправляется DHCP-клиентом)</span><span class="sxs-lookup"><span data-stu-id="1b7af-143">(sent by DHCP Client)</span></span> |
| <span data-ttu-id="1b7af-144">ACK</span><span class="sxs-lookup"><span data-stu-id="1b7af-144">ACK</span></span>        | <span data-ttu-id="1b7af-145">(5)</span><span class="sxs-lookup"><span data-stu-id="1b7af-145">(5)</span></span>   | <span data-ttu-id="1b7af-146">(отправляется DHCP-сервером)</span><span class="sxs-lookup"><span data-stu-id="1b7af-146">(sent by DHCP Server)</span></span> |
| <span data-ttu-id="1b7af-147">NACK</span><span class="sxs-lookup"><span data-stu-id="1b7af-147">NACK</span></span>       | <span data-ttu-id="1b7af-148"> (6)</span><span class="sxs-lookup"><span data-stu-id="1b7af-148">(6)</span></span>   | <span data-ttu-id="1b7af-149">(отправляется DHCP-сервером)</span><span class="sxs-lookup"><span data-stu-id="1b7af-149">(sent by DHCP Server)</span></span> |
| <span data-ttu-id="1b7af-150">RELEASE</span><span class="sxs-lookup"><span data-stu-id="1b7af-150">RELEASE</span></span>    | <span data-ttu-id="1b7af-151">(7)</span><span class="sxs-lookup"><span data-stu-id="1b7af-151">(7)</span></span>   | <span data-ttu-id="1b7af-152">(отправляется DHCP-клиентом)</span><span class="sxs-lookup"><span data-stu-id="1b7af-152">(sent by DHCP Client)</span></span> |
| <span data-ttu-id="1b7af-153">INFORM</span><span class="sxs-lookup"><span data-stu-id="1b7af-153">INFORM</span></span>     | <span data-ttu-id="1b7af-154">(8)</span><span class="sxs-lookup"><span data-stu-id="1b7af-154">(8)</span></span>   | <span data-ttu-id="1b7af-155">(отправляется DHCP-клиентом)</span><span class="sxs-lookup"><span data-stu-id="1b7af-155">(sent by DHCP Client)</span></span> |
| <span data-ttu-id="1b7af-156">FORCERENEW</span><span class="sxs-lookup"><span data-stu-id="1b7af-156">FORCERENEW</span></span> | <span data-ttu-id="1b7af-157">(9)</span><span class="sxs-lookup"><span data-stu-id="1b7af-157">(9)</span></span>   | <span data-ttu-id="1b7af-158">(отправляется DHCP-клиентом)</span><span class="sxs-lookup"><span data-stu-id="1b7af-158">(sent by DHCP Client)</span></span> |

## <a name="dhcp-communication"></a><span data-ttu-id="1b7af-159">Взаимодействие по протоколу DHCP</span><span class="sxs-lookup"><span data-stu-id="1b7af-159">DHCP Communication</span></span>

<span data-ttu-id="1b7af-160">DHCP-сервер использует протокол UDP для получения запросов DHCP-клиентов и передачи ответов.</span><span class="sxs-lookup"><span data-stu-id="1b7af-160">The DHCP Server utilizes the UDP protocol to receive DHCP Client requests and transmit responses.</span></span> <span data-ttu-id="1b7af-161">Перед получением IP-адреса выполняются отправка и получение сообщений UDP, в которых хранятся данные DHCP, с помощью широковещательного IP-адреса 255.255.255.255.</span><span class="sxs-lookup"><span data-stu-id="1b7af-161">Prior to having an IP address, UDP messages carrying the DHCP information are sent and received by utilizing the IP broadcast address of 255.255.255.255.</span></span> <span data-ttu-id="1b7af-162">Но если клиент знает адрес DHCP-сервера, он может отправлять одноадресные сообщения DHCP.</span><span class="sxs-lookup"><span data-stu-id="1b7af-162">However, if the Client knows the address of the DHCP Server it may send DHCP messages using unicast messages.</span></span>

## <a name="dhcp-server-state-machine"></a><span data-ttu-id="1b7af-163">Конечный автомат DHCP-сервера</span><span class="sxs-lookup"><span data-stu-id="1b7af-163">DHCP Server State Machine</span></span>

<span data-ttu-id="1b7af-164">DHCP-сервер реализуется в виде 2-этапного конечного автомата, выполняемого внутренним потоком DHCP, который создается во время обработки *nx_dhcp_server_create*.</span><span class="sxs-lookup"><span data-stu-id="1b7af-164">The DHCP Server is implemented as a two-step state machine processed by an internal DHCP thread that is created during *nx_dhcp_server_create* processing.</span></span> <span data-ttu-id="1b7af-165">Основными состояниями DHCP-сервера являются: получение сообщения DISCOVER от DHCP-клиента и получение сообщения REQUEST.</span><span class="sxs-lookup"><span data-stu-id="1b7af-165">The main states of DHCP Server are 1) receiving a DISCOVER message from a DHCP client and 2) receiving a REQUEST message.</span></span>

<span data-ttu-id="1b7af-166">Ниже приведены соответствующие состояния DHCP-клиента.</span><span class="sxs-lookup"><span data-stu-id="1b7af-166">Below are the corresponding DHCP Client states:</span></span>

- <span data-ttu-id="1b7af-167">**NX_DHCP_STATE_BOOT**: запуск с предыдущим IP-адресом.</span><span class="sxs-lookup"><span data-stu-id="1b7af-167">**NX_DHCP_STATE_BOOT**: Starting with a previous IP address</span></span>
- <span data-ttu-id="1b7af-168">**NX_DHCP_STATE_INIT**: запуск без предыдущего IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="1b7af-168">**NX_DHCP_STATE_INIT**: Starting with no previous IP address value</span></span>
- <span data-ttu-id="1b7af-169">**NX_DHCP_STATE_SELECTING**: ожидание ответа от любого DHCP-сервера.</span><span class="sxs-lookup"><span data-stu-id="1b7af-169">**NX_DHCP_STATE_SELECTING**: Waiting for a response from any DHCP server</span></span>
- <span data-ttu-id="1b7af-170">**NX_DHCP_STATE_REQUESTING**: DHCP-сервер определен, отправлен запрос IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="1b7af-170">**NX_DHCP_STATE_REQUESTING**: DHCP Server identified, IP address request sent</span></span>
- <span data-ttu-id="1b7af-171">**NX_DHCP_STATE_BOUND**: установлена аренда IP-адреса DHCP.</span><span class="sxs-lookup"><span data-stu-id="1b7af-171">**NX_DHCP_STATE_BOUND**: DHCP IP Address lease established</span></span>
- <span data-ttu-id="1b7af-172">**NX_DHCP_STATE_RENEWING**: пришло время продления аренды IP-адреса DHCP, запрошено продление.</span><span class="sxs-lookup"><span data-stu-id="1b7af-172">**NX_DHCP_STATE_RENEWING**: DHCP IP Address lease renewal time elapsed, renewal requested</span></span>
- <span data-ttu-id="1b7af-173">**NX_DHCP_STATE_REBINDING**: пришло время повторной привязки для аренды IP-адреса DHCP, запрошено продление.</span><span class="sxs-lookup"><span data-stu-id="1b7af-173">**NX_DHCP_STATE_REBINDING**: DHCP IP Address lease rebind time elapsed, renewal requested</span></span>
- <span data-ttu-id="1b7af-174">**NX_DHCP_STATE_FORCERENEW**: установлена аренда IP-адреса DHCP, сервером или приложением выполнено принудительное продление.</span><span class="sxs-lookup"><span data-stu-id="1b7af-174">**NX_DHCP_STATE_FORCERENEW**: DHCP IP Address lease established, force renewal by server or by application</span></span>
- <span data-ttu-id="1b7af-175">**NX_DHCP_STATE_FAILED**: сервер не найден или не получен ответ от сервера.</span><span class="sxs-lookup"><span data-stu-id="1b7af-175">**NX_DHCP_STATE_FAILED**: No server found or no response from server received</span></span>

## <a name="dhcp-additional-parameters"></a><span data-ttu-id="1b7af-176">Дополнительные параметры DHCP</span><span class="sxs-lookup"><span data-stu-id="1b7af-176">DHCP Additional Parameters</span></span>

<span data-ttu-id="1b7af-177">На сервере NetX DHCP применяется список параметров по умолчанию, которые задаются в настраиваемом параметре NX_DHCP_DEFAULT_SERVER_OPTION_LIST в файле *nx_dhcp_server.h*. Это позволяет предоставить DHCP-клиентам общие или критические параметры конфигурации сети, например адрес маршрутизатора или шлюза и DNS-сервер для DHCP-клиента.</span><span class="sxs-lookup"><span data-stu-id="1b7af-177">The NetX DHCP Server has a default list of option parameters which is set in the configurable option NX_DHCP_DEFAULT_SERVER_OPTION_LISTin *nx_dhcp_server.h* to supply DHCP Clients with common/critical network configuration parameters e.g. router or gateway address and DNS server for the DHCP Client.</span></span>

## <a name="dhcp-rfcs"></a><span data-ttu-id="1b7af-178">Документы RFC, которым соответствует протокол DHCP</span><span class="sxs-lookup"><span data-stu-id="1b7af-178">DHCP RFCs</span></span>

<span data-ttu-id="1b7af-179">Сервер NetX DHCP соответствует RFC 2132, RFC 2131 и связанным документам RFC.</span><span class="sxs-lookup"><span data-stu-id="1b7af-179">NetX DHCP Server is compliant with RFC2132, RFC2131, and related RFCs.</span></span>
