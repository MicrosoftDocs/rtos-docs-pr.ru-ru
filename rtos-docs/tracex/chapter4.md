---
title: Глава 4. Анализ производительности TraceX в ОСРВ Azure
description: В этой главе описывается средство анализа производительности TraceX в ОСРВ Azure.
author: philmea
ms.service: rtos
ms.topic: article
ms.date: 5/19/2020
ms.author: philmea
ms.openlocfilehash: 719f27ef54091e2db9eefa982ce0c27561079b5b3a254d3fd09cc46d8f66f252
ms.sourcegitcommit: 93d716cf7e3d735b18246d659ec9ec7f82c336de
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2021
ms.locfileid: "116788643"
---
# <a name="chapter-4---azure-rtos-tracex-performance-analysis"></a>Глава 4. Анализ производительности TraceX в ОСРВ Azure

В этой главе описывается средство анализа производительности TraceX в ОСРВ Azure.

## <a name="performance-analysis"></a>Анализ производительности

В TraceX имеется встроенный анализ производительности файлов трассировки. Доступны различные сведения, включая *профиль выполнения*, *популярные службы*, *использование стека потоков* и различные *статистические данные по производительности*, в том числе *статистика FileX и NetX*. Эта информация доступна через пункт меню ***Вид***. 


## <a name="execution-profile"></a>Профиль выполнения

При нажатии кнопки ***Создать профиль выполнения** _ или выборе пункта _*_Вид > Профиль-выполнение_*_ открывается профиль выполнения TraceX для загруженного в данный момент файла трассировки. Профиль выполнения, связанный с образцом трассировки ThreadX, показан на _*рисунке 19**.

![Снимок экрана: профиль выполнения, связанный с образцом трассировки ThreadX.](./media/user-guide/execution_profile.png)

**Рис. 19**

В примере на **рисунке 19** видно, что почти 45 % процессорного времени приходится на **_поток 2_ *_ и еще почти 51 % — на _* _поток 1_**. Это логично, так как из трассировки следует, что эти потоки активно отправляют и получают сообщения. На остальные контексты выполнения в этом примере приходится лишь небольшая доля времени выполнения.

## <a name="popular-services"></a>Популярные службы

Выбрав пункт ***Вид > Популярные службы**, можно просмотреть популярные службы в загруженном файле трассировки. По умолчанию эта информация отображается для всей системы. Однако также доступны популярные службы для конкретных потоков. Популярные службы в примере трассировки ThreadX показаны на _*рисунке 20**.

![Снимок экрана: популярные службы в примере трассировки ThreadX.](./media/user-guide/popular_services.png)

**Рис. 20**

В примере на **рисунке 20** видно, что двумя самыми популярными службами в этой трассировке являются **_tx_queue_send_ *_ и _* _tx_queue_receive_**. Это согласуется с поведением стандартной демонстрации ThreadX, из которой была получена трассировка.

Выбрать для анализа определенные потоки можно в раскрывающемся списке в верхней части этого окна. На **рисунке 21** показан анализ для **_потока 3_**.

![Снимок экрана: анализ для популярных служб TraceX.](./media/user-guide/popular_services_thread3.png)

**Рис. 21**

## <a name="thread-stack-usage-analysis-for-thread-3"></a>Использование стека потоков ![Анализ для потока 3.](./media/user-guide/screen_shot_17.png)

При нажатии кнопки ***Создать данные по использованию стека потоков** _ или выборе пункта _*_Вид > Использование стека потоков_*_ открываются данные по использованию стека для каждого потока в файле трассировки. Для этого ThreadX включает указатель на текущий стек потока в несколько записей трассировки в файле. Использование стека, равное 100 %, означает, что стек переполнен. Эту проблему необходимо устранить в приложении. Если в файле трассировки нет выполнения потока, использование стека для этого потока равно 0 %. Использование стека потока в образце трассировки ThreadX показано на _*рисунке 22**.

![Снимок экрана: использование стека потока TraceX.](./media/user-guide/thread_stack_usage.png)

**Рис. 22**

В примере на **рисунке 22** видно, что большинство потоков в этой трассировке имеют значение использования стека от 9 до 12 %.

## <a name="performance-statistics"></a>статистика производительности

При нажатии кнопки ***Создать статистику производительности** _ или выборе пункта _ *_Вид > Статистика производительности_** открывается статистика производительности для загруженного файла трассировки. По умолчанию эта информация отображается для всей системы. Однако статистика производительности также доступна для каждого конкретного потока.

Статистика производительности для образца трассировки ThreadX представлена на **рисунке 23**.

![Снимок экрана: статистика производительности TraceX.](./media/user-guide/performance_statistics.png)

**Рис. 23**

В примере на **рисунке 23** видно, что в этом файле трассировки было 18 переключений контекста, а также пять вытеснений потоков, 16 приостановок потоков, 19 возобновлений потоков и три прерывания. Инверсий приоритета в этом файле трассировки не найдено. Обратите внимание, что существует две категории инверсий приоритета, а именно *детерминированные* и *недетерминированные*. Детерминированные инверсии приоритета — это инверсия, при которых поток блокируется в мьютексе, принадлежащем потоку с более низким приоритетом. Недетерминированная инверсия приоритета происходит, когда другой поток с более низким приоритетом выполняется во время детерминированной инверсии приоритета. Это может привести к непредвиденному расчету времени в приложении и требует особого внимания.

## <a name="filex-statistics"></a>Статистика FileX

При выборе пункта ***Вид > Статистика FileX** _ открывается статистика производительности FileX для загруженного файла трассировки. Эта информация отображается для всей системы сразу, то есть по всем открытым объектам ../media. Статистика производительности для образца трассировки FileX представлена на _*рисунке 24**.

![Снимок экрана: статистика FileX.](./media/user-guide/filex_statistics.png)

**Рис. 24**

В примере на **рисунке 27** видно, чтоб было открыто 19 объектов ../media, закрыто 19 объектов ../media, записано на диск 19 объектов ../media, выполнено 18 операций чтения из каталога, 19 операций записи в каталог и произошло 18 промахов кэша для каталогов. Дополнительные сведения можно получить, прокрутив окно статистики вниз.

## <a name="netx-statistics"></a>Статистика NetX

При выборе пункта ***Вид > Статистика NetX** _ открывается статистика производительности NetX для загруженного файла трассировки. Эта информация отображается для всей системы. Статистика производительности для образца трассировки NetX представлена на _*рисунке 25**.

![Снимок экрана: статистика NetX.](./media/user-guide/netx_statistics.png)

**Рис. 25**

В примере на **рисунке 25** показано, что событий ARP, проверки связи или UDP не было, но было отправлено 30 IP-пакетов на 1368 байтов и получено 30 IP-пакетов на 1360 байтов.

## <a name="trace-file-information"></a>Сведения о файле трассировки

При выборе пункта ***Вид > Сведения о файле трассировки** _ открываются основные сведения о загруженном файле трассировки. Эти сведения включают в себя порядок байтов файла, размер источника времени, максимальное число байтов для каждого объекта и базовый адрес каждого указателя файла трассировки. На _ *рисунке 26** представлены сведения о стандартном файле трассировки **_demo_threadx.trx_**.

![Снимок экрана: сведения о файле TraceX.](./media/user-guide/trace_file_info.png)

**Рис. 26**

## <a name="raw-trace-dump"></a>Необработанный дамп трассировки

При выборе пункта ***Вид > Необработанный дамп трассировки** _ открывается диалоговое окно для указания имени файла с необработанным дампом трассировки. После ввода имени файла и пути к нему TraceX создает необработанный файл трассировки в текстовом формате и открывает его в _*_notepad.exe_*_. На _ *рисунке 27** представлен необработанный дамп для стандартного файла трассировки **_demo_threadx.trx_**.

![Снимок экрана: необработанный дамп трассировки.](./media/user-guide/raw_trace_dump.png)

**Рис. 27**
