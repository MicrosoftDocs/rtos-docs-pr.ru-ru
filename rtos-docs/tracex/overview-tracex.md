---
title: Общие сведения о TraceX для ОСРВ Azure
description: TraceX для ОСРВ Azure — это средство Майкрософт для анализа на основе узлов, которое предоставляет разработчикам графическое представление системных событий в реальном времени, позволяя им визуализировать и понимать поведение систем реального времени.
author: philmea
ms.author: philmea
ms.date: 5/19/2020
ms.service: rtos
ms.topic: overview
ms.openlocfilehash: 966f3be5ebe34e006067175e422480fbf1ab664bb0ff627d7b01e71036dc5e82
ms.sourcegitcommit: 93d716cf7e3d735b18246d659ec9ec7f82c336de
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2021
ms.locfileid: "116792186"
---
# <a name="overview-of-azure-rtos-tracex"></a>Обзор TraceX для ОСРВ Azure

TraceX для ОСРВ Azure — это средство Майкрософт для анализа на основе узлов, которое предоставляет разработчикам графическое представление системных событий в реальном времени, позволяя им визуализировать и понимать поведение систем реального времени. С помощью TraceX для ОСРВ Azure разработчики могут легко отслеживать возникновение системных событий, таких как прерывания и переключения контекста, которые не попадают в сферу контроля стандартных средств отладки. Возможность обнаруживать и изучать такие события, а также точно определять время их наступления в контексте работы всей системы позволяет разработчикам решать проблемы в программах. Они могут отслеживать неожиданное поведение и подробнее изучать конкретные области. Данные трассировки сохраняются на целевой системе в буфере, расположение и размер которого определяются приложением во время выполнения. TraceX для ОСРВ Azure умеет обрабатывать любой буфер, созданный надлежащим образом, не только с помощью ThreadX для ОСРВ Azure, но и любым приложением или ОСРВ. Данные трассировки можно в любой момент отправить на узел для анализа, даже после сбоя системы или во время паузы на точке останова. ThreadX для ОСРВ Azure предоставляет циклический буфер, который всегда сохраняет в доступной для анализа форме заданное число последних событий перед системным сбоем или другим важным событием.

![Отображение для одного ядра в TraceX для ОСРВ Azure](./media/user-guide/screen_shot_33.png)

**Отображение для одного ядра в TraceX**

## <a name="key-capabilites"></a>Основные возможности

### <a name="azure-rtos-tracex-built-in-system-analysis"></a>Встроенный анализ системы в TraceX для ОСРВ Azure

TraceX для ОСРВ Azure предоставляет встроенные отчеты для анализа системы, которые можно получить одним нажатием кнопки на панели инструментов TraceX. Доступные кнопки и отчеты:

![Создание отчета о профиле выполнения](./media/overview-tracex/execution-profile-report-button.jpg) Создание отчета о профиле выполнения

![Создание отчета о статистике производительности](./media/overview-tracex/performance-statistics-report-button.jpg) Создание отчета о статистике производительности

![Создание отчета об использовании стека потоков](./media/overview-tracex/thread-stack-usage-report-button.jpg) Создание отчета об использовании стека потоков

### <a name="trace-data-collected-by-azure-rtos-threadx"></a>Данные трассировки, собираемые в ThreadX для ОСРВ Azure

Система TraceX для ОСРВ Azure разработана для совместной работы со ThreadX для ОСРВ Azure, которая во время выполнения создает базу данных событий в системе и в приложениях на целевой системе. К этим событиям относятся:

* переключения контекста потоков;
* вытеснения;
* приостановки;
* завершения;
* системные прерывания;
* события приложений;
* все вызовы API ThreadX для ОСРВ Azure;
* все вызовы API NetX для ОСРВ Azure;
* все вызовы API FileX для ОСРВ Azure;
* все вызовы API USBX для ОСРВ Azure;
* значки и данные, определяемые приложением.

События записываются в раздел управления программой с метками времени и идентификаторами активного потока, чтобы их можно было позже отобразить в правильной последовательности и связать с соответствующим потоком. Программа приложения может останавливать и снова запускать ведение журнала событий динамически, например при возникновении важного контекста. Это позволяет не перегружать базу данных и не расходовать память в целевой системе, пока все работает нормально.

### <a name="azure-rtos-tracex-is-like-a-software-logic-analyzer"></a>TraceX для ОСРВ Azure выполняет роль анализатора программной логики.

После отправки журнала событий из памяти целевой системы на узел TraceX для ОСРВ Azure отображает эти события на графике, где горизонтальная ось представляет время, а по вертикальной оси разграничены разные потоки приложений и системные подпрограммы, с которыми связаны эти события. TraceX для ОСРВ Azure создает на узле анализатор программной логики, позволяя наглядно отслеживать системные события. Все события представлены значками с цветовым кодированием, которые размещаются в той точке относительно горизонтальной временной шкалы, которая соответствует времени их возникновения, справа от соответствующего потока или системной процедуры. Щелкнув значок события, вы можете отобразить соответствующие сведения для этого события и сведения о двух предыдущих и двух последующих событиях. Это позволяет одним щелчком быстро получить подробные данные о нескольких последовательных событиях. TraceX для ОСРВ Azure предоставляет отображение сводной информации, в котором все системные события размещены на одной горизонтальной линии, что упрощает анализ в многопоточных системах.

### <a name="sequential-view-mode"></a>Режим последовательного просмотра

Чтобы выбрать режим последовательного просмотра, щелкните вкладку "Sequential View" (Последовательный просмотр). Этот же режим используется по умолчанию. В нем все события следуют непосредственно друг за другом, независимо от прошедшего между ними времени. Обратите внимание также на линейку над областью просмотра. На ней отображается относительный номер события от начала трассировки. Этот режим используется по умолчанию и позволяет получить хорошее общее впечатление о событиях в системе.

![Режим последовательного просмотра](./media/user-guide/screen_shot_10.png)

**Режим последовательного просмотра**

### <a name="time-view-mode"></a>Режим временного просмотра

В этом режиме события отображаются с привязкой ко времени, и прошедшее между ними время обозначается сплошной зеленой полосой. Этот режим особенно полезен для понимания того, какое место в системе создает основную нагрузку, что позволяет разработчикам настроить систему для повышения производительности и (или) скорости реагирования.

Обратите внимание также на линейку над областью событий. На этой линейке показано количество тактов от начала трассировки, полученное на основе метки времени из журнала трассировки событий, созданной системой ThreadX для ОСРВ Azure. Если временные метки слишком близки (при высокой частоте таймера), события будут выполняться вместе. И наоборот, если промежуток между временными метками слишком велик (при низкой частоте таймера), события будут далеко друг от друга. Выбор правильной частоты для меток времени играет важную роль при анализе данных на временном представлении.

![Режим временного просмотра](./media/user-guide/screen_shot_31.png)

### <a name="system-summary-line"></a>Строка сводной информации о системе

TraceX для ОСРВ Azure также поддерживает единую строку со сводной информацией о всех событиях в системе. Эта строка содержит сводные данные о контексте и событиях. Это позволяет легко оценить состояние сложной системы. Строка сводки особенно полезна в системах с большим количеством потоков. Без нее пользователю придется отслеживать все сложные системные взаимодействия, постоянно перемещая вертикальную полосу прокрутки, чтобы следовать контексту выполнения.

TraceX для ОСРВ Azure отображает список системных контекстов в левой части экрана.
События, происходящие в определенном контексте, отображаются в горизонтальной строке справа от этого контекста. Так пользователь может легко определить, в каком контексте произошло событие, а также по строке контекста отследить все происходящие в нем события.

![Строка сводной информации о системе](./media/user-guide/screen_shot_32.png)

**Строка сводной информации о системе**

В списке контекстов первые две строки всегда содержат элементы Interrupt (Прерывание) и Initialize/Idle (Инициализация или бездействие). Контекст Interrupt (Прерывание) обозначает все системные события, созданные обработчиками прерываний (ISR). Контекст Initialize/Idle (Инициализация или бездействие) обозначает сразу два контекста ThreadX для ОСРВ Azure. События во время выполнения tx_application_define считаются событиями в контексте инициализации и размещаются в контексте Initialize/Idle (Инициализация или бездействие). Если система не выполняет каких-либо действий и в ней не создаются события, во временном представлении в контексте Initialize/Idle (Инициализация или бездействие) отображается зеленая полоса Running (Выполняется).

## <a name="methods-of-navigation"></a>Методы навигации

TraceX для ОСРВ Azure позволяет разработчику выбрать режим работы для кнопок навигации "Далее" и "Назад".

![Кнопки навигации](./media/user-guide/event.png)

Если выбран режим Event (Событие), происходит переход к предыдущему или следующему событию. Если выбран режим Context (Контекст), происходит переход к предыдущему или следующему событию в том же контексте. Если выбран режим Object (Объект), происходит переход к предыдущему или следующему событию в текущем объекте, например в определенной очереди. Если выбран режим Switches (Переключения), происходит переход к предыдущему или следующему переключению контекста. Если выбран режим Same ID (Тот же идентификатор), происходит переход к предыдущему или следующему событию с тем же идентификатором события.

### <a name="event-information-display"></a>Отображение сведений о событиях

TraceX для ОСРВ Azure предоставляет подробные сведения примерно о 300 событиях. К ним относятся шесть внутренних событий ThreadX для ОСРВ Azure, два события ISR (вход и выход), 14 внутренних событий FileX для ОСРВ Azure, 42 внутренних события NetX для ОСРВ Azure и одно определяемое пользователем событие. Остальные события напрямую соотносятся со службами API ThreadX для ОСРВ Azure, FileX для ОСРВ Azure и NetX для ОСРВ Azure.
Независимо от выбора последовательного или временного режима отображения, наведение указателя мыши на любое событие в области отображения позволяет отобразить рядом с ним подробные сведения об этом событии. Ниже представлен пример наведения указателя мыши на событие 494 в демонстрационном файле трассировки demo_threadx.trx:

![Дополнительные сведения при наведении мыши](./media/user-guide/screen_shot_37.png)

**Дополнительные сведения при наведении мыши**

Каждое отображаемое событие включает стандартные сведения о контексте, а также относительное время и метку времени. В поле Context отображается контекст, в котором произошло событие. Различаются ровно четыре контекста: поток, бездействие, ISR и инициализация. Если событие происходит в контексте потока, для него сохраняются и отображаются имя и приоритет потока, как показано выше. Поле Relative Time отображает относительное количество тактов таймера от начала трассировки. Поле Raw Time Stamp отображает необработанную метку времени для события. Наконец, отображаются все сведения, относящиеся к конкретному событию.

### <a name="zooming-in-and-out"></a>Увеличение и уменьшение масштаба

По умолчанию TraceX для ОСРВ Azure отображает события в удобном для просмотра размере, где каждый пиксель соответствует одному такту. При желании пользователь может увеличить или уменьшить масштаб. Уменьшение до масштаба 100 % полезно для просмотра полной трассировки в текущем представлении, а увеличение масштаба помогает в случаях, когда события перекрываются из-за низкого разрешения метки времени.

![Уменьшение масштаба до 100 % для общего просмотра или увеличение для детализации](./media/user-guide/screen_shot_41.png)

**Уменьшение масштаба до 100 % для общего просмотра или увеличение для детализации**

При уменьшении масштаба до 100 % на странице в выбранном режиме отображается вся трассировка, на которой легко отслеживать все контексты выполнения, собранные в этой трассировке, а также общие события в этих масштабах. Вы можете заметить, что потоки thread 1 и thread 2 выполняются чаще других. Синий цвет, которым обозначены события в них, означает, что эти потоки осуществляют вызовы к службе очередей (все события очередей имеют синий цвет).

Вы можете легко вернуться к просмотру значков в масштабе по умолчанию, несколько раз нажав кнопку увеличения масштаба или введя значение масштаба меньше 100.

### <a name="delta-ticks-between-events"></a>Разница в тактах между событиями

Определение количества тактов между разными событиями в TraceX для ОСРВ Azure выполняется очень легко: просто щелкните первое из событий и перетащите указатель ко второму событию.
В правом верхнем углу экрана появится количество тактов, прошедших между этими событиями.

![Разница в тактах](./media/user-guide/screen_shot_42.png)

**Разница в тактах**

Разница в тактах показывает, что между событием 494 и событием 496 прошло 5032 такта. Это значение можно вычислить вручную с помощью значений меток времени для каждого из событий, но сделать это в графическом пользовательском интерфейсе проще и быстрее.

### <a name="priority-inversions"></a>Инверсии приоритета

TraceX для ОСРВ Azure автоматически отображает инверсии приоритета, обнаруженные в файле трассировки. Инверсией приоритета называется такое состояние, при котором поток с более высоким приоритетом блокируется при попытке получения мьютекса, который принадлежит к потоку с более низким приоритетом. Такое состояние называется детерминированным, поскольку система специально настроена на такое поведение. Чтобы сообщить об этом пользователю, TraceX для ОСРВ Azure отображает промежутки детерминированных инверсий приоритета светлым оранжево-розовым цветом.

TraceX для ОСРВ Azure отображает и недетерминированные инверсии приоритета. Такие инверсии приоритета отличаются от детерминированных тем, что другой поток на другом уровне приоритета начал выполнение при уже существующей детерминированной инверсии приоритета. Это приводит к тому, что на некоторое время инверсия приоритета становится недетерминированной. Пользователь обычно не подозревает о наличии таких состояний, и они могут иметь серьезное влияние. Чтобы пользователь обратил внимание на эти ситуации, TraceX для ОСРВ Azure отображает недетерминированные инверсии приоритета более ярким оранжево-розовым цветом.

![Детерминированная и недетерминированная инверсии приоритета](./media/user-guide/screen_shot_43.png)

**Детерминированная и недетерминированная инверсии приоритета**

### <a name="execution-profile"></a>Профиль выполнения

TraceX для ОСРВ Azure предоставляет встроенный отчет о профиле выполнения для всех контекстов выполнения в текущем загруженном файле трассировки.

![Профиль выполнения](./media/user-guide/execution_profile.png)

### <a name="performance-statistics"></a>Performance statistics

TraceX для ОСРВ Azure предоставляет встроенный отчет по статистике производительности для текущего загруженного файла трассировки.

![Performance statistics](./media/user-guide/performance_statistics.png)

### <a name="thread-stack-usage"></a>Использование стека потоков

TraceX для ОСРВ Azure предоставляет встроенный отчет об использовании стека для всех потоков, которые выполняются в текущем загруженном файле трассировки.

![Использование стека](./media/user-guide/thread_stack_usage.png)

TraceX для ОСРВ Azure представляет статистику производительности FileX для ОСРВ Azure для текущего загруженного файла трассировки. Эта информация отображается для всей системы сразу, то есть по всем открытым медиаресурсам.

![Статистика FileX](./media/user-guide/filex_statistics.png)

### <a name="azure-rtos-netx-statistics"></a>Статистика NetX для ОСРВ Azure

TraceX для ОСРВ Azure также представляет статистику производительности NetX для текущего загруженного файла трассировки. Эта информация отображается для всей системы.

![Статистика NetX](./media/user-guide/netx_statistics.png)

### <a name="raw-trace-dump"></a>Необработанный дамп трассировки

TraceX для ОСРВ Azure может создать необработанный файл трассировки в текстовом формате и открыть его в блокноте.

![Необработанный дамп трассировки](./media/user-guide/raw_trace_dump.png)

Обратите внимание, что все приведенные сведения о времени и размере могут отличаться на вашей платформе разработки.
