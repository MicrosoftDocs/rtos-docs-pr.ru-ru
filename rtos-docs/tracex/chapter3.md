---
title: Глава 3. Описание ОСРВ Azure TraceX
description: В этой главе описываются общие функциональные возможности средства анализа систем ОСРВ Azure TraceX, включая общие функциональные возможности графического пользовательского интерфейса.
author: philmea
ms.service: rtos
ms.topic: article
ms.date: 5/19/2020
ms.author: philmea
ms.openlocfilehash: 1c974b353c92e0a3cf51c92818794197cf999582
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104815803"
---
# <a name="chapter-3---description-of-azure-rtos-tracex"></a>Глава 3. Описание ОСРВ Azure TraceX

В этой главе описываются общие функциональные возможности средства анализа систем ОСРВ Azure TraceX, включая общие функциональные возможности графического пользовательского интерфейса. 

## <a name="display-overview"></a>Обзор окна

На **рисунке 4** показано основное окно средства анализа систем TraceX. Его структура проста — контексты выполнения представлены вертикальными элементами слева. Например, инициализация, прерывание, простой и различные записи потока. События, происходящие в каждом контексте, отображаются горизонтально на линии этого контекста. Например, события **QR**, показанные ниже, показывают, что поток **_thread 2_*_ выполняет последовательные вызовы _*_tx_queue_receive_**.

![Снимок экрана: основное окно средства анализа систем TraceX.](./media/user-guide/screen_shot_10.png)


**Рисунок 5**

Изменения контекста представлены вертикальными черными линиями, соединяющими линии контекста. Текущее выбранное событие представлено вертикальной сплошной красной линией. В этом примере выбрано событие 494.

## <a name="title-bar"></a>Title Bar

Строка заголовка TraceX содержит несколько элементов с полезными сведениями. Первый — это текущая версия TraceX. Второй — это полный путь к текущему открытому файлу трассировки. В примере на **рисунке 6** показано окно **_TraceX_*_ версии _*_6.0.0_*_, в котором отображен файл трассировки _*_demo_threadx.trx_**.

![Снимок экрана: строка заголовка TraceX.](./media/user-guide/screen_shot_11.png)

**Рисунок 6**

## <a name="tool-bar"></a>Tool Bar

Панель инструментов TraceX содержит несколько кнопок и других элементов управления, служащих для открытия файлов трассировки и управления их отображением.

![Снимок экрана: панель инструментов TraceX.](./media/user-guide/screen_shot_12.png)


**Рисунок 7**

Кнопки панели инструментов TraceX (слева направо) описаны ниже.
                                             
| **Кнопка**                         | **Компонент** |
| ---------------------------------- | ----------------------------------------------------------------------------------------------- |
| ![Кнопка открытия файла трассировки](./media/user-guide/screen_shot_13.png)      | Открытие файла трассировки. |
| ![Кнопка открытия руководства пользователя](./media/user-guide/screen_shot_14.png)      | Открытие этого руководства пользователя. |
| ![Кнопка создания отчета о профиле выполнения](./media/user-guide/screen_shot_15.png)       | Создание отчета о профиле выполнения. |
| ![ Кнопка создания отчета о статистике производительности](./media/user-guide/screen_shot_16.png)       | Создание отчета о статистике производительности. |
| ![Кнопка создания отчета об использовании стека потоков](./media/user-guide/screen_shot_17.png)       | Создание отчета об использовании стека потоков. |
| ![Кнопка отображения выбранного события](./media/user-guide/screen_shot_18.png)       | Отображение текущего выбранного события. |
| ![Кнопка поиска](./media/user-guide/screen_shot_19.png)      | Поиск событий. |
| ![Кнопка увеличения масштаба](./media/user-guide/screen_shot_20.png)      | Увеличить масштаб |
| ![Кнопка масштабирования](./media/user-guide/screen_shot_21.png)      | Позволяет выбрать процентное значение масштаба отображения, где 100 % означает, что весь файл трассировки отображается в текущем представлении. |
| ![Кнопка уменьшения масштаба](./media/user-guide/screen_shot_22.png)      | Уменьшить масштаб |
| ![Кнопка выбора первого события](./media/user-guide/screen_shot_23.png)      | Выбор первого события. |
| ![Кнопка отображения предыдущей страницы событий](./media/user-guide/screen_shot_24.png)      | Отображение предыдущей страницы событий. |
| ![Кнопка отображения предыдущего события](./media/user-guide/screen_shot_25.png)      | Отображение предыдущего события. |
| ![Кнопка перехода вперед или назад](./media/user-guide/screen_shot_26.png)      | Позволяет определить, как работают кнопки перехода перед и назад. Если выбран режим **Event** _ (Событие), происходит переход к предыдущему или следующему событию. Если выбран режим _*_Context_*_ (Контекст), происходит переход к предыдущему или следующему событию в указанном контексте. Если выбран режим _*_Object_*_ (Объект), происходит переход к предыдущему или следующему событию в указанном объекте, например в определенной очереди. Если выбран режим _*_Switches_*_ (Переключения), происходит переход к предыдущему или следующему изменению контекста. Если выбран режим _ *_ID_* (Идентификатор), происходит переход к предыдущему или следующему событию с указанным идентификатором события. |
| ![Кнопка отображения следующего события](./media/user-guide/screen_shot_27.png)      | Отображение следующего события. |
| ![Кнопка отображения следующей страницы событий](./media/user-guide/screen_shot_28.png)      | Отображение следующей страницы событий. |
| ![Кнопка выбора последнего события](./media/user-guide/screen_shot_29.png)      | Выбор последнего события. |

## <a name="display-mode-tabs"></a>Вкладки режима отображения

TraceX отображает системные события двумя разными способами: *последовательно* и *по времени*. По умолчанию используется последовательный режим, который показан на **рисунке 8**.

Для изменения режима достаточно выбрать вкладку ***Sequential View** _ (Последовательное представление) или _*_Time View_*_ (Временное представление) в окне TraceX. _*На рисунке 8** показаны вкладки **_Sequential View_*_ (Последовательное представление) и _ *_Time View_*** (Временное представление).

![Снимок экрана: вкладки "Sequential View" (Последовательное представление) и "Time View" (Временное представление).](./media/user-guide/screen_shot_30.png)

**Рисунок 8**

## <a name="sequential-view-mode"></a>Режим последовательного просмотра

Режим последовательного просмотра можно выбрать с помощью вкладки ***Sequential View** _ (Последовательное представление), показанной на _*рисунке 8**. Это режим по умолчанию. В нем все события следуют непосредственно друг за другом, независимо от прошедшего между ними времени. Обратите внимание также на линейку над областью просмотра на **рисунке 8**. На ней отображается относительный номер события от начала трассировки.

Этот режим используется по умолчанию и позволяет получить хорошее общее впечатление о событиях в системе.

## <a name="time-view-mode"></a>Режим временного просмотра

Режим временного просмотра можно выбрать кнопкой ***Time View** _ (Временное представление). На _ *рисунке 9** показана та же трассировка событий, что и на **рисунке 8**, только в режиме временного просмотра. В этом режиме события отображаются с привязкой ко времени, и прошедшее между ними время обозначается сплошной зеленой полосой. Этот режим удобен для понимания, какое место в системе создает основную нагрузку, что позволяет разработчикам настроить систему для повышения производительности и (или) скорости реагирования.

![Снимок экран: вкладка "Time View" (Временное представление)](./media/user-guide/screen_shot_31.png)

**Рисунок 9**

Обратите внимание также на линейку над областью событий на **рисунке 9**. На этой линейке показано количество тактов с начала трассировки, полученное на основе метки времени из журнала трассировки событий в ThreadX. Если метки времени слишком близкие (при низкой частоте таймера), события будут выполняться вместе. И наоборот, если метки времени слишком отдалены (при высокой частоте таймера), события будут выполняться далеко друг от друга. Выбор правильной частоты для меток времени играет важную роль при анализе данных на временном представлении.

## <a name="system-summary-line"></a>Строка сводной информации о системе

TraceX также поддерживает единую строку со сводной информацией о всех событиях в системе (верхний контекст на **рисунке 10**). Это позволяет легко оценить состояние сложной системы. Строка сводки особенно удобна в системах с большим количеством потоков. Без нее придется отслеживать все сложные системные взаимодействия, постоянно перемещая вертикальную полосу прокрутки, чтобы следовать контексту выполнения.

![Снимок экрана: строка сводкой информации о системе на вкладке "Sequential View" (Последовательное представление).](./media/user-guide/screen_shot_32.png)


**Рисунок 10**

Строка сводной информации содержит данные о контексте и соответствующих событиях. В примере на **рисунке 10** легко увидеть, что поток **_thread 2_*_ выполнялся и был прерван. Прерывание приводит к вытеснению потоками _*_thread 3_**, ***thread 6** _, _*_thread 4_*_ и _*_thread 7_*_, после которых поток _ *_thread 2_** возобновляет выполнение.

## <a name="system-contexts"></a>Контексты системы

TraceX отображает список контекстов системы в левой части окна (см. **рисунок 11**). События, происходящие в определенном контексте, отображаются в горизонтальной строке справа от этого контекста. Таким образом можно легко определить, в каком контексте произошло событие, а также по строке контекста отследить все происходящие в нем события.

В списке контекстов первые строки всегда содержат контексты ***Interrupt** _ (Прерывание) и _*_Initialize/Idle_*_ (Инициализация или бездействие). Контекст _*_Interrupt_*_ (Прерывание) представляет все системные события, созданные подпрограммами обработки прерываний (IRS). Контекст _*_Initialize/Idle_*_ (Инициализация или бездействие) представляет сразу два контекста в ThreadX. События, происходящие во время _*_tx_application_define_*_, являются контекстом _*_Initialize/Idle_*_ (Инициализация или бездействие). Если система не выполняет никаких действий и в ней не происходят события, во временном представлении в контексте _*_Initialize/Idle_*_ (Инициализация или бездействие) отображается зеленая полоса _ *_Running_** (Выполняется).

![Снимок экрана: контексты системы в левой части окна.](./media/user-guide/screen_shot_33.png)

**Рисунок 11**

В примере на **рисунке 11** показаны девять контекстов потоков, начиная с контекста **_System Timer Thread_*_ (Поток системного таймера). Дополнительные сведения о конкретном контексте можно получить, наведя указатель мыши на него. Дополнительные сведения о потоке включают в себя начальный адрес стека, конечный адрес стека, общий размер, процент использования, относительный процент выполнения, число приостановок и возобновлений, а также самый высокий и низкий приоритет во время трассировки. На _* рисунке 12** показаны сведения о потоке **_thread 0_**.

![Снимок экрана: сведения о потоке thread 0.](./media/user-guide/screen_shot_34.png)


**Рисунок 12**

Контексты также можно перемещать, чтобы группировать по важности. Для этого можно перетащить контекст или щелкнуть его правой кнопкой мыши. Если щелкнуть контекст правой кнопкой мыши, откроется диалоговое окно для перемещения контекста вверх или вниз. 

Если выбрать ***Move to top** _ (Переместить вверх), то контекст _*_thread 3_*_ переместится в начало списка контекстов, как показано на _*рисунке 13**.

![Снимок экрана: перемещение контекста в начало списка контекстов.](./media/user-guide/screen_shot_35.png)


**Рисунок 13**

## <a name="thread-status-information"></a>Сведения о состоянии потока

Если эта функция включена, TraceX отображает состояние каждого потока с помощью цветной линии в контексте потока. Зеленая линия указывает, что поток находится в состоянии "Ready" (Готово), а строка любого другого цвета указывает, что поток приостановлен. Цвет линии приостановленных потоков строки указывает тип объекта ThreadX, на котором приостановлен поток. Например, на **рисунке 13** зеленая линия в контексте **System Timer Thread_ (Поток системного таймера) после события 147 показывает, что поток System Timer Thread_ (Поток системного таймера) был готов. Отсутствие зеленой линии до события 147 и после события 154 указывает, что поток _System Timer Thread*_ (Поток системного таймера) былприостановлен.

![Снимок экрана: отображение состояния каждого потока с помощью цветных линий в контексте.](./media/user-guide/screen_shot_36.png)

**Рисунок 14**

Существуют три режима отображения состояния потока, они доступны в меню ***Options > Status Lines** _ (Параметры > Строки состояния). Параметр _*_Ready Only_*_ (Только готовые) отображает только строки состояния готовности (зеленые), но не отображает строки состояния приостановки. Это параметр по умолчанию в TraceX. Параметр _ *_All On_** (Включить все) позволяет отобразить все строки состояния (готовность и приостановка).

Наконец, параметр ***All Off*** (Выключить все) отключает отображение всех строк состояния.

## <a name="event-information-display"></a>Отображение сведений о событиях

TraceX предоставляет подробные сведения примерно о 600 событиях времени выполнения, включая вызовы API ThreadX, FileX, NetX, NetX Duo, USBX и внутренние события. TraceX также поддерживает дополнительно 61 439 уникальных определяемых пользователем событий.

Независимо от выбора последовательного или временного режима отображения, наведение указателя мыши на любое событие в области отображения позволяет отобразить рядом с ним подробные сведения об этом событии. Ниже представлен пример наведения указателя мыши на событие 143 в демонстрационном файле трассировки ***demo_threadx.trx** _ (см. _*рисунок 15**).

![Снимок экрана: указатель мыши наведен на событие 143 в примере файла трассировки.](./media/user-guide/screen_shot_37.png)

**Рисунок 15**

Каждое отображаемое событие содержит стандартные сведения о ***контексте** _, а также _*_относительное время_*_ и _*_метку времени_*_. В поле "Context" (Контекст) отображается контекст, в котором произошло событие. Различаются ровно четыре контекста: поток, бездействие, ISR и инициализация. Когда событие происходит в контексте потока, для него сохраняются и отображаются имя и приоритет потока, как показано выше. Поле _*_Relative Time_*_ (Относительное время) отображает относительное количество тактов таймера от начала трассировки. Поле _ *_Raw Time Stamp_** (Необработанная метка времени) отображает необработанную метку времени для события. Наконец, отображаются все сведения, относящиеся к конкретному событию. Эта информация подробно описана в оставшейся части этой главы.

Подробные сведения о событии можно также получить, дважды щелкнув любое событие. Двойной щелчок события 143 показан на **рисунке 16**.

![Снимок экрана: подробные сведения о событии при двойном щелчке этого события.](./media/user-guide/screen_shot_38.png)

**Рисунок 16**

Возможность просмотра нескольких событий одновременно позволяет пользователю получить намного более подробное представление о том, что произошло. Одновременное отображение событий весьма удобно, так как многие события взаимосвязаны. Для этого нужно дважды щелкнуть несколько событий.

## <a name="current-event-display"></a>Отображение текущего события

TraceX отображает текущее событие в отдельном окне, если пользователь выбрал ***View > Current Event*** (Просмотр > Текущее событие) или нажал кнопку текущего события на панели инструментов. После этого TraceX отображает выбранное текущее событие в отдельном окне и обновляет это окно каждый раз, когда выбирается другое событие.

## <a name="event-searching"></a>Поиск событий

TraceX предоставляет широкие возможности поиска событий. Поля "Event ID" (Идентификатор события) и "Information" (Информация) для каждого события являются основными параметрами поиска. Если не указать значение параметра поиска, это означает, что параметр фактически удаляется из поиска. Кроме того, можно выполнить поиск таким образом, чтобы условиям поиска соответствовал любой из найденных параметров или все эти параметры. Поиск может быть ограничен определенным контекстом или охватывать все контексты в трассировке. Для вызова поиска событий необходимо нажать кнопку ***Search by Value** _ (Искать по значению) на панели инструментов, как показано на _*рисунке 17**. Она открывает диалоговое окно поиска, в котором указываются все параметры поиска. Затем с помощью кнопок **_Next_*_ (Далее) и _*_Previous_*_ (Назад) в диалоговом окне поиска можно искать следующие и предыдущие события, соответствующие заданным условиям поиска. На _ *рисунке 17** показано диалоговое окно поиска.

![Снимок экрана: поиск событий.](./media/user-guide/screen_shot_39.png)

**Рисунок 17**

![Снимок экрана: диалоговое окно поиска.](./media/user-guide/screen_shot_40.png)

**Рисунок 18**

## <a name="zooming-in-and-out"></a>Увеличение и уменьшение масштаба

По умолчанию TraceX отображает события в полном размере. При желании можно увеличить или уменьшить масштаб. Уменьшение масштаба удобно для просмотра всех событий, записанных в трассировке, а уменьшать масштаб удобно в случаях, когда события перекрываются из-за разрешения источника метки времени. На **рисунке 19** показан файл **_demo_threadx. trx_** в меньшем масштабе, что позволяет отобразить весь файл трассировки.

![Снимок экрана: пример файла показан в меньшем масштабе, что позволяет отобразить весь файл трассировки.](./media/user-guide/screen_shot_41.png)

**Рисунок 19**

При уменьшении масштаба до 100 % на странице в выбранном режиме отображается вся трассировка, в которой легко отслеживать все контексты выполнения, записанные в данную трассировку, а также общие события, происходящие в этих контекстах. На **рисунке 16** можно заметить, что потоки **_thread 1_*_ и _*_thread 2_** выполняются чаще других. Синий цвет, которым обозначены события в них, также подсказывает, что эти потоки осуществляют вызовы к службе очередей (все события очередей имеют синий цвет).

Вы можете легко вернуться к просмотру значков в масштабе по умолчанию, несколько раз нажав кнопку увеличения масштаба или введя значение масштаба меньше 100.

## <a name="delta-ticks-between-events"></a>Разница в тактах между событиями

Определить количество тактов между разными событиями в TraceX очень легко: просто щелкните начальное событие и перетащите указатель к конечному событию. В правом верхнем углу окна появится количество тактов, прошедших между этими событиями (см. **рисунок 17**).

![Снимок экрана: разница в тактах между событиями.](./media/user-guide/screen_shot_42.png)

**Рисунок 17**

Разница в тактах на **рисунке 17** показывает, что между событием 125 и событием 154 прошло 5032 такта. Это значение можно вычислить вручную, вычтя значения меток времени для каждого из событий, но использовать графический пользовательский интерфейс проще и быстрее.

## <a name="actual-time-display"></a>Отображение фактического времени

Если эта функция включена, TraceX отображает фактическое время в микросекундах в режиме ***Time View** _ (Временное представление), а также при отображении различных данных об изменении времени. По умолчанию отображение фактического времени отключено. Чтобы включить отображение фактического времени, в меню _ *_Options > Ticks per Microsecond_*** (Параметры > Число тактов в микросекунде) следует указать число тактов в микросекунде (это значение определяется источником аппаратного таймера, используемым для ведения журнала событий TraceX на целевом оборудовании).

## <a name="priority-inversions"></a>Инверсии приоритета

TraceX автоматически отображает инверсии приоритета, обнаруженные в файле трассировки. Инверсией приоритета называется такое состояние, при котором поток с более высоким приоритетом блокируется при обращении к мьютексу, который принадлежит к потоку с более низким приоритетом. Такое состояние называется *детерминированным*, так как система специально настроена для такого поведения. Чтобы сообщить об этом пользователю, TraceX отображает *детерминированные* инверсии приоритета светло-оранжевым цветом.

Также TraceX отображает и *недетерминированные* инверсии приоритета. Такие инверсии приоритета отличаются от *детерминированных* тем, что другой поток на другом уровне приоритета начал выполнение при уже существующей *детерминированной* инверсии приоритета. Это приводит к тому, что на некоторое время инверсия приоритета становится *недетерминированной*. Пользователь обычно не подозревает о наличии таких состояний, и они могут иметь серьезное влияние. Чтобы пользователь обратил внимание на эти ситуации, TraceX отображает *недетерминированные* инверсии приоритета ярким оранжевым цветом. На **рисунке 18** показаны *детерминированные* и *недетерминированные* инверсии приоритета.

![Снимок экрана: инверсия приоритета в файле трассировки.](./media/user-guide/screen_shot_43.png)

**Рисунок 18**

На **рисунке 18** показана *детерминированная* инверсия приоритета с события 398 по событие 402. В этом диапазоне на мьютексе, принадлежащем к потоку _*_thread 1_*_ с более низким приоритетом, блокируется поток ***thread 0** _ с более высоким приоритетом. На событии 402 поток _ *_thread 1_** освобождает мьютекс и тем самым завершает инверсию приоритета.

Светлая затененная область отображает *недетерминированную* инверсию приоритета с события 408 по событие 420. Эта инверсия *недетерминированная*, так как поток ***thread 1** _ содержит мьютекс, блокирующий поток _*_thread 0_*_ с более высоким приоритетом. Происходит прерывание, возобновляющее выполнение потока _*_thread 2_**, что приводит к увеличении времени, в течение которого в системе происходит инверсия приоритета. Эта ситуация может быть довольно серьезной и трудно выявляемой. Однако TraceX позволяет легко ее идентифицировать.
