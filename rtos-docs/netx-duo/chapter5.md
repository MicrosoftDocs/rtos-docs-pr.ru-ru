---
title: Глава 5. Сетевые драйверы NetX Duo для ОСРВ Azure
description: В этой главе содержится описание сетевых драйверов NetX Duo для ОСРВ Azure.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: ede57b7512f4a1a4c30759f428962739aaa2777c
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104814843"
---
# <a name="chapter-5---azure-rtos-netx-duo-network-drivers"></a><span data-ttu-id="80115-103">Глава 5. Сетевые драйверы NetX Duo для ОСРВ Azure</span><span class="sxs-lookup"><span data-stu-id="80115-103">Chapter 5 - Azure RTOS NetX Duo Network Drivers</span></span>

<span data-ttu-id="80115-104">В этой главе содержится описание сетевых драйверов NetX Duo для ОСРВ Azure.</span><span class="sxs-lookup"><span data-stu-id="80115-104">This chapter contains a description of network drivers for Azure RTOS NetX Duo.</span></span> <span data-ttu-id="80115-105">Представленная информация призвана помочь разработчикам в написании сетевых драйверов для конкретных приложений для NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="80115-105">The information presented is designed to help developers write application-specific network drivers for NetX Duo.</span></span>

## <a name="driver-introduction"></a><span data-ttu-id="80115-106">Знакомство с драйвером</span><span class="sxs-lookup"><span data-stu-id="80115-106">Driver Introduction</span></span>

<span data-ttu-id="80115-107">Структура NX_IP содержит все, что нужно для управления одним экземпляром IP.</span><span class="sxs-lookup"><span data-stu-id="80115-107">The NX_IP structure contains everything to manage a single IP instance.</span></span> <span data-ttu-id="80115-108">Сюда входят общие сведения о протоколе TCP/IP, а также подпрограмма входа драйвера физической сети для конкретного приложения.</span><span class="sxs-lookup"><span data-stu-id="80115-108">This includes general TCP/IP protocol information as well as the application-specific physical network driver's entry routine.</span></span> <span data-ttu-id="80115-109">Подпрограмма входа драйвера определяется во время работы службы \***nx_ip_create** _.</span><span class="sxs-lookup"><span data-stu-id="80115-109">The driver's entry routine is defined during the \***nx_ip_create** _ service.</span></span> <span data-ttu-id="80115-110">К экземпляру IP можно добавить дополнительные устройства через службу _ \*_nx_ip_interface_attach_\*\*.</span><span class="sxs-lookup"><span data-stu-id="80115-110">Additional devices may be added to the IP instance via the _ *_nx_ip_interface_attach_*\* service.</span></span>

<span data-ttu-id="80115-111">Обмен данными между NetX Duo и сетевым драйвером приложения осуществляется с помощью структуры запроса **NX_IP_DRIVER**.</span><span class="sxs-lookup"><span data-stu-id="80115-111">Communication between NetX Duo and the application's network driver is accomplished through the **NX_IP_DRIVER** request structure.</span></span> <span data-ttu-id="80115-112">Эта структура чаще всего определяется локально в стеке вызывающего объекта и поэтому освобождается после возврата управления драйвером и вызывающей функцией.</span><span class="sxs-lookup"><span data-stu-id="80115-112">This structure is most often defined locally on the caller's stack and is therefore released after the driver and calling function return.</span></span> <span data-ttu-id="80115-113">Структура определена следующим образом.</span><span class="sxs-lookup"><span data-stu-id="80115-113">The structure is defined as follows.</span></span>

```c
typedef struct NX_IP_DRIVER_STRUCT
{
      UINT           nx_ip_driver_command;
      UINT           nx_ip_driver_status;
      ULONG          nx_ip_driver_physical_address_msw;
      ULONG          nx_ip_driver_physical_address_lsw;
      NX_PACKET      *nx_ip_driver_packet;
      ULONG          *nx_ip_driver_return_ptr;
      NX_IP          *nx_ip_driver_ptr;
      NX_INTERFACE   *nx_ip_driver_interface;01
} NX_IP_DRIVER;
```
## <a name="driver-entry"></a><span data-ttu-id="80115-114">Вход в драйвер</span><span class="sxs-lookup"><span data-stu-id="80115-114">Driver Entry</span></span> 

<span data-ttu-id="80115-115">NetX Duo вызывает функцию входа сетевого драйвера для инициализации драйвера и отправки пакетов, а также для различных операций управления и изменения состояния, включая инициализацию и включение сетевого устройства.</span><span class="sxs-lookup"><span data-stu-id="80115-115">NetX Duo invokes the network driver entry function for driver initialization and for sending packets and for various control and status operations, including initializing and enabling the network device.</span></span> <span data-ttu-id="80115-116">NetX Duo выдает команды сетевому драйверу, задавая поле \***nx_ip_driver_command** _ в структуре запроса _ \*NX_IP_DRIVER\*\*.</span><span class="sxs-lookup"><span data-stu-id="80115-116">NetX Duo issues commands to the network driver by setting the ***nx_ip_driver_command** _ field in the _ *NX_IP_DRIVER** request structure.</span></span> <span data-ttu-id="80115-117">Функция входа драйвера имеет следующий формат.</span><span class="sxs-lookup"><span data-stu-id="80115-117">The driver entry function has the following format:</span></span>

```c
VOID my_driver_entry(NX_IP_DRIVER *request);
```
## <a name="driver-requests"></a><span data-ttu-id="80115-118">Запросы драйвера</span><span class="sxs-lookup"><span data-stu-id="80115-118">Driver Requests</span></span>

<span data-ttu-id="80115-119">NetX Duo создает запрос драйвера с определенной командой и вызывает функцию входа драйвера для выполнения этой команды.</span><span class="sxs-lookup"><span data-stu-id="80115-119">NetX Duo creates the driver request with a specific command and invokes the driver entry function to execute the command.</span></span> <span data-ttu-id="80115-120">Так как каждый сетевой драйвер имеет одну функцию входа, NetX Duo делает все запросы через структуру данных запроса драйвера.</span><span class="sxs-lookup"><span data-stu-id="80115-120">Because each network driver has a single entry function, NetX Duo makes all requests through the driver request data structure.</span></span> <span data-ttu-id="80115-121">Элемент ***nx_ip_driver_command** _ структуры данных запроса драйвера ( _*NX_IP_DRIVER\*\*) определяет запрос. Сведения о состоянии передаются обратно вызывающему объекту в элементе \**_nx_ip_driver_status_*_.</span><span class="sxs-lookup"><span data-stu-id="80115-121">The ***nx_ip_driver_command** _ member of the driver request data structure (_*NX_IP_DRIVER\*\*) defines the request. Status information is reported back to the caller in the member \**_nx_ip_driver_status_*_.</span></span> <span data-ttu-id="80115-122">Если это поле имеет значение _\*NX_SUCCESS\*\*, запрос драйвера был успешно выполнен.</span><span class="sxs-lookup"><span data-stu-id="80115-122">If this field is _\*NX_SUCCESS\*\*, the driver request was completed successfully.</span></span>

<span data-ttu-id="80115-123">NetX Duo сериализует все операции доступа к драйверу.</span><span class="sxs-lookup"><span data-stu-id="80115-123">NetX Duo serializes all access to the driver.</span></span> <span data-ttu-id="80115-124">Таким образом, драйверу не требуется выполнять асинхронный вызов функции входа в нескольких потоках.</span><span class="sxs-lookup"><span data-stu-id="80115-124">Therefore, the driver does not need to handle multiple threads asynchronously calling the entry function.</span></span> <span data-ttu-id="80115-125">Обратите внимание, что функция драйвера устройства выполняется с заблокированным IP-мьютексом.</span><span class="sxs-lookup"><span data-stu-id="80115-125">Note that the device driver function executes with the IP mutex locked.</span></span> <span data-ttu-id="80115-126">Поэтому внутренняя функция драйвера устройства не должна блокировать саму себя.</span><span class="sxs-lookup"><span data-stu-id="80115-126">Therefore the device driver internal function shall not block itself.</span></span>

<span data-ttu-id="80115-127">Как правило, драйвер устройства также обрабатывает прерывания.</span><span class="sxs-lookup"><span data-stu-id="80115-127">Typically the device driver also handles interrupts.</span></span> <span data-ttu-id="80115-128">Поэтому все функции драйвера должны быть надежными.</span><span class="sxs-lookup"><span data-stu-id="80115-128">Therefore, all driver functions need to be interrupt-safe.</span></span>

### <a name="driver-initialization"></a><span data-ttu-id="80115-129">Инициализация драйвера</span><span class="sxs-lookup"><span data-stu-id="80115-129">Driver Initialization</span></span>   
<span data-ttu-id="80115-130">Хотя фактическая обработка инициализации драйвера зависит от приложения, она обычно состоит из структуры данных и физической инициализации устройства.</span><span class="sxs-lookup"><span data-stu-id="80115-130">Although the actual driver initialization processing is application specific, it usually consists of data structure and physical hardware initialization.</span></span> <span data-ttu-id="80115-131">Сведения, необходимые NetX Duo для инициализации драйвера, — это максимальный передаваемый блок данных (MTU) IP, то есть возможное количество байтов полезной нагрузки на уровне протокола IP, включая заголовок IPv4 или IPv6, а также необходимость сопоставления "логический к физическому" для физического интерфейса.</span><span class="sxs-lookup"><span data-stu-id="80115-131">The information required from NetX Duo for driver initialization is the IP Maximum Transmission Unit (MTU), which is the number of bytes available to the IP-layer payload, including IPv4 or IPv6 header) and if the physical interface needs logical-to-physical mapping.</span></span> <span data-ttu-id="80115-132">Драйвер настраивает значение MTU для интерфейса, вызывая ***nx_ip_interface_mtu_set***.</span><span class="sxs-lookup"><span data-stu-id="80115-132">The driver configures the interface MTU value by calling ***nx_ip_interface_mtu_set***.</span></span>

<span data-ttu-id="80115-133">Драйверу устройства необходимо вызвать \***nx_ip_interface_address_mapping_configure** _, чтобы уведомить NetX Duo о необходимости сопоставления адресов интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="80115-133">The device driver needs to call \***nx_ip_interface_address_mapping_configure** _ to inform NetX Duo whether or not interface address mapping is required.</span></span> <span data-ttu-id="80115-134">Если сопоставление адресов требуется, драйвер отвечает за настройку допустимого MAC-адреса для интерфейса и передачу этого MAC-адреса в NetX с помощью _\*_nx_ip_interface_physical_address_set_\*\*.</span><span class="sxs-lookup"><span data-stu-id="80115-134">If address mapping is needed, the driver is responsible for configuring the interface with valid MAC address, and supply the MAC address to NetX via _\*_nx_ip_interface_physical_address_set_\*\*.</span></span>

<span data-ttu-id="80115-135">Когда сетевой драйвер принимает запрос NX_LINK INITIALIZE из NetX Duo, он получает указатель на управляющий блок IP в рамках управляющего блока запроса NX_IP_DRIVER, показанного выше.</span><span class="sxs-lookup"><span data-stu-id="80115-135">When the network driver receives the NX_LINK INITIALIZE request from NetX Duo, it receives a pointer to the IP control block as part of the NX_IP_DRIVER request control block shown above.</span></span>

<span data-ttu-id="80115-136">После того как приложение вызывает ***nx_ip_create***, вспомогательный поток IP отправляет запрос драйвера с набором команд в NX_LINK_INITIALIZE, чтобы драйвер инициализировал физический сетевой интерфейс.</span><span class="sxs-lookup"><span data-stu-id="80115-136">After the application calls ***nx_ip_create***, the IP helper thread sends a driver request with the command set to NX_LINK_INITIALIZE to the driver to initialize its physical network interface.</span></span> <span data-ttu-id="80115-137">Для запроса инициализации используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-137">The following NX_IP_DRIVER members are used for the initialize request.</span></span>

| <span data-ttu-id="80115-138">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-138">NX_IP_DRIVER&nbsp;member</span></span> | <span data-ttu-id="80115-139">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-139">Meaning</span></span>    |
| ------------------------- | ----------------------------- |
| <span data-ttu-id="80115-140">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-140">nx_ip_driver_command</span></span>   | <span data-ttu-id="80115-141">NX_LINK_INITIALIZE</span><span class="sxs-lookup"><span data-stu-id="80115-141">NX_LINK_INITIALIZE</span></span>    |
| <span data-ttu-id="80115-142">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-142">nx_ip_driver_ptr</span></span>       | <span data-ttu-id="80115-143">Указатель на экземпляр IP.</span><span class="sxs-lookup"><span data-stu-id="80115-143">Pointer to the IP instance.</span></span> <span data-ttu-id="80115-144">Драйвер должен сохранить это значение, чтобы функция драйвера могла найти экземпляр IP для работы.</span><span class="sxs-lookup"><span data-stu-id="80115-144">This value should be saved by the driver so that the driver function can find the IP instance to operate on.</span></span>    |
| <span data-ttu-id="80115-145">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-145">nx_ip_driver_interface</span></span> | <span data-ttu-id="80115-146">Указатель на структуру сетевого интерфейса в экземпляре IP.</span><span class="sxs-lookup"><span data-stu-id="80115-146">Pointer to the network interface structure within the IP instance.</span></span> <span data-ttu-id="80115-147">Эти сведения должны быть сохранены драйвером.</span><span class="sxs-lookup"><span data-stu-id="80115-147">This information should be saved by the driver.</span></span> <span data-ttu-id="80115-148">При получении пакетов драйвер использует сведения о структуре интерфейса для передачи пакета вверх по стеку.</span><span class="sxs-lookup"><span data-stu-id="80115-148">On receiving packets, the driver shall use the interface structure information when sending the packet up the stack.</span></span> <span data-ttu-id="80115-149">Индекс интерфейса (индекс устройства) можно получить, прочитав элемент nx_interface_index внутри этой структуры данных.</span><span class="sxs-lookup"><span data-stu-id="80115-149">The interface index (device index) can be obtained by reading the member nx_interface_index inside this data structure.</span></span> |
| <span data-ttu-id="80115-150">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-150">nx_ip_driver_status</span></span>    | <span data-ttu-id="80115-151">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-151">Completion status.</span></span> <span data-ttu-id="80115-152">Если драйвер не может инициализировать указанный интерфейс в экземпляре IP, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-152">If the driver is not able to initialize the specified interface to the IP instance, it will return a nonzero error status.</span></span> |


> [!NOTE]  
> <span data-ttu-id="80115-153">*Драйвер фактически вызывается из вспомогательного потока IP, созданного для экземпляра IP. Поэтому подпрограмме драйвера следует избегать выполнения операций блокировки. В противном случае вспомогательный поток IP может приостановить работу, что приведет к неограниченным задержкам для приложений, использующих этот поток.*</span><span class="sxs-lookup"><span data-stu-id="80115-153">*The driver is actually called from the IP helper thread that was created for the IP instance. Therefore the driver routine should avoid performing blocking operations, or the IP helper thread could stall, causing unbounded delays to applications that rely on the IP thread*.</span></span>

### <a name="enable-link"></a><span data-ttu-id="80115-154">Включение канала</span><span class="sxs-lookup"><span data-stu-id="80115-154">Enable Link</span></span>   
<span data-ttu-id="80115-155">Затем вспомогательный поток IP включает физическую сеть, задавая команду драйвера NX_LINK_ENABLE в запросе драйвера и отправляя запрос сетевому драйверу.</span><span class="sxs-lookup"><span data-stu-id="80115-155">Next, the IP helper thread enables the physical network by setting the driver command to NX_LINK_ENABLE in the driver request and sending the request to the network driver.</span></span> <span data-ttu-id="80115-156">Это происходит вскоре после того, как вспомогательный поток IP завершает запрос на инициализацию.</span><span class="sxs-lookup"><span data-stu-id="80115-156">This happens shortly after the IP helper thread completes the initialization request.</span></span> <span data-ttu-id="80115-157">Для включения канала может быть достаточно установить поле *nx_interface_link_up* в экземпляре интерфейса.</span><span class="sxs-lookup"><span data-stu-id="80115-157">Enabling the link may be as simple as setting the *nx_interface_link_up* field in the interface instance.</span></span> <span data-ttu-id="80115-158">Но могут потребоваться и операции с физическим оборудованием.</span><span class="sxs-lookup"><span data-stu-id="80115-158">But it may also involve manipulation of the physical hardware.</span></span> <span data-ttu-id="80115-159">Для запроса включения канала используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-159">The following NX_IP_DRIVER members are used for the enable link request.</span></span>

| <span data-ttu-id="80115-160">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-160">NX_IP_DRIVER&nbsp;member</span></span>       | <span data-ttu-id="80115-161">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-161">Meaning</span></span>                      |
| ------------------------- | ---------------------------- |
| <span data-ttu-id="80115-162">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-162">nx_ip_driver_command</span></span>   | <span data-ttu-id="80115-163">NX_LINK_ENABLE</span><span class="sxs-lookup"><span data-stu-id="80115-163">NX_LINK_ENABLE</span></span>   |
| <span data-ttu-id="80115-164">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-164">nx_ip_driver_ptr</span></span>       | <span data-ttu-id="80115-165">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-165">Pointer to IP instance</span></span>  |
| <span data-ttu-id="80115-166">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-166">nx_ip_driver_interface</span></span> | <span data-ttu-id="80115-167">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-167">Pointer to the interface instance</span></span> |
| <span data-ttu-id="80115-168">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-168">nx_ip_driver_status</span></span>    | <span data-ttu-id="80115-169">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-169">Completion status.</span></span> <span data-ttu-id="80115-170">Если драйвер не может включить указанный интерфейс, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-170">If the driver is not able to enable the specified interface, it will return a non-zero error status.</span></span> |

### <a name="disable-link"></a><span data-ttu-id="80115-171">Отключение канала</span><span class="sxs-lookup"><span data-stu-id="80115-171">Disable Link</span></span>   
<span data-ttu-id="80115-172">Этот запрос выполняется NetX Duo во время удаления экземпляра IP службой \***nx_ip_delete** _.</span><span class="sxs-lookup"><span data-stu-id="80115-172">This request is made by NetX Duo during the deletion of an IP instance by the \***nx_ip_delete** _ service.</span></span> <span data-ttu-id="80115-173">Приложение может также выдать эту команду, чтобы временно отключить канал для экономии энергии.</span><span class="sxs-lookup"><span data-stu-id="80115-173">Or an application may issue this command in order to temporarily disable the link in order to save power.</span></span> <span data-ttu-id="80115-174">Эта служба отключает физический сетевой интерфейс в экземпляре IP.</span><span class="sxs-lookup"><span data-stu-id="80115-174">This service disables the physical network interface on the IP instance.</span></span> <span data-ttu-id="80115-175">Для отключения канала может быть достаточно снять флаг _nx_interface_link_up\* в экземпляре интерфейса. Но могут потребоваться и операции с физическим оборудованием. Обычно эта операция обратна операции \***включения канала**_.</span><span class="sxs-lookup"><span data-stu-id="80115-175">The processing to disable the link may be as simple as clearing the _nx_interface_link_up\* flag in the interface instance. But it may also involve manipulation of the physical hardware. Typically it is a reverse operation of the \***Enable Link**_ operation.</span></span> <span data-ttu-id="80115-176">После отключения канала операция приложение запрашивает операцию _ \*_включения канала_\*\*, чтобы включить интерфейс.</span><span class="sxs-lookup"><span data-stu-id="80115-176">After the link is disabled, the application request _ *_Enable Link_*\* operation to enable the interface.</span></span>

<span data-ttu-id="80115-177">Для запроса на отключение канала используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-177">The following NX_IP_DRIVER members are used for the disable link request.</span></span>

| <span data-ttu-id="80115-178">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-178">NX_IP_DRIVER&nbsp;member</span></span>     | <span data-ttu-id="80115-179">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-179">Meaning</span></span>                      |
| ------------------------- | ---------------------------- |
| <span data-ttu-id="80115-180">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-180">nx_ip_driver_command</span></span>   | <span data-ttu-id="80115-181">NX_LINK_DISABLE</span><span class="sxs-lookup"><span data-stu-id="80115-181">NX_LINK_DISABLE</span></span>    |
| <span data-ttu-id="80115-182">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-182">nx_ip_driver_ptr</span></span>       | <span data-ttu-id="80115-183">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-183">Pointer to IP instance</span></span>   |
| <span data-ttu-id="80115-184">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-184">nx_ip_driver_interface</span></span> | <span data-ttu-id="80115-185">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-185">Pointer to the interface instance</span></span>   |
| <span data-ttu-id="80115-186">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-186">nx_ip_driver_status</span></span>    | <span data-ttu-id="80115-187">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-187">Completion status.</span></span> <span data-ttu-id="80115-188">Если драйвер не может отключить указанный интерфейс в экземпляре IP, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-188">If the driver is not able to disable the specified interface in the IP instance, it will return a non-zero error status.</span></span> |

### <a name="uninitialize-link"></a><span data-ttu-id="80115-189">Отмена инициализации канала</span><span class="sxs-lookup"><span data-stu-id="80115-189">Uninitialize Link</span></span>   
<span data-ttu-id="80115-190">Этот запрос выполняется NetX Duo во время удаления экземпляра IP службой \***nx_ip_delete** _.</span><span class="sxs-lookup"><span data-stu-id="80115-190">This request is made by NetX Duo during the deletion of an IP instance by the \***nx_ip_delete** _ service.</span></span> <span data-ttu-id="80115-191">Этот запрос отменяет инициализацию интерфейса и освобождает все ресурсы, созданные на этапе инициализации.</span><span class="sxs-lookup"><span data-stu-id="80115-191">This request uninitialize the interface, and release any resources created during initialization phase.</span></span> <span data-ttu-id="80115-192">Обычно эта операция обратна операции _ \*_инициализации_\*\*.</span><span class="sxs-lookup"><span data-stu-id="80115-192">Typically it is a reverse operation of the _ *_Initialize Link_*\* operation.</span></span> <span data-ttu-id="80115-193">После отмены инициализации интерфейса устройство нельзя будет использовать до тех пор, пока интерфейс не будет инициализирован снова.</span><span class="sxs-lookup"><span data-stu-id="80115-193">After the interface is uninitalized, the device cannot be used until the interface is initialized again.</span></span>

<span data-ttu-id="80115-194">Для запроса на отключение канала используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-194">The following NX_IP_DRIVER members are used for the disable link request.</span></span>

| <span data-ttu-id="80115-195">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-195">NX_IP_DRIVER&nbsp;member</span></span>    | <span data-ttu-id="80115-196">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-196">Meaning</span></span>                  |
|------------------------|--------------------------|
| <span data-ttu-id="80115-197">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-197">nx_ip_driver_command</span></span>   | <span data-ttu-id="80115-198">NX_LINK_UNINITIALZE</span><span class="sxs-lookup"><span data-stu-id="80115-198">NX_LINK_UNINITIALZE</span></span>      |
| <span data-ttu-id="80115-199">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-199">nx_ip_driver_ptr</span></span>       | <span data-ttu-id="80115-200">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-200">Pointer to IP instance</span></span>   |
| <span data-ttu-id="80115-201">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-201">nx_ip_driver_interface</span></span> | <span data-ttu-id="80115-202">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-202">Pointer to the interface instance</span></span> |
| <span data-ttu-id="80115-203">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-203">nx_ip_driver_status</span></span>    | <span data-ttu-id="80115-204">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-204">Completion status.</span></span> <span data-ttu-id="80115-205">Если драйвер не может отменить инициализацию указанного интерфейса в экземпляре IP, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-205">If the driver is not able to uninitialize the specified interface to the IP instance, it will return a non-zero error status.</span></span> |

### <a name="packet-send"></a><span data-ttu-id="80115-206">Отправка пакета</span><span class="sxs-lookup"><span data-stu-id="80115-206">Packet Send</span></span>   
<span data-ttu-id="80115-207">Этот запрос выполняется во время внутренней обработки отправки IPv4 или IPv6, которая используется всеми протоколами NetX Duo для передачи пакетов (за исключением ARP и RARP).</span><span class="sxs-lookup"><span data-stu-id="80115-207">This request is made during internal IPv4 or IPv6 send processing, which all NetX Duo protocols use to transmit packets (except for ARP, RARP).</span></span> <span data-ttu-id="80115-208">При получении команды отправки пакета *nx_packet_prepend_ptr* указывает на начало отправляемого пакета, то есть начало заголовка IPv4 или IPv6.</span><span class="sxs-lookup"><span data-stu-id="80115-208">On receiving the packet send command, the *nx_packet_prepend_ptr* points to the beginning of the packet to be sent, which is the beginning of the IPv4 or IPv6 header.</span></span> <span data-ttu-id="80115-209">В *nx_packet_length* указывается общий размер передаваемых данных (в байтах).</span><span class="sxs-lookup"><span data-stu-id="80115-209">*nx_packet_length* indicates the total size (in bytes) of the data being transmitted.</span></span> <span data-ttu-id="80115-210">Если значение *nx_packet_next* допустимо, исходящая датаграмма IP хранится в нескольких пакетах. В этом случае драйверу необходимо следовать по цепочке пакетов и передать весь кадр.</span><span class="sxs-lookup"><span data-stu-id="80115-210">If *nx_packet_next* is valid, the outgoing IP datagram is stored in multiple packets, the driver is required to follow the chained packet and transmit the entire frame.</span></span> <span data-ttu-id="80115-211">Обратите внимание, что допустимый диапазон данных в каждом связанном пакете хранится между *nx_packet_prepend_ptr* и *nx_packet_append_ptr*.</span><span class="sxs-lookup"><span data-stu-id="80115-211">Note that valid data area in each chained packet is stored between *nx_packet_prepend_ptr* and *nx_packet_append_ptr*.</span></span>

<span data-ttu-id="80115-212">Драйвер отвечает за формирование физического заголовка.</span><span class="sxs-lookup"><span data-stu-id="80115-212">The driver is responsible for constructing physical header.</span></span> <span data-ttu-id="80115-213">Если требуется сопоставление физического адреса с IP-адресом (например, Ethernet), то уровень IP уже разрешил MAC-адрес.</span><span class="sxs-lookup"><span data-stu-id="80115-213">If physical address to IP address mapping is required (such as Ethernet), the IP layer already resolved the MAC address.</span></span> <span data-ttu-id="80115-214">Конечный MAC-адрес передается из экземпляра IP, который хранится в *nx_ip_driver_physical_address_msw и nx_ip_driver_physical_address_lsw*.</span><span class="sxs-lookup"><span data-stu-id="80115-214">The destination MAC address is passed from the IP instance, stored in *nx_ip_driver_physical_address_msw and nx_ip_driver_physical_address_lsw*.</span></span>

<span data-ttu-id="80115-215">После добавления физического заголовка процесс отправки пакета вызывает выходную функцию драйвера для передачи пакета.</span><span class="sxs-lookup"><span data-stu-id="80115-215">After adding the physical header, the packet send processing then calls the driver's output function to transmit the packet.</span></span>

<span data-ttu-id="80115-216">Для запроса отправки пакета используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-216">The following NX_IP_DRIVER members are used for the packet send request.</span></span>

| <span data-ttu-id="80115-217">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-217">NX_IP_DRIVER&nbsp;member</span></span>              | <span data-ttu-id="80115-218">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-218">Meaning</span></span>                               |
| -----------------------------------| --------------------------------------|
| <span data-ttu-id="80115-219">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-219">nx_ip_driver_command</span></span>            | <span data-ttu-id="80115-220">NX_LINK_PACKET_SEND</span><span class="sxs-lookup"><span data-stu-id="80115-220">NX_LINK_PACKET_SEND</span></span>                |
| <span data-ttu-id="80115-221">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-221">nx_ip_driver_ptr</span></span>                | <span data-ttu-id="80115-222">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-222">Pointer to IP instance</span></span>                |
| <span data-ttu-id="80115-223">nx_ip_driver_packet</span><span class="sxs-lookup"><span data-stu-id="80115-223">nx_ip_driver_packet</span></span>             | <span data-ttu-id="80115-224">Указатель на отправляемый пакет</span><span class="sxs-lookup"><span data-stu-id="80115-224">Pointer to the packet to send</span></span>         |
| <span data-ttu-id="80115-225">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-225">nx_ip_driver_interface</span></span>          | <span data-ttu-id="80115-226">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-226">Pointer to the interface instance.</span></span>    |
| <span data-ttu-id="80115-227">nx_ip_driver_physical_address_msw</span><span class="sxs-lookup"><span data-stu-id="80115-227">nx_ip_driver_physical_address_msw</span></span> | <span data-ttu-id="80115-228">Старшие 32 бит физического адреса (только если требуется физическое сопоставление)</span><span class="sxs-lookup"><span data-stu-id="80115-228">Most significant 32-bits of physical address (only if physical mapping needed)</span></span> |
| <span data-ttu-id="80115-229">nx_ip_driver_physical_address_lsw</span><span class="sxs-lookup"><span data-stu-id="80115-229">nx_ip_driver_physical_address_lsw</span></span> | <span data-ttu-id="80115-230">Младшие 32 бит физического адреса (только если требуется физическое сопоставление)</span><span class="sxs-lookup"><span data-stu-id="80115-230">Least significant 32-bits of physical address (only if physical mapping needed)</span></span> |
| <span data-ttu-id="80115-231">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-231">nx_ip_driver_status</span></span>             | <span data-ttu-id="80115-232">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-232">Completion status.</span></span> <span data-ttu-id="80115-233">Если драйвер не может отправить пакет, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-233">If the driver is not able to send the packet, it will return a non-zero error status.</span></span> |

### <a name="packet-broadcastipv4-packets-only"></a><span data-ttu-id="80115-234">Широковещательная рассылка пакетов (только для пакетов IPv4)</span><span class="sxs-lookup"><span data-stu-id="80115-234">Packet Broadcast(IPv4 packets only)</span></span>  
<span data-ttu-id="80115-235">Этот запрос почти идентичен запросу отправки пакета.</span><span class="sxs-lookup"><span data-stu-id="80115-235">This request is almost identical to the send packet request.</span></span> <span data-ttu-id="80115-236">Единственное отличие заключается в том, что в полях физического адреса назначения задан MAC-адрес широковещательной рассылки Ethernet.</span><span class="sxs-lookup"><span data-stu-id="80115-236">The only difference is that the destination physical address fields are set to the Ethernet broadcast MAC address.</span></span> <span data-ttu-id="80115-237">Для запроса широковещательной рассылки пакета используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-237">The following NX_IP_DRIVER members are used for the packet broadcast request.</span></span>

| <span data-ttu-id="80115-238">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-238">NX_IP_DRIVER&nbsp;member</span></span>                | <span data-ttu-id="80115-239">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-239">Meaning</span></span>                                                                                                  |
|------------------------------------|----------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="80115-240">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-240">nx_ip_driver_command</span></span>               | <span data-ttu-id="80115-241">NX_LINK_PACKET_BROADCAST</span><span class="sxs-lookup"><span data-stu-id="80115-241">NX_LINK_PACKET_BROADCAST</span></span>                                                                                 |
| <span data-ttu-id="80115-242">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-242">nx_ip_driver_ptr</span></span>                   | <span data-ttu-id="80115-243">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-243">Pointer to IP instance</span></span>                                                                                   |
| <span data-ttu-id="80115-244">nx_ip_driver_packet</span><span class="sxs-lookup"><span data-stu-id="80115-244">nx_ip_driver_packet</span></span>                | <span data-ttu-id="80115-245">Указатель на отправляемый пакет</span><span class="sxs-lookup"><span data-stu-id="80115-245">Pointer to the packet to send</span></span>                                                                            |
| <span data-ttu-id="80115-246">nx_ip_driver_physical_address_ms w</span><span class="sxs-lookup"><span data-stu-id="80115-246">nx_ip_driver_physical_address_ms w</span></span> | <span data-ttu-id="80115-247">0x0000FFFF (широковещательная рассылка)</span><span class="sxs-lookup"><span data-stu-id="80115-247">0x0000FFFF (broadcast)</span></span>                                                                                   |
| <span data-ttu-id="80115-248">nx_ip_driver_physical_address_lsw</span><span class="sxs-lookup"><span data-stu-id="80115-248">nx_ip_driver_physical_address_lsw</span></span>  | <span data-ttu-id="80115-249">0xFFFFFFFF (широковещательная рассылка)</span><span class="sxs-lookup"><span data-stu-id="80115-249">0xFFFFFFFF (broadcast)</span></span>                                                                                   |
| <span data-ttu-id="80115-250">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-250">nx_ip_driver_interface</span></span>             | <span data-ttu-id="80115-251">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-251">Pointer to the interface instance.</span></span>                                                                       |
| <span data-ttu-id="80115-252">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-252">nx_ip_driver_status</span></span>                | <span data-ttu-id="80115-253">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-253">Completion status.</span></span> <span data-ttu-id="80115-254">Если драйвер не может отправить пакет, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-254">If the driver is not able to send the packet, it will return a non-zero error status.</span></span> |

### <a name="arp-send"></a><span data-ttu-id="80115-255">Отправка ARP</span><span class="sxs-lookup"><span data-stu-id="80115-255">ARP Send</span></span>  
<span data-ttu-id="80115-256">Этот запрос также аналогичен запросу на отправку IP-пакета.</span><span class="sxs-lookup"><span data-stu-id="80115-256">This request is also similar to the IP packet send request.</span></span> <span data-ttu-id="80115-257">Единственное отличие заключается в том, что в заголовке Ethernet указывается пакет ARP вместо IP-пакета, а в полях физического адреса назначения задан MAC-адрес широковещательной рассылки.</span><span class="sxs-lookup"><span data-stu-id="80115-257">The only difference is that the Ethernet header specifies an ARP packet instead of an IP packet, and destination physical address fields are set to MAC broadcast address.</span></span> <span data-ttu-id="80115-258">Для запроса отправки ARP используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-258">The following NX_IP_DRIVER members are used for the ARP send request.</span></span>

| <span data-ttu-id="80115-259">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-259">NX_IP_DRIVER&nbsp;member</span></span>                | <span data-ttu-id="80115-260">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-260">Meaning</span></span>                                                                                                      |
|------------------------------------|--------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="80115-261">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-261">nx_ip_driver_command</span></span>               | <span data-ttu-id="80115-262">NX_LINK_ARP_SEND</span><span class="sxs-lookup"><span data-stu-id="80115-262">NX_LINK_ARP_SEND</span></span>                                                                                             |
| <span data-ttu-id="80115-263">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-263">nx_ip_driver_ptr</span></span>                   | <span data-ttu-id="80115-264">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-264">Pointer to IP instance</span></span>                                                                                       |
| <span data-ttu-id="80115-265">nx_ip_driver_packet</span><span class="sxs-lookup"><span data-stu-id="80115-265">nx_ip_driver_packet</span></span>                | <span data-ttu-id="80115-266">Указатель на отправляемый пакет</span><span class="sxs-lookup"><span data-stu-id="80115-266">Pointer to the packet to send</span></span>                                                                                |
| <span data-ttu-id="80115-267">nx_ip_driver_physical_address_ms w</span><span class="sxs-lookup"><span data-stu-id="80115-267">nx_ip_driver_physical_address_ms w</span></span> | <span data-ttu-id="80115-268">0x0000FFFF (широковещательная рассылка)</span><span class="sxs-lookup"><span data-stu-id="80115-268">0x0000FFFF (broadcast)</span></span>                                                                                       |
| <span data-ttu-id="80115-269">nx_ip_driver_physical_address_lsw</span><span class="sxs-lookup"><span data-stu-id="80115-269">nx_ip_driver_physical_address_lsw</span></span>  | <span data-ttu-id="80115-270">0xFFFFFFFF (широковещательная рассылка)</span><span class="sxs-lookup"><span data-stu-id="80115-270">0xFFFFFFFF (broadcast)</span></span>                                                                                       |
| <span data-ttu-id="80115-271">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-271">nx_ip_driver_interface</span></span>             | <span data-ttu-id="80115-272">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-272">Pointer to the interface instance.</span></span>                                                                           |
| <span data-ttu-id="80115-273">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-273">nx_ip_driver_status</span></span>                | <span data-ttu-id="80115-274">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-274">Completion status.</span></span> <span data-ttu-id="80115-275">Если драйвер не может отправить пакет ARP, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-275">If the driver is not able to send the ARP packet, it will return a non-zero error status.</span></span> |

> [!IMPORTANT]  
> <span data-ttu-id="80115-276">*Если физическое сопоставление не требуется, реализация этого запроса не нужна*.</span><span class="sxs-lookup"><span data-stu-id="80115-276">*If physical mapping is not needed, implementation of this request is not required*.</span></span>

<span data-ttu-id="80115-277">*Хотя протокол ARP был заменен в IPv6 протоколом обнаружения соседей и протоколом обнаружения маршрутизаторов, сетевые драйверы Ethernet по-прежнему должны быть совместимы с одноранговыми узлами IPv4 и маршрутизаторами. Поэтому драйверы по-прежнему должны работать с пакетами ARP*.</span><span class="sxs-lookup"><span data-stu-id="80115-277">*Although ARP has been replaced with the Neighbor Discovery Protocol and the Router Discovery Protocol in IPv6, Ethernet network drivers must still be compatible with IPv4 peers and routers. Therefore, drivers must still handle ARP packets*.</span></span>

### <a name="arp-response-send"></a><span data-ttu-id="80115-278">Отправка ответа ARP</span><span class="sxs-lookup"><span data-stu-id="80115-278">ARP Response Send</span></span>  
<span data-ttu-id="80115-279">Этот запрос почти идентичен запросу отправки пакета ARP.</span><span class="sxs-lookup"><span data-stu-id="80115-279">This request is almost identical to the ARP send packet request.</span></span> <span data-ttu-id="80115-280">Единственное отличие заключается в том, что поля физического адреса назначения передаются из экземпляра IP.</span><span class="sxs-lookup"><span data-stu-id="80115-280">The only difference is the destination physical address fields are passed from the IP instance.</span></span> <span data-ttu-id="80115-281">Для запроса отправки ответа ARP используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-281">The following NX_IP_DRIVER members are used for the ARP response send request.</span></span>

| <span data-ttu-id="80115-282">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-282">NX_IP_DRIVER&nbsp;member</span></span>                  | <span data-ttu-id="80115-283">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-283">Meaning</span></span>                                  |
| -------------------------------------- | -----------------------------------------|
| <span data-ttu-id="80115-284">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-284">nx_ip_driver_command</span></span>                | <span data-ttu-id="80115-285">NX_LINK_ARP_RESPONSE_SEND</span><span class="sxs-lookup"><span data-stu-id="80115-285">NX_LINK_ARP_RESPONSE_SEND</span></span>            |
| <span data-ttu-id="80115-286">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-286">nx_ip_driver_ptr</span></span>                    | <span data-ttu-id="80115-287">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-287">Pointer to IP instance</span></span>   |
| <span data-ttu-id="80115-288">nx_ip_driver_packet</span><span class="sxs-lookup"><span data-stu-id="80115-288">nx_ip_driver_packet</span></span>                 | <span data-ttu-id="80115-289">Указатель на отправляемый пакет</span><span class="sxs-lookup"><span data-stu-id="80115-289">Pointer to the packet to send</span></span>          |
| <span data-ttu-id="80115-290">nx_ip_driver_physical_address_msw</span><span class="sxs-lookup"><span data-stu-id="80115-290">nx_ip_driver_physical_address_msw</span></span> | <span data-ttu-id="80115-291">Старшие 32 бит физического адреса</span><span class="sxs-lookup"><span data-stu-id="80115-291">Most significant 32-bits of physical address</span></span> |
| <span data-ttu-id="80115-292">nx_ip_driver_physical_address_lsw</span><span class="sxs-lookup"><span data-stu-id="80115-292">nx_ip_driver_physical_address_lsw</span></span> | <span data-ttu-id="80115-293">Младшие 32 бит физического адреса</span><span class="sxs-lookup"><span data-stu-id="80115-293">Least significant 32-bits of physical address</span></span> |
| <span data-ttu-id="80115-294">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-294">nx_ip_driver_interface</span></span>              | <span data-ttu-id="80115-295">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-295">Pointer to the interface instance</span></span> |
| <span data-ttu-id="80115-296">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-296">nx_ip_driver_status</span></span>                 | <span data-ttu-id="80115-297">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-297">Completion status.</span></span> <span data-ttu-id="80115-298">Если драйвер не может отправить пакет ARP, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-298">If the driver is not able to send the ARP packet, it will return a non-zero error status.</span></span> |

> [!IMPORTANT]  
> <span data-ttu-id="80115-299">*Если физическое сопоставление не требуется, реализация этого запроса не нужна*.</span><span class="sxs-lookup"><span data-stu-id="80115-299">*If physical mapping is not needed, implementation of this request is not required*.</span></span>

### <a name="rarp-send"></a><span data-ttu-id="80115-300">Отправка RARP</span><span class="sxs-lookup"><span data-stu-id="80115-300">RARP Send</span></span>   
<span data-ttu-id="80115-301">Этот запрос почти идентичен запросу отправки пакета ARP.</span><span class="sxs-lookup"><span data-stu-id="80115-301">This request is almost identical to the ARP send packet request.</span></span> <span data-ttu-id="80115-302">Единственным отличием является тип заголовка пакета, а также то, что поля физического адреса не требуются, так как физическое назначение всегда является широковещательным адресом.</span><span class="sxs-lookup"><span data-stu-id="80115-302">The only differences are the type of packet header and the physical address fields are not required because the physical destination is always a broadcast address.</span></span>

<span data-ttu-id="80115-303">Для запроса отправки RARP используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-303">The following NX_IP_DRIVER members are used for the RARP send request.</span></span>

| <span data-ttu-id="80115-304">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-304">NX_IP_DRIVER&nbsp;member</span></span>                | <span data-ttu-id="80115-305">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-305">Meaning</span></span>                                                                                                       |
|------------------------------------|---------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="80115-306">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-306">nx_ip_driver_command</span></span>               | <span data-ttu-id="80115-307">NX_LINK_RARP_SEND</span><span class="sxs-lookup"><span data-stu-id="80115-307">NX_LINK_RARP_SEND</span></span>                                                                                             |
| <span data-ttu-id="80115-308">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-308">nx_ip_driver_ptr</span></span>                   | <span data-ttu-id="80115-309">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-309">Pointer to IP instance</span></span>                                                                                        |
| <span data-ttu-id="80115-310">nx_ip_driver_packet</span><span class="sxs-lookup"><span data-stu-id="80115-310">nx_ip_driver_packet</span></span>                | <span data-ttu-id="80115-311">Указатель на отправляемый пакет</span><span class="sxs-lookup"><span data-stu-id="80115-311">Pointer to the packet to send</span></span>                                                                                 |
| <span data-ttu-id="80115-312">nx_ip_driver_physical_address_ms w</span><span class="sxs-lookup"><span data-stu-id="80115-312">nx_ip_driver_physical_address_ms w</span></span> | <span data-ttu-id="80115-313">0x0000FFFF (широковещательная рассылка)</span><span class="sxs-lookup"><span data-stu-id="80115-313">0x0000FFFF (broadcast)</span></span>                                                                                        |
| <span data-ttu-id="80115-314">nx_ip_driver_physical_address_lsw</span><span class="sxs-lookup"><span data-stu-id="80115-314">nx_ip_driver_physical_address_lsw</span></span>  | <span data-ttu-id="80115-315">0xFFFFFFFF (широковещательная рассылка)</span><span class="sxs-lookup"><span data-stu-id="80115-315">0xFFFFFFFF (broadcast)</span></span>                                                                                        |
| <span data-ttu-id="80115-316">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-316">nx_ip_driver_interface</span></span>             | <span data-ttu-id="80115-317">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-317">Pointer to the interface instance.</span></span>                                                                            |
| <span data-ttu-id="80115-318">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-318">nx_ip_driver_status</span></span>                | <span data-ttu-id="80115-319">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-319">Completion status.</span></span> <span data-ttu-id="80115-320">Если драйвер не может отправить пакет RARP, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-320">If the driver is not able to send the RARP packet, it will return a non-zero error status.</span></span> |

> [!IMPORTANT]  
> <span data-ttu-id="80115-321">*В приложениях, которым требуется служба RARP, эта команда должна быть реализована*.</span><span class="sxs-lookup"><span data-stu-id="80115-321">*Applications that require RARP service must implement this command*.</span></span>

### <a name="multicast-group-join"></a><span data-ttu-id="80115-322">Присоединение к группе многоадресной рассылки</span><span class="sxs-lookup"><span data-stu-id="80115-322">Multicast Group Join</span></span>   
<span data-ttu-id="80115-323">Этот запрос выполняется с помощью служб ***nx_igmp_multicast_interface join** _ и _*_nx_ipv4_multicast_interface_join_*_ в IPv4, службы _ *_nxd_ipv6_multicast_interface_join_** в IPv6, а также различных операций, требуемых протоколу IPv6.</span><span class="sxs-lookup"><span data-stu-id="80115-323">This request is made with the ***nx_igmp_multicast_interface join** _ and _*_nx_ipv4_multicast_interface_join_*_ service in IPv4, _ *_nxd_ipv6_multicast_interface_join_** service in IPv6, and various operation required by IPv6.</span></span> <span data-ttu-id="80115-324">Сетевой драйвер принимает указанный адрес группы многоадресной рассылки и настраивает физический носитель для приема входящих пакетов с этого адреса.</span><span class="sxs-lookup"><span data-stu-id="80115-324">The network driver takes the supplied multicast group address and sets up the physical media to accept incoming packets from that multicast group address.</span></span> <span data-ttu-id="80115-325">Обратите внимание, что для драйверов, которые не поддерживают фильтрацию многоадресной рассылки, логика приема драйвера может работать в неизбирательном режиме.</span><span class="sxs-lookup"><span data-stu-id="80115-325">Note that for drivers that don't support multicast filter, the driver receive logic may have to be in promiscuous mode.</span></span> <span data-ttu-id="80115-326">В этом случае драйверу может потребоваться фильтровать входящие кадры на основе MAC-адреса назначения, чтобы сократить объем трафика, передаваемого в экземпляр IP.</span><span class="sxs-lookup"><span data-stu-id="80115-326">In this case, the driver may need to filter incoming frames based on destination MAC address, thus reducing the amount of traffic passed into the IP instance.</span></span> <span data-ttu-id="80115-327">Для запроса на присоединение к группе многоадресной рассылки используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-327">The following NX_IP_DRIVER members are used for the multicast group join request.</span></span>

| <span data-ttu-id="80115-328">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-328">NX_IP_DRIVER&nbsp;member</span></span>                  | <span data-ttu-id="80115-329">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-329">Meaning</span></span>                                 |
| -------------------------------------- | --------------------------------------- |
| <span data-ttu-id="80115-330">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-330">nx_ip_driver_command</span></span>                | <span data-ttu-id="80115-331">NX_LINK_MULTICAST_JOIN</span><span class="sxs-lookup"><span data-stu-id="80115-331">NX_LINK_MULTICAST_JOIN</span></span>               |
| <span data-ttu-id="80115-332">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-332">nx_ip_driver_ptr</span></span>                    | <span data-ttu-id="80115-333">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-333">Pointer to IP instance</span></span>  |
| <span data-ttu-id="80115-334">nx_ip_driver_physical_address_msw</span><span class="sxs-lookup"><span data-stu-id="80115-334">nx_ip_driver_physical_address_msw</span></span> | <span data-ttu-id="80115-335">Старшие 32 бит физического адреса многоадресной рассылки</span><span class="sxs-lookup"><span data-stu-id="80115-335">Most significant 32-bits of physical multicast address</span></span> |
| <span data-ttu-id="80115-336">nx_ip_driver_physical_address_lsw</span><span class="sxs-lookup"><span data-stu-id="80115-336">nx_ip_driver_physical_address_lsw</span></span> | <span data-ttu-id="80115-337">Младшие 32 бит физического адреса многоадресной рассылки</span><span class="sxs-lookup"><span data-stu-id="80115-337">Least significant 32-bits of physical multicast address</span></span> |
| <span data-ttu-id="80115-338">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-338">nx_ip_driver_interface</span></span>              | <span data-ttu-id="80115-339">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-339">Pointer to the interface instance</span></span> |
| <span data-ttu-id="80115-340">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-340">nx_ip_driver_status</span></span>                 | <span data-ttu-id="80115-341">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-341">Completion status.</span></span> <span data-ttu-id="80115-342">Если драйвер не может присоединиться к группе многоадресной рассылки, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-342">If the driver is not able to join the multicast group, it will return a non-zero error status.</span></span> |

> [!NOTE]  
> <span data-ttu-id="80115-343">*Приложения IPv6 требуют реализации многоадресной рассылки в драйвере для протоколов на основе ICMPv6, например настройки адресов. Однако для приложений IPv4 реализация этого запроса не требуется, если возможности многоадресной рассылки не нужны*.</span><span class="sxs-lookup"><span data-stu-id="80115-343">*IPv6 applications will require multicast to be implemented in the driver for ICMPv6 based protocols such as address configuration. However, for IPv4 applications, implementation of this request is not necessary if multicast capabilities are not required*.</span></span>

> [!IMPORTANT]  
> <span data-ttu-id="80115-344">*Если протокол IPv6 не включен и возможности многоадресной рассылки по протоколу IPv4 не требуются, реализация этого запроса не нужна*.</span><span class="sxs-lookup"><span data-stu-id="80115-344">*If IPv6 is not enabled, and multicast capabilities are not required by IPv4, implementation of this request is not required*.</span></span>

### <a name="multicast-group-leave"></a><span data-ttu-id="80115-345">Выход из группы многоадресной рассылки</span><span class="sxs-lookup"><span data-stu-id="80115-345">Multicast Group Leave</span></span>  
<span data-ttu-id="80115-346">Этот запрос инициируется путем явного вызова службы ***nx_igmp_multicast_interface_leave** _ или _*_nx_ipv4_multicast_interface_leave_*_ в IPv4, службы _ *_nxd_ipv6_multicast_interface_leave_** в IPv6, а также с помощью различных внутренних операций NetX Duo, требуемых протоколу IPv6.</span><span class="sxs-lookup"><span data-stu-id="80115-346">This request is invoked by explicitly calling the ***nx_igmp_multicast_interface_leave** _ or _*_nx_ipv4_multicast_interface_leave_*_ services in IPv4, _ *_nxd_ipv6_multicast_interface_leave_** service in IPv6, or by various internal NetX Duo operations required for IPv6.</span></span> <span data-ttu-id="80115-347">Драйвер удаляет указанный адрес многоадресной рассылки Ethernet из списка многоадресной рассылки.</span><span class="sxs-lookup"><span data-stu-id="80115-347">The driver removes the supplied Ethernet multicast address from the multicast list.</span></span> <span data-ttu-id="80115-348">После выхода узла из группы многоадресной рассылки пакеты в сети с этим адресом многоадресной рассылки Ethernet больше не принимаются данным экземпляром IP.</span><span class="sxs-lookup"><span data-stu-id="80115-348">After a host has left a multicast group, packets on the network with this Ethernet multicast address are no longer received by this IP instance.</span></span> <span data-ttu-id="80115-349">Для запроса на выход из группы многоадресной рассылки используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-349">The following NX_IP_DRIVER members are used for the multicast group leave request.</span></span>

| <span data-ttu-id="80115-350">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-350">NX_IP_DRIVER&nbsp;member</span></span>              | <span data-ttu-id="80115-351">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-351">Meaning</span></span>                              |
| -----------------------------------| -------------------------------------|
| <span data-ttu-id="80115-352">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-352">nx_ip_driver_command</span></span>            | <span data-ttu-id="80115-353">NX_LINK_MULTICAST_LEAVE</span><span class="sxs-lookup"><span data-stu-id="80115-353">NX_LINK_MULTICAST_LEAVE</span></span>           |
| <span data-ttu-id="80115-354">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-354">nx_ip_driver_ptr</span></span>                | <span data-ttu-id="80115-355">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-355">Pointer to IP instance</span></span>   |
| <span data-ttu-id="80115-356">nx_ip_driver_physical_address_msw</span><span class="sxs-lookup"><span data-stu-id="80115-356">nx_ip_driver_physical_address_msw</span></span> | <span data-ttu-id="80115-357">Старшие 32 бит физического адреса многоадресной рассылки</span><span class="sxs-lookup"><span data-stu-id="80115-357">Most significant 32 bits of physical multicast address</span></span> |
| <span data-ttu-id="80115-358">nx_ip_driver_physical_address_lsw</span><span class="sxs-lookup"><span data-stu-id="80115-358">nx_ip_driver_physical_address_lsw</span></span> | <span data-ttu-id="80115-359">Младшие 32 бит физического адреса многоадресной рассылки</span><span class="sxs-lookup"><span data-stu-id="80115-359">Least significant 32 bits of physical multicast address</span></span> |
| <span data-ttu-id="80115-360">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-360">nx_ip_driver_interface</span></span>              | <span data-ttu-id="80115-361">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-361">Pointer to the interface instance</span></span> |
| <span data-ttu-id="80115-362">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-362">nx_ip_driver_status</span></span>                 | <span data-ttu-id="80115-363">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-363">Completion status.</span></span> <span data-ttu-id="80115-364">Если драйвер не может выйти из группы многоадресной рассылки, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-364">If the driver is not able to leave the multicast group, it will return a non-zero error status.</span></span> |

> [!IMPORTANT]  
> <span data-ttu-id="80115-365">*Если возможности многоадресной рассылки по протоколу IPv4 или IPv6 не требуются, реализация этого запроса не нужна*.</span><span class="sxs-lookup"><span data-stu-id="80115-365">*If multicast capabilities are not required by either IPv4 or IPv6, implementation of this request is not required*.</span></span>

### <a name="attach-interface"></a><span data-ttu-id="80115-366">Подключение интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-366">Attach Interface</span></span>  
<span data-ttu-id="80115-367">Этот запрос выполняется из NetX Duo к драйверу устройства и позволяет связать экземпляр драйвера с соответствующим экземпляром IP и экземпляром физического интерфейса в пределах IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="80115-367">This request is invoked from the NetX Duo to the device driver, allowing the driver to associate the driver instance with the corresponding IP instance and the physical interface instance within the IP.</span></span> <span data-ttu-id="80115-368">Для запроса на подключение интерфейса используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-368">The following NX_IP_DRIVER members are used for the attach interface request.</span></span>

| <span data-ttu-id="80115-369">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-369">NX_IP_DRIVER&nbsp;member</span></span>    | <span data-ttu-id="80115-370">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-370">Meaning</span></span>                  |
|------------------------|--------------------------|
| <span data-ttu-id="80115-371">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-371">nx_ip_driver_command</span></span>   | <span data-ttu-id="80115-372">NX_LINK_INTERFACE_ATTACH</span><span class="sxs-lookup"><span data-stu-id="80115-372">NX_LINK_INTERFACE_ATTACH</span></span> |
| <span data-ttu-id="80115-373">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-373">nx_ip_driver_ptr</span></span>       | <span data-ttu-id="80115-374">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-374">Pointer to IP instance</span></span>   |
| <span data-ttu-id="80115-375">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-375">nx_ip_driver_interface</span></span> | <span data-ttu-id="80115-376">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-376">Pointer to the interface instance.</span></span>|
| <span data-ttu-id="80115-377">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-377">nx_ip_driver_status</span></span>    | <span data-ttu-id="80115-378">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-378">Completion status.</span></span> <span data-ttu-id="80115-379">Если драйвер не может подключить указанный интерфейс к экземпляру IP, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-379">If the driver is not able to detach the specified interface to the IP instance, it will return a non-zero error status.</span></span> |

### <a name="detach-interface"></a><span data-ttu-id="80115-380">Отключение интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-380">Detach Interface</span></span>    
<span data-ttu-id="80115-381">Этот запрос выполняется из NetX Duo к драйверу устройства и позволяет отвязать экземпляр драйвера от соответствующего экземпляра IP и экземпляра физического интерфейса в пределах IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="80115-381">This request is invoked by NetX Duo to the device driver, allowing the driver to disassociate the driver instance with the corresponding IP instance and the physical interface instance within the IP.</span></span> <span data-ttu-id="80115-382">Для запроса на подключение интерфейса используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-382">The following NX_IP_DRIVER members are used for the attach interface request.</span></span>

| <span data-ttu-id="80115-383">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-383">NX_IP_DRIVER&nbsp;member</span></span>    | <span data-ttu-id="80115-384">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-384">Meaning</span></span>                                                                                                                                    |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="80115-385">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-385">nx_ip_driver_command</span></span>   | <span data-ttu-id="80115-386">NX_LINK_INTERFACE_DETACH</span><span class="sxs-lookup"><span data-stu-id="80115-386">NX_LINK_INTERFACE_DETACH</span></span>                                                                                                                   |
| <span data-ttu-id="80115-387">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-387">nx_ip_driver_ptr</span></span>       | <span data-ttu-id="80115-388">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-388">Pointer to IP instance</span></span>                                                                                                                     |
| <span data-ttu-id="80115-389">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-389">nx_ip_driver_interface</span></span> | <span data-ttu-id="80115-390">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-390">Pointer to the interface instance.</span></span>                                                                                                         |
| <span data-ttu-id="80115-391">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-391">nx_ip_driver_status</span></span>    | <span data-ttu-id="80115-392">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-392">Completion status.</span></span> <span data-ttu-id="80115-393">Если драйвер не может отключить указанный интерфейс в экземпляре IP, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-393">If the driver is not able to attach the specified interface to the IP instance, it will return a non-zero error status.</span></span> |

### <a name="get-link-status"></a><span data-ttu-id="80115-394">Получение состояния канала</span><span class="sxs-lookup"><span data-stu-id="80115-394">Get Link Status</span></span>    
<span data-ttu-id="80115-395">Приложение может запросить состояние канала сетевого интерфейса с помощью службы NetX Duo ***nx_ip_interface_status_check*** для любого интерфейса на узле.</span><span class="sxs-lookup"><span data-stu-id="80115-395">The application can query the network interface link status using the NetX Duo service ***nx_ip_interface_status_check*** service for any interface on the host.</span></span> <span data-ttu-id="80115-396">Дополнительные сведения об этих службах см. в главе 4, "Описание служб NetX Duo", на странице 149.</span><span class="sxs-lookup"><span data-stu-id="80115-396">See Chapter 4, "Description of NetX Duo Services" on page 149, for more details on these services.</span></span>

<span data-ttu-id="80115-397">Состояние канала содержится в поле *nx_interface_link_up* в структуре NX_INTERFACE, на которую ссылается указатель *nx_ip_driver_interface*.</span><span class="sxs-lookup"><span data-stu-id="80115-397">The link status is contained in the *nx_interface_link_up* field in the NX_INTERFACE structure pointed to by *nx_ip_driver_interface* pointer.</span></span> <span data-ttu-id="80115-398">Для запроса получения состояния канала используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-398">The following NX_IP_DRIVER members are used for the link status request.</span></span>

| <span data-ttu-id="80115-399">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-399">NX_IP_DRIVER&nbsp;member</span></span>       | <span data-ttu-id="80115-400">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-400">Meaning</span></span>                  |
| --------------------------- | -------------------------|
| <span data-ttu-id="80115-401">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-401">nx_ip_driver_command</span></span>     | <span data-ttu-id="80115-402">NX_LINK_GET_STATUS</span><span class="sxs-lookup"><span data-stu-id="80115-402">NX_LINK_GET_STATUS</span></span>    |
| <span data-ttu-id="80115-403">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-403">nx_ip_driver_ptr</span></span>         | <span data-ttu-id="80115-404">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-404">Pointer to IP instance</span></span>   |
| <span data-ttu-id="80115-405">nx_ip_driver_return_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-405">nx_ip_driver_return_ptr</span></span> | <span data-ttu-id="80115-406">Указатель для размещения состояния</span><span class="sxs-lookup"><span data-stu-id="80115-406">Pointer to the destination to place the status.</span></span> |
| <span data-ttu-id="80115-407">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-407">nx_ip_driver_interface</span></span>   | <span data-ttu-id="80115-408">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-408">Pointer to the interface instance</span></span>   |
| <span data-ttu-id="80115-409">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-409">nx_ip_driver_status</span></span>      | <span data-ttu-id="80115-410">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-410">Completion status.</span></span> <span data-ttu-id="80115-411">Если драйвер не может получить определенное состояние, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-411">If the driver is not able to get specific status, it will return a non-zero error status.</span></span> |

> [!NOTE]  
> <span data-ttu-id="80115-412">Функция \***nx_ip_status_check** _ по-прежнему доступна для проверки состояния основного интерфейса.</span><span class="sxs-lookup"><span data-stu-id="80115-412">\***nx_ip_status_check** _ is still available for checking the status of the primary interface.</span></span> <span data-ttu-id="80115-413">Однако разработчикам приложений рекомендуется использовать специальную службу интерфейса: _ *_nx_ip_interface_status_check._*\*</span><span class="sxs-lookup"><span data-stu-id="80115-413">However, application developers are encouraged to use the interface specific service: _ *_nx_ip_interface_status_check._*\*</span></span>

### <a name="get-link-speed"></a><span data-ttu-id="80115-414">Определение скорости канала</span><span class="sxs-lookup"><span data-stu-id="80115-414">Get Link Speed</span></span>  
<span data-ttu-id="80115-415">Этот запрос выполняется из службы ***nx_ip_driver_direct_command***.</span><span class="sxs-lookup"><span data-stu-id="80115-415">This request is made from within the ***nx_ip_driver_direct_command*** service.</span></span> <span data-ttu-id="80115-416">Драйвер сохраняет скорость канала в указанном месте.</span><span class="sxs-lookup"><span data-stu-id="80115-416">The driver stores the link's line speed in the supplied destination.</span></span> <span data-ttu-id="80115-417">Для запроса на определение скорости канала используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-417">The following NX_IP_DRIVER members are used for the link line speed request.</span></span>

| <span data-ttu-id="80115-418">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-418">NX_IP_DRIVER&nbsp;member</span></span>   | <span data-ttu-id="80115-419">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-419">Meaning</span></span>                   |
| ------------------------| ------------------------- |
| <span data-ttu-id="80115-420">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-420">nx_ip_driver_command</span></span>     | <span data-ttu-id="80115-421">NX_LINK_GET_SPEED</span><span class="sxs-lookup"><span data-stu-id="80115-421">NX_LINK_GET_SPEED</span></span>          |
| <span data-ttu-id="80115-422">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-422">nx_ip_driver_ptr</span></span>         | <span data-ttu-id="80115-423">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-423">Pointer to IP instance</span></span>                                                                                         |
| <span data-ttu-id="80115-424">nx_ip_driver_return_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-424">nx_ip_driver_return_ptr</span></span> | <span data-ttu-id="80115-425">Указатель для размещения скорости канала</span><span class="sxs-lookup"><span data-stu-id="80115-425">Pointer to the destination to place the line speed</span></span>                                                             |
| <span data-ttu-id="80115-426">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-426">nx_ip_driver_interface</span></span>   | <span data-ttu-id="80115-427">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-427">Pointer to the interface instance</span></span>                                                                              |
| <span data-ttu-id="80115-428">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-428">nx_ip_driver_status</span></span>      | <span data-ttu-id="80115-429">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-429">Completion status.</span></span> <span data-ttu-id="80115-430">Если драйвер не может определить скорость, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-430">If the driver is not able to get speed information, it will return a non-zero error status.</span></span> |

> [!IMPORTANT]  
> <span data-ttu-id="80115-431">*Этот запрос не используется внутри NetX Duo, поэтому его реализация не является обязательной*.</span><span class="sxs-lookup"><span data-stu-id="80115-431">*This request is not used internally by NetX Duo so its implementation is optional*.</span></span>

### <a name="get-duplex-type"></a><span data-ttu-id="80115-432">Получение дуплексного типа</span><span class="sxs-lookup"><span data-stu-id="80115-432">Get Duplex Type</span></span>   
<span data-ttu-id="80115-433">Этот запрос выполняется из службы ***nx_ip_driver_direct_command***.</span><span class="sxs-lookup"><span data-stu-id="80115-433">This request is made from within the ***nx_ip_driver_direct_command*** service.</span></span> <span data-ttu-id="80115-434">Драйвер сохраняет дуплексный тип канала в указанном месте.</span><span class="sxs-lookup"><span data-stu-id="80115-434">The driver stores the link's duplex type in the supplied destination.</span></span> <span data-ttu-id="80115-435">Для запроса на получение дуплексного типа используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-435">The following NX_IP_DRIVER members are used for the duplex type request.</span></span>

| <span data-ttu-id="80115-436">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-436">NX_IP_DRIVER&nbsp;member</span></span>   | <span data-ttu-id="80115-437">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-437">Meaning</span></span>                                                                                                    |
| --------------------------- | -------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="80115-438">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-438">nx_ip_driver_command</span></span>     | <span data-ttu-id="80115-439">NX_LINK_GET_DUPLEX_TYPE</span><span class="sxs-lookup"><span data-stu-id="80115-439">NX_LINK_GET_DUPLEX_TYPE</span></span>                                                                                    |
| <span data-ttu-id="80115-440">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-440">nx_ip_driver_ptr</span></span>         | <span data-ttu-id="80115-441">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-441">Pointer to IP instance</span></span>                                                                                         |
| <span data-ttu-id="80115-442">nx_ip_driver_return_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-442">nx_ip_driver_return_ptr</span></span> | <span data-ttu-id="80115-443">Указатель для размещения дуплексного типа</span><span class="sxs-lookup"><span data-stu-id="80115-443">Pointer to the destination to place the duplex type</span></span>                                                            |
| <span data-ttu-id="80115-444">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-444">nx_ip_driver_interface</span></span>   | <span data-ttu-id="80115-445">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-445">Pointer to the interface instance</span></span>                                                                              |
| <span data-ttu-id="80115-446">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-446">nx_ip_driver_status</span></span>      | <span data-ttu-id="80115-447">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-447">Completion status.</span></span> <span data-ttu-id="80115-448">Если драйвер не может получить сведения о дуплексном типе, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-448">If the driver is not able to get duplex information, it will return a nonzero error status.</span></span> |

> [!IMPORTANT]  
> <span data-ttu-id="80115-449">*Этот запрос не используется внутри NetX Duo, поэтому его реализация не является обязательной*.</span><span class="sxs-lookup"><span data-stu-id="80115-449">*This request is not used internally by NetX Duo so its implementation is optional*.</span></span>

### <a name="get-error-count"></a><span data-ttu-id="80115-450">Получение количества ошибок</span><span class="sxs-lookup"><span data-stu-id="80115-450">Get Error Count</span></span>   
<span data-ttu-id="80115-451">Этот запрос выполняется из службы ***nx_ip_driver_direct_command***.</span><span class="sxs-lookup"><span data-stu-id="80115-451">This request is made from within the ***nx_ip_driver_direct_command*** service.</span></span> <span data-ttu-id="80115-452">Драйвер сохраняет количество ошибок канала в указанном месте.</span><span class="sxs-lookup"><span data-stu-id="80115-452">The driver stores the link's error count in the supplied destination.</span></span> <span data-ttu-id="80115-453">Для поддержки этой функции драйверу необходимо учитывать ошибки операций.</span><span class="sxs-lookup"><span data-stu-id="80115-453">To support this feature, the driver needs to track operation errors.</span></span> <span data-ttu-id="80115-454">Для запроса на получение количества ошибок канала используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-454">The following NX_IP_DRIVER members are used for the link error count request.</span></span>

| <span data-ttu-id="80115-455">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-455">NX_IP_DRIVER&nbsp;member</span></span>   | <span data-ttu-id="80115-456">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-456">Meaning</span></span>                   |
| --------------------------- | -------------------------------|
| <span data-ttu-id="80115-457">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-457">nx_ip_driver_command</span></span>     | <span data-ttu-id="80115-458">NX_LINK_GET_ERROR_COUNT</span><span class="sxs-lookup"><span data-stu-id="80115-458">NX_LINK_GET_ERROR_COUNT</span></span>   |
| <span data-ttu-id="80115-459">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-459">nx_ip_driver_ptr</span></span>         | <span data-ttu-id="80115-460">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-460">Pointer to IP instance</span></span>   |
| <span data-ttu-id="80115-461">nx_ip_driver_return_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-461">nx_ip_driver_return_ptr</span></span> | <span data-ttu-id="80115-462">Указатель для размещения количества ошибок</span><span class="sxs-lookup"><span data-stu-id="80115-462">Pointer to the destination to place the error count</span></span> |
| <span data-ttu-id="80115-463">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-463">nx_ip_driver_interface</span></span>   | <span data-ttu-id="80115-464">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-464">Pointer to the interface instance</span></span>|
| <span data-ttu-id="80115-465">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-465">nx_ip_driver_status</span></span>      | <span data-ttu-id="80115-466">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-466">Completion status.</span></span> <span data-ttu-id="80115-467">Если драйвер не может определить количество ошибок, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-467">If the driver is not able to get error count, it will return a non-zero error status.</span></span> |

> [!IMPORTANT]
> <span data-ttu-id="80115-468">*Этот запрос не используется внутри NetX Duo, поэтому его реализация не является обязательной*.</span><span class="sxs-lookup"><span data-stu-id="80115-468">*This request is not used internally by NetX Duo so its implementation is optional*.</span></span>

### <a name="get-receive-packet-count"></a><span data-ttu-id="80115-469">Определение количества полученных пакетов</span><span class="sxs-lookup"><span data-stu-id="80115-469">Get Receive Packet Count</span></span>    
<span data-ttu-id="80115-470">Этот запрос выполняется из службы ***nx_ip_driver_direct_command***.</span><span class="sxs-lookup"><span data-stu-id="80115-470">This request is made from within the ***nx_ip_driver_direct_command*** service.</span></span> <span data-ttu-id="80115-471">Драйвер сохраняет количество полученных по каналу пакетов в указанном месте.</span><span class="sxs-lookup"><span data-stu-id="80115-471">The driver stores the link's receive packet count in the supplied destination.</span></span> <span data-ttu-id="80115-472">Для поддержки этой функции драйверу необходимо учитывать количество полученных пакетов.</span><span class="sxs-lookup"><span data-stu-id="80115-472">To support this feature, the driver needs to keep track of the number of packets received.</span></span> <span data-ttu-id="80115-473">Для запроса на определение количества полученных по каналу пакетов используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-473">The following NX_IP_DRIVER members are used for the link receive packet count request.</span></span>

| <span data-ttu-id="80115-474">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-474">NX_IP_DRIVER&nbsp;member</span></span>       | <span data-ttu-id="80115-475">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-475">Meaning</span></span>                        |
| --------------------------- | -------------------------------|
| <span data-ttu-id="80115-476">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-476">nx_ip_driver_command</span></span>     | <span data-ttu-id="80115-477">NX_LINK_GET_RX_COUNT</span><span class="sxs-lookup"><span data-stu-id="80115-477">NX_LINK_GET_RX_COUNT</span></span>      |
| <span data-ttu-id="80115-478">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-478">nx_ip_driver_ptr</span></span>         | <span data-ttu-id="80115-479">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-479">Pointer to IP instance</span></span>  |
| <span data-ttu-id="80115-480">nx_ip_driver_return_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-480">nx_ip_driver_return_ptr</span></span> | <span data-ttu-id="80115-481">Указатель для размещения количества полученных пакетов</span><span class="sxs-lookup"><span data-stu-id="80115-481">Pointer to the destination to place the receive packet count</span></span>   |
| <span data-ttu-id="80115-482">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-482">nx_ip_driver_interface</span></span>   | <span data-ttu-id="80115-483">Указатель на физический сетевой интерфейс</span><span class="sxs-lookup"><span data-stu-id="80115-483">Pointer to the physical network interface</span></span>  |
| <span data-ttu-id="80115-484">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-484">nx_ip_driver_status</span></span>      | <span data-ttu-id="80115-485">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-485">Completion status.</span></span> <span data-ttu-id="80115-486">Если драйвер не может определить количество полученных пакетов, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-486">If the driver is not able to get receive count, it will return a non-zero error status.</span></span> |

> [!IMPORTANT]  
> <span data-ttu-id="80115-487">*Этот запрос не используется внутри NetX Duo, поэтому его реализация не является обязательной*.</span><span class="sxs-lookup"><span data-stu-id="80115-487">*This request is not used internally by NetX Duo so its implementation is optional*.</span></span>

### <a name="get-transmit-packet-count"></a><span data-ttu-id="80115-488">Определение количества переданных пакетов</span><span class="sxs-lookup"><span data-stu-id="80115-488">Get Transmit Packet Count</span></span>   
<span data-ttu-id="80115-489">Этот запрос выполняется из службы ***nx_ip_driver_direct_command***.</span><span class="sxs-lookup"><span data-stu-id="80115-489">This request is made from within the ***nx_ip_driver_direct_command*** service.</span></span> <span data-ttu-id="80115-490">Драйвер сохраняет количество переданных по каналу пакетов в указанном месте.</span><span class="sxs-lookup"><span data-stu-id="80115-490">The driver stores the link's transmit packet count in the supplied destination.</span></span> <span data-ttu-id="80115-491">Для поддержки этой функции драйверу необходимо отслеживать каждый пакет, передаваемый через каждый интерфейс.</span><span class="sxs-lookup"><span data-stu-id="80115-491">To support this feature, the driver needs to keep track of each packet it transmits on each interface.</span></span> <span data-ttu-id="80115-492">Для запроса на получение количества переданных по каналу пакетов используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-492">The following  NX_IP_DRIVER members are used for the link transmit packet count request.</span></span>

| <span data-ttu-id="80115-493">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-493">NX_IP_DRIVER&nbsp;member</span></span>   | <span data-ttu-id="80115-494">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-494">Meaning</span></span>                   |
| ----------------------- | ------------------------- |
| <span data-ttu-id="80115-495">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-495">nx_ip_driver_command</span></span> | <span data-ttu-id="80115-496">NX_LINK_GET_TX_COUNT</span><span class="sxs-lookup"><span data-stu-id="80115-496">NX_LINK_GET_TX_COUNT</span></span>  |
| <span data-ttu-id="80115-497">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-497">nx_ip_driver_ptr</span></span>     | <span data-ttu-id="80115-498">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-498">Pointer to IP instance</span></span>    |
| <span data-ttu-id="80115-499">nx_ip_driver_return_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-499">nx_ip_driver_return_ptr</span></span> | <span data-ttu-id="80115-500">Указатель для размещения количества переданных пакетов</span><span class="sxs-lookup"><span data-stu-id="80115-500">Pointer to the destination to place the transmit packet count</span></span>  |
| <span data-ttu-id="80115-501">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-501">nx_ip_driver_interface</span></span>   | <span data-ttu-id="80115-502">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-502">Pointer to the interface instance</span></span>   |
| <span data-ttu-id="80115-503">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-503">nx_ip_driver_status</span></span>      | <span data-ttu-id="80115-504">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-504">Completion status.</span></span> <span data-ttu-id="80115-505">Если драйвер не может определить количество переданных пакетов, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-505">If the driver is not able to get transmit count, it will return a non-zero error status.</span></span> |

> [!IMPORTANT]  
> <span data-ttu-id="80115-506">*Этот запрос не используется внутри NetX Duo, поэтому его реализация не является обязательной*.</span><span class="sxs-lookup"><span data-stu-id="80115-506">*This request is not used internally by NetX Duo so its implementation is optional*.</span></span>

### <a name="get-allocation-errors"></a><span data-ttu-id="80115-507">Получение ошибок выделения</span><span class="sxs-lookup"><span data-stu-id="80115-507">Get Allocation Errors</span></span>   
<span data-ttu-id="80115-508">Этот запрос выполняется из службы ***nx_ip_driver_direct_command***.</span><span class="sxs-lookup"><span data-stu-id="80115-508">This request is made from within the ***nx_ip_driver_direct_command*** service.</span></span> <span data-ttu-id="80115-509">Драйвер сохраняет количество ошибок выделения пула пакетов для канала в указанном месте.</span><span class="sxs-lookup"><span data-stu-id="80115-509">The driver stores the link's packet pool allocation error count in the supplied destination.</span></span> <span data-ttu-id="80115-510">Для запроса на получение ошибок выделения для канала используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-510">The following NX_IP_DRIVER members are used for the link allocation error count request.</span></span>

| <span data-ttu-id="80115-511">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-511">NX_IP_DRIVER&nbsp;member</span></span>       | <span data-ttu-id="80115-512">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-512">Meaning</span></span>                       |
| --------------------------- | ----------------------------- |
| <span data-ttu-id="80115-513">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-513">nx_ip_driver_command</span></span>     | <span data-ttu-id="80115-514">NX_LINK_GET_ALLOC_ERRORS</span><span class="sxs-lookup"><span data-stu-id="80115-514">NX_LINK_GET_ALLOC_ERRORS</span></span>  |
| <span data-ttu-id="80115-515">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-515">nx_ip_driver_ptr</span></span>         | <span data-ttu-id="80115-516">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-516">Pointer to IP instance</span></span>     |
| <span data-ttu-id="80115-517">nx_ip_driver_return_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-517">nx_ip_driver_return_ptr</span></span> | <span data-ttu-id="80115-518">Указатель для размещения количества ошибок выделения</span><span class="sxs-lookup"><span data-stu-id="80115-518">Pointer to the destination to place the allocation error count</span></span>  |
| <span data-ttu-id="80115-519">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-519">nx_ip_driver_interface</span></span>   | <span data-ttu-id="80115-520">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-520">Pointer to the interface instance</span></span>  |
| <span data-ttu-id="80115-521">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-521">nx_ip_driver_status</span></span>      | <span data-ttu-id="80115-522">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-522">Completion status.</span></span> <span data-ttu-id="80115-523">Если драйвер не может определить количество ошибок выделения, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-523">If the driver is not able to get allocation errors, it will return a non-zero error status.</span></span> |

> [!IMPORTANT]  
> <span data-ttu-id="80115-524">*Этот запрос не используется внутри NetX Duo, поэтому его реализация не является обязательной*.</span><span class="sxs-lookup"><span data-stu-id="80115-524">*This request is not used internally by NetX Duo so its implementation is optional*.</span></span>

### <a name="driver-deferred-processing"></a><span data-ttu-id="80115-525">Отложенная обработка драйвера</span><span class="sxs-lookup"><span data-stu-id="80115-525">Driver Deferred Processing</span></span>    
<span data-ttu-id="80115-526">Этот запрос выполняется из вспомогательного потока IP в ответ на вызов драйвером подпрограммы _\***nx_ip_driver_deferred_processing**_ из подпрограммы обработки прерываний (ISR) при передаче или получении.</span><span class="sxs-lookup"><span data-stu-id="80115-526">This request is made from the IP helper thread in response to the driver calling the _\***nx_ip_driver_deferred_processing**_ routine from a transmit or receive ISR.</span></span> <span data-ttu-id="80115-527">Это позволяет подпрограмме ISR драйвера распределять обработку операций по приему и передаче пакетов на вспомогательный поток IP, благодаря чему снижается нагрузка на эту подпрограмму.</span><span class="sxs-lookup"><span data-stu-id="80115-527">This allows the driver ISR to defer the packet receive and transmit processing to the IP helper thread and thus reduce the amount to process in the ISR.</span></span> <span data-ttu-id="80115-528">Поле _nx_interface_additional_link_info\* в структуре NX_INTERFACE, на которую указывает *nx_ip_driver_interface*, может использоваться драйвером для хранения сведений о событии отложенной обработки из контекста вспомогательного потока IP.</span><span class="sxs-lookup"><span data-stu-id="80115-528">The _nx_interface_additional_link_info\* field in the NX_INTERFACE structure pointed to by *nx_ip_driver_interface* may be used by the driver to store information about the deferred processing event from the IP helper thread context.</span></span> <span data-ttu-id="80115-529">Для события отложенной обработки используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-529">The following  NX_IP_DRIVER members are used for the deferred processing event.</span></span>

| <span data-ttu-id="80115-530">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-530">NX_IP_DRIVER&nbsp;member</span></span>     | <span data-ttu-id="80115-531">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-531">Meaning</span></span>                           |
| ------------------------- | --------------------------------- |
| <span data-ttu-id="80115-532">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-532">nx_ip_driver_command</span></span>   | <span data-ttu-id="80115-533">NX_LINK_DEFERRED_PROCESSING</span><span class="sxs-lookup"><span data-stu-id="80115-533">NX_LINK_DEFERRED_PROCESSING</span></span>    |
| <span data-ttu-id="80115-534">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-534">nx_ip_driver_ptr</span></span>       | <span data-ttu-id="80115-535">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-535">Pointer to IP instance</span></span>            |
| <span data-ttu-id="80115-536">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-536">nx_ip_driver_interface</span></span> | <span data-ttu-id="80115-537">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-537">Pointer to the interface instance</span></span> |

### <a name="set-physical-address"></a><span data-ttu-id="80115-538">Задание физического адреса</span><span class="sxs-lookup"><span data-stu-id="80115-538">Set Physical Address</span></span>  
<span data-ttu-id="80115-539">Этот запрос выполняется из службы \***nx_ip_interface_physical_address_set** _.</span><span class="sxs-lookup"><span data-stu-id="80115-539">This request is made from within the \***nx_ip_interface_physical_address_set** _ service.</span></span> <span data-ttu-id="80115-540">Эта служба позволяет приложению изменять физический адрес интерфейса во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="80115-540">This service allows an application to change the interface physical address at run time.</span></span> <span data-ttu-id="80115-541">При получении этой команды драйвер должен изменить аппаратный адрес сетевого интерфейса на указанный физический адрес.</span><span class="sxs-lookup"><span data-stu-id="80115-541">On receiving this command, the driver is required to re-configure the hardware address of the network interface to the supplied physical address.</span></span> <span data-ttu-id="80115-542">Так как у экземпляра IP уже есть новый адрес, вызывать службу _ *_nx_ip_interface_address_set_*\* из этой команды не нужно.</span><span class="sxs-lookup"><span data-stu-id="80115-542">Since the IP instance already has the new address, there is no need to call the _ *_nx_ip_interface_address_set_*\* service from this command.</span></span>

<span data-ttu-id="80115-543">Для запроса команд пользователя используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-543">The following NX_IP_DRIVER members are used for the user command request.</span></span>

| <span data-ttu-id="80115-544">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-544">NX_IP_DRIVER&nbsp;member</span></span>      | <span data-ttu-id="80115-545">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-545">Meaning</span></span>                      |
| -------------------------- | ---------------------------- |
| <span data-ttu-id="80115-546">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-546">nx_ip_driver_command</span></span>    | <span data-ttu-id="80115-547">NX_LINK_SET_PHYSICAL_ADDRESS</span><span class="sxs-lookup"><span data-stu-id="80115-547">NX_LINK_SET_PHYSICAL_ADDRESS</span></span>  |
| <span data-ttu-id="80115-548">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-548">nx_ip_driver_ptr</span></span>        | <span data-ttu-id="80115-549">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-549">Pointer to IP instance</span></span>  |
| <span data-ttu-id="80115-550">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-550">nx_ip_driver_interface</span></span>  | <span data-ttu-id="80115-551">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-551">Pointer to the interface instance</span></span>   |
| <span data-ttu-id="80115-552">nx_ip_driver_physical_ad dress_msw</span><span class="sxs-lookup"><span data-stu-id="80115-552">nx_ip_driver_physical_ad dress_msw</span></span> | <span data-ttu-id="80115-553">Старшие 32 бит нового физического адреса</span><span class="sxs-lookup"><span data-stu-id="80115-553">Most significant 32-bits of the new physical address</span></span>  |
| <span data-ttu-id="80115-554">nx_ip_driver_physical_ad dress_lsw</span><span class="sxs-lookup"><span data-stu-id="80115-554">nx_ip_driver_physical_ad dress_lsw</span></span> | <span data-ttu-id="80115-555">Младшие 32 бит нового физического адреса</span><span class="sxs-lookup"><span data-stu-id="80115-555">Least significant 32-bits of the new physical address</span></span>  |
| <span data-ttu-id="80115-556">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-556">nx_ip_driver_status</span></span>                  | <span data-ttu-id="80115-557">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-557">Completion status.</span></span> <span data-ttu-id="80115-558">Если драйвер не может изменить физический адрес, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-558">If the driver is not able to reconfigure the physical address, it will return a non-zero error status.</span></span> |

### <a name="user-commands"></a><span data-ttu-id="80115-559">Команды пользователя</span><span class="sxs-lookup"><span data-stu-id="80115-559">User Commands</span></span>    
<span data-ttu-id="80115-560">Этот запрос выполняется из службы ***nx_ip_driver_direct_command***.</span><span class="sxs-lookup"><span data-stu-id="80115-560">This request is made from within the ***nx_ip_driver_direct_command*** service.</span></span> <span data-ttu-id="80115-561">Драйвер обрабатывает команды пользователя, относящиеся к приложению.</span><span class="sxs-lookup"><span data-stu-id="80115-561">The driver processes the application specific user commands.</span></span> <span data-ttu-id="80115-562">Для запроса команд пользователя используются указанные ниже элементы NX_IP_DRIVER.</span><span class="sxs-lookup"><span data-stu-id="80115-562">The following NX_IP_DRIVER members are used for the user command request.</span></span>

| <span data-ttu-id="80115-563">Элемент &nbsp;NX_IP_DRIVER</span><span class="sxs-lookup"><span data-stu-id="80115-563">NX_IP_DRIVER&nbsp;member</span></span>       | <span data-ttu-id="80115-564">Значение</span><span class="sxs-lookup"><span data-stu-id="80115-564">Meaning</span></span>                       |
| --------------------------- | ----------------------------- |
| <span data-ttu-id="80115-565">nx_ip_driver_command</span><span class="sxs-lookup"><span data-stu-id="80115-565">nx_ip_driver_command</span></span>     | <span data-ttu-id="80115-566">NX_LINK_USER_COMMAND</span><span class="sxs-lookup"><span data-stu-id="80115-566">NX_LINK_USER_COMMAND</span></span>       |
| <span data-ttu-id="80115-567">nx_ip_driver_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-567">nx_ip_driver_ptr</span></span>         | <span data-ttu-id="80115-568">Указатель на экземпляр IP</span><span class="sxs-lookup"><span data-stu-id="80115-568">Pointer to IP instance</span></span>        |
| <span data-ttu-id="80115-569">nx_ip_driver_return_ptr</span><span class="sxs-lookup"><span data-stu-id="80115-569">nx_ip_driver_return_ptr</span></span> | <span data-ttu-id="80115-570">Определяется пользователем</span><span class="sxs-lookup"><span data-stu-id="80115-570">User defined</span></span>       |
| <span data-ttu-id="80115-571">nx_ip_driver_interface</span><span class="sxs-lookup"><span data-stu-id="80115-571">nx_ip_driver_interface</span></span>   | <span data-ttu-id="80115-572">Указатель на экземпляр интерфейса</span><span class="sxs-lookup"><span data-stu-id="80115-572">Pointer to the interface instance</span></span>    |
| <span data-ttu-id="80115-573">nx_ip_driver_status</span><span class="sxs-lookup"><span data-stu-id="80115-573">nx_ip_driver_status</span></span>      | <span data-ttu-id="80115-574">Состояние завершения.</span><span class="sxs-lookup"><span data-stu-id="80115-574">Completion status.</span></span> <span data-ttu-id="80115-575">Если драйвер не может выполнить команды пользователя, он возвращает ненулевое состояние ошибки.</span><span class="sxs-lookup"><span data-stu-id="80115-575">If the driver is not able to execute user commands, it will return a non-zero error status.</span></span> |

> [!IMPORTANT] 
> <span data-ttu-id="80115-576">*Этот запрос не используется внутри NetX Duo, поэтому его реализация не является обязательной*.</span><span class="sxs-lookup"><span data-stu-id="80115-576">*This request is not used internally by NetX Duo so its implementation is optional*.</span></span>

### <a name="unimplemented-commands"></a><span data-ttu-id="80115-577">Нереализованные команды</span><span class="sxs-lookup"><span data-stu-id="80115-577">Unimplemented Commands</span></span>  
<span data-ttu-id="80115-578">Для команд, которые не реализуются сетевым драйвером, поле возвращаемого состояния должно иметь значение NX_UNHANDLED_COMMAND.</span><span class="sxs-lookup"><span data-stu-id="80115-578">Commands unimplemented by the network driver must have the return status field set to NX_UNHANDLED_COMMAND.</span></span>

## <a name="driver-capability"></a><span data-ttu-id="80115-579">Возможность драйвера</span><span class="sxs-lookup"><span data-stu-id="80115-579">Driver Capability</span></span>

<span data-ttu-id="80115-580">Некоторые сетевые интерфейсы предлагают функции разгрузки для операций вычисления контрольной суммы.</span><span class="sxs-lookup"><span data-stu-id="80115-580">Some network interfaces offer checksum offload features.</span></span> <span data-ttu-id="80115-581">Драйверы устройств могут использовать возможности аппаратного ускорения для освобождения ЦП от выполнения различных вычислений контрольной суммы.</span><span class="sxs-lookup"><span data-stu-id="80115-581">Device drivers may take advantage of the hardware accelerations to free up CPU time from running various checksum computations.</span></span>

<span data-ttu-id="80115-582">В зависимости от уровня аппаратной поддержки вычислений контрольной суммы драйверу устройства необходимо сообщить экземпляру IP о том, какая аппаратная функция включена.</span><span class="sxs-lookup"><span data-stu-id="80115-582">Depending the level of hardware checksum support from the hardware, the device driver needs to inform the IP instance which hardware feature is enabled.</span></span> <span data-ttu-id="80115-583">Таким образом, экземпляру IP будет известна используемая аппаратная функция и он переложит как можно больше вычислений на оборудование.</span><span class="sxs-lookup"><span data-stu-id="80115-583">This way, the IP instance is aware of the hardware feature, and offload as much computation to the hardware as possible.</span></span> <span data-ttu-id="80115-584">Драйвер должен использовать интерфейс API ***nx_ip_interface_capability_set*** для задания всех функций, которые поддерживает физический интерфейс.</span><span class="sxs-lookup"><span data-stu-id="80115-584">The driver should use the API ***nx_ip_interface_capability_set*** to set all the features the physical interface is able to handle.</span></span>

<span data-ttu-id="80115-585">Можно использовать следующие функции.</span><span class="sxs-lookup"><span data-stu-id="80115-585">The following features can be used:</span></span>

- <span data-ttu-id="80115-586">NX_INTERFACE_CAPABILITY_IPV4_TX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-586">NX_INTERFACE_CAPABILITY_IPV4_TX_CHECKSUM</span></span>
- <span data-ttu-id="80115-587">NX_INTERFACE_CAPABILITY_IPV4_RX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-587">NX_INTERFACE_CAPABILITY_IPV4_RX_CHECKSUM</span></span>
- <span data-ttu-id="80115-588">NX_INTERFACE_CAPABILITY_TCP_TX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-588">NX_INTERFACE_CAPABILITY_TCP_TX_CHECKSUM</span></span>
- <span data-ttu-id="80115-589">NX_INTERFACE_CAPABILITY_TCP_RX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-589">NX_INTERFACE_CAPABILITY_TCP_RX_CHECKSUM</span></span>
- <span data-ttu-id="80115-590">NX_INTERFACE_CAPABILITY_UDP_TX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-590">NX_INTERFACE_CAPABILITY_UDP_TX_CHECKSUM</span></span>
- <span data-ttu-id="80115-591">NX_INTERFACE_CAPABILITY_UDP_RX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-591">NX_INTERFACE_CAPABILITY_UDP_RX_CHECKSUM</span></span>
- <span data-ttu-id="80115-592">NX_INTERFACE_CAPABILITY_ICMPV4_TX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-592">NX_INTERFACE_CAPABILITY_ICMPV4_TX_CHECKSUM</span></span>
- <span data-ttu-id="80115-593">NX_INTERFACE_CAPABILITY_ICMPV4_RX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-593">NX_INTERFACE_CAPABILITY_ICMPV4_RX_CHECKSUM</span></span>
- <span data-ttu-id="80115-594">NX_INTERFACE_CAPABILITY_ICMPV6_TX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-594">NX_INTERFACE_CAPABILITY_ICMPV6_TX_CHECKSUM</span></span>
- <span data-ttu-id="80115-595">NX_INTERFACE_CAPABILITY_ICMPV6_RX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-595">NX_INTERFACE_CAPABILITY_ICMPV6_RX_CHECKSUM</span></span>
- <span data-ttu-id="80115-596">NX_INTERFACE_CAPABILITY_IGMP_TX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-596">NX_INTERFACE_CAPABILITY_IGMP_TX_CHECKSUM</span></span>
- <span data-ttu-id="80115-597">NX_INTERFACE_CAPABILITY_IGMP_RX_CHECKSUM</span><span class="sxs-lookup"><span data-stu-id="80115-597">NX_INTERFACE_CAPABILITY_IGMP_RX_CHECKSUM</span></span>

<span data-ttu-id="80115-598">Для вычислений контрольной суммы, которые выполняются оборудованием, драйвер должен правильно настроить дескрипторы оборудования или буфера, чтобы контрольная сумма для исходящего пакета могла быть сгенерирована и вставлена в заголовок оборудованием.</span><span class="sxs-lookup"><span data-stu-id="80115-598">For a checksum computation that can be performed in hardware, the driver must set up the hardware or the buffer descriptors correctly so the checksum for an out-going packet can be generated and inserted into the header by the hardware.</span></span> <span data-ttu-id="80115-599">При получении пакета логика контрольной суммы оборудования должна иметь возможность проверить значение контрольной суммы.</span><span class="sxs-lookup"><span data-stu-id="80115-599">On receiving a packet, the hardware checksum logic should be able to verify the checksum value.</span></span> <span data-ttu-id="80115-600">Если значение контрольной суммы неверно, полученный кадр должен быть отклонен.</span><span class="sxs-lookup"><span data-stu-id="80115-600">If the checksum value is incorrect, the received frame should be discarded.</span></span>

<span data-ttu-id="80115-601">Даже при наличии возможности вычисления контрольной суммы на аппаратном уровне экземпляр IP также сохраняет такую возможность.</span><span class="sxs-lookup"><span data-stu-id="80115-601">Even with the capability of performing checksum computation in hardware, the IP instance still maintains the checksum capability.</span></span> <span data-ttu-id="80115-602">В некоторых сценариях, например при применении защиты IPsec к датаграмме UDP, контрольная сумма UDP должна вычисляться программным обеспечением перед передачей кадра UDP вниз по стеку.</span><span class="sxs-lookup"><span data-stu-id="80115-602">In certain scenarios, for example a UDP datagram going through IPsec protection, the UDP checksum must be computed in software before passing the UDP frame down the stack.</span></span> <span data-ttu-id="80115-603">Большинство аппаратных функций контрольной суммы не поддерживают вычисление контрольной суммы для сегмента данных, защищенного с помощью IPsec.</span><span class="sxs-lookup"><span data-stu-id="80115-603">Most hardware checksum feature does not support checksum computation for a segment of data protected by IPsec.</span></span> <span data-ttu-id="80115-604">Для кадра UDP или ICMP, который должен быть фрагментирован, контрольную сумму UDP или ICMP необходимо вычислять в программном обеспечении.</span><span class="sxs-lookup"><span data-stu-id="80115-604">For a UDP or ICMP frame that needs to be fragmented, the UDP or ICMP checksum needs to be computed in software.</span></span> <span data-ttu-id="80115-605">Как правило, аппаратная логика контрольной суммы не поддерживает сценарии, когда данные разбиваются на несколько кадров.</span><span class="sxs-lookup"><span data-stu-id="80115-605">Most hardware checksum logic does not handle the case where the data is split into multiple frames.</span></span>

## <a name="driver-output"></a><span data-ttu-id="80115-606">Выходные данные драйвера</span><span class="sxs-lookup"><span data-stu-id="80115-606">Driver Output</span></span>  

<span data-ttu-id="80115-607">Для всех вышеупомянутых запросов на передачу пакетов требуется выходная функция, реализованная в драйвере.</span><span class="sxs-lookup"><span data-stu-id="80115-607">All previously mentioned packet transmit requests require an output function implemented in the driver.</span></span> <span data-ttu-id="80115-608">Конкретная логика передачи зависит от оборудования, но обычно она включает проверку аппаратных возможностей для немедленной отправки пакета.</span><span class="sxs-lookup"><span data-stu-id="80115-608">Specific transmit logic is hardware specific, but it usually consists of checking for hardware capacity to send the packet immediately.</span></span> <span data-ttu-id="80115-609">Если возможно, полезные данные пакета (и дополнительные полезные данные в цепочке пакетов) загружаются в один аппаратный буфер передачи или несколько и инициируется операция передачи.</span><span class="sxs-lookup"><span data-stu-id="80115-609">If possible, the packet payload (and additional payloads in the packet  chain) are loaded into one or more of the hardware transmit buffers and a transmit operation is initiated.</span></span> <span data-ttu-id="80115-610">Если пакет не помещается в доступные буферы передачи, его следует поставить в очередь и осуществить передачу, когда буферы станут доступны.</span><span class="sxs-lookup"><span data-stu-id="80115-610">If the packet won't fit in the available transmit buffers, the packet should be queued, and be transmitted when the transmission buffers become available.</span></span>

<span data-ttu-id="80115-611">Рекомендуемая очередь передачи — это односвязный список, имеющий как головной, так и заключительный указатели.</span><span class="sxs-lookup"><span data-stu-id="80115-611">The recommended transmit queue is a singly linked list, having both head and tail pointers.</span></span> <span data-ttu-id="80115-612">Новые пакеты добавляются в конец очереди, вымещая самый старый пакет вперед.</span><span class="sxs-lookup"><span data-stu-id="80115-612">New packets are added to the end of the queue, keeping the oldest packet at the front.</span></span> <span data-ttu-id="80115-613">Поле *nx_packet_queue_next* используется в качестве ссылки на следующий пакет в очереди.</span><span class="sxs-lookup"><span data-stu-id="80115-613">The *nx_packet_queue_next* field is used as the packet's next link in the queue.</span></span> <span data-ttu-id="80115-614">Драйвер определяет головной и заключительный указатели очереди передачи.</span><span class="sxs-lookup"><span data-stu-id="80115-614">The driver defines the head and tail pointers of the transmit queue.</span></span>

> [!CAUTION]  
> <span data-ttu-id="80115-615">*Так как доступ к этой очереди осуществляется из частей драйвера, отвечающих за обработку потока и прерываний, к операциям очереди должна применяться защита прерываний*.</span><span class="sxs-lookup"><span data-stu-id="80115-615">*Because this queue is accessed from thread and interrupt portions of the driver, interrupt protection must be placed around the queue manipulations*.</span></span>

<span data-ttu-id="80115-616">Большинство аппаратных реализаций создают прерывание по завершении передачи пакета.</span><span class="sxs-lookup"><span data-stu-id="80115-616">Most physical hardware implementations generate an interrupt upon packet transmit completion.</span></span> <span data-ttu-id="80115-617">Когда драйвер получает такое прерывание, он обычно освобождает ресурсы, связанные с только что переданным пакетом.</span><span class="sxs-lookup"><span data-stu-id="80115-617">When the driver receives such an interrupt, it typically releases the resources associated with the packet just being transmitted.</span></span> <span data-ttu-id="80115-618">В случае если логика передачи считывает данные непосредственно из буфера NX_PACKET, драйвер должен использовать службу ***nx_packet_transmit_release***, чтобы вернуть пакет, связанный с прерыванием завершения передачи, в доступный пул пакетов.</span><span class="sxs-lookup"><span data-stu-id="80115-618">In case the transmit logic reads data directly from the NX_PACKET buffer, the driver should use the ***nx_packet_transmit_release*** service to release the packet associated with the transmit complete interrupt back to the available packet pool.</span></span> <span data-ttu-id="80115-619">Затем драйвер проверяет очередь передачи на наличие дополнительных пакетов, ожидающих отправки.</span><span class="sxs-lookup"><span data-stu-id="80115-619">Next, the driver examines the transmit queue for additional packets waiting to be sent.</span></span> <span data-ttu-id="80115-620">Из очереди извлекается и загружается в буферы столько пакетов, сколько помещается в аппаратные буферы передачи.</span><span class="sxs-lookup"><span data-stu-id="80115-620">As many of the queued transmit packets that fit into the hardware transmit buffer(s) are de-queued and loaded into the buffers.</span></span> <span data-ttu-id="80115-621">За этим следует инициация следующей операции отправки.</span><span class="sxs-lookup"><span data-stu-id="80115-621">This is followed by initiation of another send operation.</span></span>

<span data-ttu-id="80115-622">Как только данные в NX_PACKET перемещаются в передатчик FIFO (или, если драйвер поддерживает операцию нулевого копирования, как только данные в NX_PACKET передаются), драйвер должен переместить *nx_packet_prepend_ptr* в начало заголовка IP перед вызовом ***nx_packet_transmit_release** _. Не забудьте соответствующим образом настроить поле _nx_packet_length*.</span><span class="sxs-lookup"><span data-stu-id="80115-622">As soon as the data in the NX_PACKET has been moved into the transmitter FIFO (or in case a driver supports zero-copy operation, the data in NX_PACKET has been transmitted), the driver must move the *nx_packet_prepend_ptr* to the beginning of the IP header before calling ***nx_packet_transmit_release.** _ Remember to adjust _nx_packet_length* field accordingly.</span></span> <span data-ttu-id="80115-623">Если IP-кадр состоит из нескольких пакетов, необходимо освободить только головной элемент цепочки пакетов.</span><span class="sxs-lookup"><span data-stu-id="80115-623">If an IP frame is made up of multiple packets, only the head of the packet chain needs to be released.</span></span>

## <a name="driver-input"></a><span data-ttu-id="80115-624">Входные данные драйвера</span><span class="sxs-lookup"><span data-stu-id="80115-624">Driver Input</span></span>

<span data-ttu-id="80115-625">Приняв прерывание получения пакета, сетевой драйвер извлекает пакет из приемных буферов физического оборудования и создает допустимый пакет NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="80115-625">Upon reception of a received packet interrupt, the network driver retrieves the packet from the physical hardware receive buffers and builds a valid NetX Duo packet.</span></span> <span data-ttu-id="80115-626">Формирование допустимого пакета NetX Duo включает в себя настройку поля соответствующей длины и объединение нескольких пакетов в цепочку, если размер входящего пакета превышает размер полезных данных одного пакета.</span><span class="sxs-lookup"><span data-stu-id="80115-626">Building a valid NetX Duo packet involves setting up the appropriate length field and chaining together multiple packets if the incoming packet's size is greater than a single packet payload.</span></span> <span data-ttu-id="80115-627">После правильного построения *prepend_ptr* перемещается на место после заголовка физического слоя и полученный пакет отправляется в NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="80115-627">Once properly built, the *prepend_ptr* is moved after the physical layer header and the receive packet is dispatched to NetX Duo.</span></span>

<span data-ttu-id="80115-628">В NetX Duo предполагается, что заголовки протоколов IP (IPv4 и IPv6) и ARP выравниваются по границе **ULONG**.</span><span class="sxs-lookup"><span data-stu-id="80115-628">NetX Duo assumes that the IP (IPv4 and IPv6) and ARP headers are aligned on a **ULONG** boundary.</span></span> <span data-ttu-id="80115-629">Следовательно, драйвер NetX Duo должен обеспечить такое выравнивание.</span><span class="sxs-lookup"><span data-stu-id="80115-629">The NetX Duo driver must, therefore, ensure this alignment.</span></span> <span data-ttu-id="80115-630">В средах Ethernet это достигается за счет того, что заголовок Ethernet начинается через 2 байт от начала пакета.</span><span class="sxs-lookup"><span data-stu-id="80115-630">In Ethernet environments this is done by starting the Ethernet header two bytes from the beginning of the packet.</span></span> <span data-ttu-id="80115-631">Когда *nx_packet_prepend_ptr* перемещается за пределы заголовка Ethernet, базовый заголовок IP (IPv4 и IPv6) или ARP выравнивается по границе 4 байт.</span><span class="sxs-lookup"><span data-stu-id="80115-631">When the *nx_packet_prepend_ptr* is moved beyond the Ethernet header, the underlying IP (IPv4 and IPv6) or ARP header is 4-byte aligned.</span></span>

> [!WARNING] 
> <span data-ttu-id="80115-632">*Важные различия между заголовками IPv6 и IPv6 Ethernet см. в разделе "Заголовки Ethernet" ниже*.</span><span class="sxs-lookup"><span data-stu-id="80115-632">*See the section "Ethernet Headers" below for important differences between IPv6 and IPv6 Ethernet headers*.</span></span>

<span data-ttu-id="80115-633">В NetX Duo доступно несколько функций получения пакетов.</span><span class="sxs-lookup"><span data-stu-id="80115-633">There are several receive packet functions available in NetX Duo.</span></span> <span data-ttu-id="80115-634">Если полученный пакет является пакетом ARP, вызывается _\***nx_arp_packet_deferred_receive**_.</span><span class="sxs-lookup"><span data-stu-id="80115-634">If the received packet is an ARP packet, _\***nx_arp_packet_deferred_receive**_ is called.</span></span> <span data-ttu-id="80115-635">Если полученный пакет является пакетом RARP, вызывается _ _*_nx_rarp_packet_deferred_receive_*_.</span><span class="sxs-lookup"><span data-stu-id="80115-635">If the received packet is an RARP packet, _ _*_nx_rarp_packet_deferred_receive_*_ is called.</span></span> <span data-ttu-id="80115-636">Существует несколько вариантов обработки входящих IP-пакетов.</span><span class="sxs-lookup"><span data-stu-id="80115-636">There are several options for handling incoming IP packets.</span></span> <span data-ttu-id="80115-637">Для максимально быстрой обработки IP-пакетов вызывается функция _ _*_nx_ip_packet_receive_*_.</span><span class="sxs-lookup"><span data-stu-id="80115-637">For the fastest handling of IP packets, _ _*_nx_ip_packet_receive_*_ is called.</span></span> <span data-ttu-id="80115-638">Этот подход имеет минимальные издержки, но оказывает более высокую нагрузку на подпрограмму обработки прерываний (ISR) драйвера.</span><span class="sxs-lookup"><span data-stu-id="80115-638">This approach has the least overhead, but requires more processing in the driver's receive interrupt service handler (ISR).</span></span> <span data-ttu-id="80115-639">Для минимальной нагрузки на ISR вызывается __ \*_nx_ip_packet_deferred_receive_\*\*.</span><span class="sxs-lookup"><span data-stu-id="80115-639">For minimal ISR processing __ *_nx_ip_packet_deferred_receive_*\* is called.</span></span>

<span data-ttu-id="80115-640">После того как новый пакет приема будет правильно сформирован, буферы приема физического оборудования подготавливаются к приему дополнительных данных.</span><span class="sxs-lookup"><span data-stu-id="80115-640">After the new receive packet is properly built, the physical hardware's receive buffers are setup to receive more data.</span></span> <span data-ttu-id="80115-641">Для этого может потребоваться выделение пакетов NetX Duo и размещение адреса полезных данных в аппаратном буфере приема. Однако может быть достаточно всего лишь изменить параметр в аппаратном буфере приема.</span><span class="sxs-lookup"><span data-stu-id="80115-641">This might require allocating NetX Duo packets and placing the payload address in the hardware receive buffer or it may simply amount to changing a setting in the hardware receive buffer.</span></span> <span data-ttu-id="80115-642">Для снижения риска переполнения важно, чтобы аппаратные буферы приема становились доступными как можно скорее после получения пакета.</span><span class="sxs-lookup"><span data-stu-id="80115-642">To minimize overrun possibilities, it is important that the hardware's receive buffers have available buffers as soon as possible after a packet is received.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="80115-643">*Исходные буферы приема настраиваются во время инициализации драйвера*.</span><span class="sxs-lookup"><span data-stu-id="80115-643">*The initial receive buffers are setup during driver initialization*.</span></span>

### <a name="deferred-receive-packet-handling"></a><span data-ttu-id="80115-644">Отложенная обработка получаемых пакетов</span><span class="sxs-lookup"><span data-stu-id="80115-644">Deferred Receive Packet Handling</span></span>  
<span data-ttu-id="80115-645">Драйвер может перекладывать обработку принимаемых пакетов на вспомогательный поток IP в NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="80115-645">The driver may defer receive packet processing to the NetX Duo IP helper thread.</span></span> <span data-ttu-id="80115-646">В некоторых приложениях это может быть необходимо для снижения нагрузки на ISR и уменьшения количества отброшенных пакетов.</span><span class="sxs-lookup"><span data-stu-id="80115-646">For some applications this may be necessary to minimize ISR processing as well as dropped packets.</span></span> 

<span data-ttu-id="80115-647">Для использования отложенной обработки пакетов необходимо сначала скомпилировать библиотеку NetX Duo с параметром \***NX_DRIVER_DEFERRED_PROCESSING** _.</span><span class="sxs-lookup"><span data-stu-id="80115-647">To use deferred packet handling, the NetX Duo library must first be compiled with \***NX_DRIVER_DEFERRED_PROCESSING** _ defined.</span></span> <span data-ttu-id="80115-648">В результате логика отложенной обработки пакетов будет добавлена во вспомогательный поток IP NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="80115-648">This adds the deferred packet logic to the NetX Duo IP helper thread.</span></span> <span data-ttu-id="80115-649">Затем при получении пакета данных драйвер должен вызвать __nx_ip_packet_deferred_receive():\*</span><span class="sxs-lookup"><span data-stu-id="80115-649">Next, on receiving a data packet, the driver must call __nx_ip_packet_deferred_receive():\*</span></span>

```c
_nx_ip_packet_deferred_receive(ip_ptr, packet_ptr);
```
<span data-ttu-id="80115-650">Функция отложенного приема помещает полученный пакет, представленный указателем *packet_ptr*, в связанный список FIFO и уведомляет вспомогательный поток IP.</span><span class="sxs-lookup"><span data-stu-id="80115-650">The deferred receive function places the receive packet represented by *packet_ptr* on a FIFO (linked list) and notifies the IP helper thread.</span></span> <span data-ttu-id="80115-651">После выполнения вспомогательный поток IP многократно вызывает функцию отложенной обработки для обработки каждого отложенного пакета.</span><span class="sxs-lookup"><span data-stu-id="80115-651">After executing, the IP helper repetitively calls the deferred handling function to process each deferred packet.</span></span> <span data-ttu-id="80115-652">Отложенная обработка обычно включает в себя удаление заголовка пакета физического уровня (обычно Ethernet) и отправку его в одну из следующих функций приема NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="80115-652">The deferred handler processing typically includes removing the packet's physical layer header (usually Ethernet) and dispatching it to one of these NetX Duo receive functions:</span></span>

- <span data-ttu-id="80115-653">***_nx_ip_packet_receive***</span><span class="sxs-lookup"><span data-stu-id="80115-653">***_nx_ip_packet_receive***</span></span>
- <span data-ttu-id="80115-654">***_nx_arp_packet_deferred_receive***</span><span class="sxs-lookup"><span data-stu-id="80115-654">***_nx_arp_packet_deferred_receive***</span></span>
- <span data-ttu-id="80115-655">***_nx_rarp_packet_deferred_receive***</span><span class="sxs-lookup"><span data-stu-id="80115-655">***_nx_rarp_packet_deferred_receive***</span></span>

## <a name="ethernet-headers"></a><span data-ttu-id="80115-656">Заголовки Ethernet</span><span class="sxs-lookup"><span data-stu-id="80115-656">Ethernet Headers</span></span> 

<span data-ttu-id="80115-657">Одно из наиболее существенных различий между IPv6 и IPv4 в плане заголовков Ethernet — это параметр типа кадра.</span><span class="sxs-lookup"><span data-stu-id="80115-657">One of the most significant differences between IPv6 and IPv4 for Ethernet Headers is the frame type setting.</span></span> <span data-ttu-id="80115-658">При отправке пакетов драйвер Ethernet отвечает за указание типа кадра Ethernet в исходящих пакетах.</span><span class="sxs-lookup"><span data-stu-id="80115-658">When sending out packets, the Ethernet driver is responsible for setting the Ethernet frame type in outgoing packets.</span></span> <span data-ttu-id="80115-659">Для пакетов IPv6 тип кадра должен быть 0x86DD; для пакетов IPv4 — 0x0800.</span><span class="sxs-lookup"><span data-stu-id="80115-659">For IPv6 packets, the frame type should be 0x86DD; for IPv4 packets, the frame type should be 0x0800.</span></span>

<span data-ttu-id="80115-660">В следующем фрагменте кода демонстрируется этот процесс.</span><span class="sxs-lookup"><span data-stu-id="80115-660">The following code segment illustrates this process:</span></span>

```c
NX_PACKET *packet_ptr;
packet_ptr = driver_req_ptr -> nx_ip_driver_packet;
if (packet_ptr -> nx_packet_ip_version == NX_IP_VERSION_V4)
{

   /* Set Ethernet frame type to IPv4 /*
   ethernet_frame_ptr -> frame_type = 0x0800;

   /* Swap endian-ness for little endian targets.*/
   NX_CHANGE_USHORT_ENDIAN(ethernet_frame_ptr -> frame_type);
}
else if (packet_ptr -> nx_packet_ip_version == NX_IP_VERSION_V6)
{

   /* Set Ethernet frame type to IPv6. /*
   ethernet_frame_ptr -> frame_type = 0x86DD;

   /* Swap endian-ness for little endian targets.*/
   NX_CHANGE_USHORT_ENDIAN(ethernet_frame_ptr -> frame_type);
}
else
{

   /* Unknown IP version. Free the packet we will not send. */
   nx_packet_transmit_release(packet_ptr);
}
```
<span data-ttu-id="80115-661">Аналогичным образом, для входящих пакетов драйвер Ethernet должен определить тип пакета по типу кадра Ethernet.</span><span class="sxs-lookup"><span data-stu-id="80115-661">Similarly, for incoming packets, the Ethernet driver should determine the packet type from the Ethernet frame type.</span></span> <span data-ttu-id="80115-662">Он должен принимать типы кадров IPv6 (0x86DD), IPv4 (0x0800), ARP (0x0806) и RARP (0x8035).</span><span class="sxs-lookup"><span data-stu-id="80115-662">It should be implemented to accept IPv6 (0x86DD), IPv4 (0x0800), ARP (0x0806), and RARP (0x8035) frame types.</span></span>

## <a name="example-ram-ethernet-network-driver"></a><span data-ttu-id="80115-663">Пример сетевого драйвера Ethernet в ОЗУ</span><span class="sxs-lookup"><span data-stu-id="80115-663">Example RAM Ethernet Network Driver</span></span>

<span data-ttu-id="80115-664">Демонстрационная система NetX Duo поставляется с небольшим сетевым драйвером, работающим в ОЗУ. Он определяется в файле ***nx_ram_network_driver.c***.</span><span class="sxs-lookup"><span data-stu-id="80115-664">The NetX Duo demonstration system is delivered with a small RAM-based network driver, defined in the file ***nx_ram_network_driver.c.***</span></span> <span data-ttu-id="80115-665">В этом драйвере предполагается, что экземпляры IP находятся в одной сети и при их создании каждому экземпляру устройства просто назначаются виртуальные аппаратные адреса (MAC-адреса).</span><span class="sxs-lookup"><span data-stu-id="80115-665">This driver assumes the IP instances are all on the same network and simply assigns virtual hardware addresses (MAC addresses) to each device instance as they are created.</span></span> <span data-ttu-id="80115-666">Этот файл служит хорошим примером базовой структуры драйверов физической сети NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="80115-666">This file provides a good example of the basic structure of NetX Duo physical network drivers.</span></span> <span data-ttu-id="80115-667">Пользователи могут разрабатывать собственные сетевые драйверы с помощью платформы драйверов, представленной в этом примере.</span><span class="sxs-lookup"><span data-stu-id="80115-667">Users may develop their own network drivers using the driver framework presented in this example.</span></span>

<span data-ttu-id="80115-668">Функция входа сетевого драйвера — \* **_nx_ram_network_driver(),** _. Она передается в вызов создания экземпляра IP.</span><span class="sxs-lookup"><span data-stu-id="80115-668">The entry function of the network driver is \***_nx_ram_network_driver(),** _ which is passed to the IP instance create call.</span></span> <span data-ttu-id="80115-669">Функции входа для дополнительных сетевых интерфейсов можно передать в службу _nx_ip_interface_attach()\*.</span><span class="sxs-lookup"><span data-stu-id="80115-669">Entry functions for additional network interfaces can be passed into the _nx_ip_interface_attach()\* service.</span></span> <span data-ttu-id="80115-670">После запуска экземпляра IP вызывается функция входа драйвера для инициализации и включения устройства (см. **NX_LINK_INITIALIZE** и **NX_LINK_ENABLE**).</span><span class="sxs-lookup"><span data-stu-id="80115-670">After the IP instance starts to run, the driver entry function is invoked to initialize and enable the device (refer to the case **NX_LINK_INITIALIZE** and **NX_LINK_ENABLE**).</span></span> <span data-ttu-id="80115-671">После выполнения команды **NX_LINK_ENABLE** устройство должно быть готово к передаче и получению пакетов.</span><span class="sxs-lookup"><span data-stu-id="80115-671">After the **NX_LINK_ENABLE** command is issued, the device should be ready to transmit and receive packets.</span></span> 

<span data-ttu-id="80115-672">Экземпляр IP передает сетевые пакеты с помощью одной из следующих команд.</span><span class="sxs-lookup"><span data-stu-id="80115-672">The IP instance transmits network packets via one of these commands:</span></span>

|                                 |                                                                |
| ------------------------------- | -------------------------------------------------------------- |
| <span data-ttu-id="80115-673">***NX_LINK_PACKET_SEND***</span><span class="sxs-lookup"><span data-stu-id="80115-673">***NX_LINK_PACKET_SEND***</span></span>    | <span data-ttu-id="80115-674">Передается пакет IPv4 или IPv6.</span><span class="sxs-lookup"><span data-stu-id="80115-674">An IPv4 or IPv6 packet is being transmitted,</span></span>                   |
| <span data-ttu-id="80115-675">***NX_LINK_ARP_SEND***</span><span class="sxs-lookup"><span data-stu-id="80115-675">***NX_LINK_ARP_SEND***</span></span>       | <span data-ttu-id="80115-676">Передается пакет запроса или ответа ARP.</span><span class="sxs-lookup"><span data-stu-id="80115-676">An ARP request or ARP response packet is being transmitted,</span></span>    |
| <span data-ttu-id="80115-677">***NX_LINK_ARP_RARP_SEND***</span><span class="sxs-lookup"><span data-stu-id="80115-677">***NX_LINK_ARP_RARP_SEND***</span></span> | <span data-ttu-id="80115-678">Передается пакет запроса или ответа RARP.</span><span class="sxs-lookup"><span data-stu-id="80115-678">A Reverse ARP request or response packet is being transmitted,</span></span> |

<span data-ttu-id="80115-679">При обработке этих команд сетевому драйверу необходимо добавить в начало соответствующий заголовок кадра Ethernet, а затем отправить его в базовое оборудование для передачи.</span><span class="sxs-lookup"><span data-stu-id="80115-679">On processing these commands, the network driver needs to prepend the appropriate Ethernet frame header, and then send it to the underlying hardware for transmission.</span></span> <span data-ttu-id="80115-680">В процессе передачи сетевой драйвер получает монопольное владение областью буфера пакетов.</span><span class="sxs-lookup"><span data-stu-id="80115-680">During the transmission process, the network driver has the exclusive ownership of the packet buffer area.</span></span> <span data-ttu-id="80115-681">Таким образом, после передачи данных (или их копирования во внутренний буфер передачи драйвера) сетевой драйвер должен освободить буфер пакетов, сначала переместив указатель prepend на место после заголовка Ethernet в заголовок IP (и изменив длину пакета соответствующим образом), а затем вызвав службу ***nx_packet_transmit_release()***, чтобы освободить пакет.</span><span class="sxs-lookup"><span data-stu-id="80115-681">Therefore once the data is being transmitted (or once the data has been copied into the driver internal transfer buffer), the network driver is responsible for releasing the packet buffer by first moving the prepend pointer past the Ethernet header to the IP header (and adjust packet length accordingly), and then by calling the ***nx_packet_transmit_release()*** service to release the packet.</span></span> <span data-ttu-id="80115-682">Если не освободить пакет после передачи данных, это приведет к утечке пакетов.</span><span class="sxs-lookup"><span data-stu-id="80115-682">Not releasing the packet after data transmission will cause packets to leak.</span></span>

<span data-ttu-id="80115-683">Драйвер сетевого устройства также отвечает за обработку входящих пакетов данных.</span><span class="sxs-lookup"><span data-stu-id="80115-683">The network device driver is also responsible for handling incoming data packets.</span></span> <span data-ttu-id="80115-684">В примере драйвера в ОЗУ полученный пакет обрабатывается функцией ***_nx_ram_network_driver_receive()***.</span><span class="sxs-lookup"><span data-stu-id="80115-684">In the RAM driver example, the received packet is processed by the function ***_nx_ram_network_driver_receive()***.</span></span> <span data-ttu-id="80115-685">Когда устройство получает кадр Ethernet, драйвер должен сохранить данные в структуре NX_PACKET.</span><span class="sxs-lookup"><span data-stu-id="80115-685">Once the device receives an Ethernet frame, the driver is responsible for storing the data in  NX_PACKET structure.</span></span> <span data-ttu-id="80115-686">Обратите внимание: в NetX Duo предполагается, что заголовок IP начинается с адреса с выравниванием по границе 4 байт.</span><span class="sxs-lookup"><span data-stu-id="80115-686">Note that NetX Duo assumes the IP header starts from 4-byte aligned address.</span></span> <span data-ttu-id="80115-687">Так как длина заголовка Ethernet равна 14 байт, драйверу необходимо сохранить начало заголовка Ethernet по адресу с выравниванием по границе 2 байт. Это позволит гарантировать, что заголовок IP будет начинаться с адреса с выравниванием по границе 4 байт.</span><span class="sxs-lookup"><span data-stu-id="80115-687">Since the length of Ethernet header is 14byte, the driver needs to store the starting of the Ethernet header at 2-byte aligned address to guarantee that the IP header starts at 4-byte aligned address.</span></span>