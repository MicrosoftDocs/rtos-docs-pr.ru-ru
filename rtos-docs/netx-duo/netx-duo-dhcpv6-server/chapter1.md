---
title: Глава 1. Общие сведения о DHCPv6-сервере NetX Duo для ОСРВ Azure
description: В этом документе подробно описано, как DHCPv6-сервер NetX Duo назначает IPv6-адреса клиентам DHCPv6.
author: philmea
ms.author: philmea
ms.date: 06/08/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 6cf7baa91b1804876b97b1d75d1872d1120ad028
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104814748"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-dhcpv6-server"></a><span data-ttu-id="8e91e-103">Глава 1. Общие сведения о DHCPv6-сервере NetX Duo для ОСРВ Azure</span><span class="sxs-lookup"><span data-stu-id="8e91e-103">Chapter 1 - Introduction to Azure RTOS NetX Duo DHCPv6 server</span></span>

<span data-ttu-id="8e91e-104">В сетях IPv6 для получения IPv6-адресов клиентами требуется протокол DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-104">In IPv6 networks, DHCPv6is required for Clients to obtain IPv6 addresses.</span></span> <span data-ttu-id="8e91e-105">Он не заменяет протокол DHCP, так как не может предоставлять IPv4-адреса.</span><span class="sxs-lookup"><span data-stu-id="8e91e-105">It does not replace DHCP which is limited to IPv4in that it does not offer IPv4 addresses.</span></span> <span data-ttu-id="8e91e-106">Протокол DHCPv6 схож с DHCP по своему функционалу, но имеет множество улучшений.</span><span class="sxs-lookup"><span data-stu-id="8e91e-106">DHCPv6 has similar features to DHCP as well as many enhancements.</span></span> <span data-ttu-id="8e91e-107">Клиент, который не может использовать или не использует автоматическую настройку IPv6-адресов без отслеживания состояния, может использовать DHCPv6 для получения уникального глобального IPv6-адреса с DHCPv6-сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-107">A Client who does not or cannot use IPv6 stateless address auto-configuration can use DHCPv6 to be assigned a unique global IPv6 address from a DHCPv6 Server.</span></span>

<span data-ttu-id="8e91e-108">NetX Duo изначально поддерживает приложения и сетевые протоколы на основе IPv6, такие как DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-108">NetX Duo was developed to support IPv6 network based applications and network protocols such as DHCPv6.</span></span> <span data-ttu-id="8e91e-109">В этом документе подробно описано, как DHCPv6-сервер NetX Duo назначает IPv6-адреса клиентам DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-109">This document will explain in detail how the NetX Duo DHCPv6 Server assigns IPv6 addresses to DHCPv6 Clients.</span></span>

## <a name="dhcpv6-communication"></a><span data-ttu-id="8e91e-110">Обмен данными по протоколу DHCPv6</span><span class="sxs-lookup"><span data-stu-id="8e91e-110">DHCPv6 Communication</span></span>

<span data-ttu-id="8e91e-111">**Структура сообщения DHCPv6**</span><span class="sxs-lookup"><span data-stu-id="8e91e-111">**DHCPv6 Message structure**</span></span>

<span data-ttu-id="8e91e-112">Сообщение в основе своей состоит из заголовка, за которым следует один блок параметров или, как правило, несколько.</span><span class="sxs-lookup"><span data-stu-id="8e91e-112">Message content is basically a message header followed by one or more (usually more) option blocks.</span></span> <span data-ttu-id="8e91e-113">Ниже приведена базовая структура, в которой каждый блок представляет один байт.</span><span class="sxs-lookup"><span data-stu-id="8e91e-113">Below is the basic structure where each block represents one byte:</span></span>

![Схема сообщения DHCPv6 и структуры блока параметров.](media/image2.jpg)

<span data-ttu-id="8e91e-115">**Рис. 1. Сообщение DHCPv6 и структура блока параметров**</span><span class="sxs-lookup"><span data-stu-id="8e91e-115">**Figure 1. DHCPv6 message and option block structure**</span></span>

<span data-ttu-id="8e91e-116">Однобайтовое поле Msg-Type указывает тип сообщения DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-116">The 1-byte Msg-Type field indicates the type of DHCPv6 message.</span></span> <span data-ttu-id="8e91e-117">Значение трехбайтового поля Transaction-ID задается клиентом.</span><span class="sxs-lookup"><span data-stu-id="8e91e-117">The 3-byte Transaction-ID field is set by the Client.</span></span> <span data-ttu-id="8e91e-118">Это может быть любая последовательность символов, но она должна быть уникальной для каждого сообщения от клиента серверу (при отправке повторяющихся сообщений клиентом она сохраняется).</span><span class="sxs-lookup"><span data-stu-id="8e91e-118">It can by any sequence of characters but must be unique for each Client message to the Server (conserved across duplicate messages sent by the Client).</span></span> <span data-ttu-id="8e91e-119">Сервер использует поле Transaction-ID в каждом ответе клиенту, чтобы тот мог сопоставлять сообщения от сервера в случае задержки или потери пакетов в сети.</span><span class="sxs-lookup"><span data-stu-id="8e91e-119">The Server uses that Transaction-ID for each response to the Client to enable the Client to match up Server messages in the event of packets that are delayed or dropped on the network.</span></span> <span data-ttu-id="8e91e-120">За полем Transaction-ID следует один параметр DHCPv6 или несколько, которые указывают, что запрашивает клиент.</span><span class="sxs-lookup"><span data-stu-id="8e91e-120">Following the Transaction-ID field, are one or more DHCPv6 options used to indicate what the Client is requesting.</span></span>

<span data-ttu-id="8e91e-121">Структура параметра DHCPv6 состоит из кода параметра, поля длины параметра (длина полей кодов не учитывается) и, наконец, самих данных параметра, которые представляют собой одно двухбайтовое поле кодов параметров для данных, запрашиваемых клиентом, или несколько.</span><span class="sxs-lookup"><span data-stu-id="8e91e-121">The DHCPv6 option structure is composed of an option code, an option length field, which does not include the length or code fields, and finally the option data itself which is one or more 2 byte option code fields for the data the Client is requesting.</span></span>

<span data-ttu-id="8e91e-122">Некоторые блоки параметров имеют вложенные параметры.</span><span class="sxs-lookup"><span data-stu-id="8e91e-122">Some option blocks have nested options.</span></span> <span data-ttu-id="8e91e-123">Например, параметр *Ассоциация удостоверений для невременных адресов (IANA)* содержит один параметр *Ассоциация удостоверений (IA)* или несколько для запроса IPv6-адресов.</span><span class="sxs-lookup"><span data-stu-id="8e91e-123">For example, an *Identity Association for Non Temporary Address (IANA)* option contains one or more *Identity Association (IA)* options to request IPv6 addresses.</span></span> <span data-ttu-id="8e91e-124">Параметр *IANA*, возвращаемый в ответном сообщении сервера, содержит те же параметры *IA* с предоставленным сервером IPv6-адресом и сроком аренды, а также параметр *состояния*, указывающий на наличие ошибки при выполнении запроса адреса от клиента.</span><span class="sxs-lookup"><span data-stu-id="8e91e-124">The *IANA* option returned in the Server Reply message contains the same *IA* option(s) with the IPv6 address and lease times granted by the Server, as well as a *Status* option indicating if there is an error with the Client address request.</span></span>

<span data-ttu-id="8e91e-125">Список всех блоков параметров и их описание приводится в **приложении А**.</span><span class="sxs-lookup"><span data-stu-id="8e91e-125">A list of all option blocks and their description is provided in **Appendix A**.</span></span>

<span data-ttu-id="8e91e-126">**Типы сообщений DHCPv6**</span><span class="sxs-lookup"><span data-stu-id="8e91e-126">**DHCPv6 Message Types**</span></span>

<span data-ttu-id="8e91e-127">Хотя протокол DHCPv6 значительно расширяет функциональные возможности DHCP, в нем предусмотрено то же количество сообщений, что и в DHCP, и поддерживает он те же параметры поставщика.</span><span class="sxs-lookup"><span data-stu-id="8e91e-127">Although DHCPv6 greatly enhances the functionality of DHCP, it uses the same number of messages as DHCP and supports the same vendor options as DHCP.</span></span> <span data-ttu-id="8e91e-128">Список сообщений DHCPv6</span><span class="sxs-lookup"><span data-stu-id="8e91e-128">The list of DHCPv6 messages are as follows:</span></span>

- <span data-ttu-id="8e91e-129">SOLICIT (1) (отправляется клиентом)</span><span class="sxs-lookup"><span data-stu-id="8e91e-129">SOLICT (1) (sent by Client)</span></span>
- <span data-ttu-id="8e91e-130">ADVERTISE (2) (отправляется сервером)</span><span class="sxs-lookup"><span data-stu-id="8e91e-130">ADVERTISE (2) (sent by Server)</span></span>
- <span data-ttu-id="8e91e-131">REQUEST (3) (отправляется клиентом)</span><span class="sxs-lookup"><span data-stu-id="8e91e-131">REQUEST (3) (sent by Client)</span></span>
- <span data-ttu-id="8e91e-132">REPLY (7) (отправляется сервером)</span><span class="sxs-lookup"><span data-stu-id="8e91e-132">REPLY (7) (sent by Server)</span></span>
- <span data-ttu-id="8e91e-133">CONFIRM (4) (отправляется клиентом)</span><span class="sxs-lookup"><span data-stu-id="8e91e-133">CONFIRM (4) (sent by Client)</span></span>
- <span data-ttu-id="8e91e-134">RENEW (5) (отправляется клиентом)</span><span class="sxs-lookup"><span data-stu-id="8e91e-134">RENEW (5) (sent by Client)</span></span>
- <span data-ttu-id="8e91e-135">REBIND (6) (отправляется клиентом)</span><span class="sxs-lookup"><span data-stu-id="8e91e-135">REBIND (6) (sent by Client)</span></span>
- <span data-ttu-id="8e91e-136">RELEASE (8) (отправляется клиентом)</span><span class="sxs-lookup"><span data-stu-id="8e91e-136">RELEASE (8) (sent by Client)</span></span>
- <span data-ttu-id="8e91e-137">DECLINE (9) (отправляется клиентом)</span><span class="sxs-lookup"><span data-stu-id="8e91e-137">DECLINE (9) (sent by Client)</span></span>
- <span data-ttu-id="8e91e-138">INFORM_REQUEST (11) (отправляется клиентом)</span><span class="sxs-lookup"><span data-stu-id="8e91e-138">INFORM_REQUEST (11) (sent by Client)</span></span>
- <span data-ttu-id="8e91e-139">RECONFIGURE\* (10) (отправляется сервером)</span><span class="sxs-lookup"><span data-stu-id="8e91e-139">RECONFIGURE\* (10) (sent by Server)</span></span>

<span data-ttu-id="8e91e-140">\*Сообщение RECONFIGURE не поддерживается DHCPv6-сервером NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="8e91e-140">\*RECONFIGURE is not supported by the NetX Duo DHCPv6 Server.</span></span>

<span data-ttu-id="8e91e-141">Базовая последовательность DHCPv6-запросов выглядит следующим образом (в скобках приводятся эквивалентные типы сообщений DHCPv4).</span><span class="sxs-lookup"><span data-stu-id="8e91e-141">The basic DHCPv6 request sequence, with the equivalent DHCPv4 message type in parenthesis, is as follows:</span></span>

<span data-ttu-id="8e91e-142">Клиент ***Solicit** _ (_Discovery *) Сервер **Advertisement** (* Offer *) Клиент **Request** (* Request *) Сервер **Reply** (* DHCPAck*)</span><span class="sxs-lookup"><span data-stu-id="8e91e-142">Client ***Solicit** _ (_Discovery *) Server **Advertisement** (* Offer *) Client **Request** (* Request *) Server **Reply** (* DHCPAck*)</span></span>

<span data-ttu-id="8e91e-143">Клиент **Renew**(same) Сервер **Reply** (*DHCPAck*)</span><span class="sxs-lookup"><span data-stu-id="8e91e-143">Client **Renew**(same) Server **Reply** (*DHCPAck*)</span></span>

## <a name="dhcpv6-message-validation"></a><span data-ttu-id="8e91e-144">Проверка сообщения DHCPv6</span><span class="sxs-lookup"><span data-stu-id="8e91e-144">DHCPv6 Message Validation</span></span>

<span data-ttu-id="8e91e-145">Идентификатор транзакции: клиент должен создавать идентификатор транзакции для каждого сообщения, отправляемого на сервер.</span><span class="sxs-lookup"><span data-stu-id="8e91e-145">Transaction ID: The Client must generate a transaction ID for each message it sends to the Server.</span></span> <span data-ttu-id="8e91e-146">DHCPv6-сервер отклоняет любое сообщение от клиента, не совпадающее с этим идентификатором.</span><span class="sxs-lookup"><span data-stu-id="8e91e-146">The DHCPv6 Server will reject any message from the Client not matching this transaction ID.</span></span> <span data-ttu-id="8e91e-147">Сервер, в свою очередь, должен использовать тот же идентификатор транзакции в ответах клиенту.</span><span class="sxs-lookup"><span data-stu-id="8e91e-147">The Server in turn must use the same transaction ID in its responses back to the Client.</span></span>

<span data-ttu-id="8e91e-148">**Уникальные идентификаторы (DUID) DHCPv6**</span><span class="sxs-lookup"><span data-stu-id="8e91e-148">**DHCPv6 unique Identifiers (DUIDs)**</span></span>

<span data-ttu-id="8e91e-149">Все сообщения от сервера должны также включать в себя уникальный идентификатор DHCPv6 (DUID), иначе клиент DHCPv6 не примет их.</span><span class="sxs-lookup"><span data-stu-id="8e91e-149">All Server messages must also include a DHCPv6 unique Identifier (DUID) in each message or the DHCPv6 Client should not accept the message.</span></span> <span data-ttu-id="8e91e-150">Идентификатор DUID канального уровня (LL) — это блок управления, содержащий MAC-адрес клиента, тип оборудования и тип DUID.</span><span class="sxs-lookup"><span data-stu-id="8e91e-150">A Link Layer (LL) DUID is a control block containing client MAC address, hardware type, and DUID type.</span></span> <span data-ttu-id="8e91e-151">Идентификатор DUID времени канального уровня (LLT) также содержит поле времени, которое снижает вероятность того, что идентификатор DUID не будет уникальным в сети узла.</span><span class="sxs-lookup"><span data-stu-id="8e91e-151">A Link Layer Time (LLT) DUID additionally contains a time field which decreases the chances the DUID will not be unique on the host network.</span></span> <span data-ttu-id="8e91e-152">По этой причине стандарт RFC 3315 рекомендует использовать идентификаторы DUID типа LLT, а не LL.</span><span class="sxs-lookup"><span data-stu-id="8e91e-152">For that reason RFC 3315 recommends LLT DUIDs over LL DUIDs.</span></span> <span data-ttu-id="8e91e-153">Если ведущее приложение не создает собственное уникальное значение времени, компонент DHCPv6 NetX Duo предоставит значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="8e91e-153">If the host application does not create its own unique time value, NetX Duo DHCPv6 will provide a default one.</span></span> <span data-ttu-id="8e91e-154">Третьим типом идентификатора DUID является DUID предприятия (назначаемый поставщиком). Он содержит идентификатор предприятия, зарегистрированный в IANA, и частные данные, которые могут различаться по типу и длине, например в зависимости от размера памяти, типа операционной системы и конфигурации оборудования.</span><span class="sxs-lookup"><span data-stu-id="8e91e-154">The third type of DUID is the Enterprise (Vendor assigned) DUID which contains a registered Enterprise ID (as in registered with IANA) and private data that is variable in type and length e.g. based on memory size, operating system type of other hardware configuration.</span></span> <span data-ttu-id="8e91e-155">Сведения о настройке назначаемых поставщиком сервера и частных значений идентификатора см. в списке параметров конфигурации далее в этом документе.</span><span class="sxs-lookup"><span data-stu-id="8e91e-155">See the list of Configuration Options elsewhere in this document for setting up the Server vendor assigned and private ID values.</span></span>

<span data-ttu-id="8e91e-156">Клиент также должен включать свой идентификатор DUID в сообщения серверу (за исключением INFORM_REQUEST), иначе сервер отклонит их.</span><span class="sxs-lookup"><span data-stu-id="8e91e-156">The Client must also include its DUID in its messages to the Server except for INFORM_REQUEST, or the Server will reject them.</span></span>

<span data-ttu-id="8e91e-157">**Сеансы "клиент — сервер" DHCPv6**</span><span class="sxs-lookup"><span data-stu-id="8e91e-157">**DHCPv6 Client Server Sessions**</span></span>

<span data-ttu-id="8e91e-158">Клиенты и серверы DHCPv6 обмениваются сообщениями по протоколу UDP.</span><span class="sxs-lookup"><span data-stu-id="8e91e-158">DHCPv6 Clients and Servers exchange messages over UDP.</span></span> <span data-ttu-id="8e91e-159">Клиент использует порт 546 для отправки и получения сообщений DHCPv6, а сервер использует порт 547.</span><span class="sxs-lookup"><span data-stu-id="8e91e-159">The Client uses port 546 to send and receive DHCPv6 messages and the Server uses port 547.</span></span> <span data-ttu-id="8e91e-160">Изначально клиент использует локальный адрес канала для передачи и получения сообщений DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-160">The Client initially uses its link-local address for transmitting and receiving DHCPv6 messages.</span></span> <span data-ttu-id="8e91e-161">Он отправляет все сообщения на DHCPv6-серверы, используя зарезервированный адрес многоадресного взаимодействия канального уровня, известный как адрес многоадресного взаимодействия *All_DHCP_Relay_Agents_and_Servers* *(FF02::01:02)* .</span><span class="sxs-lookup"><span data-stu-id="8e91e-161">It sends all messages to DHCPv6 servers using a reserved, link-scoped multicast address known as the *All_DHCP_Relay_Agents_and_Servers* multicast address *(FF02::01:02)*.</span></span>

<span data-ttu-id="8e91e-162">Для обработки запросов на назначение IPv6-адресов DHCPv6-сервер прослушивает сообщения *SOLICIT*, отправляемые по адресу *All_DHCP_Relay_Agents_and_Servers*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-162">ForIPv6 address assignment requests, the DHCPv6 Server listens for *Solicit* messages sent to the *All_DHCP_Relay_Agents_and_Servers* address.</span></span> <span data-ttu-id="8e91e-163">В запросе *SOLICIT* клиент может запросить назначение конкретного IPv6-адреса или дать серверу возможность выбрать адрес.</span><span class="sxs-lookup"><span data-stu-id="8e91e-163">In the *Solicit* request, the Client can request the assignment of specific IPv6 address or let the Server choose one.</span></span> <span data-ttu-id="8e91e-164">Он также может запросить другие сведения о конфигурации сети с сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-164">It can also request other network configuration information from the Server.</span></span>

<span data-ttu-id="8e91e-165">Если DHCPv6-сервер получает допустимое сообщение *SOLICIT* и может назначить клиенту IPv6-адрес, он отвечает сообщением *ADVERTISE*. Оно содержит IPv6-адрес, который будет предоставлен клиенту, срок аренды IPv6-адреса и дополнительные сведения, запрошенные клиентом.</span><span class="sxs-lookup"><span data-stu-id="8e91e-165">If the DHCPv6Server extracts a valid *Solicit* message and can assign an IPv6 address to the Client, it responds with an *Advertise* message containing the IPv6 address it will grant to the Client, the IPv6 address lease time and any additional information requested by the Client.</span></span> <span data-ttu-id="8e91e-166">Если клиент принимает предложение сервера, он отправляет в ответ сообщение *REQUEST*, уведомляя тем самым сервер о принятии IPv6-адреса.</span><span class="sxs-lookup"><span data-stu-id="8e91e-166">If the Client accepts the Server offer it responds with a *Request* message letting the Server know it will accept the IPv6 address.</span></span> <span data-ttu-id="8e91e-167">Сервер подтверждает привязку клиента к IPv6-адресу с помощью сообщения *REPLY*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-167">The Server confirms the Client is bound to the IPv6 address with a *Reply* message.</span></span>

<span data-ttu-id="8e91e-168">Если сообщение клиента DHCPv6 недопустимо, сервер отклоняет его без уведомления.</span><span class="sxs-lookup"><span data-stu-id="8e91e-168">If the Client DHCPv6 message is invalid, the Server will discard the message silently.</span></span> <span data-ttu-id="8e91e-169">Если сервер не может предоставить адрес, он отправляет сообщение *REPLY* с указанием проблемы в поле состояния параметра IANA IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="8e91e-169">If the Server is unable to grant the request it will send a *Reply* message with an indication of the problem in the status field of the IP address IANA option.</span></span> <span data-ttu-id="8e91e-170">При получении повторяющихся запросов от клиента сервер повторно отправляет предыдущий ответ DHCPv6, предполагая, что клиент просто не получил пакет.</span><span class="sxs-lookup"><span data-stu-id="8e91e-170">If duplicate Client requests are received the Server resends its previous DHCPv6 response, assuming the Client simply did not receive the packet.</span></span>

<span data-ttu-id="8e91e-171">Клиент должен проверить, что IPv6-адрес, назначаемый сервером, не назначен другому узлу в системе. Для этого он использует различные протоколы IPv6, например протокол обнаружения дублирующихся адресов (DAD).</span><span class="sxs-lookup"><span data-stu-id="8e91e-171">It is up to the Client to verify that its assigned IPv6 address from the Server is not assigned to another host on the system by using various IPv6 protocols such as Duplicate Address Detection.</span></span> <span data-ttu-id="8e91e-172">Если адрес не уникален, клиент отправляет серверу сообщение *DECLINE*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-172">If the address is not unique, the Client will send the Server a *Decline* message.</span></span> <span data-ttu-id="8e91e-173">На основе этих сведений сервер обновляет свою таблицу аренды IP-адресов, регистрируя адрес как назначенный.</span><span class="sxs-lookup"><span data-stu-id="8e91e-173">The Server updates its IP lease table with this information, recording that the address is already assigned.</span></span> <span data-ttu-id="8e91e-174">Тем временем клиент должен начать процесс запроса DHCPv6 заново с помощью еще одного сообщения *SOLICIT*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-174">Meanwhile the Client must restart the DHCPv6 request process with another *Solicit* message.</span></span>

<span data-ttu-id="8e91e-175">Помимо IPv6-адреса, клиенту, скорее всего, также потребуются сведения о DNS-сервере и другие сведения о сети, например доменное имя сети.</span><span class="sxs-lookup"><span data-stu-id="8e91e-175">In addition to an IPv6 address, a Client will likely also need to know the DNS server and possibly other network information such as the network domain name.</span></span> <span data-ttu-id="8e91e-176">Протокол DHCPv6 дает возможность запрашивать эти сведения с помощью запросов параметров в сообщениях *SOLICIT* и *REQUEST* или отдельно в сообщениях *запроса информации*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-176">DHCPv6 provides the means to request this information using either the use of Option Requests in the *Solicit* and *Request* messages, or separately in *Information Request* messages.</span></span> <span data-ttu-id="8e91e-177">Параметры DHCPv6 описываются далее в этой главе.</span><span class="sxs-lookup"><span data-stu-id="8e91e-177">DHCPv6 options are explained later in this chapter.</span></span>

<span data-ttu-id="8e91e-178">**Срок аренды IPv6-адреса**</span><span class="sxs-lookup"><span data-stu-id="8e91e-178">**IPv6 Lease Duration**</span></span>

<span data-ttu-id="8e91e-179">Когда сервер предоставляет клиенту IPv6-адрес, он также назначает срок его аренды (время существования) в параметре IANA. По истечении этого срока клиенту рекомендуется начать продление (T1) или повторную привязку (T2) IPv6-адреса с помощью сообщений *RENEW* и *REBIND*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-179">When the Server grants an IPv6 address to a Client, it also assigns the lease duration (lifetime)in the IANA option for when it recommends the Client to start renewing (T1) or rebinding (T2) its IPv6 address using *Renew* and *Rebind* messages.</span></span> <span data-ttu-id="8e91e-180">Различие между ними заключается в том, что клиент направляет сообщение *RENEW* серверу, включая в запрос *RENEW* идентификатор DUID сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-180">The difference between the two is the Client directs the *Renew* message to the Server by including the Server DUID in the *Renew* request.</span></span> <span data-ttu-id="8e91e-181">Однако в сообщении *REBIND* на адрес *All_DHCP_Relay_Agents_and_Servers* конкретный сервер не указывается и, следовательно, не включается идентификатор DUID сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-181">However, it does not specify any server, and hence does not include a Server DUID, in the *Rebind* message to the *All_DHCP_Relay_Agents_and_Servers* address.</span></span> <span data-ttu-id="8e91e-182">Параметр IA, который содержит фактический IPv6-адрес, предоставляемый сервером клиенту, также содержит предпочтительное и допустимое время существования, когда арендуемый IPv6-адрес станет нерекомендуемым или устаревшим (недопустимым).</span><span class="sxs-lookup"><span data-stu-id="8e91e-182">The IA option which contains the actual IPv6 address the Server grants the Client also contains the preferred and valid lifetimes when the leased IPv6 address becomes deprecated or obsolete (invalid), respectively.</span></span>

<span data-ttu-id="8e91e-183">DHCPv6-сервер NetX Duo сохраняет время ожидания сеанса для каждого клиента, чтобы отслеживать время между сообщениями от него.</span><span class="sxs-lookup"><span data-stu-id="8e91e-183">The NetX Duo DHCPv6 Server maintains a session timeout for each Client to track the time between Client messages.</span></span> <span data-ttu-id="8e91e-184">Это необходимо на случай потери подключения узлом клиента или отказа сети.</span><span class="sxs-lookup"><span data-stu-id="8e91e-184">This is necessary in the event of a Client host losing connectivity or the network doing down.</span></span> <span data-ttu-id="8e91e-185">По истечении времени ожидания сеанса предполагается, что клиент больше не планирует или не может выполнять DHCPv6-запросы к серверу.</span><span class="sxs-lookup"><span data-stu-id="8e91e-185">When the session timeout expires, it is assumed the Client is either no longer interested or able to make DHCPv6 requests of the Server.</span></span> <span data-ttu-id="8e91e-186">Сервер удаляет запись клиента и возвращает все предварительно назначенные IPv6-адреса обратно в доступный пул.</span><span class="sxs-lookup"><span data-stu-id="8e91e-186">The Server deletes the Client record and returns any tentatively assigned IPv6 address back to the available pool.</span></span> <span data-ttu-id="8e91e-187">Время ожидания сеанса — это настраиваемый пользователем параметр.</span><span class="sxs-lookup"><span data-stu-id="8e91e-187">The session timeout wait is a user configurable option.</span></span>

<span data-ttu-id="8e91e-188">Если клиент хочет освободить свой IPv6-адрес или обнаруживает, что IPv6-адрес, назначенный ему DHCPv6-сервером, уже используется, он отправляет сообщение *RELEASE* или *DECLINE* соответственно.</span><span class="sxs-lookup"><span data-stu-id="8e91e-188">If the Client wishes to release its IPv6 address, or discovers that the IPv6 address assigned to it by the DHCPv6 Server is already in use, it send a *Release* or *Decline* message respectively.</span></span> <span data-ttu-id="8e91e-189">В случае сообщения *RELEASE* сервер возвращает IPv6-адрес обратно в доступный пул.</span><span class="sxs-lookup"><span data-stu-id="8e91e-189">In the case of a *Release* message, the Server returns that IPv6 address status back to the available pool.</span></span> <span data-ttu-id="8e91e-190">В случае сообщения *DECLINE* он обновляет свою таблицу аренды IP-адресов, чтобы указать, что этот IPv6-адрес недоступен (принадлежит другому объекту в сети).</span><span class="sxs-lookup"><span data-stu-id="8e91e-190">In the case of the *Decline* message, it updates its IP lease table to indicate this IPv6 address is not available (owned by another entity elsewhere on the network).</span></span>

<span data-ttu-id="8e91e-191">**Аренда IPv6-адреса и данные записи клиента**</span><span class="sxs-lookup"><span data-stu-id="8e91e-191">**IPv6 Lease and Client Record Data**</span></span>

<span data-ttu-id="8e91e-192">Когда DHCPv6-сервер начинает принимать запросы клиентов, он ведет список активных клиентов, которые запрашивают или получили IPv6-адреса.</span><span class="sxs-lookup"><span data-stu-id="8e91e-192">When the DHCPv6 Server starts accepting Client requests it maintains a list of active Clients who are requesting or have been assigned IPv6 addresses.</span></span> <span data-ttu-id="8e91e-193">Сервер проверяет срок аренды IP-адреса с помощью таймера аренды, который периодически обновляет длительность аренды клиента.</span><span class="sxs-lookup"><span data-stu-id="8e91e-193">The Server checks for IP lease expiration by means of a lease timer that periodically updates the Client lease duration.</span></span> <span data-ttu-id="8e91e-194">Если длительность превышает допустимое время существования, сервер очищает запись клиента и возвращает его IPv6-адрес в доступный пул.</span><span class="sxs-lookup"><span data-stu-id="8e91e-194">When the duration exceeds the valid lifetime, the Server clears the Client record and returns its IPv6 address back to the available pool.</span></span> <span data-ttu-id="8e91e-195">Клиент должен начать процесс продления или повторной привязки до того, как это произойдет.</span><span class="sxs-lookup"><span data-stu-id="8e91e-195">It is up to the Client to start the renewal/rebinding process before this happens!</span></span>

<span data-ttu-id="8e91e-196">Таблица записей клиента на DHCPv6-сервере NetX Duo содержит сведения для идентификации клиентов, а также сведения о состоянии для проверки клиентских DHCPv6-запросов и назначения или повторного назначения IPv6-адресов.</span><span class="sxs-lookup"><span data-stu-id="8e91e-196">The NetX Duo DHCPv6 Server client record table contains information to identify Clients, and ‘state’ information for validating DHCPv6 Client requests and assigning or re-assigning IPv6 addresses.</span></span> <span data-ttu-id="8e91e-197">Эти сведения включают в себя следующее.</span><span class="sxs-lookup"><span data-stu-id="8e91e-197">Such information includes:</span></span>

- <span data-ttu-id="8e91e-198">Уникальный идентификатор DHCPv6 (DUID) клиента, который уникальным образом определяет каждый узел клиента в сети.</span><span class="sxs-lookup"><span data-stu-id="8e91e-198">The Client DHCPv6 Unique Identifier (DUID) which uniquely defines each Client host on a network.</span></span> <span data-ttu-id="8e91e-199">Клиент должен использовать этот идентификатор DUID во всех сообщениях DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-199">The Client must always use this same DUID for all its DHCPv6 messages.</span></span>

- <span data-ttu-id="8e91e-200">Ассоциация удостоверений для невременных адресов (IANA) и IPv6-адрес ассоциации удостоверений (IA) клиента вместе определяют параметры назначения IPv6-адреса клиенту.</span><span class="sxs-lookup"><span data-stu-id="8e91e-200">The Client Identity Association for Non Temporary Addresses (IANA) and Identity Association IPv6 address (IA) cumulatively which define the Client IPv6 address assignment parameters.</span></span>

- <span data-ttu-id="8e91e-201">Запросы параметров клиента (DNS-сервер, доменное имя и т. д.).</span><span class="sxs-lookup"><span data-stu-id="8e91e-201">Client option requests (DNS server, domain name, etc).</span></span>

- <span data-ttu-id="8e91e-202">Исходный IPv6-адрес клиента (если задан) и адрес назначения (если не является многоадресным) последнего DHCPv6-запроса.</span><span class="sxs-lookup"><span data-stu-id="8e91e-202">The Client IPv6 source address (if set) and destination address (if not multicast) of its most recent DHCPv6 request.</span></span>

- <span data-ttu-id="8e91e-203">Тип последнего сообщения клиента и состояние DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-203">The Client’s most recent message type and DHCPv6 ‘state’.</span></span>

## <a name="netx-duo-dhcpv6-server-requirements-and-constraints"></a><span data-ttu-id="8e91e-204">Требования и ограничения для DHCPv6-сервера NetX Duo</span><span class="sxs-lookup"><span data-stu-id="8e91e-204">NetX Duo DHCPv6 Server Requirements and Constraints</span></span>

<span data-ttu-id="8e91e-205">Для использования интерфейса API DHCPv6-сервера NetX Duo требуется ThreadX 5.1 или более поздней версии и NetX Duo 5.5 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="8e91e-205">The NetX Duo DHCPv6 Server API requires ThreadX 5.1 or later, and NetX Duo 5.5 or later.</span></span>

<span data-ttu-id="8e91e-206">**Требования**</span><span class="sxs-lookup"><span data-stu-id="8e91e-206">**Requirements**</span></span>

<span data-ttu-id="8e91e-207">***Настройка задачи потока IP***</span><span class="sxs-lookup"><span data-stu-id="8e91e-207">***IP Thread Task Setup***</span></span>

<span data-ttu-id="8e91e-208">DHCPv6-сервер NetX Duo требует создания экземпляра IP для отправки и получения сообщений DHCPv6 по сетевому каналу.</span><span class="sxs-lookup"><span data-stu-id="8e91e-208">The NetX Duo DHCPv6 Server requires a creation of an IP instance for sending and receiving messages to DHCPv6 on its network link.</span></span> <span data-ttu-id="8e91e-209">Это выполняется с помощью службы *nx_ip_create*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-209">This is done using the *nx_ip_create* service.</span></span> <span data-ttu-id="8e91e-210">Должен быть создан сам DHCPv6-сервер NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="8e91e-210">The NetX Duo DHCPv6 Server itself must be created.</span></span> <span data-ttu-id="8e91e-211">Это выполняется с помощью службы *nx_dhcpv6_server_create*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-211">This is done using the *nx_dhcpv6_server_create* service.</span></span>

<span data-ttu-id="8e91e-212">Компонент DHCPv6 использует протоколы NetX Duo, ICMPv6 и UDP.</span><span class="sxs-lookup"><span data-stu-id="8e91e-212">DHCPv6 utilizes NetX Duo, ICMPv6 and UDP.</span></span> <span data-ttu-id="8e91e-213">Поэтому прежде чем использовать DHCPv6-сервер, необходимо включить IPv6, вызвав следующие службы NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="8e91e-213">Therefore IPv6 must first be enabled prior to using DHCPv6 Server by calling the following NetX Duo services:</span></span>

- <span data-ttu-id="8e91e-214">*nx_udp_enable*</span><span class="sxs-lookup"><span data-stu-id="8e91e-214">*nx_udp_enable*</span></span>
- <span data-ttu-id="8e91e-215">*nxd_ipv6_enable*</span><span class="sxs-lookup"><span data-stu-id="8e91e-215">*nxd_ipv6_enable*</span></span>
- <span data-ttu-id="8e91e-216">*nxd_icmp_enable*</span><span class="sxs-lookup"><span data-stu-id="8e91e-216">*nxd_icmp_enable*</span></span>

<span data-ttu-id="8e91e-217">Кроме того, перед запуском DHCPv6-сервера нужно выполнить ряд задач по настройке.</span><span class="sxs-lookup"><span data-stu-id="8e91e-217">Further, before the DHCPv6 Server can be started, it has a number of set up tasks to perform:</span></span>

- <span data-ttu-id="8e91e-218">Создание и проверка локального канального и глобального IPv6-адресов.</span><span class="sxs-lookup"><span data-stu-id="8e91e-218">Create and validate its link local and IPv6 global addresses.</span></span> <span data-ttu-id="8e91e-219">Проверка адресов выполняется NetX Duo автоматически с помощью обнаружения повторяющихся адресов, если оно включено.</span><span class="sxs-lookup"><span data-stu-id="8e91e-219">Address validation is performed automatically by NetX Duo using Duplicate Address Detection if it is enabled.</span></span> <span data-ttu-id="8e91e-220">Подробные сведения о проверке локальных канальных и глобальных IP-адресов см. в *руководстве пользователя NetX Duo*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-220">See the *NetX Duo User Manual* for details on link local and global IP address validation.</span></span>

- <span data-ttu-id="8e91e-221">Задание индекса сетевого интерфейса для интерфейса DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-221">Set the network interface index for its DHCPv6 interface.</span></span>

- <span data-ttu-id="8e91e-222">Создание диапазона IP-адресов для назначаемых IPv6-адресов.</span><span class="sxs-lookup"><span data-stu-id="8e91e-222">Create an IP address range for assignable IPv6 addresses.</span></span> <span data-ttu-id="8e91e-223">Если остались данные от предыдущего сеанса DHCPv6-сервера, то таблицу аренды IPv6-адресов и записи клиентов из этого сеанса необходимо передать из энергонезависимой памяти на DHCPv6-сервер.</span><span class="sxs-lookup"><span data-stu-id="8e91e-223">Or, if data exists from a previous Server DHCPv6 session, IPv6 lease table and client records from that session must be uploaded from non volatile memory to the DHCPv6 Server.</span></span> <span data-ttu-id="8e91e-224">В примере небольшой системы далее в этом документе будут продемонстрированы службы DHCPv6-сервера для выполнения этого требования.</span><span class="sxs-lookup"><span data-stu-id="8e91e-224">The small example system elsewhere in this document will demonstrate the DHCPv6 Server services for accomplishing this requirement.</span></span>

- <span data-ttu-id="8e91e-225">Задание идентификатора DUID сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-225">Set the Server DUID.</span></span> <span data-ttu-id="8e91e-226">Если сервер создал идентификатор DUID в предыдущем сеансе, он должен использовать те же данные для создания того же DUID для сообщений клиентам.</span><span class="sxs-lookup"><span data-stu-id="8e91e-226">If the Server has created its DUID in a previous session it must use the same data to create the same DUID for messages to its Clients.</span></span> <span data-ttu-id="8e91e-227">В примере небольшой системы далее в этом документе будет показано, как выполняется это требование.</span><span class="sxs-lookup"><span data-stu-id="8e91e-227">The small example system elsewhere in this document will demonstrate how this requirement is accomplished.</span></span>

<span data-ttu-id="8e91e-228">На этом этапе DHCPv6-сервер готов к запуску.</span><span class="sxs-lookup"><span data-stu-id="8e91e-228">At this point the DHCPv6 Server is ready to run.</span></span> <span data-ttu-id="8e91e-229">На внутреннем уровне DHCPv6-сервер NetX Duo создаст сокет UDP, привязанный к порту 547, и начнет прослушивание запросов клиентов.</span><span class="sxs-lookup"><span data-stu-id="8e91e-229">Internally the NetX Duo DHCPv6 Server will create a UDP socket bound to port 547, and starts listening for Client requests.</span></span>

<span data-ttu-id="8e91e-230">***Требования к пулу пакетов***</span><span class="sxs-lookup"><span data-stu-id="8e91e-230">***Packet Pool Requirements***</span></span>

<span data-ttu-id="8e91e-231">Для отправки сообщений DHCPv6 DHCPv6-сервером NetX Duo требуется пул пакетов.</span><span class="sxs-lookup"><span data-stu-id="8e91e-231">NetX Duo DHCPv6 Server requires a packet pool for sending DHCPv6 messages.</span></span> <span data-ttu-id="8e91e-232">Пользователь может настроить размер этого пула пакетов, указав размер полезных данных и количество доступных пакетов, с учетом ожидаемого объема сообщений DHCPv6 и других данных, которые будут отправляться ведущим приложением.</span><span class="sxs-lookup"><span data-stu-id="8e91e-232">The size of the packet pool in terms of packet payload and number of packets available is user configurable, and depends on the anticipated volume of DHCPv6 messages and other transmissions the host application will be sending.</span></span>

<span data-ttu-id="8e91e-233">Типичное сообщение DHCPv6 имеет размер около 200–300 байт в зависимости от числа дополнительных параметров, запрошенных клиентом, и сведений, доступных на сервере.</span><span class="sxs-lookup"><span data-stu-id="8e91e-233">A typical DHCPv6 message is about 200-300 bytes depending on the number of additional options requested by the Client, and information available from the Server.</span></span>

<span data-ttu-id="8e91e-234">***Настройка интерфейса DHCPv6-сервера***</span><span class="sxs-lookup"><span data-stu-id="8e91e-234">***Setting the DHCPv6 Server interface***</span></span>

<span data-ttu-id="8e91e-235">По умолчанию DHCPv6-сервер принимает запросы от клиентов через основной сетевой интерфейс.</span><span class="sxs-lookup"><span data-stu-id="8e91e-235">The DHCPv6 Server defaults to the primary network interface as the interface it will accept Client requests on.</span></span> <span data-ttu-id="8e91e-236">Однако ведущее приложение по-прежнему должно задавать индекс глобального адреса, который использовался для создания глобального адреса сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-236">However, the host application must still set the global address index which it used to create the Server global address.</span></span> <span data-ttu-id="8e91e-237">Индекс интерфейса DHCPv6 и индекс глобального адреса задаются с помощью службы *nx_dhcpv6_server_interface_set*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-237">The DHCPv6 interface index and global address index are set using the *nx_dhcpv6_server_interface_set* service.</span></span> <span data-ttu-id="8e91e-238">Это также продемонстрировано в примере небольшой системы в этом документе.</span><span class="sxs-lookup"><span data-stu-id="8e91e-238">This is also demonstrated in the “small example” in this document.</span></span>

<span data-ttu-id="8e91e-239">***Сохранение интерфейса DUID DHCPv6 между перезагрузками сервера***</span><span class="sxs-lookup"><span data-stu-id="8e91e-239">***Saving DHCPv6 DUID across Server Reboots***</span></span>

<span data-ttu-id="8e91e-240">Протокол DHCPv6 требует, чтобы сервер использовал один и тот же DUID между перезагрузками.</span><span class="sxs-lookup"><span data-stu-id="8e91e-240">The DHCPv6 protocol requires the Server to use the same DUID across multiple reboots.</span></span> <span data-ttu-id="8e91e-241">Для выполнения этого требования все данные, использовавшиеся для создания DUID, должны храниться в энергонезависимой памяти.</span><span class="sxs-lookup"><span data-stu-id="8e91e-241">Any data used to create the DUID must therefore be stored and retrieved from nonvolatile memory for this requirement.</span></span> <span data-ttu-id="8e91e-242">Для узлов, использующих идентификаторы DUID канального уровня со временем, для которых требуется доступ к часам в реальном времени,</span><span class="sxs-lookup"><span data-stu-id="8e91e-242">For hosts that use the Link Layer Plus Time DUID which requires access to a real time clock.</span></span> <span data-ttu-id="8e91e-243">ведущее приложение DHCPv6 NetX Duo должно иметь доступ к данным в реальном времени для генерации значения времени при создании первого идентификатора DUID сервера и сохранять эти данные для повторного использования в последующих сеансах сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-243">The NetX Duo DHCPv6 host application should include real time data access for generating a time value for the initial Server DUID creation, and store that data for reuse on subsequent Server sessions.</span></span> <span data-ttu-id="8e91e-244">Затем служба *nx_dhcpv6_set_server_duid* принимает в качестве аргументов данные DUID, а также параметры конфигурации в зависимости от типа DUID, чтобы создать (или воспроизвести) собственный идентификатор DUID.</span><span class="sxs-lookup"><span data-stu-id="8e91e-244">The *nx_dhcpv6_set_server_duid* then takes DUID data as its arguments, as well as configuration options depending on DUID type, to produce (or reproduce) its own DUID.</span></span>

<span data-ttu-id="8e91e-245">***Создание списка назначаемых IPv6-адресов***</span><span class="sxs-lookup"><span data-stu-id="8e91e-245">***Assignable IPv6 Address List Creation***</span></span>

<span data-ttu-id="8e91e-246">После создания DHCPv6-сервера его ведущее приложение должно создать диапазон назначаемых глобальных IPv6-адресов, если нет ранее сохраненного списка адресов.</span><span class="sxs-lookup"><span data-stu-id="8e91e-246">After creation of the DHCPv6 Server, the Server host application must create a range of assignable IPv6 global addresses if there is no previously stored IP address list data.</span></span> <span data-ttu-id="8e91e-247">Это делается с помощью службы *nx_dhcpv6_create_ip_address_range*, которая принимает в качестве входных данных начальный и конечный IPv6-адреса.</span><span class="sxs-lookup"><span data-stu-id="8e91e-247">This is done using the *nx_dhcpv6_create_ip_address_range* service which takes as input a starting and ending IPv6 address.</span></span>

<span data-ttu-id="8e91e-248">***Сохранение сведений о назначаемых DHCPv6-адресах и клиентах***</span><span class="sxs-lookup"><span data-stu-id="8e91e-248">***Saving DHCPv6 Assignable Address and Client data***</span></span>

<span data-ttu-id="8e91e-249">Протокол DHCPv6 требует, чтобы DHCPv6-сервер сохранял сведения о клиентах и IPv6-адресах в энергонезависимой памяти на случай перезагрузки сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-249">The DHCPv6 protocol requires that the DHCPv6 Server save its Client and IPv6 address data in nonvolatile storage in the event of rebooting the server.</span></span> <span data-ttu-id="8e91e-250">DHCPv6-сервер NetX Duo имеет несколько интерфейсов API для передачи и скачивания сведений о клиентах и IPv6-адресах.</span><span class="sxs-lookup"><span data-stu-id="8e91e-250">The NetX Duo DHCPv6 Server has several API for uploading and downloading Client and IPv6 address data to and from the DHCPv6 Server, respectively:</span></span>

<span data-ttu-id="8e91e-251">*nx_dhcpv6_add_client_record*</span><span class="sxs-lookup"><span data-stu-id="8e91e-251">*nx_dhcpv6_add_client_record*</span></span>

<span data-ttu-id="8e91e-252">*nx_dhcpv6_add_ip_address_lease*</span><span class="sxs-lookup"><span data-stu-id="8e91e-252">*nx_dhcpv6_add_ip_address_lease*</span></span>

<span data-ttu-id="8e91e-253">*nx_dhcpv6_retrieve_client_record*</span><span class="sxs-lookup"><span data-stu-id="8e91e-253">*nx_dhcpv6_retrieve_client_record*</span></span>

<span data-ttu-id="8e91e-254">*nx_dhcpv6_retrieve_ip_address_lease*</span><span class="sxs-lookup"><span data-stu-id="8e91e-254">*nx_dhcpv6_retrieve_ip_address_lease*</span></span>

<span data-ttu-id="8e91e-255">Отправлять данные на сервер необходимо перед его перезагрузкой.</span><span class="sxs-lookup"><span data-stu-id="8e91e-255">Uploading data to the Server must be done before restarting the Server.</span></span> <span data-ttu-id="8e91e-256">Скачивать данные следует только после того, как DHCPv6-сервер остановлен (или приостановлен).</span><span class="sxs-lookup"><span data-stu-id="8e91e-256">Downloading the data should be done only after the DHCPv6 Server is stopped (or suspended).</span></span> <span data-ttu-id="8e91e-257">Соответствующие службы подробно описаны далее в этом документе.</span><span class="sxs-lookup"><span data-stu-id="8e91e-257">The services for doing so are described in detail later in this document.</span></span> <span data-ttu-id="8e91e-258">Однако компонент DHCPv6 NetX Duo не определяет способ доступа к энергонезависимому хранилищу.</span><span class="sxs-lookup"><span data-stu-id="8e91e-258">However, the NetX Duo DHCPv6 provides does not define an access to nonvolatile storage.</span></span> <span data-ttu-id="8e91e-259">За это отвечает ведущее приложение.</span><span class="sxs-lookup"><span data-stu-id="8e91e-259">This must be handled by the host application.</span></span> <span data-ttu-id="8e91e-260">Данная операция демонстрируется в примере небольшой системы.</span><span class="sxs-lookup"><span data-stu-id="8e91e-260">The small example demonstrates how the host application does this.</span></span>

<span data-ttu-id="8e91e-261">***Уникальный идентификатор DHCP-сервера (DUID)***</span><span class="sxs-lookup"><span data-stu-id="8e91e-261">***Server DHCP Unique Identifier (DUID)***</span></span>

<span data-ttu-id="8e91e-262">Идентификатор DUID сервера однозначно определяет узел DHCPv6-сервера в сети.</span><span class="sxs-lookup"><span data-stu-id="8e91e-262">The Server DUID uniquely defines the DHCPv6 Server host on the network.</span></span> <span data-ttu-id="8e91e-263">Если сервер ранее не создал свой идентификатор DUID, он может сделать это с помощью *nx_dhcpv6_server_set_duid*.</span><span class="sxs-lookup"><span data-stu-id="8e91e-263">If a Server has not previously created its DUID, it can use the *nx_dhcpv6_server_set_duid* to create one.</span></span> <span data-ttu-id="8e91e-264">Согласно стандарту RFC 3315, DHCPv6-сервер должен сохранить этот идентификатор DUID в энергонезависимой памяти, чтобы его можно было получить после перезагрузки сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-264">As per RFC 3315, the DHCPv6 Server must save this DUID to nonvolatile memory to be able to retrieve it after Server reboots.</span></span> <span data-ttu-id="8e91e-265">DHCPv6-сервер поддерживает следующие типы DUID: канального уровня, канального уровня со временем и предприятия (назначенный поставщиком).</span><span class="sxs-lookup"><span data-stu-id="8e91e-265">The DHCPv6 Server supports the Link Layer, Link Layer Time and Enterprise (Vendor assigned) DUID types.</span></span> <span data-ttu-id="8e91e-266">Обратите внимание, что клиент должен напрямую отправлять идентификатор DUID от поставщика.</span><span class="sxs-lookup"><span data-stu-id="8e91e-266">Note that the Client must send in the Vendor type DUID directly.</span></span> <span data-ttu-id="8e91e-267">Параметр DUID поставщика (17) не поддерживается напрямую DHPv6-сервером NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="8e91e-267">The option for Vendor type DUIDs (17) is not directly supported by the NetX Duo DHPv6 Server.</span></span>

<span data-ttu-id="8e91e-268">Ведущее приложение DHCPv6-сервера имеет значения по умолчанию для назначения IPv6-адресов, включая срок аренды.</span><span class="sxs-lookup"><span data-stu-id="8e91e-268">The DHCPv6 Server host application has default values for IPv6 address assignment including lease timeout.</span></span> <span data-ttu-id="8e91e-269">Сведения о настройке этих параметров см. в разделе "Настраиваемые параметры" далее в этом документе.</span><span class="sxs-lookup"><span data-stu-id="8e91e-269">See Configurable Options later in this document for how to set these options.</span></span> <span data-ttu-id="8e91e-270">:</span><span class="sxs-lookup"><span data-stu-id="8e91e-270">:</span></span>

<span data-ttu-id="8e91e-271">Блок управления *IANA* содержит поля T1 и T2.</span><span class="sxs-lookup"><span data-stu-id="8e91e-271">The *IANA* control block contains the T1 and T2 fields.</span></span> <span data-ttu-id="8e91e-272">Блок *IA* в блоке управления *IANA* содержит поля предпочтительного и допустимого времени существования.</span><span class="sxs-lookup"><span data-stu-id="8e91e-272">The *IA* block in the *IANA* control block contains the preferred and valid lifetime fields.</span></span> <span data-ttu-id="8e91e-273">Ведущее приложение имеет настраиваемые параметры для настройки этих параметров. Они определены далее в этом документе.</span><span class="sxs-lookup"><span data-stu-id="8e91e-273">The host application has configurable options defined elsewhere in this document for setting these options.</span></span> <span data-ttu-id="8e91e-274">Эти параметры назначаются всем клиентским запросам IPv6-адресов.</span><span class="sxs-lookup"><span data-stu-id="8e91e-274">They are assigned to all Client IPv6 address requests.</span></span>

<span data-ttu-id="8e91e-275">Параметры DHCPv6 для аренды IP-адресов определены ниже.</span><span class="sxs-lookup"><span data-stu-id="8e91e-275">These DHCPv6 IP lease parameters are defined below.</span></span>

<span data-ttu-id="8e91e-276">T1 — время в секундах, когда клиент должен начать продление IPv6-адреса на сервере, который его назначил.</span><span class="sxs-lookup"><span data-stu-id="8e91e-276">T1 – time in seconds when the Client must start renewing its IPv6 address from the Server that assigned it.</span></span>

<span data-ttu-id="8e91e-277">T2 — время в секундах, когда клиент должен начать повторную привязку IPv6-адреса, если продление завершилось сбоем, по каналу связи с любым сервером.</span><span class="sxs-lookup"><span data-stu-id="8e91e-277">T2 – time in seconds when the Client must start rebinding the IPv6 address, if renewal failed, with any Server on its link.</span></span>

<span data-ttu-id="8e91e-278">Предпочтительное время существования — время в секундах, когда адрес клиента становится нерекомендуемым, если клиент не продлил или не привязал его повторно.</span><span class="sxs-lookup"><span data-stu-id="8e91e-278">Preferred lifetime – time in seconds when the Client address becomes deprecated if the Client has not renewed or rebound it.</span></span> <span data-ttu-id="8e91e-279">Клиент по-прежнему может использовать этот адрес.</span><span class="sxs-lookup"><span data-stu-id="8e91e-279">The Client can still use this address.</span></span>

<span data-ttu-id="8e91e-280">Допустимое время существования — время в секундах, когда срок действия IP-адреса клиента истекает. Клиент не должен использовать такой адрес в сообщениях.</span><span class="sxs-lookup"><span data-stu-id="8e91e-280">Valid lifetime – time in seconds when the Client IP address is expired and MUST not use this address in its network transmissions.</span></span>

<span data-ttu-id="8e91e-281">В стандарте RFC рекомендуется использовать значения T1 и T2, равные 0,5 и 0,8 соответственно, в качестве предпочтительного времени существования в параметре *IANA* клиента.</span><span class="sxs-lookup"><span data-stu-id="8e91e-281">The RFC recommends T1 and T2 times that are 0.5 and 0.8, respectively, of the preferred lifetime in the Client *IANA* option.</span></span> <span data-ttu-id="8e91e-282">Если сервер не имеет предпочтений, он должен установить эти значения равными нулю.</span><span class="sxs-lookup"><span data-stu-id="8e91e-282">If the Server has no preference, it should set these times to zero.</span></span> <span data-ttu-id="8e91e-283">Если в ответе сервера содержатся значения T1 и T2, равные нулю, клиент может установить собственные значения T1 и T2.</span><span class="sxs-lookup"><span data-stu-id="8e91e-283">If a Server reply contains T1 and T2 times set to zero, it is letting the Client set its own T1 and T2 times.</span></span>

<span data-ttu-id="8e91e-284">**Ограничения**</span><span class="sxs-lookup"><span data-stu-id="8e91e-284">**Constraints**</span></span>

<span data-ttu-id="8e91e-285">DHCPv6-сервер NetX Duo не поддерживает следующие параметры протокола DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-285">NetX Duo DHCPv6 Server does not support the following DHCPv6 options:</span></span>

  - <span data-ttu-id="8e91e-286">Параметр быстрой фиксации, который оптимизирует процесс запроса адреса DHCPv6, сводя его к обмену сообщениями SOLICIT и REPLY.</span><span class="sxs-lookup"><span data-stu-id="8e91e-286">Rapid Commit option which optimizes the DHCPv6 address request process to just the Solicit and Reply message exchange</span></span>

  - <span data-ttu-id="8e91e-287">Параметр повторной настройки, позволяющий серверу инициировать изменение состояния IP-адреса клиента.</span><span class="sxs-lookup"><span data-stu-id="8e91e-287">Reconfigure option which allows the Server can initiate changes to the Client’s IP address status.</span></span>

  - <span data-ttu-id="8e91e-288">Параметр одноадресной рассылки. Все клиентские сообщения должны отправляться на адрес многоадресного взаимодействия *All_DHCP_Relay_Agents_and_Servers*, а не на DHCPv6-сервер напрямую.</span><span class="sxs-lookup"><span data-stu-id="8e91e-288">Unicast option; all Client messages must be sent to the *All_DHCP_Relay_Agents_and_Servers* multicast address rather than to the DHCPv6 Server directly.</span></span>

  - <span data-ttu-id="8e91e-289">Параметр ассоциации удостоверений для временных адресов (IA_TA), который представляет временный IP-адрес, предоставляемый клиенту.</span><span class="sxs-lookup"><span data-stu-id="8e91e-289">Identity Association for the Temporary Addresses(IA_TA)option which is a temporary IP address granted to a Client.</span></span>

  - <span data-ttu-id="8e91e-290">Несколько параметров IA (IPv6-адресов) на один запрос клиента.</span><span class="sxs-lookup"><span data-stu-id="8e91e-290">Multiple IA (IPv6 addresses) options per Client Request</span></span>

  - <span data-ttu-id="8e91e-291">Узел ретрансляции между клиентом и сервером DHCPv6, то есть клиент и сервер должны находиться в одной сети.</span><span class="sxs-lookup"><span data-stu-id="8e91e-291">Relay host between DHCPv6 Client and Server e.g. Client and Server must be on the same network.</span></span>

  - <span data-ttu-id="8e91e-292">Протокол IPSec и проверка подлинности не поддерживаются в сообщениях DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="8e91e-292">IPSec and Authentication are not supported in DHCPv6 messaging.</span></span> <span data-ttu-id="8e91e-293">Однако в зависимости от используемой версии NetX Duo для экземпляра IP может быть включен протокол IPSec.</span><span class="sxs-lookup"><span data-stu-id="8e91e-293">However, the IP instance may be IPSec enabled depending on the version of NetX Duo in use.</span></span>

  - <span data-ttu-id="8e91e-294">DHCPv6-сервер NetX Duo напрямую поддерживает только запрос параметра DNS-сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-294">The NetX Duo DHCPv6 Server directly supports only the DNS server option request.</span></span> <span data-ttu-id="8e91e-295">В будущих выпусках это может измениться.</span><span class="sxs-lookup"><span data-stu-id="8e91e-295">This may change in future releases.</span></span>

  - <span data-ttu-id="8e91e-296">Параметр делегирования префикса не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="8e91e-296">The Prefix Delegation option is not supported.</span></span>

  - <span data-ttu-id="8e91e-297">Проверка подлинности сообщений DHCPv6, хотя протокол IPSec можно включить в базовой среде NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="8e91e-297">Authentication of DHCPv6 messages although IPSec can be enabled in the underlying NetX Duo environment.</span></span> <span data-ttu-id="8e91e-298">DHCPv6-сервер NetX Duo также не поддерживает релейные подключения к клиентам.</span><span class="sxs-lookup"><span data-stu-id="8e91e-298">Neither does the NetX Duo DHCPv6 Server support relay connections to the Clients.</span></span> <span data-ttu-id="8e91e-299">Предполагается, что все запросы клиентов поступают от узлов в сети сервера.</span><span class="sxs-lookup"><span data-stu-id="8e91e-299">It is assumed all Client requests originate from hosts on the Server network.</span></span>

## <a name="netx-duo-dhcpv6-server-callback-functions"></a><span data-ttu-id="8e91e-300">Функции обратного вызова DHCPv6-сервера NetX Duo</span><span class="sxs-lookup"><span data-stu-id="8e91e-300">NetX Duo DHCPv6 Server Callback Functions</span></span>

<span data-ttu-id="8e91e-301">*nx_dhcpv6_IP_address_declined_handler*</span><span class="sxs-lookup"><span data-stu-id="8e91e-301">*nx_dhcpv6_IP_address_declined_handler*</span></span>

<span data-ttu-id="8e91e-302">Когда клиент DHCPv6 отправляет сообщение DECLINE, DHCPv6-сервер NetX Duo помечает адрес как недоступный в своих таблицах IPv6-адресов.</span><span class="sxs-lookup"><span data-stu-id="8e91e-302">When the DHCPv6 Client sends a Decline message, the NetX Duo DHCPv6 Server marks the address as not available in its IPv6 address tables.</span></span> <span data-ttu-id="8e91e-303">Настроить обработку данного сообщения сервером можно с помощью *nx_dhcpv6_IP_address_declined_handler* *.*</span><span class="sxs-lookup"><span data-stu-id="8e91e-303">To have the ability to customize the Server handling of this message, the *nx_dhcpv6_IP_address_declined_handler* is provided *.*</span></span> <span data-ttu-id="8e91e-304">Однако этот обратный вызов в настоящее время не реализован.</span><span class="sxs-lookup"><span data-stu-id="8e91e-304">However, this callback is not currently implemented.</span></span>

<span data-ttu-id="8e91e-305">*nx_dhcpv6_server_option_request_handler*</span><span class="sxs-lookup"><span data-stu-id="8e91e-305">*nx_dhcpv6_server_option_request_handler*</span></span>

<span data-ttu-id="8e91e-306">Когда сообщение клиента DHCPv6 содержит данные запроса параметра, DHCPv6-сервер NetX Duo перенаправляет каждый код параметра запроса в этот пользовательский обратный вызов, если он определен.</span><span class="sxs-lookup"><span data-stu-id="8e91e-306">When the DHCPv6 Client message contains option request data, the NetX Duo DHCPv6 Server forwards each option request option code to this user callback, if defined.</span></span> <span data-ttu-id="8e91e-307">Таким образом сервер NetX Duo может позволить пользовательскому обратному вызову заполнить данные.</span><span class="sxs-lookup"><span data-stu-id="8e91e-307">This gives the NetX Duo Server the capability to let the user defined callback fill in the data.</span></span> <span data-ttu-id="8e91e-308">Однако в настоящее время эта функция не реализована.</span><span class="sxs-lookup"><span data-stu-id="8e91e-308">However this functionality is not currently implemented.</span></span>

## <a name="supported-dhcpv6-rfcs"></a><span data-ttu-id="8e91e-309">Поддерживаемые стандарты RFC DHCPv6</span><span class="sxs-lookup"><span data-stu-id="8e91e-309">Supported DHCPv6 RFCs</span></span>

<span data-ttu-id="8e91e-310">Протокол DHCPv6 в NetX Duo соответствует требованиям RFC3315, RFC3646 и связанных с ними стандартов RFC.</span><span class="sxs-lookup"><span data-stu-id="8e91e-310">NetX Duo DHCPv6 is compliant with RFC3315, RFC3646, and related RFCs.</span></span>