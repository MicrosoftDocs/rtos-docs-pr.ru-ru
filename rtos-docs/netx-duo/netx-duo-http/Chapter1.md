---
title: Глава 1. Введение в HTTP в NetX Duo для ОСРВ Azure
description: В этой главе описывается модуль HTTP в NetX Duo для ОСРВ Azure.
author: philmea
ms.author: philmea
ms.date: 07/15/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 45f35f2c1bec142e10d29eedb6e5a88a8eb74771e5d4adf1d85b04a87ad59ab7
ms.sourcegitcommit: 93d716cf7e3d735b18246d659ec9ec7f82c336de
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2021
ms.locfileid: "116796214"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-http"></a>Глава 1. Введение в HTTP в NetX Duo для ОСРВ Azure

Протокол HTTP предназначен для передачи содержимого в Интернете. HTTP — это простой протокол, который использует для передачи содержимого надежные службы протокола TCP. Благодаря этому HTTP считается очень надежным протоколом для обмена содержимым. Также HTTP является одним из самых часто используемых протоколов приложений. Все действия в Интернете используют протокол HTTP. HTTP в NetX Duo для ОСРВ Azure поддерживает сети IPv4 и IPv6. IPv6 не вносит прямых изменений в протокол HTTP, но для его поддержки требуются некоторые изменения в исходном API HTTP в NetX для ОСРВ Azure, которые будут описаны в этом документе.

## <a name="http-requirements"></a>Требования для HTTP

Для правильной работы пакета HTTP в NetX Duo требуется установить NetX Duo версии 5.2 или более поздней. Кроме того, должен быть уже создан экземпляр IP-адреса, для которого включено использование TCP. Ведущее приложение IPv6 должно использовать для настройки локального и глобального адресов IPv6 API IPv6 и (или) DHCPv6. Этот процесс демонстрируется в разделе "Пример небольшой системы" в **главе 2**.

Для HTTP-клиента из пакета HTTP в NetX Duo больше нет дополнительных требований.

Но HTTP-сервер из пакета HTTP в NetX Duo имеет еще несколько дополнительных требований. Ему требуется полный доступ к хорошо известному TCP-порту 80 для обработки всех запросов от HTTP-клиентов. Также HTTP-сервер рассчитан на работу со встраиваемой файловой системой FileX. Если система FileX недоступна, пользователь может портировать используемые разделы FileX в собственную среду. Этот процесс рассматривается в последующих разделах этого руководства.

## <a name="http-constraints"></a>Ограничения HTTP

Протокол HTTP в NetX Duo реализует стандарт HTTP 1.0. Но существует ряд дополнительных ограничений:

1.  не поддерживаются постоянные подключения;
2.  не поддерживаются конвейеры обработки запросов;
3.  HTTP-сервер поддерживает обычную проверку подлинности и дайджест-проверку подлинности MD5, но не поддерживает MD5-sess; в настоящее время HTTP-клиент поддерживает только обычную проверку подлинности;
4.  не поддерживается сжатие содержимого;
5.  не поддерживаются запросы TRACE, OPTIONS и CONNECT;
6.  пул пакетов, связанный с HTTP-сервером или HTTP-клиентом, должен быть достаточно большим для размещения заголовка HTTP целиком;
7.  службы HTTP-клиента предназначены только для передачи содержимого, а средства для отображения в этом пакете не предоставляются.

## <a name="http-url-resource-names"></a>URL-адрес HTTP (имена ресурсов)

Протокол HTTP разработан для передачи содержимого через Интернет. Запрашиваемое содержимое определяется URL-адресом. Это основной компонент каждого HTTP-запроса. URL-адреса всегда начинаются с символа *"/"* и обычно обозначают определенные файлы на HTTP-сервере. Ниже приведены типичные расширения файлов, используемые с протоколом HTTP:

| Расширение | Значение |
| --------- | ------- |
| .htm или .html | Hypertext Markup Language (HTML) |
| .txt | Простой текст ASCII |
| .gif | Двоичное изображение GIF |
| .xbm | Двоичное изображение Xbitmap |

## <a name="http-client-requests"></a>Запросы HTTP-клиента

В протоколе HTTP есть простой механизм для запроса содержимого в Интернете. По сути, это стандартные набор команд HTTP, которые отправляются клиентом после успешного установления подключения по *стандартному TCP-порту 80*. Ниже приведены некоторые основные команды HTTP:

| Команда HTTP | Значение |
| ------------ | ------- |
| GET resource HTTP/1.0 | *Получает указанный ресурс.* |
| POST resource HTTP/1.0 | *Получает указанный ресурс и передает прилагаемые входные данные на HTTP-сервер.* |
| HEAD resource HTTP/1.0 | *Выполняется так же, как GET, но HTTP-сервер не возвращает содержимое.* |
| PUT resource HTTP/1.0 | *Передает ресурс для размещения на HTTP-сервере.* |
| DELETE resource HTTP/1.0 | *Удаляет ресурс с сервера.* |

Эти команды ASCII обычно генерируются веб-браузерами и службами клиента HTTP-клиента в NetX для выполнения операций HTTP на HTTP-сервере.

> [!NOTE]
> По умолчанию приложение HTTP-клиента использует для подключения порт 80. Но используемый для подключения к HTTP-серверу порт можно изменить во время выполнения с помощью службы nx_http_client_set_connect_port. Дополнительные сведения об этой службе см. в главе 4. Это полезно для работы с теми веб-серверами, которые иногда используют альтернативные порты для клиентских подключений.

## <a name="http-server-responses"></a>Ответы HTTP-сервера

HTTP-сервер использует для отправки ответов на команды клиента тот же самый *стандартный TCP-порт 80*. Когда HTTP-сервер завершает обработку команды клиента, он возвращает строку ответа ASCII, которая включает в себя 3-значный числовой код состояния. Программное обеспечение клиента по этому числовому ответу определяет, была ли операция выполнена успешно или завершилась сбоем. Ниже приведен список ответов HTTP-сервера на команды клиента:

| Числовое поле | Значение |
| ------------- | ------- |
| *200* | *Запрос выполнен успешно* |
| *400* |   *Запрос не сформирован должным образом* |
| *401* | *Несанкционированный запрос, клиент должен отправить аутентификацию* |
| *404* | *Указанный ресурс в запросе не найден* |
| *500* | *Внутренняя ошибка HTTP-сервера* |
| *501* | *Запрос не реализован HTTP-сервером* |
| *502* | *Служба недоступна* |

Например, на запрос клиента PUT для файла test.htm в случае успешного выполнения будет возвращено сообщение HTTP/1.0 200 OK.

## <a name="http-communication"></a>Связь по протоколу HTTP

Как упоминалось ранее, HTTP-сервер принимает запросы от клиентов через хорошо известный TCP-порт 80. HTTP-клиенты могут использовать любой доступный TCP-порт. Общая последовательность событий HTTP выглядит следующим образом:

### <a name="http-get-request"></a>HTTP-запрос GET

1.  Клиент отправляет запрос на подключение к TCP-порту 80 сервера.
2.  Клиент отправляет запрос **GET <ресурс> HTTP/1.0** и другие заголовки.
3.  Сервер создает сообщение **HTTP/1.0 200 OK** с дополнительной информацией, за которой следует содержимое запрошенного ресурса (при наличии).
4.  Сервер разрывает подключение.
5.  Клиент разрывает соединение.

### <a name="http-put-request"></a>HTTP-запрос PUT

1.  Клиент отправляет запрос на подключение к TCP-порту 80 сервера.
2.  Клиент отправляет запрос **PUT <ресурс> HTTP/1.0** и другие заголовки, за которыми следует содержимое ресурса.
3.  Сервер создает сообщение **HTTP/1.0 200 OK** с дополнительной информацией, за которой следует содержимое запрошенного ресурса.
4.  Сервер разрывает подключение.
5.  Клиент разрывает подключение.

> [!NOTE]
>Как уже упоминалось, HTTP-клиент может изменить стандартный порт 80 на любой другой порт с помощью службы *nx_http_client_set_connect_port*, что позволяет связаться с веб-серверами, использующими альтернативные порты.

## <a name="http-authentication"></a>Проверка подлинности HTTP

Аутентификация HTTP является опциональной, то есть требуется не для всех HTTP-запросов. Различают две разновидности аутентификации: обычную и с использованием дайджеста. Обычная аутентификация по имени и паролю работает точно так же, как во многих других протоколах. При обычной аутентификации HTTP имя и пароли объединяются в одну строку и кодируются в формат Base64. Основным недостатком обычной проверки подлинности является то, что имя и пароль передаются в запросе в открытом виде. Это позволяет достаточно легко похищать такие имена и пароли. Дайджест-проверка подлинности устраняет эту проблему, так как при ней имя и пароль не передаются вместе с запросом. Вместо этого применяется специальный механизм вычисления 128-битного ключа (дайджеста) по имени пользователя, паролю и некоторым другим параметрам. Сервер NetX HTTP поддерживает стандартный алгоритм дайджеста MD5.

Когда нужна проверка подлинности? По сути, HTTP-сервер самостоятельно решает, требуется ли проверка подлинности для запрошенного ресурса. Если проверка подлинности нужна, но в запросе от клиента нет необходимой информации, клиенту возвращается ответ "HTTP/1.0 401 Unauthorized" с указанием требуемого типа проверки подлинности. Ожидается, что клиент в этом случае сформирует новый запрос с правильными данными проверки подлинности.

## <a name="http-authentication-callback"></a>Обратный вызов проверки подлинности HTTP

Как уже упоминалось, проверка подлинности HTTP является необязательной, то есть используется не при любой передаче данных через Интернет. Кроме того, проверка подлинности обычно зависит от конкретного ресурса. Один и тот же сервер может требовать проверку подлинности для доступа к некоторым ресурсам и не требовать для доступа к другим. Пакет сервера NetX HTTP позволяет приложению указать (с помощью вызова *nx_http_server_create*) подпрограмму обратного вызова для проверки подлинности, которая будет вызываться в начале обработки каждого запроса от HTTP-клиента.

Эта подпрограмма обратного вызова предоставляет серверу NetX HTTP строковые значения имени пользователя, пароля и области, которые связаны с конкретным ресурсом, и возвращает необходимый тип проверки подлинности. Если для ресурса не требуется проверка подлинности, обратный вызов проверки подлинности должен возвращать значение **NX_HTTP_DONT_AUTHENTICATE**. Если для указанного ресурса требуется обычная проверка подлинности, то подпрограмма должна возвращать **NX_HTTP_BASIC_AUTHENTICATE**. И, наконец, если требуется дайджест-проверка подлинности MD5, то подпрограмма обратного вызова должна возвращать **NX_HTTP_DIGEST_AUTHENTICATE**. Если ни для одного из ресурсов, предоставляемого HTTP-сервером, не требуется проверка подлинности, обратный вызов можно не указывать, передав в вызов создания для HTTP-сервера пустой указатель.

Формат подпрограммы обратного вызова проверки подлинности для приложения достаточно прост и определен ниже.

```c
UINT nx_http_server_authentication_check(NX_HTTP_SERVER *server_ptr,
                                          UINT request_type, CHAR *resource,
                                          CHAR **name, CHAR **password,
                                          CHAR **realm);
```
Входные параметры определяются следующим образом:

| Параметр | Значение |
| --------- | --------|
| *request_type* | Указывает запрос HTTP-клиента, который может иметь одно из следующих значений: <br/> **NX_HTTP_SERVER_GET_REQUEST**<br/>**NX_HTTP_SERVER_POST_REQUEST**<br/>**NX_HTTP_SERVER_HEAD_REQUEST**<br/>**NX_HTTP_SERVER_PUT_REQUEST**<br/>**NX_HTTP_SERVER_DELETE_REQUEST** |
| *resource* | Конкретный запрашиваемый ресурс. |
| *name* | Назначение для указателя на требуемое имя пользователя. |
| *password* | Назначение для указателя на требуемый пароль. |
| *realm* | Назначение для указателя на область для этой аутентификации. |

Возвращаемое значение подпрограммы аутентификации указывает, требуется ли аутентификация. Указатели ```name, password, and realm``` не используются, если подпрограмма обратного вызова для аутентификации возвращает значение **NX_HTTP_DONT_AUTHENTICATE**. В противном случае разработчик HTTP-сервера должен убедиться, что значения **NX_HTTP_MAX_USERNAME** и **NX_HTTP_MAX_PASSWORD**, определенные в файле *nxd_http_server.h*, достаточно велики для размещения имени пользователя и пароля, указанных в подпрограмме обратного вызова для аутентификации. Оба этих значения по умолчанию имеют размер в 20 символов.

## <a name="http-invalid-usernamepassword-callback"></a>Обратный вызов для недопустимых значений имени пользователя или пароля HTTP

Необязательный обратный вызов для недопустимых значений имени пользователя или пароля на HTTP-сервере в NetX вызывается в тех случаях, когда HTTP-сервер получает в запросе от клиента недопустимое сочетание имени пользователя и пароля. Если приложение HTTP-сервера зарегистрирует этот обратный вызов, указанная подпрограмма будет вызываться в случае ошибки базовой или дайджест-аутентификации в *nx_http_server_get_process*, *nx_http_server_put_process* или *nx_http_server_delete_process*.

Чтобы зарегистрировать обратный вызов на HTTP-сервере, используйте следующую службу, которая определена в HTTP-сервере в NetX Duo.

```c
UINT nx_http_server_invalid_userpassword_notify_set(
                   NX_HTTP_SERVER *http_server_ptr,
                   UINT *invalid_username_password_callback)
                            (CHAR *resource,
                             NXD_ADDRESS *client_nxd_address,
                             UINT request_type))
```

Определены следующие типы запросов:
 - **NX_HTTP_SERVER_GET_REQUEST**
 - **NX_HTTP_SERVER_POST_REQUEST**
 - **NX_HTTP_SERVER_HEAD_REQUEST**
 - **NX_HTTP_SERVER_PUT_REQUEST**
 - **NX_HTTP_SERVER_DELETE_REQUEST**

## <a name="http-insert-gmt-date-header-callback"></a>Обратный вызов добавления заголовка даты GMT в HTTP

Этот необязательный обратный вызов на HTTP-сервере в NetX Duo позволяет вставлять в ответные сообщения заголовок со значением даты. Он вызывается, когда HTTP-сервер отвечает на запрос PUT или GET.

Этот необязательный обратный вызов на HTTP-сервере в NetX Duo позволяет вставлять в ответные сообщения заголовок со значением даты. Он вызывается, когда HTTP-сервер отвечает на запрос PUT или GET.

Чтобы зарегистрировать обратный вызов даты GMT на HTTP-сервере, используйте следующую службу, которая определена на HTTP-сервере в NetX Duo.

```c
UINT  _nx_http_server_gmt_callback_set(
                    NX_HTTP_SERVER *server_ptr,
                    VOID (*gmt_get)(NX_HTTP_SERVER_DATE *date)
```

Тип данных NX_HTTP_SERVER_DATE определяется следующим образом:

```c
typedef struct NX_HTTP_SERVER_DATE_STRUCT
{
    USHORT          nx_http_server_year;           /* Year                 */
    UCHAR           nx_http_server_month;          /* Month                */
    UCHAR           nx_http_server_day;            /* Day                  */
    UCHAR           nx_http_server_hour;           /* Hour              */
    UCHAR           nx_http_server_minute;         /* Minute               */
    UCHAR           nx_http_server_second;         /* Second               */
    UCHAR           nx_http_server_weekday;        /* Weekday              */
} NX_HTTP_SERVER_DATE;
```

## <a name="http-cache-info-get-callback"></a>Обратный вызов для получения сведений из кэша HTTP

HTTP-сервер поддерживает обратный вызов для запроса ограничений по возрасту и датам для определенного ресурса в приложении HTTP. Эти сведения позволяют определить, будет ли HTTP-сервер отправлять всю страницу клиенту по запросу GET. Если в запросе клиента нет строки "if modified since" (если изменено позднее) или это значение не совпадает с датой "last modified" (последнее изменение), полученной в обратном вызове запроса сведений из кэша, то клиенту отправляется вся страница.

Чтобы зарегистрировать обратный вызов на HTTP-сервере, определена приведенная ниже служба.

```c
UINT  _nx_http_server_cache_info_callback_set(
                              NX_HTTP_SERVER *server_ptr,
                              UINT (*cache_info_get)
                                    (CHAR *, UINT *, NX_HTTP_SERVER_DATE *))
```

## <a name="http-multipart-support"></a>Поддержка многокомпонентных сообщений HTTP

Протокол MIME изначально предназначался для взаимодействия с протоколом SMTP, но теперь он используется и с протоколом HTTP. MIME позволяет включать в одно сообщение смешанные типы данных (например, image/jpg и text/plain). HTTP-сервер в NetX Duo включает дополнительные службы для определения типа содержимого в полученных от клиента сообщениях HTTP, содержащих данные MIME. Чтобы включить поддержку многокомпонентных сообщений для протокола HTTP и использовать эти службы, необходимо определить параметр конфигурации **NX_HTTP_MULTIPART_ENABLE**.

```c
UINT  nx_http_server_get_entity_header(NX_HTTP_SERVER *server_ptr,
                                       NX_PACKET **packet_pptr,
                                       UCHAR *entity_header_buffer,
                                       ULONG buffer_size);

UINT  nx_http_server_get_entity_content(NX_HTTP_SERVER *server_ptr,
                                        NX_PACKET **packet_pptr,
                                        ULONG *available_offset,
                                        ULONG *available_length)
```

Дополнительные сведения об использовании этих служб можно найти в главе 3 "Описание служб HTTP".

## <a name="http-multi-thread-support"></a>Поддержка многопоточности HTTP

Службы клиента NetX HTTP можно вызывать из нескольких потоков одновременно. Но запросы на чтение или запись для конкретного экземпляра HTTP-клиента должны выполняться последовательно из одного потока.

## <a name="http-rfcs"></a>Соответствие HTTP стандартам RFC

Реализация HTTP в NetX соответствует требованиям стандартов RFC1945 "Hypertext Transfer Protocol/1.0" (Протокол передачи гипертекста, версия 1.0), RFC 2581 "TCP Congestion Control" (Контроль перегрузки TCP), RFC 1122 "Requirements for Internet Hosts" (Требования к Интернет-узлам) и других связанных с ними RFC.
