---
title: Глава 1 - Введение в преобразование сетевых адресов
description: Преобразование сетевых IP-адресов (NAT) изначально было разработано для решения проблемы ограниченного числа IPv4-адресов в Интернете.
author: philmea
ms.author: philmea
ms.date: 07/14/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 3d01aa6f68e21ea82f65a59a19c4f5c7958a6b92
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104814632"
---
# <a name="chapter-1---an-introduction-to-network-address-translation"></a><span data-ttu-id="475b2-103">Глава 1 - Введение в преобразование сетевых адресов</span><span class="sxs-lookup"><span data-stu-id="475b2-103">Chapter 1 - An introduction to Network Address Translation</span></span>

## <a name="the-need-for-network-address-translation"></a><span data-ttu-id="475b2-104">Необходимость преобразовании сетевых адресов</span><span class="sxs-lookup"><span data-stu-id="475b2-104">The Need for Network Address Translation</span></span>

<span data-ttu-id="475b2-105">Преобразование сетевых IP-адресов (NAT) изначально было разработано для решения проблемы ограниченного числа IPv4-адресов в Интернете.</span><span class="sxs-lookup"><span data-stu-id="475b2-105">IP Network Address Translation (NAT) was originally developed to solve the problem of a limited number of Internet IPv4 addresses.</span></span> <span data-ttu-id="475b2-106">Необходимость в NAT возникает в случаях, когда нескольким устройствам требуется доступ в Интернет, но только один IPv4-адрес в Интернете назначается поставщиком услуг Интернета (ISP).</span><span class="sxs-lookup"><span data-stu-id="475b2-106">The need for NAT arises when multiple devices need to access the Internet but only one IPv4 Internet address is assigned by the Internet Service Provider (ISP).</span></span>

<span data-ttu-id="475b2-107">Имеются и другие преимущества использования NAT.</span><span class="sxs-lookup"><span data-stu-id="475b2-107">There are other benefits of using NAT as well.</span></span> <span data-ttu-id="475b2-108">Топология сети за пределами локального домена может меняться по-разному.</span><span class="sxs-lookup"><span data-stu-id="475b2-108">Network topology outside the local domain can change in many ways.</span></span> <span data-ttu-id="475b2-109">Клиенты могут менять поставщиков, магистральные сети компании могут быть реорганизованы, а поставщики могут объединяться или разделяться.</span><span class="sxs-lookup"><span data-stu-id="475b2-109">Customers may change providers, company backbones may be reorganized, or providers may merge or split.</span></span> <span data-ttu-id="475b2-110">При изменении внешней топологии назначения адресов для хостов в локальном домене также должны изменяться, чтобы отразить эти внешние изменения.</span><span class="sxs-lookup"><span data-stu-id="475b2-110">Whenever the external topology changes, address assignments for hosts within the local domain must also change to reflect these external changes.</span></span> <span data-ttu-id="475b2-111">Изменения данного типа могут быть скрыты от пользователей в домене путем централизации изменений на одном маршрутизаторе трансляции адресов.</span><span class="sxs-lookup"><span data-stu-id="475b2-111">Changes of this type can be hidden from users within the domain by centralizing changes to a single address translation router.</span></span> <span data-ttu-id="475b2-112">NAT обеспечивает доступ локальных хостов к общедоступному Интернету и защищает их от прямого доступа извне.</span><span class="sxs-lookup"><span data-stu-id="475b2-112">NAT enables access for local hosts to the public Internet and protects them from direct access from the outside.</span></span> <span data-ttu-id="475b2-113">Организации с сетью, настроенной преимущественно для внутреннего использования, с необходимостью периодического внешнего доступа, являются хорошими кандидатами для этой схемы.</span><span class="sxs-lookup"><span data-stu-id="475b2-113">Organizations with a network setup predominantly for internal use, with a need for occasional external access are good candidates for this scheme.</span></span>

## <a name="basic-nat-and-network-address-port-translation"></a><span data-ttu-id="475b2-114">Базовая трансляция портов NAT и сетевых адресов</span><span class="sxs-lookup"><span data-stu-id="475b2-114">Basic NAT and Network Address Port Translation</span></span>

<span data-ttu-id="475b2-115">Маршрутизатор с поддержкой NAT устанавливается между общедоступной и частной сетями.</span><span class="sxs-lookup"><span data-stu-id="475b2-115">A NAT-enabled router is installed between the public network and the private network.</span></span> <span data-ttu-id="475b2-116">Роль маршрутизатора с поддержкой NAT заключается в переводе между внутренними частными адресами IPv4 и назначенным общедоступным IPv4-адресом, поэтому все устройства в частной сети могут использовать один и тот же общедоступный IPv4-адрес.</span><span class="sxs-lookup"><span data-stu-id="475b2-116">The role of the NAT-enabled router is to translate between the internal private IPv4 addresses and the assigned public IPv4 address, so all the devices on the private network are able to share the same public IPv4 address.</span></span>

<span data-ttu-id="475b2-117">В базовой реализации NAT маршрутизатор NAT «владеет» одним или несколькими глобально зарегистрированными IP-адресами, отличными от его собственного IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="475b2-117">In the basic implementation of NAT, the NAT router ‘owns’ one or more globally registered IP addresses different from its own IP address.</span></span> <span data-ttu-id="475b2-118">Данные глобальные адреса доступны для назначения хостам в частной сети статически или динамически.</span><span class="sxs-lookup"><span data-stu-id="475b2-118">These global addresses are available to assign to hosts on its private network either statically or dynamically.</span></span> <span data-ttu-id="475b2-119">NAPT, или преобразование сетевых адресов и портов, представляет собой разновидность базового NAT, в котором преобразование сетевых адресов расширено за счет включения идентификатора «транспорта».</span><span class="sxs-lookup"><span data-stu-id="475b2-119">NAPT, or Network Address Port Translation, is a variation of basic NAT, where network address translation is extended to include a ‘transport’ identifier.</span></span> <span data-ttu-id="475b2-120">Чаще всего это номер порта для пакетов TCP и UDP и идентификатор запроса для пакетов ICMP.</span><span class="sxs-lookup"><span data-stu-id="475b2-120">Most typically this is the port number for TCP and UDP packets, and the Query ID for ICMP packets.</span></span>

<span data-ttu-id="475b2-121">Соединения через границу NAT обычно инициируются узлами частной сети, отправляющими исходящие пакеты на внешний узел.</span><span class="sxs-lookup"><span data-stu-id="475b2-121">Connections across the NAT boundary are typically initiated by hosts on the private network sending outbound packets to an external host.</span></span> <span data-ttu-id="475b2-122">Как правило, данным хостам назначаются *динамические* (временные) IP-адреса для этой цели.</span><span class="sxs-lookup"><span data-stu-id="475b2-122">These hosts are usually assigned *dynamic* (temporary) IP addresses for this purpose.</span></span> <span data-ttu-id="475b2-123">Однако также возможно инициировать соединения в обратном направлении, если в частной сети есть «серверы», например HTTP- или FTP-серверы, которые будут принимать запросы клиентов из внешней сети.</span><span class="sxs-lookup"><span data-stu-id="475b2-123">However, it is also possible to have connections initiated in the opposite direction if the private network has ‘servers’ e.g. HTTP or FTP servers that will accept Client requests from the external network.</span></span> <span data-ttu-id="475b2-124">Как правило, NAT назначает этим локальным хостам *статический* (постоянный) IP-адрес: порт.</span><span class="sxs-lookup"><span data-stu-id="475b2-124">NAT will typically assign these local hosts a *static* (permanent) IP address:port.</span></span>

## <a name="how-network-address-translation-works"></a><span data-ttu-id="475b2-125">Принцип работы преобразования сетевых адресов</span><span class="sxs-lookup"><span data-stu-id="475b2-125">How Network Address Translation Works</span></span>

<span data-ttu-id="475b2-126">Типичная настройка сети с маршрутизатором с поддержкой NAT показана на рисунке 1.</span><span class="sxs-lookup"><span data-stu-id="475b2-126">A typical network setup with a NAT-enabled router is illustrated in Figure 1.</span></span>

![Типичная настройка сети с маршрутизатором с поддержкой NAT](media/image2.png)

<span data-ttu-id="475b2-128">**Рисунок 1. Типичная настройка сети с маршрутизатором с поддержкой NAT**</span><span class="sxs-lookup"><span data-stu-id="475b2-128">**Figure 1 - A typical network setup with a NAT-enabled router**</span></span>

<span data-ttu-id="475b2-129">Как правило, маршрутизатор с поддержкой NAT имеет два сетевых интерфейса.</span><span class="sxs-lookup"><span data-stu-id="475b2-129">A NAT-enabled router typically has two network interfaces.</span></span> <span data-ttu-id="475b2-130">Один интерфейс подключен к общедоступной сети Интернет; другой подключен к частной сети.</span><span class="sxs-lookup"><span data-stu-id="475b2-130">One interface is connected to the public Internet; the other is connected to the private network.</span></span> <span data-ttu-id="475b2-131">Типичный маршрутизатор в контексте данной настройки отвечает за маршрутизацию IP-дейтаграмм между частной сетью и общедоступной сетью на основе IP-адреса назначения.</span><span class="sxs-lookup"><span data-stu-id="475b2-131">A typical router in this setup is responsible for routing IP datagrams between the private network and the public network based on destination IP address.</span></span> <span data-ttu-id="475b2-132">Маршрутизатор с поддержкой NAT выполняет преобразование адресов перед маршрутизацией дейтаграммы IPv4 между общедоступным и частным интерфейсами.</span><span class="sxs-lookup"><span data-stu-id="475b2-132">A NAT-enabled router performs address translation before routing an IPv4 datagram between the public and the private interface.</span></span> <span data-ttu-id="475b2-133">Трансляция устанавливается для каждого сеанса TCP или UDP на основе внутреннего адреса источника, номера порта источника и внешнего адреса назначения и номера порта назначения.</span><span class="sxs-lookup"><span data-stu-id="475b2-133">A translation is established for each TCP or UDP session, based the internal source address, source port number, and external destination address and destination port number.</span></span> <span data-ttu-id="475b2-134">Для датаграммы эхо-запроса и ответа ICMP вместо номера порта используется идентификатор запроса ICMP.</span><span class="sxs-lookup"><span data-stu-id="475b2-134">For ICMP echo request and response datagram, the ICMP query ID is used instead of the port number.</span></span>

<span data-ttu-id="475b2-135">Чтобы проиллюстрировать типичную реализацию преобразования сетевых адресов, давайте рассмотрим конфигурацию сети, показанную на рисунке 2.</span><span class="sxs-lookup"><span data-stu-id="475b2-135">To illustrate a typical implementation of Network Address Translation, let us consider a network setup in Figure 2.</span></span>

![Типичная реализация преобразования сетевых адресов](media/image3.png)

<span data-ttu-id="475b2-137">**Рисунок 2 - Типичная реализация преобразования сетевых адресов**</span><span class="sxs-lookup"><span data-stu-id="475b2-137">**Figure 2 - A typical implementation of Network Address Translation**</span></span>

<span data-ttu-id="475b2-138">В данном сценарии маршрутизатор NAT соединяет частную сеть слева, а общедоступную сеть - справа.</span><span class="sxs-lookup"><span data-stu-id="475b2-138">In this scenario, the NAT router connects the private network to the left, and the public network to the right.</span></span> <span data-ttu-id="475b2-139">Предположим, что на стороне общедоступной сети IP-адрес интерфейса NAT-маршрутизатора - 202.151.25.14; на интерфейсе частной сети NAT-маршрутизатор использует IP-адрес 192.168.1.254.</span><span class="sxs-lookup"><span data-stu-id="475b2-139">Let’s assume on the public network side, the NAT router interface IP address is 202.151.25.14; on the private network interface, the NAT router uses the IP address 192.168.1.254.</span></span> <span data-ttu-id="475b2-140">Узел в частной сети инициирует TCP-соединение с веб-сервером в Интернете.</span><span class="sxs-lookup"><span data-stu-id="475b2-140">A node on the private network initiates a TCP connection with a web server on the Internet.</span></span>

<span data-ttu-id="475b2-141">На рисунке 3 показано высокоуровневое представление процесса трансляции сетевых адресов.</span><span class="sxs-lookup"><span data-stu-id="475b2-141">Figure 3 shows a high-level view of the Network Address Translation process.</span></span>

![Общее представление о процессе преобразовании сетевых адресов](media/image4.png)

<span data-ttu-id="475b2-143">**Рисунок 3 - Общий вид процесса трансляции сетевых адресов**</span><span class="sxs-lookup"><span data-stu-id="475b2-143">**Figure 3 - A high-level view of the Network Address Translation process**</span></span>

1. <span data-ttu-id="475b2-144">Клиент передает сообщение протокола TCP SYN на веб-сервер.</span><span class="sxs-lookup"><span data-stu-id="475b2-144">Client transmits a TCP SYN message to the web server.</span></span> <span data-ttu-id="475b2-145">Адрес отправителя 192.168.1.15, номер порта 6732; адрес назначения - 128.15.54.3, номер порта 80.</span><span class="sxs-lookup"><span data-stu-id="475b2-145">The sender address is 192.168.1.15, port number 6732; the destination address is 128.15.54.3, port number 80.</span></span>
1. <span data-ttu-id="475b2-146">Пакет от клиента принимается маршрутизатором NAT на интерфейсе частной сети.</span><span class="sxs-lookup"><span data-stu-id="475b2-146">The packet from the Client is received on the private network interface by the NAT router.</span></span> <span data-ttu-id="475b2-147">К пакету применяется правило исходящего трафика: адрес отправителя (клиента) преобразуется в общедоступный IP-адрес NAT-маршрутизатора 202.15.25.14, а номер исходного порта отправителя (клиента) преобразуется в номер порта TCP 2015 на общедоступном интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="475b2-147">The outbound traffic rule applies to the packet: the sender’s (Client’s) address is translated to the NAT router’s public IP address 202.15.25.14, and sender (Client) source port number is translated to the TCP port number 2015 on the public interface.</span></span>
1. <span data-ttu-id="475b2-148">После этого пакет передается через интернет и в конечном итоге достигает хоста-получателя 128.15.54.3.</span><span class="sxs-lookup"><span data-stu-id="475b2-148">The packet is then transmitted over the Internet and ultimately reaches its destination host 128.15.54.3.</span></span> <span data-ttu-id="475b2-149">Обратите внимание, что на принимающей стороне, исходя из адреса источника IP-уровня и номера порта TCP-уровня, похоже, что пакет исходит из 202.151.24.14, номер порта 2015.</span><span class="sxs-lookup"><span data-stu-id="475b2-149">Notice that on the receiving side, based on the IP layer source address and TCP layer port number, the packet appears to have originated from 202.151.24.14, port number 2015.</span></span>
   <span data-ttu-id="475b2-150">На рисунке 4 показан процесс NAT на обратном пути.</span><span class="sxs-lookup"><span data-stu-id="475b2-150">Figure 4 shows the NAT process on the return path.</span></span>

   ![Процесс NAT на обратном пути](media/image5.png)

   <span data-ttu-id="475b2-152">**Рисунок 4 - Процесс NAT на обратном пути**</span><span class="sxs-lookup"><span data-stu-id="475b2-152">**Figure 4 - NAT process on the return path**</span></span>
1. <span data-ttu-id="475b2-153">В данном сценарии Интернет-хост 128.15.54.3 отправляет ответный пакет с Интернет-адресом NAT-маршрутизатора в качестве пункта назначения.</span><span class="sxs-lookup"><span data-stu-id="475b2-153">In this scenario, the Internet host 128.15.54.3 sends a response packet with the NAT router’s Internet address as its destination.</span></span>
1. <span data-ttu-id="475b2-154">Пакет достигает маршрутизатора NAT.</span><span class="sxs-lookup"><span data-stu-id="475b2-154">The packet reaches the NAT router.</span></span> <span data-ttu-id="475b2-155">Поскольку это входящий пакет, применяются правила входящей трансляции: адрес назначения изменяется обратно на исходный IP-адрес отправителя (клиента): 192.168.1.15, номер порта назначения 6732.</span><span class="sxs-lookup"><span data-stu-id="475b2-155">Since this is an in-bound packet, the in-bound translation rules apply: the destination address is changed back to the original sender’s (Client’s) IP address: 192.168.1.15, destination port number 6732.</span></span>
1. <span data-ttu-id="475b2-156">После этого пакет пересылается клиенту через интерфейс, подключенный к внутренней сети.</span><span class="sxs-lookup"><span data-stu-id="475b2-156">The packet is then forwarded to the Client through the interface that is connected to the internal network.</span></span>

<span data-ttu-id="475b2-157">Таким образом, сетевой адрес и номер порта отправителя не видны другим хостам в общедоступном Интернете.</span><span class="sxs-lookup"><span data-stu-id="475b2-157">In this manner the internet network address and port number of the sender is not exposed to other hosts on the public Internet.</span></span>

## <a name="netx-duo-nat-features"></a><span data-ttu-id="475b2-158">Возможности NetX Duo NAT</span><span class="sxs-lookup"><span data-stu-id="475b2-158">NetX Duo NAT Features</span></span>

<span data-ttu-id="475b2-159">Когда экземпляр NAT создается с помощью вызова *nx_nat_create*, создается таблица преобразования NAT.</span><span class="sxs-lookup"><span data-stu-id="475b2-159">When the NAT instance is created using *nx_nat_create* call, the NAT translation table is created.</span></span>

```C
UINT nx_nat_create(NX_NAT_DEVICE *nat_ptr, NX_IP *ip_ptr,
    UINT global_interface_index,
    VOID *dynamic_cache_memory,
    UINT dynamic_cache_size);
```

<span data-ttu-id="475b2-160">Чтобы отслеживать преобразования сетевых адресов для всех активных соединений между локальной и внешней сетями, маршрутизатор NetX Duo с поддержкой NAT поддерживает таблицу трансляции с информацией о каждом частном подключении к хосту, которая включает исходный и целевой IP-адрес и номер порта.</span><span class="sxs-lookup"><span data-stu-id="475b2-160">To keep track of the network address translations for all active connections between local and external networks, the NetX Duo NAT-enabled router maintains a translation table with information about each private host connection which includes source and destination IP address and port number.</span></span>

<span data-ttu-id="475b2-161">Местоположение этой таблицы преобразования («кеш») устанавливается указателем dynamic_cache_memory.</span><span class="sxs-lookup"><span data-stu-id="475b2-161">The location of this translation table (“cache”) is set with the dynamic_cache_memory pointer.</span></span> <span data-ttu-id="475b2-162">Данная область должна представлять собой 4-байтовое выровненное буферное пространство.</span><span class="sxs-lookup"><span data-stu-id="475b2-162">This area must be a 4 byte aligned buffer space.</span></span> <span data-ttu-id="475b2-163">Размер таблицы (или количество записей) определяется делением размера кэша dynamic_cache_size на размер записи таблицы NAT.</span><span class="sxs-lookup"><span data-stu-id="475b2-163">The size of the table (or number of entries) is determined by dividing the cache size dynamic_cache_size by the size of a NAT table entry.</span></span> <span data-ttu-id="475b2-164">Таблица должна быть достаточно большой для минимального количества записей, заданного параметром  **NX_NAT_MIN_ENTRY_COUNT, который определен в *nx_nat.h*. Значение по умолчанию - 3.**</span><span class="sxs-lookup"><span data-stu-id="475b2-164">The table must be large enough for the minimal number of entries specified by **NX_NAT_MIN_ENTRY_COUNT which is defined in *nx_nat.h*. The default value is 3.**</span></span>

<span data-ttu-id="475b2-165">Время ожидания для всех динамических записей в таблице преобразования NetX Duo NAT инициализируется значением NX_NAT_ENTRY_RESPONSE_TIMEOUT, которое определено в *nx_nat.h*.</span><span class="sxs-lookup"><span data-stu-id="475b2-165">The timeout for all dynamic entries in the NetX Duo NAT translation table are initialized to NX_NAT_ENTRY_RESPONSE_TIMEOUT which is defined in *nx_nat.h*.</span></span> <span data-ttu-id="475b2-166">Значение по умолчанию составляет 4 минуты (или 240 системных тиков для процессора 100 МГц) в соответствии с рекомендациями RFC 2663.</span><span class="sxs-lookup"><span data-stu-id="475b2-166">The default value is 4 minutes (or 240 system ticks for a 100 mHz processor) as recommended by RFC 2663.</span></span> <span data-ttu-id="475b2-167">Каждый раз, когда NetX Duo NAT получает или отправляет пакет, соответствующий динамической записи в таблице, он сбрасывает время ожидания этой записи на NX_NAT_ENTRY_RESPONSE_TIMEOUT.</span><span class="sxs-lookup"><span data-stu-id="475b2-167">Each time NetX Duo NAT receives or sends a packet matching a dynamic entry in the table it resets that entry’s time out to NX_NAT_ENTRY_RESPONSE_TIMEOUT.</span></span> <span data-ttu-id="475b2-168">При поиске в таблице NetX Duo NAT также проверяет таблицу на наличие просроченных записей и удаляет их.</span><span class="sxs-lookup"><span data-stu-id="475b2-168">When searching the table, NetX Duo NAT will also check the table for expired entries and delete them.</span></span>

<span data-ttu-id="475b2-169">Чтобы создать входящие записи как статические в таблице, например для серверов в локальной сети NetX Duo NAT предоставляет службу *nx_nat_inbound_entry_create*.</span><span class="sxs-lookup"><span data-stu-id="475b2-169">To create inbound entries as static in the table e.g. for servers on the local network, NetX Duo NAT provides the *nx_nat_inbound_entry_create* service.</span></span> <span data-ttu-id="475b2-170">Если запись в таблице определяет подключение к локальному хосту как статическое, срок его действия никогда не истекает.</span><span class="sxs-lookup"><span data-stu-id="475b2-170">If a table entry defines the local host connection as static, it never expires.</span></span>

```C
UINT nx_nat_inbound_entry_create(NX_NAT_DEVICE *nat_ptr,
    NX_NAT_TRANSLATION_ENTRY *entry_ptr,
    ULONG local_ip_address, USHORT external_port,
    USHORT local_port, UCHAR protocol);
```

<span data-ttu-id="475b2-171">Данная служба более подробно описана в [Главе 4 - Описание служб](chapter4.md)</span><span class="sxs-lookup"><span data-stu-id="475b2-171">This service is described in more detail in [Chapter 4 - Description of Services](chapter4.md)</span></span>

<span data-ttu-id="475b2-172">Во время выполнения, если таблица преобразования заполнена и большее количество записей не может быть добавлено, NetX Duo NAT уведомит приложение NAT с помощью обратного вызова о полном кэше, если оно зарегистрировано в экземпляре NAT.</span><span class="sxs-lookup"><span data-stu-id="475b2-172">During runtime, if the translation table is full and no more entries can be added, NetX Duo NAT will notify the NAT application with a cache full callback if one is registered with the NAT instance.</span></span> <span data-ttu-id="475b2-173">Это делается посредством службы *nx_nat_cache_notify_set*:</span><span class="sxs-lookup"><span data-stu-id="475b2-173">This is done using the *nx_nat_cache_notify_set* service:</span></span>

```C
UINT nx_nat_cache_notify_set(NX_NAT_DEVICE *nat_ptr,
    VOID (*cache_full_notify_cb)(NX_NAT_DEVICE *nat_ptr));
```

<span data-ttu-id="475b2-174">См. [Главу 4 - Описание служб](chapter4.md) для получения дополнительных сведений о данной службе.</span><span class="sxs-lookup"><span data-stu-id="475b2-174">See [Chapter 4 - Description of Services](chapter4.md) for more details about this service.</span></span>

## <a name="nat-packet-processing-in-netx-duo"></a><span data-ttu-id="475b2-175">Обработка пакетов NAT в NetX Duo</span><span class="sxs-lookup"><span data-stu-id="475b2-175">NAT Packet Processing in NetX Duo</span></span>

<span data-ttu-id="475b2-176">NetX Duo NAT предназначен для использования на маршрутизаторе IPv4.</span><span class="sxs-lookup"><span data-stu-id="475b2-176">NetX Duo NAT is intended for use on an IPv4 router.</span></span> <span data-ttu-id="475b2-177">Для работы NAT необходимо настроить NetX Duo для пересылки пакетов на сервер NAT.</span><span class="sxs-lookup"><span data-stu-id="475b2-177">For NAT to work, NetX Duo must be configured for forwarding packets to the NAT server.</span></span> <span data-ttu-id="475b2-178">См. Главу 2 об установке NetX Duo NAT, чтобы узнать, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="475b2-178">See Chapter 2 on NetX Duo NAT installation for how to do so.</span></span> <span data-ttu-id="475b2-179">После этого сервер NAT указывает, будет ли он «потреблять» (пытаться пересылать) пакет на хост в любой из своих сетей.</span><span class="sxs-lookup"><span data-stu-id="475b2-179">The NAT server then indicates if it will ‘consume’ (attempt to forward) the packet to a host on either of its networks.</span></span> <span data-ttu-id="475b2-180">Если пакет не используется, он «возвращается» в NetX Duo для обработки пакета, как обычно.</span><span class="sxs-lookup"><span data-stu-id="475b2-180">If it will not consume the packet, the packet is ‘returned’ to NetX Duo to process the packet as it normally would.</span></span>

<span data-ttu-id="475b2-181">Когда сервер NAT получает пакет для пересылки от NetX Duo, он определяет, является ли пакет входящим или исходящим.</span><span class="sxs-lookup"><span data-stu-id="475b2-181">When the NAT server receives a packet to forward from NetX Duo, it determines if the packet is inbound or outbound.</span></span>

<span data-ttu-id="475b2-182">Для исходящих пакетов сервер NAT проверяет адрес и порт источника IP-заголовка пакета.</span><span class="sxs-lookup"><span data-stu-id="475b2-182">For outbound packets, the NAT server checks the packet IP header source address and port.</span></span> <span data-ttu-id="475b2-183">Если таблица преобразования не содержит записи для пакета, ранее отправленного этим хостом для того же места назначения, NAT создаст новую запись, которая будет содержать уникальный глобальный IP-адрес источника: порт для соединения, и изменит заголовки пакетов с этим новый IP-адрес: порт перед отправкой во внешнюю сеть.</span><span class="sxs-lookup"><span data-stu-id="475b2-183">If the translation table does not contain an entry for a packet previously sent by this host for the same destination, NAT will create a new entry which will contain a unique global source IP address:port for the connection, and modify the packet headers with this new IP address:port before sending it onto the external network.</span></span>

<span data-ttu-id="475b2-184">Для входящих пакетов сервер NAT ищет в своей таблице преобразования предыдущую запись с внешним IP-адресом: порт, совпадающим с IP-адресом назначения пакета: порт.</span><span class="sxs-lookup"><span data-stu-id="475b2-184">For inbound packets, the NAT server looks for a previous entry in its translation table with an external IP address: port matching the packet destination IP address: port.</span></span> <span data-ttu-id="475b2-185">Если совпадение не найдено, пакет отбрасывается, если только адрес назначения: порт не является внешним адресом сервера в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="475b2-185">If no match is found, it will discard the packet unless the destination address: port is the external address for server on the local network.</span></span> <span data-ttu-id="475b2-186">Если сервер действительно найдет совпадение, он заменит внешний IP-адрес назначения заголовка пакета: порт частным IP-адресом: порт и отправит пакет в локальную сеть на предполагаемый частный хост.</span><span class="sxs-lookup"><span data-stu-id="475b2-186">If it does find a match, it will replace the packet header’s external destination IP address: port with the private IP address: port and send the packet onto the local network to the intended private host.</span></span>

<span data-ttu-id="475b2-187">NetX Duo NAT использует ряд портов трансляции TCP, UDP и ICMP для создания уникального локального адреса: соединения портов для локальных хостов, соединяющихся с внешними хостами.</span><span class="sxs-lookup"><span data-stu-id="475b2-187">NetX Duo NAT uses a range of TCP, UDP and ICMP translation ports for creating unique local address: port connections for local hosts connecting with outside hosts.</span></span> <span data-ttu-id="475b2-188">Следующие настраиваемые пользователем параметры, определенные в *nx_nat.h,* , определяют диапазон для каждого протокола:</span><span class="sxs-lookup"><span data-stu-id="475b2-188">The following user configurable options, defined in *nx_nat.h,* define the range for each protocol:</span></span>

```C
NX_NAT_START_TCP_PORT

NX_NAT_END_TCP_PORT

NX_NAT_START_UDP_PORT

NX_NAT_END_UDP_PORT

NX_NAT_START_ICMP_QUERY_ID

NX_NAT_END_ICMP_QUERY_ID
```

## <a name="nat-requirements-and-constraints"></a><span data-ttu-id="475b2-189">Требования и ограничения NAT</span><span class="sxs-lookup"><span data-stu-id="475b2-189">NAT Requirements and Constraints</span></span>

<span data-ttu-id="475b2-190">NetX Duo NAT требует наличия NetX Duo 5.8 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="475b2-190">NetX Duo NAT requires NetX Duo 5.8 or later.</span></span> <span data-ttu-id="475b2-191">Приложение NAT требует создания одного экземпляра IP и интерфейса для внутренней и внешней физической сети.</span><span class="sxs-lookup"><span data-stu-id="475b2-191">The NAT application requires creation of a single IP instance and an interface to the internal and external physical network.</span></span>

<span data-ttu-id="475b2-192">Ограничения:</span><span class="sxs-lookup"><span data-stu-id="475b2-192">Constraints:</span></span>

- <span data-ttu-id="475b2-193">NetX Duo NAT поддерживает TCP, UDP и ICMP.</span><span class="sxs-lookup"><span data-stu-id="475b2-193">NetX Duo NAT supports TCP, UDP and ICMP.</span></span> <span data-ttu-id="475b2-194">Протокол IGMP не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="475b2-194">IGMP is not supported.</span></span>
- <span data-ttu-id="475b2-195">NetX Duo NAT не поддерживает адресацию IPv6.</span><span class="sxs-lookup"><span data-stu-id="475b2-195">NetX Duo NAT does not support IPv6 addressing.</span></span>
- <span data-ttu-id="475b2-196">NetX Duo NAT не включает службы DNS или DHCP, хотя NetX Duo NAT может интегрировать данные службы со своими операциями NAT.</span><span class="sxs-lookup"><span data-stu-id="475b2-196">NetX Duo NAT does not include DNS or DHCP services, although NetX Duo NAT can integrate those services with its NAT operations.</span></span>

## <a name="rfcs-supported-by-netx-duo-nat"></a><span data-ttu-id="475b2-197">Стандарты RFC, поддерживаемые NetX Duo NAT</span><span class="sxs-lookup"><span data-stu-id="475b2-197">RFCs Supported by NetX Duo NAT</span></span>

<span data-ttu-id="475b2-198">Реализация NetX Duo NAT основана на информации, представленной в следующих стандартах RFC:</span><span class="sxs-lookup"><span data-stu-id="475b2-198">NetX Duo NAT implementation is based on information presented in the following RFCs:</span></span>

- <span data-ttu-id="475b2-199">RFC 2663: Терминология и соображения преобразователя сетевых адресов IP (NAT)</span><span class="sxs-lookup"><span data-stu-id="475b2-199">RFC 2663: IP Network Address Translator (NAT) Terminology and Considerations</span></span>
- <span data-ttu-id="475b2-200">RFC 3022: Традиционное преобразование сетевых IP-адресов (традиционный NAT)</span><span class="sxs-lookup"><span data-stu-id="475b2-200">RFC 3022: Traditional IP Netowrk Address Translator (Traditional NAT)</span></span>
- <span data-ttu-id="475b2-201">RFC 4787: Требования к поведению при преобразовании сетевых адресов (NAT) для одноадресного UDP</span><span class="sxs-lookup"><span data-stu-id="475b2-201">RFC 4787: Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</span></span>
