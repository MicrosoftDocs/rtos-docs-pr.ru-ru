---
title: Глава 2. Установка и использование mDNS
description: В этой главе обсуждаются разные вопросы, связанные с установкой, настройкой и использованием модуля mDNS в NetX Duo.
author: philmea
ms.author: philmea
ms.date: 07/09/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 6f9e3d023f1bdbde4546a94da1bc1ccb48578d0e
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104814667"
---
# <a name="chapter-2---installation-and-use-of-mdns"></a>Глава 2. Установка и использование mDNS

В этой главе обсуждаются разные вопросы, связанные с установкой, настройкой и использованием модуля mDNS в NetX Duo.

## <a name="product-distribution"></a>Распространение продукта

mDNS для NetX Duo доступен по адресу [https://github.com/azure-rtos/netxduo](https://github.com/azure-rtos/netxduo). Этот пакет включает в себя два исходных файла и PDF-файл с этим документом:

- **nxd_mdns.h** — файл заголовка модуля mDNS в NetX Duo
- **nxd_mdns.c** — исходный файл на C для модуля mDNS в NetX Duo
- **nxd_mdns.pdf** — описание mDNS в NetX Duo в формате PDF
- **demo_netxduo_mdns.c** — простой демонстрационный пример программы, которая использует службы, предоставляемые mDNS.

## <a name="netx-duo-mdns-installation"></a>Установка mDNS в NetX Duo

Чтобы использовать API mDNS в NetX Duo, упомянутый выше дистрибутив нужно целиком скопировать в тот же каталог, где установлен NetX Duo. Например, если NetX Duo установлен в каталог *c:\netxduo*, в него же следует скопировать файлы *nxd_mdns.h* и *nxd_mdns.c*.

## <a name="using-netx-duo-mdns"></a>Использование mDNS в NetX Duo

Использование модуля mDNS в NetX Duo не представляет никаких трудностей. В коде приложения следует включить файл *nxd_ptp_client.h* после включения *tx_api.h* и *nx_api.h*, чтобы использовать ThreadX и NetX Duo соответственно. Проект сборки должен включать исходный код mDNS и файл приложения, а также файлы библиотек ThreadX и NetX. Это все, что необходимо для использования mDNS в NetX Duo.

## <a name="configuration-options"></a>Параметры конфигурации

Существует ряд параметров конфигурации для сборки модуля mDNS в NetX Duo. Здесь указаны значения по умолчанию, но любое из них можно задать в приложении перед тем, как включать указанный выше файл заголовка mDNS в NetX Duo. Их подробное описание приводится ниже:

- **NX_MDNS_DISABLE_SERVER** — отключает возможности сервера mDNS/DNS-SD. Без возможностей сервера модуль mDNS/DNS-SD не сможет анонсировать службы, предоставляемые локальным узлом, или отвечать на запросы mDNS. По умолчанию этот символ не определен.
- **NX_MDNS_DISABLE_CLIENT** — отключает возможности клиента mDNS/DNS-SD. Без возможностей клиента модуль mDNS/DNS-SD не может отправлять запросы и сохранять ответы на запросы mDNS, полученные по сети.
- **NX_MDNS_ENABLE_ADDRESS_CHECK** — если определен, модуль mDNS выполняет проверку адресов (источника и назначения) и портов для полученных сообщений mDNS. По умолчанию этот символ определен.
- **NX_MDNS_ENABLE_CLIENT_POOF** — если определен, модуль mDNS выполняет пассивное наблюдение за сбоями, то есть клиент mDNS/DNS_SD (запрашивающая сторона) отслеживает пакеты многоадресной рассылки, отправляемые другими узлами в сети. По умолчанию этот символ определен.
- **NX_MDNS_ENABLE_SERVER_NEGATIVE_RESPONSES** — если определен, сервер mDNS /DNS-SD (отвечающая сторона) создает отрицательные ответы на те запросы, по которым является полномочным владельцем. По умолчанию этот символ определен.
- **NX_MDNS_ENABLE_IPV6** — если определен, модуль mDNS/DNS-SD отправляет и принимает сообщения mDNS через IPv6-адрес. По умолчанию этот символ не определен.
- **NX_MDNS_IPV6_ADDRESS_COUNT** — максимально допустимое количество IPv6-адресов на узле. Значение по умолчанию — 2.
- **NX_MDNS_HOST_NAME_MAX** — максимальная длина строки для имени узла. Значение по умолчанию — 64. В эту длину не включается завершающий символ NULL.
- **NX_MDNS_SERVICE_NAME_MAX** — максимальная длина строки для имени службы. Значение по умолчанию — 64. В эту длину не включается завершающий символ NULL.
- **NX_MDNS_HOST_NAME_MAX** — максимальная длина строки для доменного имени. Значение по умолчанию — 16. В эту длину не включается завершающий символ NULL.
- **NX_MDNS_CONFLICT_COUNT** — максимальное число конфликтов для имени узла или имени службы. Значение по умолчанию: 8.
- **NX_MDNS_RR_TTL_HOST** — значение срока жизни для записей ресурсов с именем узла, в секундах. Значение по умолчанию — 120 секунд.
- **NX_MDNS_RR_TTL_OTHER** — значение срока жизни для других записей ресурсов, в секундах. Значение по умолчанию — 4500 (75 минут).
- **NX_MDNS_PROBING_TIMER_COUNT** — интервал времени между двумя последовательными зондирующими сообщениями mDNS (в тактах). Значение по умолчанию — 25 тактов, что соответствует времени в 250 мс.
- **NX_MDNS_ANNOUNCING_TIMER_COUNT** — интервал времени между двумя последовательными анонсирующими сообщениями mDNS (в тактах). Значение по умолчанию — 25 тактов, что соответствует времени в 250 мс.
- **NX_MDNS_GOODBYE_TIMER_COUNT** — интервал времени между повторными сообщениями "прощания" (в тактах). Значение по умолчанию — 25 тактов, что соответствует времени в 250 мс.
- **NX_MDNS_QUERY_MIN_TIMER_COUNT** — минимальный интервал времени между двумя запросами (в тактах). Значение по умолчанию — 100 тактов, что соответствует времени в 1 с.
- **NX_MDNS_QUERY_MAX_TIMER_COUNT** — максимальный интервал времени между двумя запросами (в тактах). Значение по умолчанию — 360 000, что соответствует времени в 60 с.
- **NX_MDNS_QUERY_DELAY_MIN** — минимальная задержка перед отправкой первого запроса, в тактах. Значение по умолчанию — 2 такта, что соответствует времени в 20 мс.
- **NX_MDNS_QUERY_DELAY_RANGE** —диапазон задержки перед отправкой первого запроса, в тактах. Значение по умолчанию — 10 тактов, что соответствует времени в 100 мс.
- **NX_MDNS_RESPONSE_INTERVAL** — диапазон времени реагирования на запрос, позволяющий гарантировать интервал не менее 1 с после предыдущей многоадресной рассылки записи, в тактах. Значение по умолчанию — 100 тактов.
- **NX_MDNS_RESPONSE_PROBING_TIMER_OUT** — диапазон времени реагирования на зондирующий запрос, позволяющий гарантировать интервал не менее 250 мс после предыдущей многоадресной рассылки записи, в тактах. Значение по умолчанию — 25 тактов.
- **NX_MDNS_RESPONSE_UNIQUE_DELAY** — задержка при ответе на запрос к службе, которая уникальна в локальной сети, в тактах. Значение по умолчанию — 1 такт, что соответствует времени в 10 мс.
- **NX_MDNS_RESPONSE_SHARED_DELAY_MIN** — минимальная задержка при реагировании на запрос к общему ресурсу, в тактах. Значение по умолчанию — 2 такта, что соответствует времени в 20 мс.
- **NX_MDNS_RESPONSE_SHARED_DELAY_RANGE** — диапазон задержки при реагировании на запрос к общему ресурсу, в тактах. Значение по умолчанию — 10 тактов, что соответствует времени в 100 мс.
- **NX_MDNS_RESPONSE_TC_DELAY_MIN** — минимальная задержка при реагировании на запрос с установленным битом TC, в тактах. Значение по умолчанию — 40 тактов, что соответствует времени в 400 мс.
- **NX_MDNS_RESPONSE_TC_DELAY_RANGE** — диапазон задержки при реагировании на запрос с установленным битом TC, в тактах. Значение по умолчанию — 10 тактов, что соответствует времени в 100 мс.
- **NX_MDNS_TIMER_COUNT_RANGE** — при отправке ответов mDNS в пакет включаются все ответы, которые должны быть отправлены в пределах значения этого таймера. Диапазон этого таймера выражается в тактах. Значение по умолчанию — 12, что соответствует времени в 120 мс. Это значение позволяет включить в ответ все сообщения, которые должны быть отправлены в ближайшие 120 мс (при условии длительности такта в 10 мс).
- **NX_MDNS_PROBING_RETRANSMIT_COUNT** — количество повторно отправленных зондирующих сообщений. Значение по умолчанию равно 3.
- **NX_MDNS_GOODBYE_RETRANSMIT_COUNT** — количество повторно отправленных сообщений "прощания". Значение по умолчанию — 1.
- **NX_MDNS_POOF_MIN_COUNT** — количество запросов, на которые не получено многоадресных ответов, после которых узел может предположить, что запись более не действительна. Значение по умолчанию — 2.
- **NX_MDNS_POOF_TIME_COUNT** — интервал времени (в тактах), после которого запись удаляется из кэша при наличии двух или более запросов, на которые не получено многоадресной рассылки с ожидаемым ответом. Значение по умолчанию — 1000 тактов, что соответствует времени в 10 с.
- **NX_MDNS_RR_DELETE_DELAY_TIMER_COUNT** — задержка перед удалением записи ресурса, когда ее срок жизни достигает нуля, в тактах. Значение по умолчанию — 100 тактов, что соответствует времени в 1 с.
