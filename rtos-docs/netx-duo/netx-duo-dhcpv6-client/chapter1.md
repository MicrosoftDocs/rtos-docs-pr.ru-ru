---
title: Глава 1. Введение в DHCPv6-клиент NetX Duo для ОСРВ Azure
description: В сетях IPv6 протокол DHCPv6 используется вместо DHCP для динамического назначения глобальных IP-адресов с сервера DHCPv6. Он поддерживает большинство прежних функций и предоставляет множество улучшений.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 3bf3b52c53bb26e2c9c2c736ae35817eb967f609
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104814784"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-dhcpv6-client"></a><span data-ttu-id="97924-103">Глава 1. Введение в DHCPv6-клиент NetX Duo для ОСРВ Azure</span><span class="sxs-lookup"><span data-stu-id="97924-103">Chapter 1 - Introduction to Azure RTOS NetX Duo DHCPv6 Client</span></span>

<span data-ttu-id="97924-104">В сетях IPv6 протокол DHCPv6 используется вместо DHCP для динамического назначения глобальных IP-адресов с сервера DHCPv6. Он поддерживает большинство прежних функций и предоставляет множество улучшений.</span><span class="sxs-lookup"><span data-stu-id="97924-104">In IPv6 networks, DHCPv6 replaces DHCP for dynamic global IP address assignment from a DHCPv6 Server, and offers most of the same features as well as many enhancements.</span></span> <span data-ttu-id="97924-105">В этом документе подробно описано, как получать IPv6-адреса через API DHCPv6-клиента NetX Duo для ОСРВ Azure.</span><span class="sxs-lookup"><span data-stu-id="97924-105">This document will explain in detail how the Azure RTOS NetX Duo DHCPv6 Client API is used to obtain IPv6 addresses.</span></span>

## <a name="dhcpv6-communication"></a><span data-ttu-id="97924-106">Обмен данными по протоколу DHCPv6</span><span class="sxs-lookup"><span data-stu-id="97924-106">DHCPv6 Communication</span></span>

<span data-ttu-id="97924-107">Протокол DHCPv6 использует UDP.</span><span class="sxs-lookup"><span data-stu-id="97924-107">The DHCPv6 protocol uses UDP.</span></span> <span data-ttu-id="97924-108">Для обмена сообщениями DHCPv6-клиент использует порт 546, а сервер — порт 547.</span><span class="sxs-lookup"><span data-stu-id="97924-108">The Client uses port 546 and the Server uses port 547 to exchange DHCPv6 messages.</span></span> <span data-ttu-id="97924-109">Клиент использует локальный адрес канала в качестве исходного адреса для отправки запросов DHCPv6 к доступным серверам DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="97924-109">The Client uses its link local address for a source address to initiate the DHCPv6 requests to the DHCPv6 server(s) available.</span></span> <span data-ttu-id="97924-110">Когда клиент отправляет сообщения, предназначенные для всех серверов DHCPv6 в сети, он использует адрес многоадресной рассылки *All_DHCP_Relay_Agents_and_Servers*, который имеет значение *FF02::01:02*.</span><span class="sxs-lookup"><span data-stu-id="97924-110">When the Client sends messages intended for all DHCPv6 servers on the network it uses the *All_DHCP_Relay_Agents_and_Servers* multicast address *FF02::01:02*.</span></span> <span data-ttu-id="97924-111">Это зарезервированный адрес для многоадресной рассылки в области канала.</span><span class="sxs-lookup"><span data-stu-id="97924-111">This is a reserved, link-scoped multicast address.</span></span>

## <a name="dhcpv6-process-of-requesting-an-ipv6-address"></a><span data-ttu-id="97924-112">Процесс запроса IPv6-адреса по протоколу DHCPv6</span><span class="sxs-lookup"><span data-stu-id="97924-112">DHCPv6 Process of Requesting an IPv6 Address</span></span>

<span data-ttu-id="97924-113">Чтобы начать процесс запроса глобального IPv6-адреса, клиент отправляет сообщение SOLICIT с помощью службы *nx_dhcpv6_send_solicit*:</span><span class="sxs-lookup"><span data-stu-id="97924-113">To begin the process of requesting a global IPv6 address assignment, a Client first sends a SOLICIT message using the *nx_dhcpv6_send_solicit* service:</span></span>

<span data-ttu-id="97924-114">**UINT nx_dhcpv6_request_solicit(NX_DHCPV6 \*dhcpv6_ptr)**</span><span class="sxs-lookup"><span data-stu-id="97924-114">**UINT nx_dhcpv6_request_solicit(NX_DHCPV6 \*dhcpv6_ptr)**</span></span>

<span data-ttu-id="97924-115">Это сообщение отправляется на адрес *All_DHCP_Relay_Agents_and_Servers*, то есть на все доступные серверы.</span><span class="sxs-lookup"><span data-stu-id="97924-115">This message is sent to all servers using the *All_DHCP_Relay_Agents_and_Servers* address.</span></span> <span data-ttu-id="97924-116">В запросе SOLICIT клиент может предоставить серверу указание с конкретными IPv6-адресами, которые он желает получить.</span><span class="sxs-lookup"><span data-stu-id="97924-116">In the SOLICIT request, the Client may request the assignment of specific IPv6 address(es) as a hint to the Server.</span></span> <span data-ttu-id="97924-117">Кроме того, он может включить в сообщение SOLICIT запрос параметра (Option Request), чтобы получить от сервера другие сведения о конфигурации сети, например адреса DNS-сервера, сервера NTP и т. п.</span><span class="sxs-lookup"><span data-stu-id="97924-117">It can also request other network configuration information from the Server such as DNS server, NTP server and other options in the Option Request in the SOLICIT message.</span></span>

<span data-ttu-id="97924-118">Сервер DHCPv6, который может обслужить этот запрос клиента, возвращает ему сообщение ADVERTISE с указанием IPv6-адресов, которые он может назначить клиенту, времени аренды этих IPv6-адресов и дополнительных сведений, запрошенных клиентом.</span><span class="sxs-lookup"><span data-stu-id="97924-118">A DHCPv6 Server that can service a Client request responds with an ADVERTISE message containing the IPv6 address(es) it can assign to the Client, the IPv6 address lease time and any additional information requested by the Client.</span></span> <span data-ttu-id="97924-119">Протокол DHCPv6-клиента требует, чтобы клиент определенное время ожидал сообщения ADVERTISE от всех серверов DHCPv6 в сети.</span><span class="sxs-lookup"><span data-stu-id="97924-119">The DHCPv6 Client protocol requires the Client to wait for a period of time to receive ADVERTISE messages from all DHCPv6 Servers on the network.</span></span> <span data-ttu-id="97924-120">Он предварительно обрабатывает каждое сообщение ADVERTISE как допустимое и изучает параметры DHCPv6 по полученным данным.</span><span class="sxs-lookup"><span data-stu-id="97924-120">It pre-processes each ADVERTISE message to be a valid message, and scans the option data for various DHCPv6 parameters.</span></span> <span data-ttu-id="97924-121">Также он проверяет значение Preference в параметре Preference Option, если оно предоставлено сервером.</span><span class="sxs-lookup"><span data-stu-id="97924-121">It also checks the Preference value in the Preference Option, if supplied by the Server.</span></span> <span data-ttu-id="97924-122">Если получено несколько сообщений ADVERTISE, DHCPv6-клиент NetX выбирает сервер с самым высоким значением предпочтения из числа тех, которые предоставили ответы в пределах периода ожидания.</span><span class="sxs-lookup"><span data-stu-id="97924-122">If more than one ADVERTISE message is received, the NetX DHCPv6 Client chooses the Server with the highest preference value received by the end of the wait period.</span></span>

<span data-ttu-id="97924-123">Исключением является ситуация, в которой клиент получает сообщение ADVERTISE со значением предпочтения 255.</span><span class="sxs-lookup"><span data-stu-id="97924-123">The exception is if the Client receives an ADVERTISE message with a preference value of 255.</span></span> <span data-ttu-id="97924-124">В этом случае он немедленно принимает это сообщение и отклоняет все последующие сообщения ADVERTISE.</span><span class="sxs-lookup"><span data-stu-id="97924-124">It accepts that message immediately and discards all subsequent ADVERTISE messages.</span></span>

<span data-ttu-id="97924-125">Период ожидания определяется как период повторной передачи, в течение которого DHCPv6-клиент ожидает ответы. Если не получено ни одного ответа от серверов, по окончании этого периода клиент отправляет новое сообщение SOLICIT.</span><span class="sxs-lookup"><span data-stu-id="97924-125">The wait period is defined as the retransmission period that the DHCPv6 Client waits before sending another SOLICIT message if it has not received a response from any Server.</span></span> <span data-ttu-id="97924-126">Начальное время ожидания для повторной передачи в состоянии SOLICIT определяется для протокола DHCPv6 по стандарту RFC 3315 равным 1 секунде.</span><span class="sxs-lookup"><span data-stu-id="97924-126">The initial retransmission timeout in the SOLICIT state is defined by to the DHCPv6 protocol described in RFC 3315 to be 1 second.</span></span> <span data-ttu-id="97924-127">Если DHCPv6-клиент не получает допустимого ответа от сервера, последующие интервалы повторной передачи удваиваются, но не превышают 120 секунд.</span><span class="sxs-lookup"><span data-stu-id="97924-127">Subsequent retransmission intervals, if the DHCPv6 Client fails to receive a valid Server response, are doubled up to a maximum of 120 seconds.</span></span>

<span data-ttu-id="97924-128">После выбора сервера клиент извлекает данные из сообщения ADVERTISE и отправляет выбранному серверу сообщение REQUEST, чтобы принять назначенные значения адреса и срока аренды.</span><span class="sxs-lookup"><span data-stu-id="97924-128">Having chosen the Server, the Client extracts data from the ADVERTISE message and sends a REQUEST message back to the Server to accept the assigned address information and lease times.</span></span> <span data-ttu-id="97924-129">Сервер возвращает сообщение REPLY с подтверждением того, что переданные клиенту IPv6-адреса успешно зарегистрированы на сервере как выделенные этому клиенту.</span><span class="sxs-lookup"><span data-stu-id="97924-129">The Server responds with a REPLY message to confirm the Client IPv6 address(es) are registered with the Server as assigned to the Client.</span></span>

<span data-ttu-id="97924-130">DHCPv6-клиент регистрирует назначенные IPv6-адреса для экземпляра IP-адреса (например, NetX Duo).</span><span class="sxs-lookup"><span data-stu-id="97924-130">The DHCPv6 Client registers the assigned IPv6 address(es) with the IP instance (e.g NetX Duo).</span></span> <span data-ttu-id="97924-131">Если настроено использование протокола обнаружения дубликатов адресов (DAD, по умолчанию включен), NetX Duo автоматически отправит сообщения Neighbor Solicit для проверки того, что назначенные адреса уникальны в сети.</span><span class="sxs-lookup"><span data-stu-id="97924-131">If configured for the Duplicate Address Detection (DAD) protocol (enabled by default), NetX Duo will automatically send Neighbor Solicit messages to verify the assigned address(es) are unique on the network.</span></span> <span data-ttu-id="97924-132">Если проверка прошла успешно, он уведомляет DHCPv6-клиент о повышении уровня каждого назначенного адреса с TENTATIVE до VALID.</span><span class="sxs-lookup"><span data-stu-id="97924-132">If so, it notifies the DHCPv6 Client when the each assigned address has been promoted from TENTATIVE to VALID.</span></span> <span data-ttu-id="97924-133">DHCPv6-клиент переходит в состояние BOUND, и устройство может использовать полученный IPv6-адрес для отправки и передачи сообщений.</span><span class="sxs-lookup"><span data-stu-id="97924-133">The DHCPv6 Client is promoted to the BOUND state and the device may use that IPv6 address to send and transmit messages.</span></span> <span data-ttu-id="97924-134">Если протокол DAD возвращает ошибку, NetX Duo уведомляет об этом DHCPv6-клиент, который в свою очередь отправляет серверу сообщение DECLINE для полученных ранее IPv6-адресов и сбрасывает состояние DHCPv6-клиента до начальной инициализации (INIT).</span><span class="sxs-lookup"><span data-stu-id="97924-134">If the DAD protocol fails, NetX Duo notifies the DHCPv6 Client and the DHCPv6 Client sends a DECLINE message for the IPv6 address(es) assigned back to the Server and resets the DHCPv6 Client state to the INIT state.</span></span>

### <a name="notification-of-successful-address-assignment-and-validation"></a><span data-ttu-id="97924-135">Уведомление об успешном назначении и проверке адреса</span><span class="sxs-lookup"><span data-stu-id="97924-135">Notification of Successful Address Assignment and Validation</span></span>

<span data-ttu-id="97924-136">Приложение может определять результат запроса адресов для DHCPv6-клиента по изменениям состояния, если настроить на DHCPv6-клиенте обратные вызовы по изменению состояния с помощью службы *nx_dhcpv6_client_create*.</span><span class="sxs-lookup"><span data-stu-id="97924-136">The application can determine the result of the DHCPv6 Client address solicitation from the state changes if the DHCPv6 Client is configured with the state change callback in the *nx_dhcpv6_client_create* service.</span></span> <span data-ttu-id="97924-137">Если ответов от сервера не получено, наблюдаемое состояние изменится с SOLICIT на INIT.</span><span class="sxs-lookup"><span data-stu-id="97924-137">If it receives no response from the Server the state change observed is from SOLICIT to INIT.</span></span> <span data-ttu-id="97924-138">Если от сервера получен ответ, но нет возможности выделить адреса, DHCPv6-клиент выполнит зарегистрированный для приложения обратный вызов по ошибке (также регистрируется через службу *nx_dhcpv6_client_create*).</span><span class="sxs-lookup"><span data-stu-id="97924-138">If it received a response from the Server but the Server is unable to assign the address, the application will be notified by the DHCPv6 Client server error callback if configured with one (also in *nx_dhcpv6_client_create).*</span></span> <span data-ttu-id="97924-139">Если клиент достигает состояния BOUND, но не может пройти проверку DAD, состояние изменится с BOUND на INIT.</span><span class="sxs-lookup"><span data-stu-id="97924-139">If the Client achieved the BOUND state but then failed the DAD check, it will see a state change from BOUND to INIT.</span></span> <span data-ttu-id="97924-140">Обратите внимание, что при использовании DAD приложение должно оставить достаточно времени для завершения проверки DAD с момента начала процесса запроса.</span><span class="sxs-lookup"><span data-stu-id="97924-140">Note that an application that is enabled for DAD must allow time for the DAD check after starting the request process.</span></span> <span data-ttu-id="97924-141">Обычно на это требуется около 400–500 тактов (около 4-5 секунд в большинстве случаев).</span><span class="sxs-lookup"><span data-stu-id="97924-141">Typically this is about 400-500 ticks (4-5 seconds in most cases).</span></span>

### <a name="relinquishing-an-ipv6-address"></a><span data-ttu-id="97924-142">Освобождение IPv6-адреса</span><span class="sxs-lookup"><span data-stu-id="97924-142">Relinquishing an IPv6 Address</span></span>

<span data-ttu-id="97924-143">Если клиенту потребуется освободить назначенный ему IPv6-адрес, он информирует об этом сервер DHCPv6 путем вызова службы *nx_dhcpv6_request_release*:</span><span class="sxs-lookup"><span data-stu-id="97924-143">If and when the Client needs to release an assigned IPv6 address, it informs the DHCPv6 server by calling the *nx_dhcpv6_request_release* service:</span></span>

### <a name="uint-nx_dhcpv6_request_releasenx_dhcpv6-dhcpv6_ptr"></a><span data-ttu-id="97924-144">UINT nx_dhcpv6_request_release(NX_DHCPV6 \*dhcpv6_ptr)</span><span class="sxs-lookup"><span data-stu-id="97924-144">UINT nx_dhcpv6_request_release(NX_DHCPV6 \*dhcpv6_ptr)</span></span>

<span data-ttu-id="97924-145">DHCPv6-клиент отправляет сообщение одноадресной рассылки RELEASE с назначенными адресами на тот сервер, который ранее назначил эти адреса, и ожидает сообщения REPLY с подтверждением получения этого сообщения сервером.</span><span class="sxs-lookup"><span data-stu-id="97924-145">The DHCPv6 Client sends a unicast RELEASE message containing the assigned addresses to the Server who assigned the address and waits for a REPLY confirming the Server received the message.</span></span>

<span data-ttu-id="97924-146">Примечание. Существует другой процесс для клиентов, которые отключаются от питания, но намерены после перезапуска сохранить назначенные IPv6-адреса для дальнейшего использования.</span><span class="sxs-lookup"><span data-stu-id="97924-146">Note: There is a different process for the Client that is powering down but plans to continue using the assigned IPv6 addresses on reboot.</span></span> <span data-ttu-id="97924-147">Такой клиент не отправляет сообщение RELEASE при выключении питания, если не планирует запрашивать новый адрес после включения питания.</span><span class="sxs-lookup"><span data-stu-id="97924-147">It does not send the RELEASE message on powering down unless it plans to request a new address on power up.</span></span> <span data-ttu-id="97924-148">Эта ситуация подробнее описана в разделе "Требования к энергонезависимой памяти".</span><span class="sxs-lookup"><span data-stu-id="97924-148">See “Non Volatile Memory Requirements” for explanation of this situation.</span></span>

### <a name="dhcpv6-lease-timeouts"></a><span data-ttu-id="97924-149">Истечение срока аренды DHCPv6</span><span class="sxs-lookup"><span data-stu-id="97924-149">DHCPv6 Lease Timeouts</span></span>

<span data-ttu-id="97924-150">Аренда IPv6, предоставляемая сервером, содержит два параметра срока ожидания (T1 и T2) в каждом блоке IANA (сопоставления удостоверения для постоянных адресов).</span><span class="sxs-lookup"><span data-stu-id="97924-150">The IPv6 lease assigned by the Server contains two timeout parameters, T1 and T2 in each Identity Association – Non Temporary Addresses (IANA) block.</span></span> <span data-ttu-id="97924-151">Стандарт IANA описан в других разделах этого руководства пользователя.</span><span class="sxs-lookup"><span data-stu-id="97924-151">An IANA is described in elsewhere in this User Guide.</span></span> <span data-ttu-id="97924-152">Если с момента привязки DHCPv6-клиента к назначенному IPv6-адресу прошло время, равное T1, DHCPv6-клиент автоматически начинает процесс обновления IPv6-адреса, отправляя сообщение продления (RENEW).</span><span class="sxs-lookup"><span data-stu-id="97924-152">If the elapsed time from when the DHCPv6 Client was bound to the assigned IPv6 address equals T1, the DHCPv6 Client automatically starts renewing the IPv6 address by sending a RENEW message.</span></span> <span data-ttu-id="97924-153">Если прошло время, равное T2, и клиент DHCPv6 не получил ответы на запросы RENEW, он автоматически отправляет сообщение REBIND.</span><span class="sxs-lookup"><span data-stu-id="97924-153">If the elapsed time equals T2, DHCPv6 Client automatically sends a REBIND message if it received no responses to its RENEW requests.</span></span>

<span data-ttu-id="97924-154">Еще два параметра аренды IPv6 (предпочтительное и допустимое время существования) назначаются каждому блоку IA (сопоставления удостоверений), которые содержатся в блоках IANA.</span><span class="sxs-lookup"><span data-stu-id="97924-154">Two other IPv6 lease parameters, preferred and valid lifetime, are assigned with each Identity Association (IA) block contained in the IANA block.</span></span> <span data-ttu-id="97924-155">Предпочтительное и допустимое время существования обозначают периоды, после которых назначенный IPv6-адрес объявляется устаревшим или недопустимым, соответственно.</span><span class="sxs-lookup"><span data-stu-id="97924-155">The preferred and valid lifetimes are when the assigned IPv6 address is deprecated or invalid, respectively.</span></span> <span data-ttu-id="97924-156">Значение T1 должно быть меньше предпочтительного времени существования.</span><span class="sxs-lookup"><span data-stu-id="97924-156">T1 must be less than the preferred lifetime.</span></span> <span data-ttu-id="97924-157">Значение T2 должно быть меньше допустимого времени существования.</span><span class="sxs-lookup"><span data-stu-id="97924-157">T2 must be less than the valid lifetime.</span></span>

### <a name="ip-thread-task-requirements"></a><span data-ttu-id="97924-158">Требования к задачам для потока IP</span><span class="sxs-lookup"><span data-stu-id="97924-158">IP Thread Task Requirements</span></span>

<span data-ttu-id="97924-159">DHCPv6-клиент NetX Duo требует создать экземпляр IP-адреса NetX Duo до того, как будет создан DHCPv6-клиент для использования клиентских служб DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="97924-159">The NetX Duo DHCPv6 Client requires creation of a NetX Duo IP instance previous to creating the DHCPv6 Client to use DHCPv6 Client services.</span></span>

<span data-ttu-id="97924-160">Протоколы UDP, IPv6 и ICMPv6 должны быть включены для этого экземпляра IP, прежде чем применять DHCPv6-клиент.</span><span class="sxs-lookup"><span data-stu-id="97924-160">UDP, IPv6, and ICMPv6 must be enabled on the IP instance prior to the using DHCPv6 Client.</span></span>

  - <span data-ttu-id="97924-161">*nx_udp_enable*</span><span class="sxs-lookup"><span data-stu-id="97924-161">*nx_udp_enable*</span></span>

  - <span data-ttu-id="97924-162">*nxd_ipv6_enable*</span><span class="sxs-lookup"><span data-stu-id="97924-162">*nxd_ipv6_enable*</span></span>

  - <span data-ttu-id="97924-163">*nxd_icmp_enable*</span><span class="sxs-lookup"><span data-stu-id="97924-163">*nxd_icmp_enable*</span></span>

### <a name="packet-pool-requirements"></a><span data-ttu-id="97924-164">Требования к пулу пакетов</span><span class="sxs-lookup"><span data-stu-id="97924-164">Packet Pool Requirements</span></span>

<span data-ttu-id="97924-165">Для создания DHCPv6-клиента NetX Duo требуется ранее созданный пул пакетов для отправки сообщений DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="97924-165">NetX Duo DHCPv6 Client creation requires a previously created packet pool for sending DHCPv6 messages.</span></span> <span data-ttu-id="97924-166">Пользователь может настроить размер этого пула пакетов, указав размер полезных данных и количество доступных пакетов, с учетом ожидаемого объема сообщений DHCPv6 и других данных, которые будут отправляться приложением.</span><span class="sxs-lookup"><span data-stu-id="97924-166">The size of the packet pool in terms of packet payload and number of packets available is user configurable, and depends on the anticipated volume of DHCPv6 messages and other transmissions the application will be sending.</span></span>

<span data-ttu-id="97924-167">Размер обычного сообщения DHCPv6 составляет около 200 байтов в зависимости от количества IA-адресов и параметров DHCPv6, запрошенных клиентом.</span><span class="sxs-lookup"><span data-stu-id="97924-167">A typical DHCPv6 message is about 200 bytes depending on the number of IA addresses and DHCPv6 options requested by the Client.</span></span>

### <a name="network-requirements"></a><span data-ttu-id="97924-168">Требования к сети</span><span class="sxs-lookup"><span data-stu-id="97924-168">Network Requirements</span></span>

<span data-ttu-id="97924-169">Для DHCPv6-клиента NetX Duo требуется создание сокета UDP, привязанного к порту 546.</span><span class="sxs-lookup"><span data-stu-id="97924-169">The NetX Duo DHCPv6 Client requires the creation of UDP socket bound to port 546.</span></span> <span data-ttu-id="97924-170">Этот сокет создается одновременно с задачей DHCPv6-клиента.</span><span class="sxs-lookup"><span data-stu-id="97924-170">The socket is created when the DHCPv6 Client task is created.</span></span>

### <a name="non-volatile-memory-requirements"></a><span data-ttu-id="97924-171">Требования к энергонезависимой памяти</span><span class="sxs-lookup"><span data-stu-id="97924-171">Non Volatile Memory Requirements</span></span>

<span data-ttu-id="97924-172">Если DHCPv6-клиент при выключении питания освобождает арендованный у сервера DHCPv6 IPv6-адрес и запрашивает новые IPv6-адреса после перезагрузки, наличие энергозависимой памяти не требуется.</span><span class="sxs-lookup"><span data-stu-id="97924-172">If a DHCPv6 Client releases its IPv6 lease with the DHCPv6 Server when powering down, and requests new IPv6 address(es) on reboot, then non volatile memory storage is not required.</span></span> <span data-ttu-id="97924-173">Если клиенту нужно сохранить назначенную аренду, он должен сохранять некоторые сведения о DHCPv6-клиенте в энергонезависимой памяти при перезагрузках.</span><span class="sxs-lookup"><span data-stu-id="97924-173">If a Client wishes to continue using its assigned lease, it must store certain information about the DHCPv6 Client to non volatile memory across reboots.</span></span>

<span data-ttu-id="97924-174">Требования к долговременной памяти и API-интерфейсы DHCPv6-клиента подробнее обсуждаются в главе 2 руководства **Использование DHCPv6-клиента NetX Duo**.</span><span class="sxs-lookup"><span data-stu-id="97924-174">Non volatile memory requirements and the DHCPv6 Client API are discussed further in **Using the NetX Duo DHCPv6 Client** in Chapter Two.</span></span>

### <a name="netx-duo-dhcpv6-client-limitations"></a><span data-ttu-id="97924-175">Ограничения DHCPv6-клиента NetX Duo</span><span class="sxs-lookup"><span data-stu-id="97924-175">NetX Duo DHCPv6 Client Limitations</span></span>

<span data-ttu-id="97924-176">В текущем выпуске для DHCPv6-клиента NetX Duo действуют следующие ограничения:</span><span class="sxs-lookup"><span data-stu-id="97924-176">The current release of the NetX Duo DHCPv6 Client has the following limitations:</span></span>

  - <span data-ttu-id="97924-177">DHCPv6-клиент NetX Duo не поддерживает возможность отправки одноадресных сообщений DHCPv6 на сервер DHCPv6, даже если это разрешено сервером.</span><span class="sxs-lookup"><span data-stu-id="97924-177">NetX Duo DHCPv6 Client does not support the Server Unicast option for sending unicast DHCPv6 messages to the DHCPv6 Server even if the Server indicates this is permitted.</span></span>

  - <span data-ttu-id="97924-178">DHCPv6-клиент NetX Duo не поддерживает запрос Reconfigure, в котором сервер сообщает об изменениях IPv6-адресов для клиентов в сети.</span><span class="sxs-lookup"><span data-stu-id="97924-178">NetX Duo DHCPv6 Client does not support the Reconfigure request in which a Server initiates IPv6 address changes to the Clients on the network.</span></span>

  - <span data-ttu-id="97924-179">DHCPv6-клиент NetX Duo не поддерживает формат Enterprise для блока управления "Уникальный идентификатор DHCPv6".</span><span class="sxs-lookup"><span data-stu-id="97924-179">NetX Duo DHCPv6 Client does not support the Enterprise format for the DHCPv6 Unique Identifier control block.</span></span> <span data-ttu-id="97924-180">Он поддерживает только форматы "Канальный уровень" и "Канальный уровень и время".</span><span class="sxs-lookup"><span data-stu-id="97924-180">It only supports Link Layer and Link Layer Plus Time format.</span></span>

  - <span data-ttu-id="97924-181">DHCPv6-клиент NetX Duo не поддерживает запросы адресов по временным каналам связи (TA), но поддерживает запрос постоянных адресов (IANA).</span><span class="sxs-lookup"><span data-stu-id="97924-181">NetX Duo DHCPv6 Client does not support Temporary Association (TA) address requests, but does support Non Temporary (IANA) option requests.</span></span>

## <a name="multihome-and-multiple-address-support"></a><span data-ttu-id="97924-182">Поддержка множественной адресации и нескольких адресов</span><span class="sxs-lookup"><span data-stu-id="97924-182">Multihome and Multiple Address Support</span></span>

<span data-ttu-id="97924-183">DHCPv6-клиент поддерживает несколько интерфейсов и несколько адресов для каждого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="97924-183">The DHCPv6 Client supports multiple interfaces and multiple addresses per interface.</span></span> <span data-ttu-id="97924-184">Служба DHCPv6-клиента *nx_dhcpv6_client_set_interface* позволяет клиентскому приложению задать сетевой интерфейс, через который приложение будет взаимодействовать с сервером DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="97924-184">The DHCPv6 Client service, *nx_dhcpv6_client_set_interface* enables the Client application to set the network interface on which the application will be communicating with the DHCPv6 Server.</span></span> <span data-ttu-id="97924-185">DHCPv6-клиент по умолчанию использует основной интерфейс (с нулевым индексом).</span><span class="sxs-lookup"><span data-stu-id="97924-185">The DHCPv6 Client defaults to the primary interface (index zero).</span></span>

<span data-ttu-id="97924-186">Для использования нескольких адресов на интерфейс DHCPv6-клиент поддерживает внутренний список адресов, которые нумеруются последовательно с индекса 0.</span><span class="sxs-lookup"><span data-stu-id="97924-186">For multiple addresses per interface, the DHCPv6 Client keeps an internal list of addresses starting at index 0.</span></span> <span data-ttu-id="97924-187">Обратите внимание, что зарегистрированный в DHCPv6-клиенте адрес не обязательно получит тот же индекс в таблице IP-адресов для интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="97924-187">Note that the same address registered with the DHCPv6 Client may not necessarily be located at the same index in the IP table of interface addresses.</span></span>

<span data-ttu-id="97924-188">Некоторым службам DHCPv6-клиента, которые получают сведения об аренде IPv6-адреса для клиента, требуется указать индекс адреса.</span><span class="sxs-lookup"><span data-stu-id="97924-188">For DHCPv6 Client services that retrieve information about the Client IPv6 address lease, some require an address index to be specified.</span></span> <span data-ttu-id="97924-189">Ниже представлен пример получения периодов предпочтительного и допустимого времени существования адреса:</span><span class="sxs-lookup"><span data-stu-id="97924-189">An example for obtaining the preferred and valid lifetimes is shown below:</span></span>

```C
UINT nx_dhcpv6_get_valid_ip_address_lease_time(NX_DHCPV6 *dhcpv6_ptr, 
                                              UINT address_index, 
                                              NXD_ADDRESS *ip_address,
                                              ULONG preferred_lifetime, 
                                              ULONG *valid_lifetime)
```

<span data-ttu-id="97924-190">Клиентское приложение также может получить число допустимых назначенных IPv6-адресов, вызвав службу *nx_dhcpv6_get_valid_ip_address_count*:</span><span class="sxs-lookup"><span data-stu-id="97924-190">The Client application can also retrieve the number of valid IPv6 addresses assigned from the *nx_dhcpv6_get_valid_ip_address_count* service:</span></span>

```C
UINT nx_dhcpv6_get_valid_ip_address_count(NX_DHCPV6 *dhcpv6_ptr, 
                                          UINT *address_count)
```

<span data-ttu-id="97924-191">Устаревшие службы DHCPv6-клиента, созданные до появления поддержки нескольких адресов в NetX Duo, не принимают индекс адреса.</span><span class="sxs-lookup"><span data-stu-id="97924-191">Legacy DHCPv6 Client services which were created before multiple addresses were supported in NetX Duo do not take an address index.</span></span> <span data-ttu-id="97924-192">Поэтому для работы с такими службами запрошенные данные передаются через основной глобальный адрес IA независимо от того, сколько IA-адресов назначено клиенту.</span><span class="sxs-lookup"><span data-stu-id="97924-192">Therefore, with these services, the data requested is taken from the primary global IA address, regardless how many IA addresses are assigned to the Client.</span></span> <span data-ttu-id="97924-193">Пример приведен ниже.</span><span class="sxs-lookup"><span data-stu-id="97924-193">An example is shown below:</span></span>

```C
UINT nx_dhcpv6_get_IP_address(NX_DHCPV6 *dhcpv6_ptr, 
                              NXD_ADDRESS *ip_address)
```

## <a name="netx-duo-dhcpv6-client-callback-functions"></a><span data-ttu-id="97924-194">Функции обратного вызова в DHCPv6-клиенте NetX Duo</span><span class="sxs-lookup"><span data-stu-id="97924-194">NetX Duo DHCPv6 Client Callback Functions</span></span>

<span data-ttu-id="97924-195">*nx_dhcpv6_state_change_callback*</span><span class="sxs-lookup"><span data-stu-id="97924-195">*nx_dhcpv6_state_change_callback*</span></span>

<span data-ttu-id="97924-196">Когда DHCPv6-клиент в результате обработки запроса DHCPv6 переходит в новое состояние DHCPv6, он уведомляет приложение через эту функцию обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="97924-196">When the DHCPv6 Client changes to a new DHCPv6 state as a result of processing a DHCPv6 request, it notifies the application with this callback function.</span></span>

<span data-ttu-id="97924-197">*nx_dhcpv6_server_error_handler*</span><span class="sxs-lookup"><span data-stu-id="97924-197">*nx_dhcpv6_server_error_handler*</span></span>

<span data-ttu-id="97924-198">Когда DHCPv6-клиент получает в ответе сервера ненулевое значение параметра *Status* (Состояние), которое обозначает сбой выполнения, он уведомляет приложение через этот обратный вызов с указанием кода состояния ошибки сервера.</span><span class="sxs-lookup"><span data-stu-id="97924-198">When the DHCPv6 Client receives a Server reply containing a *Status* option with a non-zero (non successful) status, it notifies the application with this callback which includes the Server error status code.</span></span>

<span data-ttu-id="97924-199">Примечание. Поскольку эти функции обратного вызова вызываются из задачи в потоке DHCPv6-клиента, клиентское приложение не должно вызывать службы DHCPv6-клиента NetX Duo, которые требуют управления мьютексом DHCPv6-клиента. К ним относятся *nx_dhcpv6_start, nx_dhcpv6_stop* и все API, которые отправляют сообщения непосредственно из обратного вызова, например *nx_dhcpv6_request_release*.</span><span class="sxs-lookup"><span data-stu-id="97924-199">Note: Since these callback functions are called from the DHCPv6 Client thread task, the Client application must NOT call any NetX Duo DHCPv6 Client services that require mutex control of the DHCPv6 Client such as *nx_dhcpv6_start, nx_dhcpv6_stop,* and any of the API that send messages directly from the callback e.g. *nx_dhcpv6_request_release*.</span></span>

## <a name="dhcpv6-rfcs"></a><span data-ttu-id="97924-200">Стандарты RFC для DHCPv6</span><span class="sxs-lookup"><span data-stu-id="97924-200">DHCPv6 RFCs</span></span>

<span data-ttu-id="97924-201">DHCP для NetX Duo соответствует требованиям RFC 3315, RFC 3646 и связанных с ними стандартов RFC.</span><span class="sxs-lookup"><span data-stu-id="97924-201">NetX Duo DHCP is compliant with RFC3315, RFC3646, and related RFCs.</span></span>