---
title: Глава 5. Драйверы отображения графического интерфейса пользователя
description: Драйверы отображения графического интерфейса пользователя определяют программный интерфейс между абстрактным холстом и физическим оборудованием для отображения.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 804187ce8562e274205e97448da77d29f99016072c137cb3c4f1f42dac58c432
ms.sourcegitcommit: 93d716cf7e3d735b18246d659ec9ec7f82c336de
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2021
ms.locfileid: "116788547"
---
# <a name="chapter-5---guix-display-drivers"></a>Глава 5. Драйверы отображения графического интерфейса пользователя

Драйверы отображения графического интерфейса пользователя определяют программный интерфейс между абстрактным холстом и физическим оборудованием для отображения. Драйвер отображения графического интерфейса пользователя реализует функции рисования нижнего уровня, которые фактически изменяют сведения о цвете пикселя в памяти холста и передают сохраненные данные о холсте в физический буфер фрейма отображения в системах с двойной буферизацией.

Драйверы отображения графического пользовательского интерфейса зависят от структуры, содержащей параметры физического дисплея и набор указателей на функции драйверов нижнего уровня. С помощью этих опосредованных функциональных указателей функции рисования для абстрактного холста и мини-приложений становятся абсолютно независимыми от сведений об оборудовании.

Графический пользовательский интерфейс предоставляет собой полноценный набор функций рисования по умолчанию для каждой поддерживаемой глубины цвета и формата цвета. При реализации драйвера отображения без специальной возможности аппаратного ускорения или других специальных условий для оборудования этих стандартных функций рисования обычно достаточно для окончательной реализации драйвера. В таких простейших драйверах обычно требуется реализовать в программном обеспечении драйвера только одну функцию — функцию настройки аппаратного устройства. Для этого часто необходима инициализация различных аппаратных регистров для определения синхронизации отображения на ЖК-экранах, размеров экрана и т. д. Для всех остальных функций в процессе реализации драйвера происходит инициализация указателей функций GX_DISPLAY в соответствии с функциями по умолчанию для требуемой глубины цвета и формата.

При реализации нестандартного драйвера отображения рекомендуется сначала инициализировать указатели функций рисования для драйвера отображения путем стандартной реализации ПО для необходимой глубины цвета, а затем заменить эти указатели функций там, где нужно вызывать специальные реализации функций (если они есть). Для этого существует функция установки по умолчанию, доступная для каждой поддерживаемой глубины цвета и формата. Например, при создании драйвера для 16-разрядного экрана RGB формата 5:6:5 сначала этот специальный драйвер должен вызывать универсальную подпрограмму установки для выбранной глубины цвета:

UINT my_custom_565_display_driver(GX_DISPLAY *display)

```c
{
      
      // perform standard function pointer setup
      
      _gx_display_driver_565rgb_setup(display, GX_NULL,
      
             my_buffertoggle);

}
```

Параметр my_buffer_toggle выше является указателем на функцию переключения буфера драйвера отображения (может быть GX_NULL, если драйвер является однобуферным и передает изображение непосредственно в аппаратный буфер фрейма).

При написании специального драйвера отображения необходимо включить файл заголовка gx_display. h в источник специального драйвера, который является файлом заголовка для внутреннего использования, недоступным для программного обеспечения на уровне приложения.

Функции рисования на уровне отображения графического пользовательского интерфейса принимают в качестве входных данных указатель на структуру **GX_DRAW_CONTEXT**. Структура **GX_DRAW_CONTEXT** определяет координаты обрезки для текущей операции рисования вместе с используемыми кистью и цветами. Каждая функция рисования получает в качестве входных данных дополнительные параметры отдельных функций.

Сигнатура точки входа драйвера **GX_DISPLAY** определяется как

```c
UINT <device>_graphics_driver_<format>(GX_DISPLAY *diplay)
```

Хотя имя этой функции полностью зависит от разработчика, при использовании графического пользовательского интерфейса рекомендуется указывать аппаратно-зависимые имена устройств в поле <device> и цветовой формат в поле <format>, указанном выше.

Эта функция должна инициализировать структуру **GX_DISPLAY**, выступающую в качестве источника входных данных, и выполнить все необходимые настройки оборудования. Структура **GX_DISPLAY** содержит следующие поля.

| &nbsp; |
| --- | --- |
| ULONG gx_display_id <br/> Это поле используется приложением в тех случаях, когда создается более одного экземпляра конкретного драйвера. |
| CHAR *gx_display_name <br/> Необязательное имя, используемое для распознавания драйвера. |
| GX_DISPLAY *gx_display_created_next <br/> Это поле инициализируется графическим пользовательским интерфейсом и используется для создания и обновления списка всех экземпляров GX_DISPLAY. |
| GX_DISPLAY *gx_display_created_previous <br/> Это поле инициализируется графическим пользовательским интерфейсом и используется для создания и обновления списка всех экземпляров GX_DISPLAY. |
| GX_VALUE gx_display_color_format <br/> Это поле должно отражать формат графических данных, поддерживаемый этим драйвером. Типы цветовых форматов определяются в файле заголовка gx_api. h. |
| GX_VALUE gx_display_width <br/> Это поле должно быть инициализировано для соблюдения физической ширины экрана (в пикселях). |
| GX_VALUE gx_display_height <br/> Это поле должно быть инициализировано для соблюдения физической высоты экрана (в пикселях). |
| GX_COLOR *gx_display_color_table <br/> Это указатель на таблицу, используемую для преобразования значений идентификаторов цветов в значения цветов в выбранном цветовом формате. |
| GX_PIXELMAP *gx_display_pixelmap_table <br/> Это указатель на активную таблицу карты отображения пикселей для этого дисплея. |
| GX_FONT *gx_display_font_table <br/> Это указатель на активную таблицу шрифтов для этого дисплея. |
| GX_COLOR *gx_display_palette <br/> Для драйверов режима палитры это указатель на активную цветовую палитру. Для драйверов, не использующих цветовую палитру, используется указатель GX_NULL. |
| UINT gx_display_pixelmap_table_size <br/> Число записей в активной таблице карты отображения пикселей. |
| UINT gx_display_font_table_size <br/> Число записей в активной таблице шрифтов. |
| UINT gx_display_palette_size <br/> Число записей в цветовой палитре (если они есть). |
| ULONG gx_display_handle <br/> Уникальный идентификатор или *обработчик*, который определяет отображение.
| UINT gx_display_driver_ready <br/> Это поле используется для оповещения графического пользовательского интерфейса о готовности драйвера к работе. В некоторых случаях драйверу может потребоваться несколько уровней инициализации и настройки, в течение этого времени графический пользовательский интерфейс не должен предпринимать попытку использования драйвера. Этот флаг должен иметь значение 1, если драйвер готов к выполнению запросов на рисование. |
| VOID *gx_display_driver_data <br/> Это поле предназначено для использования при реализации драйвера. Если драйвер должен создать дополнительную информацию, не доступную в структуре GX_DISPLAY, и ссылаться на нее, драйвер должен выделить место для этих данных и указать на них при использовании этого поля структуры. К примерам дополнительных данных для драйвера можно отнести канал DMA, который используется драйвером, или канал SPI, к которому подключен буфер фреймов отображения. |
| VOID (*gx_display_driver_drawing_initiate)(struct GX_DISPLAY_STRUCT *display, struct GX_CANVAS_STRUCT *canvas) <br/> Это указатель функции, который – если не установлен на нуль, используется для функции gx_canvas_drawing_initiate. Для драйверов отображения, использующих список графических акселераторов или аппаратного отображения графики, эту функцию можно использовать для запуска нового списка отображения. Указатель этой функции может иметь нулевое значение. |
| VOID (*gx_display_driver_palette_set)(struct GX_DISPLAY_STRUCT *display, GX_COLOR *palette, INT count) <br/> Это указатель на функцию для установки цветовой палитры. Эта функция имеет нулевое значение, если драйвер не работает в режиме палитры (также называется режимом таблицы подстановки цветов или CLUT). |
| VOID (*gx_display_driver_simple_line_draw)(GX_DRAW_CONTECT *context, INT x1, INTy1, INT x2, INT y2) <br/> Это указатель на функцию для реализации универсального рисования линии без сглаживания. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_simple_wide_line_draw)(GX_DRAW_CONTECT *context, INT x1, INTy1, INT x2, INT y2) <br/> Это указатель на функцию для реализации универсального рисования толстой линии без сглаживания. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_anti_aliased_line_draw)(GX_DRAW_CONTECT *context, INT x1, INTy1, INT x2, INT y2) <br/> Это указатель на функцию для реализации универсального рисования линии без сглаживания. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_anti_aliased_wide_line_draw)(GX_DRAW_CONTECT *context, INT x1, INTy1, INT x2, INT y2) <br/> Это указатель на функцию для реализации универсального рисования толстой линии без сглаживания. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_horizonal_line_draw)(GX_DRAW_CONTECT *context, INT x1, INT x2, INT y) <br/> Это указатель на функцию для реализации особого метода рисования горизонтальной линии. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_horizonal_pixelmap_line_draw)(GX_DRAW_CONTECT *context, INT x1, INT x2, INT y, GX_PIXELMAP *map) <br/> Это указатель на функцию, реализующую рисование отдельной записи из карты отображения пикселей. Эта функция используется автоматически для заполнения фигур по шаблону. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_vertical_line_draw)(GX_DRAW_CONTECT *context, INT y1, INT y2, INT x) <br/> Это указатель на функцию для реализации особого метода рисования горизонтальной линии. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_horizonal_pattern_line_draw)(GX_DRAW_CONTECT *context, INT x1, INT x2, INT y) <br/> Это указатель на функцию для реализации рисования горизонтальной линии по шаблону. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_vertical_pattern_line_draw)(GX_DRAW_CONTECT *context, INT y1, INT y2, INT x) <br/> Это указатель на функцию для реализации рисования вертикальной линии по шаблону. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_canvas_copy)(struct GX_CANVAS_STRUCT *source, struct GX_CANVAS_STRUCT *dest) <br/> Это указатель на функцию для копирования данных холста из одного холста в другой. Для определения области копирования используется недопустимый прямоугольник исходного холста. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_canvas_blend)(struct GX_CANVAS_STRUCT *source, struct GX_CANVAS_STRUCT *dest) <br/> Это указатель на функцию для альфа-смешения данных холста из исходного холста с существующими данными на конечном холсте. Для определения области смешения используется недопустимый прямоугольник исходного холста. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_pixelmap_blend)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp, GX_UBYTE alpha) <br/> Это указатель на функцию для смешения карты отображения пикселей на холсте фона, определяемом контекстом рисования. Передаваемое альфа-значение может быть дополнением к альфа-каналу, содержащемуся в данных карты отображения пикселей. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_pixelmap_draw)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp) <br/> Это указатель на функцию для рисования карты отображения пикселей на холсте, задаваемом контекстом рисования. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_jpeg_draw)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp) <br/> Это указатель на функцию для декодирования изображения JPG и его отображения непосредственно на холсте. Эта функция доступна только в том случае, если определено GX_SOFTWARE_DECODER_SUPPORT. Указатель этой функции может иметь нулевое значение. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_png_draw)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp) <br/> Это указатель на функцию для декодирования изображения JPG и его отображения непосредственно на холсте. Эта функция доступна только в том случае, если определено GX_SOFTWARE_DECODER_SUPPORT. Указатель этой функции может иметь нулевое значение. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_pixelmap_rotate)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp INT angle, INT rot_cx, INT rot_cy) <br/> Это указатель на функцию для поворота карты отображения пикселей и его отображения результата непосредственно на холсте. Эта функция используется в операции gx_canvas_pixelmap_rotate API. Реализации этой функции по умолчанию доступны для каждой глубины цвета и цветового формата. |
| VOID *gx_display_driver_pixel_write)(GX_DRAW_CONTEXT *context, INT x, INT y, GX_COLOR color) <br/> Это указатель на функцию записи одного пикселя в память холста. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. <br/>
| VOID *gx_display_driver_block_move)(GX_DRAW_CONTEXT *context,GX_RECTANGLE *block, INT xshift, INT yshift) <br/> Это указатель на функцию перемещения или сдвига блока пикселей в пределах холста. Эта функция в основном используется для быстрой прокрутки содержимого окна. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_pixel_blend)(GX_DRAW_CONTEXT *context, INT x, INT y, GX_COLOR color, GX_UBYTE alpha) <br/> Эта функция используется для альфа-смешивания входного значения цвета пикселя со значением цвета, имеющимся в памяти холста в точке с координатами (x,y). Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| GX_COLOR (*gx_display_driver_native_color_get)(GX_COLOR rawcolor) <br/> Эта функция преобразует цвет из 32-разрядного формата A:R:G:B, используемого в графическом пользовательском интерфейсе, в собственный формат цветов холста и экрана. Возможна потеря некоторой информации о цветах в драйверах отображения, использующих меньшую глубину цвета. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| USHORT (*gx_display_driver_row_pitch_get)(USHORT width) <br/> Возвращает число байт или полный шаг одной строки графических данных для заданной ширины холста. Эта функция используется для вычисления размера области памяти, необходимой для создания холста. Шаг и ширина строки не всегда одинаковы из-за ограничений выравнивания строк при проверке оборудования. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_buffer_toggle)(struct GX_CANVAS_STRUCT *canvas, GX_RECTANGLE *dirty_area) <br/> Это указатель на функцию, которая переключается между рабочим и отображаемым буферами фреймов для систем памяти с двойной буферизацией. Эта функция должна сначала указать оборудованию начать использовать новый буфер фреймов, а затем скопировать измененную часть нового видимого буфера в вспомогательный буфер, чтобы гарантировать, что два буфера останутся синхронизированными. | 
| VOID (*gx_display_driver_polygon_draw)(GX_DRAW_CONTEXT *context, INT num_points, GX_POINT *vertices <br/> Указатель на функцию рисования многоугольника. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_polygon_fill)(GX_DRAW_CONTEXT *context, INT num_points, GX_POINT *vertices <br/> Указатель на функцию рисования залитого многоугольника. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_circle_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Указатель на функцию рисования окружности. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_anti_aliased_circle_draw) (GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Указатель на функцию рисования окружности без сглаживания. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_wide_circle_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Указатель на функцию рисования окружности с широким контуром. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_wide_anti_aliased_circle_draw) (GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Указатель на функцию рисования окружности с широким контуром и с применением сглаживания. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_circle_fill)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Указатель на функцию рисования залитой окружности. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_arc_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INT end_angle) <br/> Указатель на функцию рисования дуги. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_anti_aliased_arc_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INTend_angle) <br/> Указатель на функцию рисования дуги без сглаживания. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_wide_arc_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INT end_angle) <br/> Указатель на функцию рисования дуги с широким контуром. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_anti_aliased_wide_arc_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INTend_angle) <br/> Указатель на функцию рисования дуги без сглаживания. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_arc_fill)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INT end_angle) <br/> Указатель на функцию рисования залитой дуги. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_pie_fill)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INT end_angle) <br/> Указатель на функцию рисования заполненной круговой диаграммы. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_ellipse_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Указатель на функцию рисования эллипса. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_anti_aliased_ellipse_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Указатель на функцию рисования эллипса. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_wide_ellipse_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Указатель на функцию рисования эллипса с широким контуром. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_anti_aliased_wide_ellipse_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Указатель на функцию рисования эллипса с широким контуром. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_ellipse_fill)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Указатель на функцию рисования заполненного эллипса. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_8bit_glyph_draw)(GX_DRAW_CONTEXT *context, GX_RECTANGLE *draw_area, GX_POINT *map_offset, constGX_GLYPH *glyph) <br/> Указатель на функцию рисования одного 8-разрядного текстового глифа с псевдонимом на холсте с помощью кисти в текущем контексте рисования. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_4bit_glyph_draw)(GX_DRAW_CONTEXT *context, GX_RECTANGLE *draw_area, GX_POINT *map_offset, const GX_GLYPH *glyph) <br/> Указатель на функцию рисования одного 4-разрядного текстового глифа с псевдонимом на холсте с помощью кисти в текущем контексте рисования. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |
| VOID (*gx_display_driver_1bit_glyph_draw)(GX_DRAW_CONTEXT *context, GX_RECTANGLE *draw_area, GX_POINT *map_offset, const GX_GLYPH *glyph) <br/> Указатель на функцию рисования одного 1-разрядного монохромного текстового глифа на холсте с помощью кисти в текущем контексте рисования. Реализация этой функции по умолчанию доступна для каждой поддерживаемой глубины цвета и цветового формата. |


