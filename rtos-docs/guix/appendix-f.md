---
title: Приложение Е. Службы привязки GUIX для ОСРВ
description: Сведения о службах привязки GUIX для ОСРВ.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 1d94dbb9d7d53ec3e1900188142974cc981dfea9
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104815567"
---
# <a name="appendix-f---guix-rtos-binding-services"></a>Приложение Е. Службы привязки GUIX для ОСРВ

Для функционирования GUIX требуются службы потоков или задач, мьютекс, очередь событий и службы времени, предоставляемые базовой системой ОСРВ. Для предоставления этих служб GUIX по умолчанию настроен для использования операционной системы реального времени ThreadX. Чтобы перенести GUIX в другую операционную систему, разработчик должен определить директиву препроцессора GX_DISABLE_THREADX_BINDING и перестроить библиотеку GUIX, чтобы удалить зависимости ThreadX. Кроме того, разработчик должен предоставить следующие определения макросов и вспомогательные функции. Примеры этих определений макросов и вспомогательных функций можно найти в файлах gx_system_rtos_bind.h и gx_system_rtos_bind.c, в которых приведен пример универсальной интеграции ОСРВ.

Макросы системной интеграции:

**GX_RTOS_BINDING_INITIALIZE**

Этот макрос вызывается во время инициализации системы. Макрос должен быть определен для вызова любой функции, необходимой для подготовки системных служб ОСРВ или ресурсов ОСРВ перед использованием. Это возможность привязки для подготовки ресурсов ОСРВ, которые будут использоваться GUIX.

**GX_SYSTEM_THREAD_START**

Этот макрос вызывается, когда задача или поток GUIX должны начать выполняться. Этот макрос должен быть определен для вызова функции, запускающей поток GUIX. Точка входа в поток GUIX передается вызываемой функции. Сигнатура вызываемой функции должна иметь следующий вид:

**UINT *function_name*(VOID (thread_entry_point)(VOID));**

Эта функция должна возвращать GX_SUCCESS, если поток успешно запущен; в противном случае должно возвращаться GX_FAILURE.

**GX_EVENT_PUSH**

Этот макрос вызывается для отправки события в очередь событий FIFO, используемую GUIX. При переносе в новую систему ОСРВ именно вы несете ответственность за реализацию этой очереди событий потокобезопасным способом. Структуры GX_EVENT должны быть скопированы в эту очередь и скопированы из нее, то есть очередь указателей GX_EVENT не будет работать, так как события GUIX могут быть автоматическими переменными из представления производителя событий. Сигнатура функции, вызываемой этим макросом, должна иметь следующий вид:

**UINT *function_name* (GX_EVENT *event_ptr);**

Эта функция должна возвращать GX_SUCCESS, если событие передается в очередь событий; в противном случае должно возвращаться GX_FAILURE.

**GX_EVENT_POP**

Этот макрос вызывается для удаления самого старого события из очереди событий GUIX и его копирования в запрошенное расположение. Эта функция должна при необходимости блокировать или ожидать события, если на данный момент в очереди событий нет событий. Сигнатура функции, вызываемой этим макросом, должна иметь следующий вид:

UINT function_name(GX_EVENT *put_event, GX_BOOL wait)

Если параметр wait = = GX_TRUE, функция не должна возвращать значение, пока не будет предоставлено событие. Если параметр wait имеет значение GX_FALSE, функция должна возвращаться немедленно с событием или без него.

Если событие извлекается из очереди, оно должно быть скопировано в расположение put_event, а возвращаемое состояние имеет значение GX_SUCCESS. В противном случае возвращаемое состояние должно иметь значение GX_FAILURE.

**GX_EVENT_FOLD**

GUIX вызывает этот макрос для свертывания события в очередь событий FIFO, используемую GUIX. Свертывание события означает, что если в очереди уже существует событие того же типа, эта запись обновляется для включения полезных данных нового события. Если в очереди отсутствует событие того же типа, в нее помещается новое событие. 

Для привязок, которые не могут реализовать функцию свертывания событий, можно просто вызвать GX_EVENT_PUSH.

**GX_TIMER_START**

Этот макрос вызывается, когда GUIX требуется получить входные данные периодического таймера. Этот макрос должен вызывать службу, запускающую службу периодического таймера ОСРВ низкого уровня. Если службу таймера ОСРВ трудно остановить или запустить, можно, но нецелесообразно, оставить ее в запущенном состоянии.

Когда служба таймера ОСРВ нижнего уровня время от времени завершает работу, привязка должна вызывать системную функцию GUIX _gx_system_timer_expiration(0). Ее периодический вызов обеспечивает функционирование служб мини-приложения таймера GUIX высокого уровня.

**GX_TIMER_STOP**

Этот макрос вызывается, когда GUIX больше не требуется периодический таймера (т. е. нет активных запущенных таймеров GUIX). Если службу таймера ОСРВ трудно остановить или запустить, можно, но нецелесообразно, оставить ее в запущенном состоянии и не задавать для макроса никаких действий.

**GX_SYSTEM_MUTEX_LOCK**

Этот макрос вызывается GUIX в критических разделах кода, чтобы запретить другой задаче вытеснять и изменять общие структуры данных, что в противном случае может привести к повреждению. Этот макрос должен вызывать функцию, которая реализует подходящую службу блокировки ресурсов ОСРВ.

Если вы никогда не использовали никакие службы API GUIX вне потока GUIX, можно не задавать для макроса никаких действий.

**GX_SYSTEM_MUTEX_UNLOCK**

Этот макрос вызывается в конце критических разделов кода и должен разблокировать ресурс GUIX с помощью подходящей базовой службы ОСРВ. Если вы никогда не использовали никакие службы API GUIX вне потока GUIX, можно не задавать для макроса никаких действий.

**GX_SYSTEM_TIME_GET**

Этот макрос должен вызывать функцию, возвращающую текущее системное время (системные такты), которое обычно представляет собой число прерываний таймера низкого уровня, произошедших с момента запуска системы. Эта служба используется для вычисления скорости сенсорного пера для жестов сенсорного ввода. Сигнатура функции, вызываемой этим макросом, должна иметь следующий вид:

**ULONG *function_name*(VOID);**

**GX_CURRENT_THREAD**

Этот макрос вызывается для определения выполняющегося в данный момент потока. Служба, вызываемая этим макросом, должна возвращать void *. Это значит, что для возврата в GUX тип данных, используемый операционной системой для определения текущего потока выполнения, должен быть приведен к типу void *.

Полный пример универсальной привязки ОСРВ реализован в файлах gx_system_rtos_bind.h и gx_system_rtos_bind.c.