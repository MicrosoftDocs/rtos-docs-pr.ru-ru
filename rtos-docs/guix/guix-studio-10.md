---
title: Простой пример проекта
description: В этой главе описывается, как создать пример проекта в GUIX Studio и выполнить его в GUIX.
author: jdeere5220
ms.author: kemaxwel
ms.date: 9/30/2020
ms.service: rtos
ms.topic: article
ms.openlocfilehash: 3661396f097e0ed7bd872fae01a7bec9212001b9
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104815004"
---
# <a name="chapter-10-example-project"></a>Глава 10. Пример проекта

В этой главе описывается, как создать пример проекта в GUIX Studio и выполнить его в GUIX.

## <a name="create-new-project"></a>Создание проекта

Сначала необходимо создать проект и настроить дисплеи и языки, которые он будет поддерживать. При первом запуске GUIX Studio появляется экран ***Recent Projects*** (Недавние проекты).

![Снимок экрана: диалоговое окно Recent Projects (Недавние проекты) в GUIX Studio](./media/guix-studio/recent_projects.png)

**Рис. 10.1**

Нажмите кнопку ***Create New Project…** _ (Создать проект), чтобы создать проект. Появится диалоговое окно _ *_New GUIX Project_** (Новый проект GUIX), показанное ниже.

![Снимок экрана: диалоговое окно создания проекта в GUIX Studio](./media/guix-studio/create_new_project.png)

**Рис. 10.2**

Введите имя проекта ***new_example***. Имена проектов должны следовать стандартным правилам именования переменных в C, то есть в них не должно быть специальных или зарезервированных символов. Введите путь к расположению, где нужно сохранить проект. Путь должен указывать на допустимый каталог файловой системы. GUIX Studio не создаст каталог, если он не существует. Чтобы создать проект, нажмите кнопку OK.

Следующий экран — Project Configuration (Конфигурация проекта).

![Снимок экрана: диалоговое окно Project Configuration (Конфигурация проекта) в GUIX Studio](./media/guix-studio/config_new_project.png)

**Рис. 10.3**

В этом диалоговом окне можно указать, сколько дисплеев будет поддерживать проект, и присвоить каждому из них имя. Для каждого дисплея необходимо указать поддерживаемый формат цвета и при необходимости ввести путь к выходным файлам, создаваемым для каждого экрана. Каталогом по умолчанию для выходных файлов является "***.\\***", то есть выходные файлы C записываются в тот же каталог, что и сам проект.

В этом примере оставьте для параметра ***Number of Displays** _ (Число дисплеев) значение 1, в поле отображаемого имени введите имя _*_main_display_*_ и установите флажок _*_allocate canvas memory_*_ (Выделить память холста). Оставьте значения по умолчанию в полях разрешения, формата цвета и каталога и нажмите кнопку _*_OK_**.

Проект должен открыться в интегрированной среде разработки (IDE) Studio, как показано на рис. 10.4.

![Снимок экрана: проект, открытый в IDE Studio](./media/guix-studio/initial_screen.png)

**Рис. 10.4**

При создании проекта GUIX Studio автоматически создает окно по умолчанию в качестве отправной точки. Это серое поле, находящееся по центру *целевого представления*.

Если это окно не выбрано, щелкните его, чтобы вокруг него появилось пунктирное поле выделения. Теперь на панели ***Properties View** _ (Представление свойств) измените значения свойств _*_Widget Name_*_ (Имя мини-приложения), _*_Widget Id_*_ (Идентификатор мини-приложения), _*_Left_*_ (Слева), _*_Top_*_ (Сверху), _*_Width_*_ (Ширина), _*_Height_*_ (Высота) и _ *_Border_* * (Граница) на указанные ниже. В процессе внесения этих изменений они немедленно вступают в силу в целевом представлении.

![Снимок экрана: диалоговое окно Properties View (Представление свойств)](./media/guix-studio/initial_window_properties.png)

**Рис. 10.5**

Далее мы добавим ресурс карты отображения пикселей, который будет использоваться в мини-приложении ***GX_ICON** _. В дистрибутиве GUIX Studio есть несколько значков, которые подойдут для этого примера. Разверните представление ресурсов _*_Pixelmaps_*_ (Карты отображения ресурсов) и нажмите кнопку _ *_Add New Pixelmap_** (Добавить новую карту отображения ресурсов).

![Снимок экрана: кнопка Add New Pixelmap (Добавить новую карту отображения ресурсов)](./media/guix-studio/image74.jpg)

Перейдите к папке установки GUIX Studio и в папке * **./graphics/icons** _ выберите файл с именем _*_i_history_lg.png_*_. Нажмите кнопку _*_Открыть_*_, чтобы добавить этот ресурс в проект. Теперь в представлении ресурсов _ *_Pixelmaps_** (Карты отображения пикселей) должно быть показано, как будет выглядеть добавленное изображение значка.

![Снимок экрана: представление ресурсов Pixelmaps (Карты отображения пикселей)](./media/guix-studio/example_add_pixelmap.png)

**Рис. 10.6**

Этот новый ресурс изображения будет использоваться позже в макете пользовательского интерфейса.

Так же, как ресурс карты отображения пикселей, мы добавим на панель элементов новый ресурс шрифта, чтобы использовать его в дальнейшем в проекте. Разверните представление ресурсов ***Fonts** _ (Шрифты) и нажмите кнопку _*_Add New Font_*_ (Добавить новый шрифт). Откроется диалоговое окно _*_Add/Edit Font_*_ (Добавление или изменение шрифта). Перейдите к имеющимся шрифтам GUIX в папке установки GUIX Studio, _*_ .\\fonts\\verasans_ *_, и выберите файл шрифта TrueType с именем _* _VeraIt.ttf_*_. В поле имени шрифта введите значение_* _MEDIUM_ITALIC_*_, а в поле высоты — значение_* _30_**. Теперь диалоговое окно будет выглядеть так.

![Снимок экрана: диалоговое окно Edit Font (Изменение шрифта)](./media/guix-studio/example_add_font.png)

**Рис. 10.7**

Нажмите кнопку ***OK***, чтобы добавить этот шрифт в проект. Теперь шрифт должен отображаться в представлении ресурсов.

![Снимок экрана: шрифты в представлении ресурсов](./media/guix-studio/example_font_added.png)

**Рис. 10.8**

Этот новый шрифт будет использоваться позже в проекте пользовательского интерфейса.

Теперь, когда у нас есть новые ресурсы, необходимо добавить на экран дочерние мини-приложения, которые смогут использовать их. Выберите ранее созданное окно с именем ***hello_world** _, щелкнув его правой кнопкой мыши в целевом представлении. В появившемся всплывающем меню выберите команду _*_Insert > Text > Prompt_*_ (Вставить > Текст > Подсказка), чтобы вставить новое мини-приложение _ *_GX_PROMPT_** и прикрепить его к фоновому окну. Теперь окно должно выглядеть так.

![Снимок экрана: всплывающее меню с выбранной подсказкой](./media/guix-studio/image78.jpg)

**Рис. 10.9**

В представлении ресурсов _ *_Fonts_** (Шрифты) выберите шрифт с именем ***MEDIUM_ITALIC** _ и перетащите его в мини-приложение подсказки. Затем измените свойства подсказки, как показано на рис. 10.10, чтобы задать ее размеры, прозрачность, текст и стиль.

![Снимок экрана: представление свойств для подсказки](./media/guix-studio/image79.jpg)

**Рис. 10.10**

Для просмотра всех параметров, в зависимости от разрешения экрана, может потребоваться прокрутить представление свойств вниз. После внесения этих изменений целевое представление должно выглядеть следующим образом.

![Снимок экрана: всплывающее меню с выделенным элементом Hello World](./media/guix-studio/image80.jpg)

**Рис. 10.11**

Далее мы разместим на экране мини-приложение типа "Кнопка-значок". Выберите фоновое окно, щелкнув его, и в меню верхнего уровня или контекстном меню выберите пункты ***Insert > Button > Icon Button** (Вставить > Кнопка > Кнопка-значок), чтобы добавить новое мини-приложение _*_GX_ICON_BUTTON_*_ в окно. Щелкните ранее добавленный значок с именем _ *_I_HISTORY_LG_** и перетащите его на кнопку-значок. В представлении свойств измените расположение и размер значка, как показано ниже.

![Снимок экрана: представление свойств для мини-приложения типа "Кнопка-значок"](./media/guix-studio/image81.jpg)

**Рис. 10.12**

Теперь экран должен выглядеть следующим образом.

![Снимок экрана: всплывающее меню с элементом Hello World и значком буфера обмена](./media/guix-studio/image82.jpg)

**Рис. 10.13**

На этом простой пример экрана завершен. Реальные экраны приложений, скорее всего, будут гораздо более сложными, но этого достаточно для демонстрации создания собственных экранов с помощью GUIX Studio.

## <a name="generate-resource-and-application-code"></a>Создание кода ресурса и приложения

Следующим шагом является создание файла ресурсов и файла спецификации, которые определяют встроенный пользовательский интерфейс GUIX времени выполнения. Чтобы создать выходные файлы, необходимо щелкнуть правой кнопкой мыши узел ***main_display** _ в представлении проекта и выбрать команду _ *_Generate Resource Files_** (Создать файлы ресурсов). Появится информационное окно с сообщением о том, что файлы ресурсов созданы, как показано на рис. 10.14.

![Снимок экрана с диалоговым окном уведомления](./media/guix-studio/image83.jpg)

**Рис. 10.14**

Нажмите кнопку ***OK** _, чтобы закрыть это уведомление, снова щелкните правой кнопкой мыши узел _*_main_display_*_ и выберите команду _ *_Generate Specification Files_** (Создать файлы спецификации). Появится аналогичное окно уведомления. Файлы простого приложения с пользовательским интерфейсом созданы.

## <a name="create-user-supplied-code"></a>Создание пользовательского кода

Следующим шагом является создание собственного файла приложения, который будет вызывать созданный с помощью GUIX Studio экран. В редакторе на свой выбор создайте исходный файл с именем ***new_example.c*** и введите в нем следующий исходный код.

```C

/* This is an example of the GUIX graphics framework in Win32. */
/* Include system files. */

#include <stdio.h>
#include "tx_api.h"
#include "gx_api.h"

/* Include GUIX resource and specification files for example. */

#include "new_example_resources.h"
#include "new_example_specifications.h"

/* Define the new example thread control block and stack. */

TX_THREAD new_example_thread;
UCHAR new_example_thread_stack[4096];

/* Define the root window pointer. */

GX_WINDOW_ROOT *root_window;

/* Define function prototypes. */

VOID new_example_thread_entry(ULONG thread_input);
UINT win32_graphics_driver_setup_24bpp(GX_DISPLAY *display);

int main()
{
    /* Enter the ThreadX kernel. */
    tx_kernel_enter();
    return(0);
}

VOID tx_application_define(void *first_unused_memory)
{
    /* Create the new example thread. */
    tx_thread_create(&new_example_thread, "GUIX New Example Thread", 
                      new_example_thread_entry, 0, 
                      new_example_thread_stack, sizeof(new_example_thread_stack),
                      1, 1, TX_NO_TIME_SLICE, TX_AUTO_START);
}

VOID new_example_thread_entry(ULONG thread_input)
{

    /* Initialize the GUIX library */
    gx_system_initialize();

    /* Configure the main display. */
    gx_studio_display_configure(MAIN_DISPLAY,                      /* Display to configure*/
                                win32_graphics_driver_setup_24bpp, /* Driver to use */
                                LANGUAGE_ENGLISH,                  /* Language to install */
                                MAIN_DISPLAY_DEFAULT_THEME,        /* Theme to install */
                                &root_window);                     /* Root window pointer */

    /* Create the screen - attached to root window. */

    gx_studio_named_widget_create("hello_world", (GX_WIDGET *) root_window, GX_NULL);

    /* Show the root window to make it visible. */
    gx_widget_show(root_window);

    /* Let GUIX run. */
    gx_system_start();

}
```

Приведенный выше исходный код создает типичный поток ThreadX `GUIX New Example Thread` с размером стека 4 КБ. Самое интересное начинается в функции ***new_example_thread_entry***. В ней запускается выполнение потока GUIX.

Сначала вызывается функция с именем ***gx_system_initialize***. Этот вызов всегда должен выполняться перед вызовом любых других интерфейсов API GUIX для подготовки библиотеки GUIX к первому использованию.

Далее в примере вызывается функция ***gx_studio_display_configure***. Она создает экземпляр дисплея GUIX, устанавливает требуемый язык таблицы строк приложения, устанавливает запрошенную тему из ресурсов дисплея и возвращает указатель на корневое окно, созданное для этого дисплея. Корневое окно используется в качестве родительского для всех экранов верхнего уровня, которые будут отображаться в приложении.

Далее в примере вызывается функция ***gx_studio_named_widget_create** _ для создания экземпляра экрана _ *_hello_world_**. Эта функция использует структуры данных и ресурсы, созданные средой GUIX Studio, для создания экземпляра определенного экрана. Мы передаем указатель на корневое окно в качестве второго параметра в вызов этой функции, то есть мы хотим, чтобы экран был присоединен непосредственно к корневому окну. Последний параметр — необязательный возвращаемый указатель, который можно использовать, если нам нужен указатель на созданный экран.

Далее вызывается функция ***gx_widget_show** _, которая делает корневое окно и все его дочерние элементы, включая экран _ *_hello_world_**, видимыми.

Наконец, в примере вызывается ***gx_system_start***. Эта функция начинает выполнение цикла обработки системных событий GUIX.

## <a name="build-and-run-the-example"></a>Сборка и запуск примера

Процедура сборки и запуска примера зависит от используемых средств сборки и среды. Однако в целом она выглядит так.

1. Создайте каталог и проект приложения.
1. Добавьте в проект следующие файлы.

    **new_example_resources.c**

    **new_example_specification.c**

    **new_example.c**

1. Добавьте вспомогательные файлы среды выполнения Win32 из пути установки GUIX Studio ***./win32_runtime***. К ним относятся файлы заголовков и библиотеки времени выполнения Win32 для ThreadX и GUIX.
1. Добавьте в проект библиотеку Win32 GUIX (***gx.lib***).
1. Добавьте в проект библиотеку Win32 ThreadX (***tx.lib***).
1. Скомпилируйте, скомпонуйте и запустите приложение.
