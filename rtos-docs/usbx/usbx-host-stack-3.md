---
title: Глава 3. Функциональные компоненты стека узлов USBX
description: В этой главе приведено описание высокопроизводительного внедренного в USBX стека узлов USB с точки зрения функциональных возможностей.
author: philmea
ms.author: philmea
ms.date: 5/19/2020
ms.service: rtos
ms.topic: article
ms.openlocfilehash: 17b8d884dd2c71d60e91f5fcec40c360060f4fe8
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "104816299"
---
# <a name="chapter-3---functional-components-of-usbx-host-stack"></a><span data-ttu-id="9a7ed-103">Глава 3. Функциональные компоненты стека узлов USBX</span><span class="sxs-lookup"><span data-stu-id="9a7ed-103">Chapter 3 - Functional Components of USBX Host Stack</span></span>

<span data-ttu-id="9a7ed-104">В этой главе приведено описание высокопроизводительного внедренного в USBX стека узлов USB с точки зрения функциональных возможностей.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-104">This chapter contains a description of the high performance USBX embedded USB host stack from a functional perspective.</span></span>

## <a name="execution-overview"></a><span data-ttu-id="9a7ed-105">Общие сведения о выполнении</span><span class="sxs-lookup"><span data-stu-id="9a7ed-105">Execution Overview</span></span>

<span data-ttu-id="9a7ed-106">USBX включает в себя следующие компоненты:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-106">USBX is composed of several components:</span></span>

- <span data-ttu-id="9a7ed-107">инициализация;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-107">Initialization</span></span>
- <span data-ttu-id="9a7ed-108">вызовы интерфейса приложения;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-108">Application interface calls</span></span>
- <span data-ttu-id="9a7ed-109">корневой концентратор;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-109">Root Hub</span></span>
- <span data-ttu-id="9a7ed-110">класс концентраторов;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-110">Hub Class</span></span>
- <span data-ttu-id="9a7ed-111">классы узлов;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-111">Host Classes</span></span>
- <span data-ttu-id="9a7ed-112">стек узлов USB;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-112">USB Host Stack</span></span>
- <span data-ttu-id="9a7ed-113">хост-контроллер.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-113">Host controller</span></span>

<span data-ttu-id="9a7ed-114">Стек узлов USBX показан на схеме ниже.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-114">The following diagram illustrates the USBX host stack.</span></span>

![Стек узлов USBX](./media/usbx-host-stack/usbx-host-stack.png)

### <a name="initialization"></a><span data-ttu-id="9a7ed-116">Инициализация</span><span class="sxs-lookup"><span data-stu-id="9a7ed-116">Initialization</span></span>

<span data-ttu-id="9a7ed-117">Чтобы активировать USBX, нужно вызвать функцию ***ux_system_initialize***.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-117">In order to activate USBX, the function ***ux_system_initialize*** must be called.</span></span> <span data-ttu-id="9a7ed-118">Эта функция инициализирует ресурсы памяти USBX.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-118">This function initializes the memory resources of USBX.</span></span>

<span data-ttu-id="9a7ed-119">Чтобы активировать средства узлов USBX, нужно вызвать функцию ***ux_system_initialize***.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-119">In order to activate USBX host facilities, the function ***ux_host_stack_initialize*** must be called.</span></span> <span data-ttu-id="9a7ed-120">Эта функция в свою очередь инициализирует все ресурсы, используемые стеком узлов USBX, например потоки ThreadX, мьютексы и семафоры.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-120">This function will in turn initialize all the resources used by the USBX host stack such as ThreadX threads, mutexes, and semaphores.</span></span>

<span data-ttu-id="9a7ed-121">Активация как минимум одного хост-контроллера USB и одного или нескольких классов USB выполняется уже при инициализации приложения.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-121">It is up to the application initialization to activate at least one USB host controller and one or more USB classes.</span></span> <span data-ttu-id="9a7ed-122">Если классы были зарегистрированы в стеке и была вызвана функция инициализации хост-контроллеров, то шина является активной и можно начать обнаружение устройств.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-122">When the classes have been registered to the stack and the host controller(s) initialization function has been called the bus is active and device discovery can start.</span></span> <span data-ttu-id="9a7ed-123">Если корневой концентратор хост-контроллера обнаружит подключенное устройство, то поток перечисления USB, отвечающий за топологию USB, будет пробужден и продолжится перечисление устройств.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-123">If the root hub of the host controller detects an attached device, the USB enumeration thread, in charge of the USB topology, will be wake up and proceed to enumerate the device(s).</span></span>

<span data-ttu-id="9a7ed-124">Ввиду особенностей корневого концентратора и нисходящих концентраторов возможна ситуация, когда все подключенные USB-устройства не будут полностью настроены при возвращении функции инициализации хост-контроллера.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-124">It is possible, due to the nature of the root hub and downstream hubs, that all attached USB devices may not have been configured completely when the host controller initialization function returns.</span></span> <span data-ttu-id="9a7ed-125">Перечисление всех USB-устройств может занять несколько секунд, особенно при наличии одного или нескольких концентраторов между корневым концентратором и USB-устройствами.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-125">It can take several seconds to enumerate all USB devices, especially if there are one or more hubs between the root hub and USB devices.</span></span>

### <a name="application-interface-calls"></a><span data-ttu-id="9a7ed-126">Вызовы интерфейса приложения</span><span class="sxs-lookup"><span data-stu-id="9a7ed-126">Application Interface Calls</span></span>

<span data-ttu-id="9a7ed-127">В USBX доступны два уровня API:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-127">There are two levels of APIs in USBX.</span></span>

- <span data-ttu-id="9a7ed-128">интерфейсы API стека узлов USB;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-128">USB Host Stack APIs</span></span>
- <span data-ttu-id="9a7ed-129">интерфейсы API классов узлов USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-129">USB Host Class APIs</span></span>

<span data-ttu-id="9a7ed-130">Как правило, приложение USBX не должно вызывать функции API стека узлов USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-130">Normally, a USBX application should not have to call any of the USB host stack API functions.</span></span> <span data-ttu-id="9a7ed-131">Большинство приложений обращается только к функциям API классов USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-131">Most applications will only access the USB Class API functions.</span></span>

### <a name="usb-host-stack-apis"></a><span data-ttu-id="9a7ed-132">Интерфейсы API стека узлов USB</span><span class="sxs-lookup"><span data-stu-id="9a7ed-132">USB Host Stack APIs</span></span>

<span data-ttu-id="9a7ed-133">Функции API стека узлов отвечают за регистрацию компонентов USBX (классов узлов и контроллеров узлов), конфигурацию устройств и запросы на передачу на доступные конечные точки устройств.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-133">The host stack API functions are responsible for the registration of USBX components (host classes and host controllers), configuration of devices, and the transfer requests for available device endpoints.</span></span>

### <a name="usb-host-class-api"></a><span data-ttu-id="9a7ed-134">API классов узлов USB</span><span class="sxs-lookup"><span data-stu-id="9a7ed-134">USB Host Class API</span></span>

<span data-ttu-id="9a7ed-135">Интерфейсы API классов для каждого класса USB сильно различаются.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-135">The Class APIs are very specific to each USB class.</span></span> <span data-ttu-id="9a7ed-136">Большинство популярных функций API для классов USB предоставляют такие возможности, как выключение и включение устройства, а также считывание или запись на устройстве.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-136">Most of the common API functions for USB classes provide services such as opening/closing a device and reading from and writing to a device.</span></span>

### <a name="root-hub"></a><span data-ttu-id="9a7ed-137">корневой концентратор;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-137">Root Hub</span></span>

<span data-ttu-id="9a7ed-138">У каждого экземпляра хост-контроллера есть один или несколько корневых концентраторов USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-138">Each host controller instance has one or more USB root hubs.</span></span> <span data-ttu-id="9a7ed-139">Количество корневых концентраторов определяется структурой контроллера. Его можно получить путем считывания определенных регистров контроллера.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-139">The number of root hubs is either determined by the nature of the controller or can be retrieved by reading specific registers from the controller.</span></span>

### <a name="hub-class"></a><span data-ttu-id="9a7ed-140">Класс концентраторов</span><span class="sxs-lookup"><span data-stu-id="9a7ed-140">Hub Class</span></span>

<span data-ttu-id="9a7ed-141">Класс концентраторов отвечает за управление концентраторами USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-141">The hub class is in charge of driving USB hubs.</span></span> <span data-ttu-id="9a7ed-142">Концентратор USB может быть изолированным или являться частью многофункционального устройства, такого как клавиатура или монитор.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-142">A USB hub can either be a stand-alone hub or as part of a compound device such as a keyboard or a monitor.</span></span> <span data-ttu-id="9a7ed-143">Концентратор может быть с собственным питанием или питанием от шины.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-143">A hub can be self-powered or bus-powered.</span></span> <span data-ttu-id="9a7ed-144">Концентраторы с питанием от шины имеют до четырех нисходящих портов и допускают подключение только устройств с собственным питанием или питанием от шины с током до 100 мА.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-144">Bus-powered hubs have a maximum of four downstream ports and can only allow for the connection of devices that are either self-powered or bus-powered devices that use less than 100mA of power.</span></span> <span data-ttu-id="9a7ed-145">Концентраторы можно подключать каскадом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-145">Hubs can be cascaded.</span></span> <span data-ttu-id="9a7ed-146">Можно подключить друг к другу до пяти концентраторов.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-146">Up to five hubs can be connected to one another.</span></span>

### <a name="usb-host-stack"></a><span data-ttu-id="9a7ed-147">Стек узлов USB</span><span class="sxs-lookup"><span data-stu-id="9a7ed-147">USB Host Stack</span></span>

<span data-ttu-id="9a7ed-148">Стек узлов USB — это основа USBX.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-148">The USB host stack is the centerpiece of USBX.</span></span> <span data-ttu-id="9a7ed-149">У него три основные функции:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-149">It has three main functions.</span></span>

- <span data-ttu-id="9a7ed-150">управление топологией USB;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-150">Manage the topology of the USB.</span></span>
- <span data-ttu-id="9a7ed-151">привязка USB-устройства к одному или нескольким классам;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-151">Bind a USB device to one or more classes.</span></span>
- <span data-ttu-id="9a7ed-152">предоставление API классам для опроса дескрипторов устройств и передачи данных по USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-152">Provide an API to classes to perform device descriptor interrogation and USB transfers.</span></span>

### <a name="topology-manager"></a><span data-ttu-id="9a7ed-153">Диспетчер топологии</span><span class="sxs-lookup"><span data-stu-id="9a7ed-153">Topology Manager</span></span>

<span data-ttu-id="9a7ed-154">Поток топологии стека USB пробуждается при подключении нового устройства или при отключении устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-154">The USB stack topology thread is awakened when a new device is connected or when a device has been disconnected.</span></span> <span data-ttu-id="9a7ed-155">Подключения устройств может принимать корневой или обычный концентратор.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-155">Either the root hub or a regular hub can accept device connections.</span></span> <span data-ttu-id="9a7ed-156">После подключения устройства к USB диспетчер топологии извлекает дескриптор устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-156">Once a device has been connected to the USB, the topology manager will retrieve the device descriptor.</span></span> <span data-ttu-id="9a7ed-157">Этот дескриптор будет содержать количество возможных конфигураций, доступных для этого устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-157">This descriptor will contain the number of possible configurations available for this device.</span></span> <span data-ttu-id="9a7ed-158">Большинство устройств имеет только одну конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-158">Most devices have one configuration only.</span></span> <span data-ttu-id="9a7ed-159">Некоторые устройства могут функционировать по-разному в зависимости от доступной мощности порта, к которому они подключены.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-159">Some devices can operate differently according to the available power available on the port where it is connected.</span></span> <span data-ttu-id="9a7ed-160">В этом случае у устройства будет несколько конфигураций, которые можно выбрать в зависимости от доступной мощности.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-160">If this is the case, the device will have multiple configurations that can be selected depending on the available power.</span></span> <span data-ttu-id="9a7ed-161">Когда устройство настроено диспетчером топологии, ему разрешается потреблять мощность, указанную в его дескрипторе конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-161">When the device is configured by the topology manager, it is then allowed to draw the amount of power specified in its configuration descriptor.</span></span>

## <a name="usb-class-binding"></a><span data-ttu-id="9a7ed-162">Привязка классов USB</span><span class="sxs-lookup"><span data-stu-id="9a7ed-162">USB Class Binding</span></span>

<span data-ttu-id="9a7ed-163">Если устройство настроено, то диспетчер топологии позволит диспетчеру классов продолжить обнаружение устройства, просмотрев дескрипторы интерфейса устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-163">When the device is configured, the topology manager will let the class manager continue the device discovery by looking at the device interface descriptors.</span></span> <span data-ttu-id="9a7ed-164">Устройство может иметь один или несколько дескрипторов интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-164">A device can have one or more interface descriptors.</span></span>

<span data-ttu-id="9a7ed-165">Интерфейс представляет функцию в устройстве.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-165">An interface represents a function in a device.</span></span> <span data-ttu-id="9a7ed-166">Например, динамик USB имеет три интерфейса: для потоковой передачи, для управления звуком и для управления различными кнопками динамика.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-166">For instance, a USB speaker has three interfaces, one for audio streaming, one for audio control, and one to manage the various speaker buttons.</span></span>

<span data-ttu-id="9a7ed-167">В диспетчере классов есть два механизма присоединения интерфейсов устройств к одному или нескольким классам.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-167">The class manager has two mechanisms to join the device interface(s) to one or more classes.</span></span> <span data-ttu-id="9a7ed-168">Он может использовать сочетание идентификаторов PID и VID (идентификатор продукта и идентификатор поставщика), найденных в дескрипторе интерфейса, или сочетание класса, подкласса и протокола.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-168">It can either use the combination of a PID/VID (product ID and vendor ID) found in the interface descriptor or the combination of Class/Subclass/Protocol.</span></span>

<span data-ttu-id="9a7ed-169">Сочетание PID и VID допустимо для интерфейсов, для управления которыми невозможно использовать универсальный класс.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-169">The PID/VID combination is valid for interfaces that cannot be driven by a generic class.</span></span> <span data-ttu-id="9a7ed-170">Сочетание класса, подкласса и протокола используется интерфейсами, принадлежащими к классу, сертифицированному по USB-IF (например, принтер, концентратор, хранилище, аудиоустройство или HID-устройство).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-170">The Class/Subclass/Protocol combination is used by interfaces that belong to a USB-IF certified class such as a printer, hub, storage, audio, or HID.</span></span>

<span data-ttu-id="9a7ed-171">Диспетчер классов содержит список зарегистрированных классов, полученный при инициализации USBX.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-171">The class manager contains a list of registered classes from the initialization of USBX.</span></span> <span data-ttu-id="9a7ed-172">Диспетчер классов будет вызывать каждый класс по одному, пока какой-либо класс не примет управление интерфейсом для этого устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-172">The class manager will call each class one at a time until one class accepts to manage the interface for that device.</span></span> <span data-ttu-id="9a7ed-173">Класс может управлять только одним интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-173">A class can only manage one interface.</span></span> <span data-ttu-id="9a7ed-174">Например, для динамика USB диспетчер классов будет вызывать все классы для каждого из интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-174">For the example of the USB audio speaker, the class manager will call all the classes for each of the interfaces.</span></span>

<span data-ttu-id="9a7ed-175">После того как класс принимает интерфейс, создается новый экземпляр этого класса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-175">Once a class accepts an interface, a new instance of that class is created.</span></span> <span data-ttu-id="9a7ed-176">Затем диспетчер классов выполняет поиск альтернативного параметра по умолчанию для интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-176">The class manager will then search for the default alternate setting for the interface.</span></span> <span data-ttu-id="9a7ed-177">У устройства может быть один или несколько альтернативных параметров для каждого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-177">A device may have one or more alternate settings for each interface.</span></span> <span data-ttu-id="9a7ed-178">Альтернативный параметр 0 будет использоваться по умолчанию до тех пор, пока класс не решит изменить его.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-178">The alternate setting 0 will be the on used by default until a class decides to change it.</span></span>

<span data-ttu-id="9a7ed-179">Для альтернативного параметра по умолчанию диспетчер классов подключит все конечные точки, указанные в этом альтернативном параметре.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-179">For the default alternate setting, the class manager will mount all the endpoints contained in the alternate setting.</span></span> <span data-ttu-id="9a7ed-180">Если подключение каждой конечной точки выполнено успешно, диспетчер классов завершит свою работу, вернувшись к классу, который завершит инициализацию интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-180">If the mounting of each endpoint is successful, the class manager will complete its job by returning to the class that will finish the initialization of the interface.</span></span>

### <a name="usbx-apis"></a><span data-ttu-id="9a7ed-181">Интерфейсы API USBX</span><span class="sxs-lookup"><span data-stu-id="9a7ed-181">USBX APIs</span></span>

<span data-ttu-id="9a7ed-182">Стек USB экспортирует определенное количество интерфейсов API для классов USB, предназначенных для выполнения опроса устройства и передачи данных по USB на определенных конечных точках.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-182">The USB stack exports a certain number of APIs for the USB classes to perform interrogation on the device and USB transfers on specific endpoints.</span></span> <span data-ttu-id="9a7ed-183">Эти функции API подробно описаны в данном справочном руководстве.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-183">These API functions are described in detail in this reference manual.</span></span>

### <a name="host-controller"></a><span data-ttu-id="9a7ed-184">Хост-контроллер</span><span class="sxs-lookup"><span data-stu-id="9a7ed-184">Host Controller</span></span>

<span data-ttu-id="9a7ed-185">Драйвер хост-контроллера отвечает за управление контроллером USB определенного типа.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-185">The host controller driver is responsible for driving a specific type of USB controller.</span></span> <span data-ttu-id="9a7ed-186">Хост-контроллер USB может содержать несколько контроллеров.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-186">A USB host controller can have multiple controllers inside.</span></span> <span data-ttu-id="9a7ed-187">Например, определенный набор микросхем Intel для компьютеров содержит два контроллера UHCI.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-187">For instance, certain Intel PC chipset contain two UHCI controllers.</span></span> <span data-ttu-id="9a7ed-188">Некоторые контроллеры USB 2.0 содержат несколько экземпляров контроллера OHCI в дополнение к одному экземпляру контроллера EHCI.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-188">Some USB 2.0 controllers contain multiple instances of an OHCI controller in addition to one instance of the EHCI controller.</span></span>

<span data-ttu-id="9a7ed-189">Хост-контроллер будет управлять несколькими экземплярами одного контроллера.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-189">The Host controller will manage multiple instance of the same controller only.</span></span> <span data-ttu-id="9a7ed-190">Для работы большинства хост-контроллеров USB 2.0 в процессе инициализации USBX потребуется инициализировать контроллер OCHI и контроллер EHCI.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-190">In order to drive most USB 2.0 host controllers, it will be required to initialize both the OCHI controller and the EHCI controller during the initialization of USBX.</span></span>

<span data-ttu-id="9a7ed-191">Хост-контроллер отвечает за управление следующим:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-191">The host controller is responsible for managing the following.</span></span>

- <span data-ttu-id="9a7ed-192">корневой концентратор;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-192">Root Hub</span></span>
- <span data-ttu-id="9a7ed-193">Управление питанием</span><span class="sxs-lookup"><span data-stu-id="9a7ed-193">Power Management</span></span>
- <span data-ttu-id="9a7ed-194">Конечные точки</span><span class="sxs-lookup"><span data-stu-id="9a7ed-194">Endpoints</span></span>
- <span data-ttu-id="9a7ed-195">Передачи</span><span class="sxs-lookup"><span data-stu-id="9a7ed-195">Transfers</span></span>

### <a name="root-hub"></a><span data-ttu-id="9a7ed-196">корневой концентратор;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-196">Root Hub</span></span>

<span data-ttu-id="9a7ed-197">Управление корневым концентратором отвечает за включение всех портов контроллера и определение наличия подключенных устройств.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-197">The root hub management is responsible for the powering up of each controller port and determining if there is a device inserted or not.</span></span> <span data-ttu-id="9a7ed-198">Эти функциональные возможности используется универсальным корневым концентратором USBX для опроса нисходящих портов контроллера.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-198">This functionality is used by the USBX generic root hub to interrogate the controller downstream ports.</span></span>

### <a name="power-management"></a><span data-ttu-id="9a7ed-199">Управление питанием</span><span class="sxs-lookup"><span data-stu-id="9a7ed-199">Power Management</span></span>

<span data-ttu-id="9a7ed-200">Управление питанием обеспечивает обработку сигналов приостановки и возобновления в совместном режиме, что влияет на все нисходящие порты контроллера одновременно или по отдельности, если контроллер предоставляет эту функцию.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-200">The power management processing provides for the handling of suspend/resume signals either in gang mode, therefore affecting all controller downstream ports at the same time, or individually if the controller offers this functionality.</span></span>

### <a name="endpoints"></a><span data-ttu-id="9a7ed-201">Конечные точки</span><span class="sxs-lookup"><span data-stu-id="9a7ed-201">Endpoints</span></span>

<span data-ttu-id="9a7ed-202">Управление конечными точками обеспечивает создание или уничтожение физических конечных точек контроллера.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-202">The endpoint management provides for the creation or destruction of physical endpoints to the controller.</span></span> <span data-ttu-id="9a7ed-203">Физические конечные точки — это сущности в памяти, которые анализируются контроллером, если контроллер поддерживает главный канал DMA, или записаны в контроллер.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-203">The physical endpoints are memory entities that are parsed by the controller if the controller supports master DMA or that are written in the controller.</span></span> <span data-ttu-id="9a7ed-204">Физические конечные точки содержат сведения о транзакциях, выполняемых контроллером.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-204">The physical endpoints contain transactions information to be performed by the controller.</span></span>

### <a name="transfers"></a><span data-ttu-id="9a7ed-205">Передачи</span><span class="sxs-lookup"><span data-stu-id="9a7ed-205">Transfers</span></span>

<span data-ttu-id="9a7ed-206">Управление передачей данных предоставляет класс для выполнения транзакции на каждой из созданных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-206">Transfer management provides for a class to perform a transaction on each of the endpoints that have been created.</span></span> <span data-ttu-id="9a7ed-207">Каждая логическая точка содержит компонент TRANSFER REQUEST для запросов на передачу USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-207">Each logical endpoint contains a component called TRANSFER REQUEST for USB transfer requests.</span></span> <span data-ttu-id="9a7ed-208">Структура TRANSFER REQUEST используется стеком для описания транзакции.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-208">The TRANSFER REQUEST is used by the stack to describe the transaction.</span></span> <span data-ttu-id="9a7ed-209">Затем эта структура передается в стек и контроллер, который может разделить ее на несколько подтранзакций, в зависимости от возможностей контроллера.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-209">This TRANSFER REQUEST is then passed to the stack and to the controller, which may divide it into several sub transactions depending on the capabilities of the controller.</span></span>

## <a name="usb-device-framework"></a><span data-ttu-id="9a7ed-210">Платформа USB-устройств</span><span class="sxs-lookup"><span data-stu-id="9a7ed-210">USB Device Framework</span></span>

<span data-ttu-id="9a7ed-211">USB-устройство представляется деревом дескрипторов.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-211">A USB device is represented by a tree of descriptors.</span></span> <span data-ttu-id="9a7ed-212">Существуют шесть основных типов дескрипторов:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-212">There are six main types of descriptors.</span></span>

- <span data-ttu-id="9a7ed-213">дескрипторы устройства;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-213">Device descriptors</span></span>
- <span data-ttu-id="9a7ed-214">дескрипторы конфигурации;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-214">Configuration descriptors</span></span>
- <span data-ttu-id="9a7ed-215">дескрипторы интерфейса;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-215">Interface descriptors</span></span>
- <span data-ttu-id="9a7ed-216">дескрипторы конечной точки;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-216">Endpoint descriptors</span></span>
- <span data-ttu-id="9a7ed-217">дескрипторы строки;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-217">String descriptors</span></span>
- <span data-ttu-id="9a7ed-218">функциональные дескрипторы.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-218">Functional descriptors</span></span>

<span data-ttu-id="9a7ed-219">USB-устройство может иметь очень простое описание, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-219">A USB device may have a very simple description and looks like this.</span></span>
<span data-ttu-id="9a7ed-220">![Простое USB-устройство](./media/usbx-host-stack/usb-device-simple.png)</span><span class="sxs-lookup"><span data-stu-id="9a7ed-220">![Simple USB device](./media/usbx-host-stack/usb-device-simple.png)</span></span>

<span data-ttu-id="9a7ed-221">На приведенном выше рисунке устройство имеет только одну конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-221">In the above illustration, the device has only one configuration.</span></span> <span data-ttu-id="9a7ed-222">К этой конфигурации подключен один интерфейс, указывающий, что устройство имеет только одну функцию и одну конечную точку.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-222">A single interface is attached to this configuration, indicating that the device has only one function, and it has one endpoint only.</span></span> <span data-ttu-id="9a7ed-223">К дескриптору устройства подключен дескриптор строки, обеспечивающий видимую идентификацию устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-223">Attached to the device descriptor is a string descriptor providing a visible identification of the device.</span></span>

<span data-ttu-id="9a7ed-224">Однако устройство может быть более сложным и выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-224">However, a device may be more complex and may appear as follows.</span></span>

![Сложное USB-устройство](./media/usbx-host-stack/usb-device-complex.png)

<span data-ttu-id="9a7ed-226">На приведенном выше рисунке у устройства два дескриптора конфигурации, подключенных к дескриптору устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-226">In the above illustration, the device has two configuration descriptors attached to the device descriptor.</span></span> <span data-ttu-id="9a7ed-227">Это устройство может указать, что у него есть два режима питания или что им можно управлять либо с помощью стандартных классов, либо с помощью собственных классов.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-227">This device may indicate that it has two power modes or can be driven by either standard classes or proprietary classes.</span></span>

<span data-ttu-id="9a7ed-228">К первой конфигурации подключены два интерфейса, указывающие, что устройство имеет две логические функции.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-228">Attached to the first configuration are two interfaces indicating that the device has two logical functions.</span></span> <span data-ttu-id="9a7ed-229">Первая функция содержит 3 дескриптора конечной точки и функциональный дескриптор.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-229">The first function has 3 endpoint descriptors and a functional descriptor.</span></span> <span data-ttu-id="9a7ed-230">Функциональный дескриптор может использоваться классом, отвечающим за управление интерфейсом, для получения дополнительных сведений об этом интерфейсе, обычно не указываемых в универсальным дескрипторе.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-230">The functional descriptor may be used by the class responsible to drive the interface to obtain further information about this interface normally not found by a generic descriptor.</span></span>

### <a name="device-descriptors"></a><span data-ttu-id="9a7ed-231">Дескрипторы устройства</span><span class="sxs-lookup"><span data-stu-id="9a7ed-231">Device Descriptors</span></span>

<span data-ttu-id="9a7ed-232">Каждое USB-устройство имеет один дескриптор устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-232">Each USB device has one single device descriptor.</span></span> <span data-ttu-id="9a7ed-233">Этот дескриптор содержит идентификационные данные устройства, число поддерживаемых конфигураций и характеристики используемой по умолчанию конечной точки управления, используемой для настройки этого устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-233">This descriptor contains the device identification, the number of configurations supported, and the characteristics of the default control endpoint used for configuring the device.</span></span>

| <span data-ttu-id="9a7ed-234">Offset</span><span class="sxs-lookup"><span data-stu-id="9a7ed-234">Offset</span></span> | <span data-ttu-id="9a7ed-235">Поле</span><span class="sxs-lookup"><span data-stu-id="9a7ed-235">Field</span></span>              | <span data-ttu-id="9a7ed-236">Size</span><span class="sxs-lookup"><span data-stu-id="9a7ed-236">Size</span></span> | <span data-ttu-id="9a7ed-237">Значение</span><span class="sxs-lookup"><span data-stu-id="9a7ed-237">Value</span></span>    | <span data-ttu-id="9a7ed-238">Описание</span><span class="sxs-lookup"><span data-stu-id="9a7ed-238">Description</span></span>                             |
| ------ | ------------------ | ---- | -------- | --------------------------------------- |
| <span data-ttu-id="9a7ed-239">0</span><span class="sxs-lookup"><span data-stu-id="9a7ed-239">0</span></span>      | <span data-ttu-id="9a7ed-240">BLength</span><span class="sxs-lookup"><span data-stu-id="9a7ed-240">BLength</span></span>            | <span data-ttu-id="9a7ed-241">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-241">1</span></span>    | <span data-ttu-id="9a7ed-242">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-242">Number</span></span>   | <span data-ttu-id="9a7ed-243">Размер дескриптора в байтах</span><span class="sxs-lookup"><span data-stu-id="9a7ed-243">Size of this descriptor in bytes</span></span> |
| <span data-ttu-id="9a7ed-244">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-244">1</span></span>      | <span data-ttu-id="9a7ed-245">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="9a7ed-245">bDescriptorType</span></span>    | <span data-ttu-id="9a7ed-246">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-246">1</span></span>    | <span data-ttu-id="9a7ed-247">Константа</span><span class="sxs-lookup"><span data-stu-id="9a7ed-247">Constant</span></span> | <span data-ttu-id="9a7ed-248">Тип дескриптора устройства</span><span class="sxs-lookup"><span data-stu-id="9a7ed-248">DEVICE Descriptor Type</span></span> |
| <span data-ttu-id="9a7ed-249">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-249">2</span></span>      | <span data-ttu-id="9a7ed-250">bcdUSB</span><span class="sxs-lookup"><span data-stu-id="9a7ed-250">bcdUSB</span></span>             | <span data-ttu-id="9a7ed-251">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-251">2</span></span>    | <span data-ttu-id="9a7ed-252">BCD</span><span class="sxs-lookup"><span data-stu-id="9a7ed-252">BCD</span></span>      | <span data-ttu-id="9a7ed-253">Номер выпуска спецификации USB в двоично-десятичном коде</span><span class="sxs-lookup"><span data-stu-id="9a7ed-253">USB Specification Release Number in BinaryCoded Dec</span></span><br /><span data-ttu-id="9a7ed-254">Пример: номер 2.10 эквивалентен 0x210.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-254">Example: 2.10 is equivalent to 0x210.</span></span> <span data-ttu-id="9a7ed-255">В этом поле указывается выпуск спецификации USB, которой соответствует устройство и его дескрипторы.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-255">This field identifies the release of the USB Specification that the device and its descriptors are compliant with.</span></span> |
| <span data-ttu-id="9a7ed-256">4</span><span class="sxs-lookup"><span data-stu-id="9a7ed-256">4</span></span>      | <span data-ttu-id="9a7ed-257">bDeviceClass</span><span class="sxs-lookup"><span data-stu-id="9a7ed-257">bDeviceClass</span></span>       | <span data-ttu-id="9a7ed-258">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-258">1</span></span>    | <span data-ttu-id="9a7ed-259">Класс</span><span class="sxs-lookup"><span data-stu-id="9a7ed-259">Class</span></span>    | <span data-ttu-id="9a7ed-260">Код класса (назначается USB-IF).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-260">Class code (assigned by USB-IF).</span></span><br /><span data-ttu-id="9a7ed-261">Если это поле сброшено в 0, то каждый интерфейс в конфигурации указывает сведения о собственном классе, и разные интерфейсы работают независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-261">If this field is reset to 0, each interface within a configuration specifies its own class information and the various interfaces operate independently.</span></span><br /><span data-ttu-id="9a7ed-262">Если для этого поля задано значение от 1 до 0xFE, то устройство поддерживает различные спецификации классов в разных интерфейсах, и интерфейсы могут не работать независимо.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-262">If this field is set to a value between 1 and 0xFE, the device supports different class specifications on different interfaces and the interfaces may not operate independently.</span></span> <span data-ttu-id="9a7ed-263">Это значение идентифицирует определение класса, используемого для агрегатных интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-263">This value identifies the class definition used for the aggregate interfaces.</span></span><br /><span data-ttu-id="9a7ed-264">Если для этого поля задано значение 0xFF, то класс устройства зависит от поставщика.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-264">If this field is set to 0xFF, the device class is vendor specific.</span></span> |
| <span data-ttu-id="9a7ed-265">5</span><span class="sxs-lookup"><span data-stu-id="9a7ed-265">5</span></span>      | <span data-ttu-id="9a7ed-266">bDeviceSubClass</span><span class="sxs-lookup"><span data-stu-id="9a7ed-266">bDeviceSubClass</span></span>    | <span data-ttu-id="9a7ed-267">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-267">1</span></span>    | <span data-ttu-id="9a7ed-268">SubClass</span><span class="sxs-lookup"><span data-stu-id="9a7ed-268">SubClass</span></span> | <span data-ttu-id="9a7ed-269">Код подкласса (назначается USB-IF).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-269">Subclass code (assigned by USB-IF).</span></span><br /><span data-ttu-id="9a7ed-270">Эти коды определяются значением поля bDeviceClass.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-270">These codes are qualified by the value of the bDeviceClass field.</span></span> <span data-ttu-id="9a7ed-271">Если поле bDeviceClass сброшено в 0, то это поле также должно быть сброшено в 0.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-271">If the bDeviceClass field is reset to 0, this field must also be reset to 0.</span></span> <span data-ttu-id="9a7ed-272">Если для поля bDeviceClass не задано значение 0xFF, то все значения зарезервированы для назначения USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-272">If the bDeviceClass field is not set to 0xFF, all values are reserved for assignment by USB.</span></span> |
| <span data-ttu-id="9a7ed-273">6</span><span class="sxs-lookup"><span data-stu-id="9a7ed-273">6</span></span>      | <span data-ttu-id="9a7ed-274">bDeviceProtocol</span><span class="sxs-lookup"><span data-stu-id="9a7ed-274">bDeviceProtocol</span></span>    | <span data-ttu-id="9a7ed-275">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-275">1</span></span>    | <span data-ttu-id="9a7ed-276">Протокол</span><span class="sxs-lookup"><span data-stu-id="9a7ed-276">Protocol</span></span> | <span data-ttu-id="9a7ed-277">Код протокола (назначается USB-IF).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-277">Protocol code (assigned by USB-IF).</span></span><br /><span data-ttu-id="9a7ed-278">Эти коды определяются значениями полей bDeviceClass и bDeviceSubClass.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-278">These codes are qualified by the value of the bDeviceClass and the bDeviceSubClass fields.</span></span> <span data-ttu-id="9a7ed-279">Если устройство поддерживает зависящие от класса протоколы для каждого устройства, а не каждого интерфейса, то этот код определяет протоколы, используемые устройством в соответствии со спецификацией класса устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-279">If a device supports class-specific protocols on a device basis as opposed to an interface basis, this code identifies the protocols that the device uses as defined by the specification of the device class.</span></span> <span data-ttu-id="9a7ed-280">Если это поле сброшено в 0, то устройство не использует зависящие от класса протоколы для каждого устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-280">If this field is reset to 0, the device does not use class specific protocols on a device basis.</span></span><br /><span data-ttu-id="9a7ed-281">Однако оно может использовать зависящие от класса протоколы для каждого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-281">However, it may use class specific protocols on an interface basis.</span></span><br /><span data-ttu-id="9a7ed-282">Если для этого поля задано значение 0xFF, то устройство использует зависящий от поставщика протокол для каждого устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-282">If this field is set to 0xFF, the device uses a vendor specific protocol on a device basis.</span></span> |
| <span data-ttu-id="9a7ed-283">7</span><span class="sxs-lookup"><span data-stu-id="9a7ed-283">7</span></span>      | <span data-ttu-id="9a7ed-284">bMaxPacketSize0</span><span class="sxs-lookup"><span data-stu-id="9a7ed-284">bMaxPacketSize0</span></span>    | <span data-ttu-id="9a7ed-285">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-285">1</span></span>    | <span data-ttu-id="9a7ed-286">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-286">Number</span></span>   | <span data-ttu-id="9a7ed-287">Максимальный размер пакета для конечной точки 0 (допускаются только размеры в байтах: 8, 16, 32 или 64).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-287">Maximum packet size for endpoint zero (only byte sizes of 8, 16, 32, or 64 are valid)</span></span> |
| <span data-ttu-id="9a7ed-288">8</span><span class="sxs-lookup"><span data-stu-id="9a7ed-288">8</span></span>      | <span data-ttu-id="9a7ed-289">idVendor</span><span class="sxs-lookup"><span data-stu-id="9a7ed-289">idVendor</span></span>           | <span data-ttu-id="9a7ed-290">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-290">2</span></span>    | <span data-ttu-id="9a7ed-291">ID</span><span class="sxs-lookup"><span data-stu-id="9a7ed-291">ID</span></span>       | <span data-ttu-id="9a7ed-292">Идентификатор поставщика (назначается USB-IF).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-292">Vendor ID (assigned by USB-IF)</span></span> |
| <span data-ttu-id="9a7ed-293">10</span><span class="sxs-lookup"><span data-stu-id="9a7ed-293">10</span></span>     | <span data-ttu-id="9a7ed-294">idProduct</span><span class="sxs-lookup"><span data-stu-id="9a7ed-294">idProduct</span></span>          | <span data-ttu-id="9a7ed-295">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-295">2</span></span>    | <span data-ttu-id="9a7ed-296">ID</span><span class="sxs-lookup"><span data-stu-id="9a7ed-296">ID</span></span>       | <span data-ttu-id="9a7ed-297">Идентификатор продукта (назначается производителем).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-297">Product ID (assigned by the Manufacturer)</span></span> |
| <span data-ttu-id="9a7ed-298">12</span><span class="sxs-lookup"><span data-stu-id="9a7ed-298">12</span></span>     | <span data-ttu-id="9a7ed-299">bcdDevice</span><span class="sxs-lookup"><span data-stu-id="9a7ed-299">bcdDevice</span></span>          | <span data-ttu-id="9a7ed-300">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-300">2</span></span>    | <span data-ttu-id="9a7ed-301">BCD</span><span class="sxs-lookup"><span data-stu-id="9a7ed-301">BCD</span></span>      | <span data-ttu-id="9a7ed-302">Номер выпуска устройства в двоично-десятичном формате.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-302">Device release number in binary-coded decimal</span></span> |
| <span data-ttu-id="9a7ed-303">14</span><span class="sxs-lookup"><span data-stu-id="9a7ed-303">14</span></span>     | <span data-ttu-id="9a7ed-304">iManufacturer</span><span class="sxs-lookup"><span data-stu-id="9a7ed-304">iManufacturer</span></span>      | <span data-ttu-id="9a7ed-305">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-305">1</span></span>    | <span data-ttu-id="9a7ed-306">Индекс</span><span class="sxs-lookup"><span data-stu-id="9a7ed-306">Index</span></span>    | <span data-ttu-id="9a7ed-307">Индекс дескриптора строки, описывающий производителя.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-307">Index of string descriptor describing manufacturer</span></span> |
| <span data-ttu-id="9a7ed-308">15</span><span class="sxs-lookup"><span data-stu-id="9a7ed-308">15</span></span>     | <span data-ttu-id="9a7ed-309">iProduct</span><span class="sxs-lookup"><span data-stu-id="9a7ed-309">iProduct</span></span>           | <span data-ttu-id="9a7ed-310">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-310">1</span></span>    | <span data-ttu-id="9a7ed-311">Индекс</span><span class="sxs-lookup"><span data-stu-id="9a7ed-311">Index</span></span>    | <span data-ttu-id="9a7ed-312">Индекс дескриптора строки, описывающий продукт.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-312">Index of string descriptor describing product</span></span> |
| <span data-ttu-id="9a7ed-313">16</span><span class="sxs-lookup"><span data-stu-id="9a7ed-313">16</span></span>     | <span data-ttu-id="9a7ed-314">iSerialNumbe</span><span class="sxs-lookup"><span data-stu-id="9a7ed-314">iSerialNumbe</span></span>       | <span data-ttu-id="9a7ed-315">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-315">1</span></span>    | <span data-ttu-id="9a7ed-316">Индекс</span><span class="sxs-lookup"><span data-stu-id="9a7ed-316">Index</span></span>    | <span data-ttu-id="9a7ed-317">Индекс дескриптора строки, описывающий серийный номер устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-317">Index of string descriptor describing the device's serial number</span></span> |
| <span data-ttu-id="9a7ed-318">17</span><span class="sxs-lookup"><span data-stu-id="9a7ed-318">17</span></span>     | <span data-ttu-id="9a7ed-319">bNumConfigurations</span><span class="sxs-lookup"><span data-stu-id="9a7ed-319">bNumConfigurations</span></span> | <span data-ttu-id="9a7ed-320">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-320">1</span></span>    | <span data-ttu-id="9a7ed-321">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-321">Number</span></span>   | <span data-ttu-id="9a7ed-322">Количество возможных конфигураций.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-322">Number of possible configurations</span></span> |

<span data-ttu-id="9a7ed-323">USBX определяет дескриптор USB-устройства следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-323">USBX defines a USB device descriptor as follows:</span></span>

```c
typedef struct UX_DEVICE_DESCRIPTOR_STRUCT
{
    UINT      bLength;
    UINT      bDescriptorType;
    USHORT    bcdUSB;
    UINT      bDeviceClass;
    UINT      bDeviceSubClass;
    UINT      bDeviceProtocol;
    UINT      bMaxPacketSize0;
    USHORT    idVendor;
    USHORT    idProduct;
    USHORT    bcdDevice;
    UINT      iManufacturer;
    UINT      iProduct;
    UINT      iSerialNumber;
    UINT      bNumConfigurations;
} UX_DEVICE_DESCRIPTOR;
```

<span data-ttu-id="9a7ed-324">Дескриптор USB-устройства является частью контейнера устройства, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-324">The USB device descriptor is part of a device container described as:</span></span>

```c
typedef struct UX_DEVICE_STRUCT
{
    ULONG ux_device_handle;
    ULONG ux_device_type;
    ULONG ux_device_state;
    ULONG ux_device_address;
    ULONG ux_device_speed;
    ULONG ux_device_port_location;
    ULONG ux_device_max_power;
    ULONG ux_device_power_source;
    UINT ux_device_current_configuration;

    TX_SEMAPHORE ux_device_protection_semaphore;
    struct UX_DEVICE_STRUCT *ux_device_parent; 
    struct UX_HOST_CLASS_STRUCT *ux_device_class; 
    VOID *ux_device_class_instance;
    struct UX_HCD_STRUCT *ux_device_hcd;
    struct UX_CONFIGURATION_STRUCT *ux_device_first_configuration; 
    struct UX_DEVICE_STRUCT *ux_device_next_device;
    struct UX_DEVICE_DESCRIPTOR_STRUCT ux_device_descriptor;
    struct UX_ENDPOINT_STRUCT ux_device_control_endpoint;
    struct UX_HUB_TT_STRUCT ux_device_hub_tt[UX_MAX_TT];
} UX_DEVICE;
```

- <span data-ttu-id="9a7ed-325">**ux_device_handle**: дескриптор устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-325">**ux_device_handle**: Handle of the device.</span></span> <span data-ttu-id="9a7ed-326">Обычно это адрес экземпляра данной структуры для устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-326">This is typically the address of the instance of this structure for the device.</span></span>
- <span data-ttu-id="9a7ed-327">**ux_device_type**: устаревшее значение.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-327">**ux_device_type**: Obsolete value.</span></span> <span data-ttu-id="9a7ed-328">Не используется.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-328">Unused.</span></span>
- <span data-ttu-id="9a7ed-329">**ux_device_state**: состояние устройства, которое может иметь одно из следующих значений:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-329">**ux_device_state**: Device State, which can have one of the following values:</span></span>
    - <span data-ttu-id="9a7ed-330">**UX_DEVICE_RESET**                0</span><span class="sxs-lookup"><span data-stu-id="9a7ed-330">**UX_DEVICE_RESET**                0</span></span>
    - <span data-ttu-id="9a7ed-331">**UX_DEVICE_ATTACHED**             1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-331">**UX_DEVICE_ATTACHED**             1</span></span>
    - <span data-ttu-id="9a7ed-332">**UX_DEVICE_ADDRESSED**            2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-332">**UX_DEVICE_ADDRESSED**            2</span></span>
    - <span data-ttu-id="9a7ed-333">**UX_DEVICE_CONFIGURED**           3</span><span class="sxs-lookup"><span data-stu-id="9a7ed-333">**UX_DEVICE_CONFIGURED**           3</span></span>
    - <span data-ttu-id="9a7ed-334">**UX_DEVICE_SUSPENDED**            4</span><span class="sxs-lookup"><span data-stu-id="9a7ed-334">**UX_DEVICE_SUSPENDED**            4</span></span>
    - <span data-ttu-id="9a7ed-335">**UX_DEVICE_RESUMED**              5</span><span class="sxs-lookup"><span data-stu-id="9a7ed-335">**UX_DEVICE_RESUMED**              5</span></span>
    - <span data-ttu-id="9a7ed-336">**UX_DEVICE_SELF_POWERED_STATE**   6</span><span class="sxs-lookup"><span data-stu-id="9a7ed-336">**UX_DEVICE_SELF_POWERED_STATE**   6</span></span>
    - <span data-ttu-id="9a7ed-337">**UX_DEVICE_SELF_POWERED_STATE**   7</span><span class="sxs-lookup"><span data-stu-id="9a7ed-337">**UX_DEVICE_SELF_POWERED_STATE**   7</span></span>
    - <span data-ttu-id="9a7ed-338">**UX_DEVICE_REMOTE_WAKEUP**        8</span><span class="sxs-lookup"><span data-stu-id="9a7ed-338">**UX_DEVICE_REMOTE_WAKEUP**        8</span></span>
    - <span data-ttu-id="9a7ed-339">**UX_DEVICE_BUS_RESET_COMPLETED**  9</span><span class="sxs-lookup"><span data-stu-id="9a7ed-339">**UX_DEVICE_BUS_RESET_COMPLETED**  9</span></span>
    - <span data-ttu-id="9a7ed-340">**UX_DEVICE_REMOVED**              10</span><span class="sxs-lookup"><span data-stu-id="9a7ed-340">**UX_DEVICE_REMOVED**              10</span></span>
    - <span data-ttu-id="9a7ed-341">**UX_DEVICE_FORCE_DISCONNECT**     11</span><span class="sxs-lookup"><span data-stu-id="9a7ed-341">**UX_DEVICE_FORCE_DISCONNECT**     11</span></span>
- <span data-ttu-id="9a7ed-342">**ux_device_address**: адрес устройства после того, как принята команда **SET_ADDRESS** (от 1 до 127).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-342">**ux_device_address**: Address of the device after the **SET_ADDRESS** command has been accepted (from 1 to 127).</span></span>
- <span data-ttu-id="9a7ed-343">**ux_device_speed**: скорость устройства:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-343">**ux_device_speed**: Speed of the device:</span></span>
    - <span data-ttu-id="9a7ed-344">**UX_LOW_SPEED_DEVICE**      0</span><span class="sxs-lookup"><span data-stu-id="9a7ed-344">**UX_LOW_SPEED_DEVICE**      0</span></span>
    - <span data-ttu-id="9a7ed-345">**UX_FULL_SPEED_DEVICE**     1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-345">**UX_FULL_SPEED_DEVICE**     1</span></span>
    - <span data-ttu-id="9a7ed-346">**UX_HIGH_SPEED_DEVICE**     2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-346">**UX_HIGH_SPEED_DEVICE**     2</span></span>
- <span data-ttu-id="9a7ed-347">**ux_device_port_location**: индекс порта родительского устройства (корневого концентратора или концентратора).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-347">**ux_device_port_location**: Index of the port of the parent device (root hub or hub).</span></span>
- <span data-ttu-id="9a7ed-348">**ux_device_max_power**: максимальный ток в мА, который может получать устройство в выбранной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-348">**ux_device_max_power**: Maximum power in mA that the device may take in the selected configuration.</span></span>
- <span data-ttu-id="9a7ed-349">**ux_device_power_source**: может иметь одно из двух следующих значений:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-349">**ux_device_power_source**: Can be one of the two following values:</span></span>
    - <span data-ttu-id="9a7ed-350">**UX_DEVICE_BUS_POWERED**     1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-350">**UX_DEVICE_BUS_POWERED**     1</span></span>
    - <span data-ttu-id="9a7ed-351">**UX_DEVICE_SELF_POWERED**    2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-351">**UX_DEVICE_SELF_POWERED**    2</span></span>
- <span data-ttu-id="9a7ed-352">**ux_device_current_configuration**: индекс текущей конфигурации, используемой этим устройством.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-352">**ux_device_current_configuration**: Index of the current configuration being used by this device.</span></span>
- <span data-ttu-id="9a7ed-353">**ux_device_parent**: указатель на контейнер родительского устройства этого устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-353">**ux_device_parent**: Device container pointer of the parent of this device.</span></span> <span data-ttu-id="9a7ed-354">Если указатель равен NULL, то родительским устройством является корневой концентратор контроллера.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-354">If the pointer is null, the parent is the root hub of the controller.</span></span>
- <span data-ttu-id="9a7ed-355">**ux_device_class**: указатель на тип класса, к которому принадлежит устройство.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-355">**ux_device_class**: Pointer to the class type that owns this device.</span></span>
- <span data-ttu-id="9a7ed-356">**ux_device_class_instance**: указатель на экземпляр класса, к которому принадлежит это устройство.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-356">**ux_device_class_instance**: Pointer to the instance of the class that owns this device.</span></span>
- <span data-ttu-id="9a7ed-357">**ux_device_hcd**: экземпляр хост-контроллера USB, к которому подключено это устройство.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-357">**ux_device_hcd**: USB Host Controller Instance where this device is attached.</span></span>
- <span data-ttu-id="9a7ed-358">**ux_device_first_configuration**: указатель на первый контейнер конфигурации для этого устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-358">**ux_device_first_configuration**: Pointer to the first configuration container for this device.</span></span>
- <span data-ttu-id="9a7ed-359">**ux_device_next_device**: указатель на следующее устройство в списке устройств на любой из шин, обнаруженных USBX.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-359">**ux_device_next_device**: Pointer to the next device in the list of device on any of the buses detected by USBX.</span></span>
- <span data-ttu-id="9a7ed-360">**ux_device_descriptor**: дескриптор USB-устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-360">**ux_device_descriptor**: USB device descriptor.</span></span>
- <span data-ttu-id="9a7ed-361">**ux_device_control_endpoint**: дескриптор конечной точки управления по умолчанию, используемой этим устройством.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-361">**ux_device_control_endpoint**: Descriptor of the default control endpoint used by this device.</span></span>
- <span data-ttu-id="9a7ed-362">**ux_device_hub_tt**: массив трансляторов транзакций (ТТ) для устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-362">**ux_device_hub_tt**: Array of Hub TTs for the device</span></span>

### <a name="configuration-descriptors"></a><span data-ttu-id="9a7ed-363">Дескрипторы конфигурации</span><span class="sxs-lookup"><span data-stu-id="9a7ed-363">Configuration Descriptors</span></span>

<span data-ttu-id="9a7ed-364">Дескриптор конфигурации содержит сведения о конкретной конфигурации устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-364">The configuration descriptor describes information about a specific device configuration.</span></span> <span data-ttu-id="9a7ed-365">USB-устройство может содержать один или несколько дескрипторов конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-365">A USB device may contain one or more configuration descriptors.</span></span> <span data-ttu-id="9a7ed-366">Поле **bNumConfigurations** в дескрипторе устройства указывает число дескрипторов конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-366">The **bNumConfigurations** field in the device descriptor indicates the number of configuration descriptors.</span></span> <span data-ttu-id="9a7ed-367">Дескриптор содержит поле **bConfigurationValue** со значением, которое при использовании в качестве параметра для запроса Set Configuration указывает устройству принять описанную конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-367">The descriptor contains a **bConfigurationValue** field with a value that, when used as a parameter to the Set Configuration request, causes the device to assume the described configuration.</span></span>

<span data-ttu-id="9a7ed-368">Дескриптор описывает количество интерфейсов, предоставляемых конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-368">The descriptor describes the number of interfaces provided by the configuration.</span></span> <span data-ttu-id="9a7ed-369">Каждый интерфейс представляет логическую функцию в устройстве и может работать независимо.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-369">Each interface represents a logical function within the device and may operate independently.</span></span> <span data-ttu-id="9a7ed-370">Например, динамик USB может иметь три интерфейса: интерфейс для потоковой передачи, интерфейс для управления звуком и HID-интерфейс для управления кнопками динамика.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-370">For instance a USB audio speaker may have three interfaces, one for audio streaming, one for audio control, and one HID interface to manage the speaker's buttons.</span></span>

<span data-ttu-id="9a7ed-371">Когда узел выдает запрос GET_DESCRIPTOR для дескриптора конфигурации, возвращаются все соответствующие дескрипторы интерфейса и конечной точки.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-371">When the host issues a GET_DESCRIPTOR request for the configuration descriptor, all related interface and endpoint descriptors are returned.</span></span>

| <span data-ttu-id="9a7ed-372">Offset</span><span class="sxs-lookup"><span data-stu-id="9a7ed-372">Offset</span></span> | <span data-ttu-id="9a7ed-373">Поле</span><span class="sxs-lookup"><span data-stu-id="9a7ed-373">Field</span></span>               | <span data-ttu-id="9a7ed-374">Size</span><span class="sxs-lookup"><span data-stu-id="9a7ed-374">Size</span></span> | <span data-ttu-id="9a7ed-375">Значение</span><span class="sxs-lookup"><span data-stu-id="9a7ed-375">Value</span></span>    | <span data-ttu-id="9a7ed-376">Описание</span><span class="sxs-lookup"><span data-stu-id="9a7ed-376">Description</span></span>                       |
| ------ | ------------------- | ---- | -------- | --------------------------------- |
| <span data-ttu-id="9a7ed-377">0</span><span class="sxs-lookup"><span data-stu-id="9a7ed-377">0</span></span>      | <span data-ttu-id="9a7ed-378">bLength</span><span class="sxs-lookup"><span data-stu-id="9a7ed-378">bLength</span></span>             | <span data-ttu-id="9a7ed-379">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-379">1</span></span>    | <span data-ttu-id="9a7ed-380">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-380">Number</span></span>   | <span data-ttu-id="9a7ed-381">Размер дескриптора в байтах.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-381">Size of this descriptor in bytes.</span></span> |
| <span data-ttu-id="9a7ed-382">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-382">1</span></span>      | <span data-ttu-id="9a7ed-383">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="9a7ed-383">bDescriptorType</span></span>     | <span data-ttu-id="9a7ed-384">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-384">1</span></span>    | <span data-ttu-id="9a7ed-385">Константа</span><span class="sxs-lookup"><span data-stu-id="9a7ed-385">Constant</span></span> | <span data-ttu-id="9a7ed-386">CONFIGURATION</span><span class="sxs-lookup"><span data-stu-id="9a7ed-386">CONFIGURATION</span></span>                     |
| <span data-ttu-id="9a7ed-387">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-387">2</span></span>      | <span data-ttu-id="9a7ed-388">wTotalLength</span><span class="sxs-lookup"><span data-stu-id="9a7ed-388">wTotalLength</span></span>        | <span data-ttu-id="9a7ed-389">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-389">2</span></span>    | <span data-ttu-id="9a7ed-390">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-390">Number</span></span>   | <span data-ttu-id="9a7ed-391">Общая длина данных, возвращаемых для этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-391">Total length of data returned for this configuration.</span></span> <span data-ttu-id="9a7ed-392">Включает в себя совокупную длину всех дескрипторов (конфигурации, интерфейса, конечной точки, а также дескрипторов, относящихся к классу или поставщику), возвращаемых для этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-392">Includes the combined length of all descriptors (configuration, interface, endpoint, and class or vendor specific) returned for this configuration.</span></span> |
| <span data-ttu-id="9a7ed-393">4</span><span class="sxs-lookup"><span data-stu-id="9a7ed-393">4</span></span>      | <span data-ttu-id="9a7ed-394">bNumInterfaces</span><span class="sxs-lookup"><span data-stu-id="9a7ed-394">bNumInterfaces</span></span>      | <span data-ttu-id="9a7ed-395">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-395">1</span></span>    | <span data-ttu-id="9a7ed-396">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-396">Number</span></span>   | <span data-ttu-id="9a7ed-397">Число интерфейсов, поддерживаемых этой конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-397">Number of interfaces supported by this configuration.</span></span> |
| <span data-ttu-id="9a7ed-398">5</span><span class="sxs-lookup"><span data-stu-id="9a7ed-398">5</span></span>      | <span data-ttu-id="9a7ed-399">bConfigurationValue</span><span class="sxs-lookup"><span data-stu-id="9a7ed-399">bConfigurationValue</span></span> | <span data-ttu-id="9a7ed-400">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-400">1</span></span>    | <span data-ttu-id="9a7ed-401">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-401">Number</span></span>   | <span data-ttu-id="9a7ed-402">Значение, используемое в качестве аргумента для запроса SET</span><span class="sxs-lookup"><span data-stu-id="9a7ed-402">Value to use as an argument to Set</span></span><br/><span data-ttu-id="9a7ed-403">Configuration для выбора этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-403">Configuration to select this configuration.</span></span> |
| <span data-ttu-id="9a7ed-404">6</span><span class="sxs-lookup"><span data-stu-id="9a7ed-404">6</span></span>      | <span data-ttu-id="9a7ed-405">iConfiguration</span><span class="sxs-lookup"><span data-stu-id="9a7ed-405">iConfiguration</span></span>      | <span data-ttu-id="9a7ed-406">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-406">1</span></span>    | <span data-ttu-id="9a7ed-407">Индекс</span><span class="sxs-lookup"><span data-stu-id="9a7ed-407">Index</span></span>    | <span data-ttu-id="9a7ed-408">Индекс дескриптора строки, описывающий эту конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-408">Index of string descriptor describing this configuration.</span></span> |
| <span data-ttu-id="9a7ed-409">7</span><span class="sxs-lookup"><span data-stu-id="9a7ed-409">7</span></span>      | <span data-ttu-id="9a7ed-410">bMAttributes</span><span class="sxs-lookup"><span data-stu-id="9a7ed-410">bMAttributes</span></span>        | <span data-ttu-id="9a7ed-411">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-411">1</span></span>    | <span data-ttu-id="9a7ed-412">Bitmap</span><span class="sxs-lookup"><span data-stu-id="9a7ed-412">Bitmap</span></span>   | <span data-ttu-id="9a7ed-413">Характеристики конфигурации: D7 — питание от шины;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-413">Configuration characteristics D7 Bus Powered</span></span><br /><span data-ttu-id="9a7ed-414">D6 — с собственным питанием;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-414">D6 Self Powered</span></span><br /><span data-ttu-id="9a7ed-415">D5 — удаленное пробуждение;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-415">D5 Remote Wakeup</span></span><br /><span data-ttu-id="9a7ed-416">D4…0 — зарезервированы (сброшены в 0).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-416">D4..0 Reserved (reset to 0)</span></span><br /><span data-ttu-id="9a7ed-417">В конфигурации устройства, которая использует питание от шины и локальный источник питания, задается и параметр D7, и параметр D6.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-417">A device configuration that uses power from the bus and a local source sets both D7 and D6.</span></span> <span data-ttu-id="9a7ed-418">Фактический источник питания во время выполнения можно определить с помощью запроса устройства GET STATUS.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-418">The actual power source at runtime may be determined using the Get Status device request.</span></span><br /><span data-ttu-id="9a7ed-419">Если конфигурация устройства поддерживает удаленное пробуждение, то параметр D5 имеет значение 1.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-419">If a device configuration supports remote wakeup, D5 is set to 1.</span></span> |
| <span data-ttu-id="9a7ed-420">8</span><span class="sxs-lookup"><span data-stu-id="9a7ed-420">8</span></span>      | <span data-ttu-id="9a7ed-421">MaxPower</span><span class="sxs-lookup"><span data-stu-id="9a7ed-421">MaxPower</span></span>            | <span data-ttu-id="9a7ed-422">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-422">1</span></span>    | <span data-ttu-id="9a7ed-423">мА</span><span class="sxs-lookup"><span data-stu-id="9a7ed-423">mA</span></span>       | <span data-ttu-id="9a7ed-424">Максимальный ток потребления USB-устройства от шины в данной конфигурации, если устройство полностью работоспособно.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-424">Maximum power consumption of USB device from the bus in this specific configuration when the device is fully operational.</span></span><br /><span data-ttu-id="9a7ed-425">Указывается в единицах по 2 мА (например, 50 = 100 мА).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-425">Expressed in 2 mA units (e.g., 50 = 100 mA).</span></span><br /><span data-ttu-id="9a7ed-426">Примечание. В конфигурации устройства указывается тип питания: от шины или собственное.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-426">Note: A device configuration reports whether the configuration is bus-powered or self-powered.</span></span><br /><span data-ttu-id="9a7ed-427">Состояние устройства указывает, использует ли устройство собственное питание в данный момент.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-427">Device status reports whether the device is currently self-powered.</span></span> <span data-ttu-id="9a7ed-428">Если устройство отключается от внешнего источника питания, оно обновляет свое состояние, чтобы указать, что оно больше не использует собственное питание.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-428">If a device is disconnected from its external power source, it updates device status to indicate that it is no longer self-powered.</span></span> |

<span data-ttu-id="9a7ed-429">USBX определяет дескриптор конфигурации USB следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-429">USBX defines a USB configuration descriptor as follows.</span></span>

```c
typedef struct UX_CONFIGURATION_DESCRIPTOR_STRUCT
{
    UINT bLength;
    UINT bDescriptorType;
    USHORT wTotalLength;
    UINT bNumInterfaces;
    UINT bConfigurationValue;
    UINT iConfiguration;
    UINT bmAttributes;
    UINT MaxPower;
} UX_CONFIGURATION_DESCRIPTOR;
```

<span data-ttu-id="9a7ed-430">Дескриптор конфигурации USB является частью контейнера конфигурации, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-430">The USB configuration descriptor is part of a configuration container described as shown below.</span></span>

```c
typedef struct UX_CONFIGURATION_STRUCT
{
    ULONG ux_configuration_handle;
    ULONG ux_configuration_state;
    struct UX_CONFIGURATION_DESCRIPTOR_STRUCT ux_configuration_descriptor;
    struct UX_INTERFACE_STRUCT *ux_configuration_first_interface;
    struct UX_CONFIGURATION_STRUCT *ux_configuration_next_configuration;
    struct UX_DEVICE_STRUCT *ux_configuration_device;
} UX_CONFIGURATION;
```

- <span data-ttu-id="9a7ed-431">**ux_configuration_handle**: дескриптор конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-431">**ux_configuration_handle**: Handle of the configuration.</span></span> <span data-ttu-id="9a7ed-432">Обычно это адрес экземпляра данной структуры для конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-432">This is typically the address of the instance of this structure for the configuration.</span></span>
- <span data-ttu-id="9a7ed-433">**ux_configuration_state**: состояние конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-433">**ux_configuration_state**: State of the configuration.</span></span>
- <span data-ttu-id="9a7ed-434">**ux_configuration_descriptor**: дескриптор USB-устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-434">**ux_configuration_descriptor**: USB device descriptor.</span></span>
- <span data-ttu-id="9a7ed-435">**ux_configuration_first_interface**: указатель на первый интерфейс для этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-435">**ux_configuration_first_interface**: Pointer to the first interface for this configuration.</span></span>
- <span data-ttu-id="9a7ed-436">**ux_configuration_next_configuration**: указатель на следующую конфигурацию для того же устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-436">**ux_configuration_next_configuration**: Pointer to the next configuration for the same device.</span></span>
- <span data-ttu-id="9a7ed-437">**ux_configuration_device**: указатель на владельца устройства этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-437">**ux_configuration_device**: Pointer to the device owner of this configuration.</span></span>

### <a name="interface-descriptors"></a><span data-ttu-id="9a7ed-438">Дескрипторы интерфейса</span><span class="sxs-lookup"><span data-stu-id="9a7ed-438">Interface Descriptors</span></span>

<span data-ttu-id="9a7ed-439">Дескриптор интерфейса описывает конкретный интерфейс в конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-439">The interface descriptor describes a specific interface within a configuration.</span></span> <span data-ttu-id="9a7ed-440">Интерфейс — это логическая функция в USB-устройстве.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-440">An interface is a logical function within a USB device.</span></span> <span data-ttu-id="9a7ed-441">Конфигурация предоставляет один или несколько интерфейсов, каждый из которых содержит ноль или более дескрипторов конечных точек, описывающих уникальный набор конечных точек в конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-441">A configuration provides one or more interfaces, each with zero or more endpoint descriptors describing a unique set of endpoints within the configuration.</span></span> <span data-ttu-id="9a7ed-442">Если конфигурация поддерживает более одного интерфейса, то дескрипторы конечных точек для определенного интерфейса соответствуют дескриптору интерфейса в данных, возвращенных запросом **GET_DESCRIPTOR** для указанной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-442">When a configuration supports more than one interface, the endpoint descriptors for a particular interface follow the interface descriptor in the data returned by the **GET_DESCRIPTOR** request for the specified configuration.</span></span>

<span data-ttu-id="9a7ed-443">Дескриптор интерфейса всегда возвращается как часть дескриптора конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-443">An interface descriptor is always returned as part of a configuration descriptor.</span></span> <span data-ttu-id="9a7ed-444">Дескриптор интерфейса невозможно получить напрямую с помощью запроса GET_DESCRIPTOR.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-444">An interface descriptor cannot be directly access by a GET_DESCRIPTOR request.</span></span>

<span data-ttu-id="9a7ed-445">Интерфейс может включать в себя альтернативные параметры, позволяющие изменить конечные точки и (или) их характеристики после настройки устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-445">An interface may include alternate settings that allow the endpoints and/or their characteristics to be varied after the device has been configured.</span></span> <span data-ttu-id="9a7ed-446">Параметр по умолчанию для интерфейса всегда является альтернативным параметром 0.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-446">The default setting for an interface is always alternate setting zero.</span></span> <span data-ttu-id="9a7ed-447">Класс может изменить текущий альтернативный параметр, чтобы изменить поведение интерфейса и характеристики связанных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-447">A class can select to change the current alternate setting to change the interface behavior and the characteristics of the associated endpoints.</span></span> <span data-ttu-id="9a7ed-448">Запрос SET_INTERFACE используется для выбора альтернативного параметра или возвращения к параметру по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-448">The SET_INTERFACE request is used to select an alternate setting or to return to the default setting.</span></span>

<span data-ttu-id="9a7ed-449">Альтернативные параметры позволяют изменить часть конфигурации устройства, не влияя на работу других интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-449">Alternate settings allow a portion of the device configuration to be varied while other interfaces remain in operation.</span></span> <span data-ttu-id="9a7ed-450">Если в конфигурации есть альтернативные параметры для одного или нескольких интерфейсов, то для каждого параметра добавляется отдельный дескриптор интерфейса и связанные с ним конечные точки.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-450">If a configuration has alternate settings for one or more of its interfaces, a separate interface descriptor and its associated endpoints are included for each setting.</span></span>

<span data-ttu-id="9a7ed-451">Если конфигурация устройства содержит один интерфейс с двумя альтернативными параметрами, то запрос GET_DESCRIPTOR для конфигурации вернет дескриптор конфигурации, затем дескриптор интерфейса с полями **bInterfaceNumber** и **bAlternateSetting**, для которых задано значение 0, а потом — дескрипторы конечных точек для этого параметра, за которым последует еще один дескриптор интерфейса и связанные с ним дескрипторы конечных точек.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-451">If a device configuration contains a single interface with two alternate settings, the GET_DESCRIPTOR request for the configuration would return the configuration descriptor, then the interface descriptor with the **bInterfaceNumber** and **bAlternateSetting** fields set to zero and then the endpoint descriptors for that setting, followed by another interface descriptor and its associated endpoint descriptors.</span></span> <span data-ttu-id="9a7ed-452">Второе поле дескриптора **bInterfaceNumber** также будет иметь значение 0, но поле **bAlternateSetting** второго дескриптора интерфейса будет иметь значение 1, указывающее, что этот альтернативный параметр относится к первому интерфейсу.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-452">The second interface descriptor's **bInterfaceNumber** field would also be set to zero, but the **bAlternateSetting** field of the second interface descriptor would be set to 1 indicating that this alternate setting belongs to the first interface.</span></span>

<span data-ttu-id="9a7ed-453">У интерфейса могут отсутствовать связанные конечные точки. В этом случае для него допустима только конечная точка управления по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-453">An interface may not have any endpoints associated with it, in which case only the default control endpoint is valid for that interface.</span></span>

<span data-ttu-id="9a7ed-454">Альтернативные параметры используются главным образом для изменения запрошенной пропускной способности для периодических конечных точек, связанных с интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-454">Alternate settings are used mainly to change the requested bandwidth for periodic endpoints associated with the interface.</span></span> <span data-ttu-id="9a7ed-455">Например, интерфейс потокового динамика USB должен содержать первый альтернативный параметр с требованием пропускной способности "0" для своей изохронной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-455">For example, a USB speaker streaming interface should have the first alternate setting with a 0 bandwidth demand on its isochronous endpoint.</span></span> <span data-ttu-id="9a7ed-456">Другие альтернативные параметры могут задавать другие требования к пропускной способности в зависимости от частоты потоковой передачи звука.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-456">Other alternate settings may select different bandwidth requirements depending on the audio streaming frequency.</span></span>

<span data-ttu-id="9a7ed-457">Дескриптор USB для интерфейса выглядит следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-457">The USB descriptor for the interface is as follows:</span></span>

| <span data-ttu-id="9a7ed-458">Offset</span><span class="sxs-lookup"><span data-stu-id="9a7ed-458">Offset</span></span> | <span data-ttu-id="9a7ed-459">Поле</span><span class="sxs-lookup"><span data-stu-id="9a7ed-459">Field</span></span>              | <span data-ttu-id="9a7ed-460">Size</span><span class="sxs-lookup"><span data-stu-id="9a7ed-460">Size</span></span> | <span data-ttu-id="9a7ed-461">Значение</span><span class="sxs-lookup"><span data-stu-id="9a7ed-461">Value</span></span>     | <span data-ttu-id="9a7ed-462">Дескриптор</span><span class="sxs-lookup"><span data-stu-id="9a7ed-462">Descriptor</span></span>                              |
| ------ | ------------------ | ---- | --------- | --------------------------------------- |
| <span data-ttu-id="9a7ed-463">0</span><span class="sxs-lookup"><span data-stu-id="9a7ed-463">0</span></span>      | <span data-ttu-id="9a7ed-464">bLength</span><span class="sxs-lookup"><span data-stu-id="9a7ed-464">bLength</span></span>            | <span data-ttu-id="9a7ed-465">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-465">1</span></span>    | <span data-ttu-id="9a7ed-466">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-466">Number</span></span>    | <span data-ttu-id="9a7ed-467">Размер дескриптора в байтах.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-467">Size of this descriptor in bytes.</span></span>       |
| <span data-ttu-id="9a7ed-468">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-468">1</span></span>      | <span data-ttu-id="9a7ed-469">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="9a7ed-469">bDescriptorType</span></span>    | <span data-ttu-id="9a7ed-470">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-470">1</span></span>    | <span data-ttu-id="9a7ed-471">Константа</span><span class="sxs-lookup"><span data-stu-id="9a7ed-471">Constant</span></span>  | <span data-ttu-id="9a7ed-472">Тип дескриптора INTERFACE.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-472">INTERFACE Descriptor Type</span></span>               |
| <span data-ttu-id="9a7ed-473">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-473">2</span></span>      | <span data-ttu-id="9a7ed-474">bInterfaceNumber</span><span class="sxs-lookup"><span data-stu-id="9a7ed-474">bInterfaceNumber</span></span>   | <span data-ttu-id="9a7ed-475">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-475">1</span></span>    | <span data-ttu-id="9a7ed-476">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-476">Number</span></span>    | <span data-ttu-id="9a7ed-477">Число интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-477">Number of interface.</span></span> <span data-ttu-id="9a7ed-478">Отсчитываемое от нуля значение, определяющее индекс в массиве параллельных интерфейсов, поддерживаемых данной конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-478">Zero-based value identifying the index in the array of concurrent interfaces supported by this configuration.</span></span> |
| <span data-ttu-id="9a7ed-479">3</span><span class="sxs-lookup"><span data-stu-id="9a7ed-479">3</span></span>      | <span data-ttu-id="9a7ed-480">bAltenateSetting</span><span class="sxs-lookup"><span data-stu-id="9a7ed-480">bAltenateSetting</span></span>   | <span data-ttu-id="9a7ed-481">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-481">1</span></span>    | <span data-ttu-id="9a7ed-482">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-482">Number</span></span>    | <span data-ttu-id="9a7ed-483">Значение, используемое для выбора альтернативного параметра для интерфейса, указанного в предыдущем поле.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-483">Value used to select alternate setting for the interface identified in the prior field.</span></span> |
| <span data-ttu-id="9a7ed-484">4</span><span class="sxs-lookup"><span data-stu-id="9a7ed-484">4</span></span>      | <span data-ttu-id="9a7ed-485">bNumEndpoints</span><span class="sxs-lookup"><span data-stu-id="9a7ed-485">bNumEndpoints</span></span>      | <span data-ttu-id="9a7ed-486">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-486">1</span></span>    | <span data-ttu-id="9a7ed-487">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-487">Number</span></span>    | <span data-ttu-id="9a7ed-488">Число конечных точек, используемых этим интерфейсом (за исключением конечной точки 0).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-488">Number of endpoints used by this interface (excluding endpoint zero).</span></span> <span data-ttu-id="9a7ed-489">Если это значение равно 0, то данный интерфейс использует только конечную точку 0.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-489">If this value is 0, this interface only uses endpoint zero.</span></span> |
| <span data-ttu-id="9a7ed-490">5</span><span class="sxs-lookup"><span data-stu-id="9a7ed-490">5</span></span>      | <span data-ttu-id="9a7ed-491">bInterfaceClass</span><span class="sxs-lookup"><span data-stu-id="9a7ed-491">bInterfaceClass</span></span>    | <span data-ttu-id="9a7ed-492">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-492">1</span></span>    | <span data-ttu-id="9a7ed-493">Класс</span><span class="sxs-lookup"><span data-stu-id="9a7ed-493">Class</span></span>     | <span data-ttu-id="9a7ed-494">Код класса (назначается USB).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-494">Class code (assigned by USB)</span></span><br /><span data-ttu-id="9a7ed-495">Если это поле сбрасывается в 0, то интерфейс не принадлежит ни к одному из классов устройств, описанных USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-495">If this field is reset to 0, the interface does not belong to any USB specified device class.</span></span><br /><span data-ttu-id="9a7ed-496">Если для этого поля задано значение 0xFF, то класс устройства зависит от поставщика.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-496">If this field is set to 0xFF, the interface class is vendor specific.</span></span><br /><span data-ttu-id="9a7ed-497">Все остальные значения зарезервированы для назначения USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-497">All other values are reserved for assignment by USB.</span></span> |
| <span data-ttu-id="9a7ed-498">6</span><span class="sxs-lookup"><span data-stu-id="9a7ed-498">6</span></span>      | <span data-ttu-id="9a7ed-499">bInterfaceSubClass</span><span class="sxs-lookup"><span data-stu-id="9a7ed-499">bInterfaceSubClass</span></span> | <span data-ttu-id="9a7ed-500">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-500">1</span></span>    | <span data-ttu-id="9a7ed-501">SubClass</span><span class="sxs-lookup"><span data-stu-id="9a7ed-501">SubClass</span></span>  | <span data-ttu-id="9a7ed-502">Код подкласса (назначается USB).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-502">Subclass code (assigned by USB).</span></span><br /><span data-ttu-id="9a7ed-503">Эти коды определяются значением поля bInterfaceClass.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-503">These codes are qualified by the value of the bInterfaceClass field.</span></span> <span data-ttu-id="9a7ed-504">Если поле bInterfaceClass сброшено в 0, то это поле также должно быть сброшено в 0.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-504">If the bInterfaceClass field is reset to 0, this field must also be reset to 0.</span></span> <span data-ttu-id="9a7ed-505">Если для поля bInterfaceClass не задано значение 0xFF, то все значения зарезервированы для назначения USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-505">If the bInterfaceClass field is not set to 0xFF, all values are reserved for assignment by USB.</span></span> |
| <span data-ttu-id="9a7ed-506">7</span><span class="sxs-lookup"><span data-stu-id="9a7ed-506">7</span></span>      | <span data-ttu-id="9a7ed-507">bInterfaceProtocol</span><span class="sxs-lookup"><span data-stu-id="9a7ed-507">bInterfaceProtocol</span></span> | <span data-ttu-id="9a7ed-508">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-508">1</span></span>    | <span data-ttu-id="9a7ed-509">Протокол</span><span class="sxs-lookup"><span data-stu-id="9a7ed-509">Protocol</span></span>  | <span data-ttu-id="9a7ed-510">Код протокола (назначается USB).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-510">Protocol code (assigned by USB).</span></span> <span data-ttu-id="9a7ed-511">Эти коды определяются значениями полей bInterfaceClass и bInterfaceSubClass.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-511">These codes are qualified by the value of the bInterfaceClass and the bInterfaceSubClass fields.</span></span> <span data-ttu-id="9a7ed-512">Если интерфейс поддерживает зависящие от класса запросы, то этот код определяет протоколы, используемые устройством, как определено спецификацией класса устройств.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-512">If an interface supports class-specific requests, this code identifies the protocols that the device uses as defined by the specification of the device class.</span></span><br /><span data-ttu-id="9a7ed-513">Если это поле сброшено в 0, то устройство не использует зависящие от класса протоколы для этого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-513">If this field is reset to 0, the device does not use a class specific protocol on this interface.</span></span> <span data-ttu-id="9a7ed-514">Если для этого поля задано значение 0xFF, то устройство использует зависящий от поставщика протокол для этого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-514">If this field is set to 0xFF, the device uses a vendor specific protocol for this interface.</span></span> |
| <span data-ttu-id="9a7ed-515">8</span><span class="sxs-lookup"><span data-stu-id="9a7ed-515">8</span></span>      | <span data-ttu-id="9a7ed-516">iInterface</span><span class="sxs-lookup"><span data-stu-id="9a7ed-516">iInterface</span></span>         | <span data-ttu-id="9a7ed-517">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-517">1</span></span>    | <span data-ttu-id="9a7ed-518">Индекс</span><span class="sxs-lookup"><span data-stu-id="9a7ed-518">Index</span></span>     | <span data-ttu-id="9a7ed-519">Индекс дескриптора строки, описывающий этот интерфейс.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-519">Index of string descriptor describing this interface.</span></span> |

<span data-ttu-id="9a7ed-520">USBX определяет дескриптор интерфейса USB следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-520">USBX defines a USB interface descriptor as follows.</span></span>

```c
typedef struct UX_INTERFACE_DESCRIPTOR_STRUCT
{
    UINT bLength;
    UINT bDescriptorType;
    UINT bInterfaceNumber;
    UINT bAlternateSetting;
    UINT bNumEndpoints;
    UINT bInterfaceClass
    UINT bInterfaceSubClass;
    UINT bInterfaceProtocol;
    UINT iInterface;
} UX_INTERFACE_DESCRIPTOR;
```

<span data-ttu-id="9a7ed-521">Дескриптор интерфейса USB является частью контейнера интерфейса, описанного ниже.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-521">The USB interface descriptor is part of an interface container described as follows.</span></span>

```c
typedef struct UX_INTERFACE_STRUCT
{
    ULONG ux_interface_handle;
    ULONG ux_interface_state;
    ULONG ux_interface_current_alternate_setting;
    struct UX_INTERFACE_DESCRIPTOR_STRUCT ux_interface_descriptor;
    struct UX_HOST_CLASS_STRUCT    *ux_interface_class;
    VOID    *ux_interface_class_instance;
    struct UX_ENDPOINT_STRUCT    *ux_interface_first_endpoint;
    struct UX_INTERFACE_STRUCT    *ux_interface_next_interface;
    struct UX_CONFIGURATION_STRUCT    *ux_interface_configuration;
} UX_INTERFACE;
```

- <span data-ttu-id="9a7ed-522">**ux_interface_handle**: дескриптор интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-522">**ux_interface_handle**: Handle of the interface.</span></span> <span data-ttu-id="9a7ed-523">Обычно это адрес экземпляра данной структуры для интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-523">This is typically the address of the instance of this structure for the interface.</span></span>
- <span data-ttu-id="9a7ed-524">**ux_interface_state**: состояние интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-524">**ux_interface_state**: State of the interface.</span></span>
- <span data-ttu-id="9a7ed-525">**ux_interface_descriptor**: дескриптор интерфейса USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-525">**ux_interface_descriptor**: USB interface descriptor.</span></span>
- <span data-ttu-id="9a7ed-526">**ux_interface_class**: указатель на тип класса, к которому принадлежит этот интерфейс.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-526">**ux_interface_class**: Pointer to the class type that owns this interface.</span></span>
- <span data-ttu-id="9a7ed-527">**ux_device_class_instance**: указатель на экземпляр класса, к которому принадлежит этот интерфейс.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-527">**ux_interface_class_instance**: Pointer to the instance of the class that owns this interface.</span></span>
- <span data-ttu-id="9a7ed-528">**ux_interface_first_endpoint**: указатель на первую конечную точку, зарегистрированную с помощью этого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-528">**ux_interface_first_endpoint**: Pointer to the first endpoint registered with this interface.</span></span>
- <span data-ttu-id="9a7ed-529">**ux_interface_next_interface**: указатель на следующий интерфейс, связанный с конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-529">**ux_interface_next_interface**: Pointer to the next interface associated with the configuration.</span></span>
- <span data-ttu-id="9a7ed-530">**ux_interface_configuration**: указатель на владельца конфигурации этого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-530">**ux_interface_configuration**: Pointer to the configuration owner of this interface.</span></span>

### <a name="endpoint-descriptors"></a><span data-ttu-id="9a7ed-531">Дескрипторы конечных точек</span><span class="sxs-lookup"><span data-stu-id="9a7ed-531">Endpoint Descriptors</span></span>

<span data-ttu-id="9a7ed-532">Каждая конечная точка, связанная с интерфейсом, имеет собственный дескриптор конечной точки.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-532">Each endpoint associated with an interface has its own endpoint descriptor.</span></span> <span data-ttu-id="9a7ed-533">Этот дескриптор содержит сведения, необходимые стеку узлов, чтобы определить требования к пропускной способности каждой конечной точки, максимальный объем полезных данных, связанных с конечной точкой, ее периодичность и направление передачи данных.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-533">This descriptor contains the information required by the host stack to determine the bandwidth requirements of each endpoint, the maximum payload associated with the endpoint, its periodicity, and its direction.</span></span> <span data-ttu-id="9a7ed-534">Дескриптор конечной точки всегда возвращается командой GET_DESCRIPTOR для конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-534">An endpoint descriptor is always returned by a GET_DESCRIPTOR command for the configuration.</span></span>

<span data-ttu-id="9a7ed-535">Конечная точка управления по умолчанию, связанная с дескриптором устройства, не считается конечной точкой, связанной с интерфейсом, и поэтому не возвращается в этом дескрипторе.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-535">The default control endpoint associated with the device descriptor is not counted as part of the endpoint(s) associated with the interface and therefore not returned in this descriptor.</span></span>

<span data-ttu-id="9a7ed-536">Когда программное обеспечение узла запрашивает изменение альтернативного параметра для интерфейса, все связанные конечные точки и их ресурсы USB изменяются в соответствии с новым альтернативным параметром.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-536">When the host software requests a change of the alternate setting for an interface, all the associated endpoints and their USB resources are modified according to the new alternate setting.</span></span>

<span data-ttu-id="9a7ed-537">За исключением конечных точек управления по умолчанию, конечные точки не могут совместно использоваться интерфейсами.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-537">Except for the default control endpoints, endpoints cannot be share between interfaces.</span></span>

| <span data-ttu-id="9a7ed-538">Offset</span><span class="sxs-lookup"><span data-stu-id="9a7ed-538">Offset</span></span> | <span data-ttu-id="9a7ed-539">Поле</span><span class="sxs-lookup"><span data-stu-id="9a7ed-539">Field</span></span>            | <span data-ttu-id="9a7ed-540">Size</span><span class="sxs-lookup"><span data-stu-id="9a7ed-540">Size</span></span> | <span data-ttu-id="9a7ed-541">Значение</span><span class="sxs-lookup"><span data-stu-id="9a7ed-541">Value</span></span>    | <span data-ttu-id="9a7ed-542">Описание</span><span class="sxs-lookup"><span data-stu-id="9a7ed-542">Description</span></span>                       |
| ------ | ---------------- | ---- | -------- | --------------------------------- |
| <span data-ttu-id="9a7ed-543">0</span><span class="sxs-lookup"><span data-stu-id="9a7ed-543">0</span></span>      | <span data-ttu-id="9a7ed-544">bLength</span><span class="sxs-lookup"><span data-stu-id="9a7ed-544">bLength</span></span>          | <span data-ttu-id="9a7ed-545">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-545">1</span></span>    | <span data-ttu-id="9a7ed-546">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-546">Number</span></span>   | <span data-ttu-id="9a7ed-547">Размер дескриптора в байтах.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-547">Size of this descriptor in bytes.</span></span> |
| <span data-ttu-id="9a7ed-548">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-548">1</span></span>      | <span data-ttu-id="9a7ed-549">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="9a7ed-549">bDescriptorType</span></span>  | <span data-ttu-id="9a7ed-550">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-550">1</span></span>    | <span data-ttu-id="9a7ed-551">Константа</span><span class="sxs-lookup"><span data-stu-id="9a7ed-551">Constant</span></span> | <span data-ttu-id="9a7ed-552">Тип дескриптора ENDPOINT.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-552">ENDPOINT Descriptor Type.</span></span> |
| <span data-ttu-id="9a7ed-553">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-553">2</span></span>      | <span data-ttu-id="9a7ed-554">bEndpointAddress</span><span class="sxs-lookup"><span data-stu-id="9a7ed-554">bEndpointAddress</span></span> | <span data-ttu-id="9a7ed-555">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-555">1</span></span>    | <span data-ttu-id="9a7ed-556">Конечная точка</span><span class="sxs-lookup"><span data-stu-id="9a7ed-556">Endpoint</span></span> | <span data-ttu-id="9a7ed-557">Адрес конечной точки на USB-устройстве, описываемом этим дескриптором.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-557">The address of the endpoint on the USB device described by this descriptor.</span></span> <span data-ttu-id="9a7ed-558">Адрес кодируется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-558">The address is encoded as follows:</span></span><br /><span data-ttu-id="9a7ed-559">биты 3…0: номер конечной точки;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-559">Bit 3...0: The endpoint number</span></span><br /><span data-ttu-id="9a7ed-560">биты 6…4: зарезервированы (сброшены в 0);</span><span class="sxs-lookup"><span data-stu-id="9a7ed-560">Bit 6...4: Reserved, reset to zero</span></span><br /><span data-ttu-id="9a7ed-561">бит 7: направление передачи, игнорируется для конечных точек управления:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-561">Bit 7: Direction, ignored for control endpoints</span></span><br /><span data-ttu-id="9a7ed-562">0: конечная точка приема;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-562">0 = OUT endpoint</span></span><br /><span data-ttu-id="9a7ed-563">1: конечная точка передачи.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-563">1 = IN endpoint</span></span> |
| <span data-ttu-id="9a7ed-564">3</span><span class="sxs-lookup"><span data-stu-id="9a7ed-564">3</span></span>      | <span data-ttu-id="9a7ed-565">bmAttributes</span><span class="sxs-lookup"><span data-stu-id="9a7ed-565">bmAttributes</span></span>     | <span data-ttu-id="9a7ed-566">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-566">1</span></span>    | <span data-ttu-id="9a7ed-567">Bitmap</span><span class="sxs-lookup"><span data-stu-id="9a7ed-567">Bitmap</span></span>   | <span data-ttu-id="9a7ed-568">Это поле описывает атрибуты конечной точки при ее настройке с помощью поля **bConfigurationValue**.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-568">This field describes the endpoint's attributes when it is configured using the **bConfigurationValue** field.</span></span> <span data-ttu-id="9a7ed-569">Биты 1…0: тип передачи;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-569">Bits 1..0: Transfer Type</span></span><br /><span data-ttu-id="9a7ed-570">00: управление;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-570">00 = Control</span></span><br /><span data-ttu-id="9a7ed-571">01: изохронная передача;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-571">01 = Isochronous</span></span><br /><span data-ttu-id="9a7ed-572">10: пакетная передача;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-572">10 = Bulk</span></span><br /><span data-ttu-id="9a7ed-573">11: прерывание.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-573">11 = Interrupt</span></span><br /><span data-ttu-id="9a7ed-574">Если конечная точка не является изохронной, то биты 5…2 являются зарезервированными и должны быть равны 0.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-574">If not an isochronous endpoint, bits 5..2 are reserved and must be set to zero.</span></span> <span data-ttu-id="9a7ed-575">Если она изохронная, то эти биты они определяются следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-575">If isochronous, they are defined as follows:</span></span><br /><span data-ttu-id="9a7ed-576">биты 3…2: тип синхронизации:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-576">Bits 3..2: Synchronization Type</span></span><br /><span data-ttu-id="9a7ed-577">00: без синхронизации;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-577">00 = No Synchronization</span></span><br /><span data-ttu-id="9a7ed-578">01: асинхронная;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-578">01 = Asynchronous</span></span><br /><span data-ttu-id="9a7ed-579">02: адаптивная;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-579">10 = Adaptive</span></span><br /><span data-ttu-id="9a7ed-580">11: синхронная.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-580">11 = Synchronous</span></span><br /><span data-ttu-id="9a7ed-581">Биты 5…4: тип использования:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-581">Bits 5..4: Usage Type</span></span><br /><span data-ttu-id="9a7ed-582">00: конечная точка данных;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-582">00 = Data endpoint</span></span><br /><span data-ttu-id="9a7ed-583">01: конечная точка обратной связи;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-583">01 = Feedback endpoint</span></span><br /><span data-ttu-id="9a7ed-584">10: конечная точка данных неявной обратной связи;</span><span class="sxs-lookup"><span data-stu-id="9a7ed-584">10 = Implicit feedback data endpoint</span></span><br /><span data-ttu-id="9a7ed-585">11: зарезервировано.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-585">11 = Reserved</span></span> |
| <span data-ttu-id="9a7ed-586">4</span><span class="sxs-lookup"><span data-stu-id="9a7ed-586">4</span></span>      | <span data-ttu-id="9a7ed-587">wMaxPacketSize</span><span class="sxs-lookup"><span data-stu-id="9a7ed-587">wMaxPacketSize</span></span>   | <span data-ttu-id="9a7ed-588">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-588">2</span></span>    | <span data-ttu-id="9a7ed-589">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-589">Number</span></span>   | <span data-ttu-id="9a7ed-590">Максимальный размер пакета, который эта конечная точка может отправить или получить, если выбрана эта конфигурация.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-590">Maximum packet size this endpoint is capable of sending or receiving when this configuration is selected.</span></span><br /><span data-ttu-id="9a7ed-591">Для изохронных конечных точек это значение используется для резервирования времени шины в расписании, которое требуется для передачи полезных данных каждого микрокадра или кадра.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-591">For isochronous endpoints, this value is used to reserve the bus time in the schedule, required for the per-(micro)frame data payloads.</span></span> <span data-ttu-id="9a7ed-592">Канал может постоянно использовать меньше пропускной способности, чем зарезервировано.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-592">The pipe may, on an ongoing basis, actually use less bandwidth than that reserved.</span></span> <span data-ttu-id="9a7ed-593">При необходимости устройство сообщает о фактической использованной пропускной способности с помощью своих обычных механизмов, не определяемых USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-593">The device reports, if necessary, the actual bandwidth used via its normal, non-USB defined mechanisms.</span></span><br /><span data-ttu-id="9a7ed-594">Для всех конечных точек биты 10…0 задают максимальный размер пакета (в байтах).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-594">For all endpoints, bits 10..0 specify the maximum packet size (in bytes).</span></span><br /><span data-ttu-id="9a7ed-595">Для высокоскоростных изохронных конечных точек и конечных точек прерывания:</span><span class="sxs-lookup"><span data-stu-id="9a7ed-595">For high-speed isochronous and interrupt endpoints:</span></span><br /><span data-ttu-id="9a7ed-596">биты 12…11 задают число дополнительных транзакций на микрокадр: 00 = нет (1 транзакция на микрокадр);</span><span class="sxs-lookup"><span data-stu-id="9a7ed-596">Bits 12..11 specify the number of additional transaction opportunities per microframe: 00 = None (1 transaction per microframe)</span></span><br /><span data-ttu-id="9a7ed-597">01: 1 дополнительная транзакция (2 на микрокадр);</span><span class="sxs-lookup"><span data-stu-id="9a7ed-597">01 = 1 additional (2 per microframe)</span></span><br /><span data-ttu-id="9a7ed-598">10: 2 дополнительные транзакции (3 на микрокадр);</span><span class="sxs-lookup"><span data-stu-id="9a7ed-598">10 = 2 additional (3 per microframe)</span></span><br /><span data-ttu-id="9a7ed-599">11: зарезервировано.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-599">11 = Reserved</span></span><br /><span data-ttu-id="9a7ed-600">Биты 15…13 зарезервированы и должны иметь значение 0.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-600">Bits 15..13 are reserved and must be set to zero.</span></span> |
| <span data-ttu-id="9a7ed-601">6</span><span class="sxs-lookup"><span data-stu-id="9a7ed-601">6</span></span>      | <span data-ttu-id="9a7ed-602">bInterval</span><span class="sxs-lookup"><span data-stu-id="9a7ed-602">bInterval</span></span>        | <span data-ttu-id="9a7ed-603">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-603">1</span></span>     | <span data-ttu-id="9a7ed-604">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-604">Number</span></span>   | <span data-ttu-id="9a7ed-605">Числовой интервал опроса конечной точки при передаче данных.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-605">Number interval for polling endpoint for data transfers.</span></span><br /><span data-ttu-id="9a7ed-606">Выражается в кадрах или микрокадрах, в зависимости от скорости работы устройства (например, 1 мс или 125 мкс).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-606">Expressed in frames or microframes depending on the device operating speed (i.e., either 1 millisecond or 125 µs units).</span></span><br /><span data-ttu-id="9a7ed-607">Для изохронных конечных точек на максимальной скорости или высокоскоростных изохронных конечных точек это значение должно находиться в диапазоне от 1 до 16.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-607">For full-/high-speed isochronous endpoints, this value must be in the range from 1 to 16.</span></span> <span data-ttu-id="9a7ed-608">Параметр **bInterval** используется в качестве порядка значения 2*bInterval–1. Например, **bInterval**, равный 4, означает период 8 (2*4–1).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-608">The **bInterval** is used as the exponent for a 2bInterval-1 value; e.g., a **bInterval** 4 means a period of 8 (24-1).</span></span><br /><span data-ttu-id="9a7ed-609">Для конечных точек прерывания на максимальной или низкой скорости значение этого поля может быть в диапазоне от 1 до 255.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-609">For full-/low-speed interrupt endpoints, the value of this field may be from 1 to 255.</span></span><br /><span data-ttu-id="9a7ed-610">Для высокоскоростных конечных точек прерывания **bInterval** используется в качестве порядка значения 2\*bInterval–1. Например, **bInterval**, равный 4, означает период 8 (24–1).</span><span class="sxs-lookup"><span data-stu-id="9a7ed-610">For high-speed interrupt endpoints, the **bInterval** is used as the exponent for a 2bInterval-1 value; e.g., a **bInterval** 4 means a period of 8 (24-1).</span></span> <span data-ttu-id="9a7ed-611">Это значение должно быть в диапазоне от 1 до 16.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-611">This value must be from 1 to 16.</span></span><br /><span data-ttu-id="9a7ed-612">Для высокоскоростных конечных точек пакетной передачи или управления параметр **bInterval** указывает максимальную скорость передачи пакетов NAK.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-612">For high-speed bulk/control OUT endpoints, the **bInterval** specify the maximum NAK rate of the endpoint.</span></span> <span data-ttu-id="9a7ed-613">Значение 0 указывает, что конечная точка никогда не передает пакеты NAK.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-613">A value of 0 indicates the endpoint never NAKs.</span></span> <span data-ttu-id="9a7ed-614">Другие значения означают не более одного пакета NAK на каждые **bInterval** микрокадров.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-614">Other values indicate at most one NAK each **bInterval** of microframes.</span></span><br /><span data-ttu-id="9a7ed-615">Это значение должно быть в диапазоне от 0 до 255.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-615">This value must be in the range from 0 to 255.</span></span> |

<span data-ttu-id="9a7ed-616">USBX определяет дескриптор конечной точки USB следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-616">USBX defines a USB endpoint descriptor as follows:</span></span>

```c
typedef struct UX_ENDPOINT_DESCRIPTOR_STRUCT
{
    UINT bLength;
    UINT bDescriptorType;
    UINT bEndpointAddress;
    UINT bmAttributes;
    USHORT wMaxPacketSize;
    UINT bInterval;
} UX_ENDPOINT_DESCRIPTOR;
```

<span data-ttu-id="9a7ed-617">Дескриптор конечной точки USB является частью контейнера конечной точки, который описан ниже.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-617">The USB endpoint descriptor is part of an endpoint container, which is described as follows.</span></span>

```c
typedef struct UX_ENDPOINT_STRUCT {
    ULONG    ux_endpoint_handle;
    ULONG    ux_endpoint_state;
    VOID    *ux_endpoint_ed;
    struct UX_ENDPOINT_DESCRIPTOR_STRUCT    ux_endpoint_descriptor;
    struct UX_ENDPOINT_STRUCT    *ux_endpoint_next_endpoint;
    struct UX_INTERFACE_STRUCT    *ux_endpoint_interface;
    struct UX_DEVICE_STRUCT    *ux_endpoint_device;
    struct UX_TRANSFER REQUEST_STRUCT    ux_endpoint_transfer request;
} UX_ENDPOINT;

```

- <span data-ttu-id="9a7ed-618">**ux_endpoint_handle**: дескриптор конечной точки.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-618">**ux_endpoint_handle**: Handle of the endpoint.</span></span> <span data-ttu-id="9a7ed-619">Обычно это адрес экземпляра данной структуры для конечной точки.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-619">This is typically the address of the instance of this structure for the endpoint.</span></span>
- <span data-ttu-id="9a7ed-620">**ux_endpoint_state**: состояние конечной точки.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-620">**ux_endpoint_state**: State of the endpoint.</span></span>
- <span data-ttu-id="9a7ed-621">**ux_endpoint_ed**: указатель на физическую конечную точку на уровне хост-контроллера.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-621">**ux_endpoint_ed**: Pointer to the physical endpoint at the host controller layer.</span></span>
- <span data-ttu-id="9a7ed-622">**ux_endpoint_descriptor**: дескриптор конечной точки USB.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-622">**ux_endpoint_descriptor**: USB endpoint descriptor.</span></span>
- <span data-ttu-id="9a7ed-623">**ux_endpoint_next_endpoint**: указатель на следующую конечную точку, принадлежащую к тому же интерфейсу.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-623">**ux_endpoint_next_endpoint**: Pointer to the next endpoint that belongs to the same interface.</span></span>
- <span data-ttu-id="9a7ed-624">**ux_endpoint_interface**: указатель на интерфейс, к которому принадлежит этот интерфейс конечной точки.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-624">**ux_endpoint_interface**: Pointer to the interface that owns this endpoint interface.</span></span>
- <span data-ttu-id="9a7ed-625">**ux_endpoint_device**: указатель на контейнер родительского устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-625">**ux_endpoint_device**: Pointer to the parent device container.</span></span>
- <span data-ttu-id="9a7ed-626">**запрос ux_endpoint_transfer**: запрос на передачу USB, используемый для отправки и получения данных устройства.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-626">**ux_endpoint_transfer request**: USB transfer request used to send/receive data from to/from the device.</span></span>

### <a name="string-descriptors"></a><span data-ttu-id="9a7ed-627">Дескрипторы строк</span><span class="sxs-lookup"><span data-stu-id="9a7ed-627">String descriptors</span></span>

<span data-ttu-id="9a7ed-628">Дескрипторы строк являются необязательными.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-628">String descriptors are optional.</span></span> <span data-ttu-id="9a7ed-629">Если устройство не поддерживает дескрипторы строк, то все ссылки на дескрипторы строк в дескрипторах устройства, конфигураций и интерфейсов должны быть сброшены в 0.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-629">If a device does not support string descriptors, all references to string descriptors within device, configuration, and interface descriptors must be reset to zero.</span></span>

<span data-ttu-id="9a7ed-630">Дескрипторы строк используют кодирование Юникода, что обеспечивает поддержку нескольких кодировок.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-630">String descriptors use UNICODE encoding, thus allowing the support for several character sets.</span></span> <span data-ttu-id="9a7ed-631">Строки в USB-устройстве могут поддерживать несколько языков.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-631">The strings in a USB device may support multiple languages.</span></span> <span data-ttu-id="9a7ed-632">При запросе дескриптора строки инициатор запроса указывает требуемый язык с помощью идентификатора языка, определенного USB-IF.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-632">When requesting a string descriptor, the requester specifies the desired language using a language ID defined by the USB-IF.</span></span> <span data-ttu-id="9a7ed-633">Список текущих определенных USB кодов LANGID можно найти в приложении USBX.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-633">The list of currently defined USB LANGIDs can be found in the USBX appendix ??.</span></span>
<span data-ttu-id="9a7ed-634">Индекс строки 0 для всех языков возвращает дескриптор строки, содержащий массив из двухбайтовых кодов LANGID, поддерживаемых устройством.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-634">String index zero for all languages returns a string descriptor that contains an array of two-byte LANGID codes supported by the device.</span></span> <span data-ttu-id="9a7ed-635">Следует отметить, что строка в формате Юникода не заканчивается 0.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-635">It should be noted that the UNICODE string is not 0 terminated.</span></span> <span data-ttu-id="9a7ed-636">Вместо этого размер массива строк вычисляется путем вычитания 2 из размера массива, содержащегося в первом байте дескриптора.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-636">Instead, the size of the string array is computed by subtracting two from the size of the array contained in the first byte of the descriptor.</span></span>

<span data-ttu-id="9a7ed-637">Дескриптор строки 0 USB кодируется следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-637">The USB string descriptor 0 is encoded as follows.</span></span>

| <span data-ttu-id="9a7ed-638">Offset</span><span class="sxs-lookup"><span data-stu-id="9a7ed-638">Offset</span></span> | <span data-ttu-id="9a7ed-639">Поле</span><span class="sxs-lookup"><span data-stu-id="9a7ed-639">Field</span></span>           | <span data-ttu-id="9a7ed-640">Size</span><span class="sxs-lookup"><span data-stu-id="9a7ed-640">Size</span></span> | <span data-ttu-id="9a7ed-641">Значение</span><span class="sxs-lookup"><span data-stu-id="9a7ed-641">Value</span></span>    | <span data-ttu-id="9a7ed-642">Описание</span><span class="sxs-lookup"><span data-stu-id="9a7ed-642">Description</span></span>                      |
| ------ | --------------- | ---- | -------- | -------------------------------- |
| <span data-ttu-id="9a7ed-643">0</span><span class="sxs-lookup"><span data-stu-id="9a7ed-643">0</span></span>      | <span data-ttu-id="9a7ed-644">bLength</span><span class="sxs-lookup"><span data-stu-id="9a7ed-644">bLength</span></span>         | <span data-ttu-id="9a7ed-645">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-645">1</span></span>    | <span data-ttu-id="9a7ed-646">N+2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-646">N+2</span></span>      | <span data-ttu-id="9a7ed-647">Размер дескриптора в байтах</span><span class="sxs-lookup"><span data-stu-id="9a7ed-647">Size of this descriptor in bytes</span></span> |
| <span data-ttu-id="9a7ed-648">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-648">1</span></span>      | <span data-ttu-id="9a7ed-649">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="9a7ed-649">bDescriptorType</span></span> | <span data-ttu-id="9a7ed-650">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-650">1</span></span>    | <span data-ttu-id="9a7ed-651">Константа</span><span class="sxs-lookup"><span data-stu-id="9a7ed-651">Constant</span></span> | <span data-ttu-id="9a7ed-652">Тип дескриптора STRING.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-652">STRING Descriptor Type</span></span>           |
| <span data-ttu-id="9a7ed-653">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-653">2</span></span>      | <span data-ttu-id="9a7ed-654">wLANGID[0]</span><span class="sxs-lookup"><span data-stu-id="9a7ed-654">wLANGID[0]</span></span>      | <span data-ttu-id="9a7ed-655">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-655">2</span></span>    | <span data-ttu-id="9a7ed-656">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-656">Number</span></span>   | <span data-ttu-id="9a7ed-657">Код LANGID 0.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-657">LANGID code 0</span></span>                    |
| <span data-ttu-id="9a7ed-658">...</span><span class="sxs-lookup"><span data-stu-id="9a7ed-658">...</span></span>    | <span data-ttu-id="9a7ed-659">...]</span><span class="sxs-lookup"><span data-stu-id="9a7ed-659">...]</span></span>            | <span data-ttu-id="9a7ed-660">...</span><span class="sxs-lookup"><span data-stu-id="9a7ed-660">...</span></span>  | <span data-ttu-id="9a7ed-661">...</span><span class="sxs-lookup"><span data-stu-id="9a7ed-661">...</span></span>      | <span data-ttu-id="9a7ed-662">...</span><span class="sxs-lookup"><span data-stu-id="9a7ed-662">...</span></span>                              |
| <span data-ttu-id="9a7ed-663">Нет</span><span class="sxs-lookup"><span data-stu-id="9a7ed-663">N</span></span>      | <span data-ttu-id="9a7ed-664">wLANGID[n]</span><span class="sxs-lookup"><span data-stu-id="9a7ed-664">wLANGID[n]</span></span>      | <span data-ttu-id="9a7ed-665">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-665">2</span></span>    | <span data-ttu-id="9a7ed-666">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-666">Number</span></span>   | <span data-ttu-id="9a7ed-667">Код LANGID n.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-667">LANGID code n</span></span>                    |

<span data-ttu-id="9a7ed-668">Другие дескрипторы строк USB кодируются следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-668">Other USB string descriptors are encoded as follows.</span></span>

| <span data-ttu-id="9a7ed-669">Offset</span><span class="sxs-lookup"><span data-stu-id="9a7ed-669">Offset</span></span> | <span data-ttu-id="9a7ed-670">Поле</span><span class="sxs-lookup"><span data-stu-id="9a7ed-670">Field</span></span>           | <span data-ttu-id="9a7ed-671">Size</span><span class="sxs-lookup"><span data-stu-id="9a7ed-671">Size</span></span> | <span data-ttu-id="9a7ed-672">Значение</span><span class="sxs-lookup"><span data-stu-id="9a7ed-672">Value</span></span>    | <span data-ttu-id="9a7ed-673">Описание</span><span class="sxs-lookup"><span data-stu-id="9a7ed-673">Description</span></span>                      |
| ------ | --------------- | ---- | -------- | -------------------------------- |
| <span data-ttu-id="9a7ed-674">0</span><span class="sxs-lookup"><span data-stu-id="9a7ed-674">0</span></span>      | <span data-ttu-id="9a7ed-675">bLength</span><span class="sxs-lookup"><span data-stu-id="9a7ed-675">bLength</span></span>         | <span data-ttu-id="9a7ed-676">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-676">1</span></span>    | <span data-ttu-id="9a7ed-677">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-677">Number</span></span>   | <span data-ttu-id="9a7ed-678">Размер дескриптора в байтах</span><span class="sxs-lookup"><span data-stu-id="9a7ed-678">Size of this descriptor in bytes</span></span> |
| <span data-ttu-id="9a7ed-679">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-679">1</span></span>      | <span data-ttu-id="9a7ed-680">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="9a7ed-680">bDescriptorType</span></span> | <span data-ttu-id="9a7ed-681">1</span><span class="sxs-lookup"><span data-stu-id="9a7ed-681">1</span></span>    | <span data-ttu-id="9a7ed-682">Константа</span><span class="sxs-lookup"><span data-stu-id="9a7ed-682">Constant</span></span> | <span data-ttu-id="9a7ed-683">Тип дескриптора STRING.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-683">STRING Descriptor Type</span></span>           |
| <span data-ttu-id="9a7ed-684">2</span><span class="sxs-lookup"><span data-stu-id="9a7ed-684">2</span></span>      | <span data-ttu-id="9a7ed-685">bString</span><span class="sxs-lookup"><span data-stu-id="9a7ed-685">bString</span></span>         | <span data-ttu-id="9a7ed-686">n</span><span class="sxs-lookup"><span data-stu-id="9a7ed-686">n</span></span>    | <span data-ttu-id="9a7ed-687">Число</span><span class="sxs-lookup"><span data-stu-id="9a7ed-687">Number</span></span>   | <span data-ttu-id="9a7ed-688">Строка в кодировке Юникода.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-688">UNICODE encoded string</span></span>           |

<span data-ttu-id="9a7ed-689">USBX определяет дескриптор строки USB ненулевой длины следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-689">USBX defines a non-zero length USB string descriptor as follows:</span></span>

```c
typedef struct UX_STRING_DESCRIPTOR_STRUCT
{
    UINT bLength;
    UINT bDescriptorType;
    USHORT bString[1];
} UX_STRING_DESCRIPTOR;
```

### <a name="functional-descriptors"></a><span data-ttu-id="9a7ed-690">Функциональные дескрипторы</span><span class="sxs-lookup"><span data-stu-id="9a7ed-690">Functional Descriptors</span></span>

<span data-ttu-id="9a7ed-691">Функциональные дескрипторы также называют дескрипторами, зависящими от класса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-691">Functional descriptors are also known as class-specific descriptors.</span></span> <span data-ttu-id="9a7ed-692">Обычно в них используются те же базовые структуры, что и в универсальных дескрипторах, и они позволяют предоставлять дополнительные сведения для класса.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-692">They normally use the same basic structures as generic descriptors and allow for additional information to be available to the class.</span></span> <span data-ttu-id="9a7ed-693">Например, в случае с динамиком USB зависящие от класса дескрипторы позволяют извлечь класс звука для каждого альтернативного параметра, соответствующего поддерживаемой частоте звука.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-693">For example, in the case of the USB audio speaker, class specific descriptors allow the audio class to retrieve for each alternate setting the type of audio frequency supported.</span></span>

### <a name="usbx-device-descriptor-framework-in-memory"></a><span data-ttu-id="9a7ed-694">Платформа дескрипторов устройств USBX в памяти</span><span class="sxs-lookup"><span data-stu-id="9a7ed-694">USBX Device Descriptor Framework in Memory</span></span>

<span data-ttu-id="9a7ed-695">USBX хранит большинство дескрипторов устройства в памяти, а точнее — все дескрипторы, кроме дескрипторов строк и функциональных дескрипторов.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-695">USBX maintains most device descriptors in memory, that is, all descriptors except the string and functional descriptors.</span></span> <span data-ttu-id="9a7ed-696">На следующей схеме показано, как эти дескрипторы хранятся и как связаны между собой.</span><span class="sxs-lookup"><span data-stu-id="9a7ed-696">The following diagram shows how these descriptors are stored and related.</span></span>

![Платформа дескрипторов устройств USBX в памяти](./media/usbx-host-stack/usbx-device-descriptor-framework.png)
