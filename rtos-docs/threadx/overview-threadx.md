---
title: Общие сведения о ОСРВ Azure ThreadX
description: Узнайте больше об Azure ThreadX — усовершенствованной операционной системе реального времени (ОСРВ), разработанной специально для глубоко внедряемых приложений.
author: philmea
ms.author: philmea
ms.date: 6/9/2021
ms.service: rtos
ms.topic: overview
ms.custom: contperf-fy21q4
ms.openlocfilehash: 300307a82cfde9c74ec0a2499528898b384076676f75bd592fa2840bc5ac53a8
ms.sourcegitcommit: 93d716cf7e3d735b18246d659ec9ec7f82c336de
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2021
ms.locfileid: "116796310"
---
# <a name="overview-of-azure-rtos-threadx"></a>Обзор ОСРВ Azure ThreadX

ОСРВ Azure ThreadX — это усовершенствованная операционная система реального времени (ОСРВ) производственного класса от корпорации Майкрософт. Она предназначена специально для глубоко внедряемых приложений, приложений, работающих в реальном времени, и приложений Интернета вещей. ОСРВ Azure ThreadX предоставляет возможности расширенного планирования, обмен данными, синхронизацию, таймеры, управление памятью и управление прерываниями. Кроме того, в ОСРВ Azure ThreadX реализовано множество дополнительных функций, включая архитектуру picokernel™, технологию планирования preemption-threshold™, технологию event-chaining™, профилирование выполнения, метрики производительности и трассировку системных событий. Благодаря чрезвычайной простоте использования ОСРВ Azure ThreadX является идеальным выбором для самых требовательных внедренных приложений. Уже развернуто несколько миллиардов экземпляров ОСРВ Azure ThreadX на самых разных продуктах, включая потребительские устройства, медицинские электронные устройства и оборудование для управления производством.

## <a name="threadx-footprint"></a>Объем памяти ThreadX

ОСРВ Azure ThreadX требуется очень мало ресурсов — всего 2 КБ для области хранения команд и 1 КБ ОЗУ. В основном это обусловлено одноуровневой архитектурой picokernel™ и автоматическим масштабированием. Автоматическое масштабирование означает, что во время компоновки в окончательный образ добавляются только службы (и поддерживающая инфраструктура), используемые приложением.

Ниже приведены типичные размеры для ОСРВ Azure ThreadX.

|Служба ОСРВ Azure ThreadX  |Типичный размер в байтах  |
|---------|---------|
|Основные службы (обязательные) |2 000  |
|Службы очередей  |900  |
|Службы флагов событий  |900  |
|Службы семафоров  |450  |
|Службы мьютексов  |1200  |
|Службы блоков памяти  |550  |
|Службы управления байтами памяти  |900  |

## <a name="threadx-execution-speed"></a>Скорость выполнения ThreadX

ОСРВ Azure ThreadX достигает переключения контекста на самых популярных процессорах меньше чем за микросекунду, опережая по этому параметру другие коммерческие ОСРВ. В дополнение к быстроте ОСРВ Azure ThreadX также является высокодетерминированной. Она обеспечивает одинаковую производительность как для 200 потоков, так и для 1 потока.

Ниже приведены типичные характеристики производительности ОСРВ Azure ThreadX.

* Быстрая загрузка: ОСРВ Azure ThreadX загружается менее чем за 120 циклов.
* Возможность отключения базовой проверки на ошибки: базовую проверку на ошибки ОСРВ Azure ThreadX можно пропустить во время компиляции. Это может быть удобно, когда код приложения проверен и больше не требует проверки на наличие ошибок для каждого параметра. Проверку на ошибки можно пропустить на уровне компилируемого модуля, а не всей системы.
* Структура picokernel: службы не размещаются на разных уровнях, что устраняет ненужные временные затраты при вызове функций.
* Оптимизированная обработка прерываний: при входе в подпрограммы ISR и выходе из них сохраняются или восстанавливаются только временные регистры, если только не требуется вытеснение.
* Оптимизированная обработка API:

    |Служба ОСРВ Azure ThreadX  |Время работы службы в микросекундах*  |
    |---------|---------|
    |Приостановка потока  |0,6  |
    |Возобновление потока  |0,6  |
    |Отправка в очередь  |0,3  |
    |Получение в очередь  |0,3  |
    |Получение семафора  |0,2  |
    |Задание семафора  |0,2  |
    |Переключение контекста  |0,4  |
    |Реагирование на прерывание  |0,0–0,6  |

    **Показатели производительности приведены для типового процессора с частотой 200 МГц.*

## <a name="advanced-technology"></a>Усовершенствованные технологии

ОСРВ Azure ThreadX примечательна тем, что в ней используется планирование с использованием порога вытеснения. Это уникальная функция ОСРВ Azure ThreadX, которая была предметом обширных научных исследований. Дополнительные сведения см. в статье [Scheduling Fixed-Priority Tasks with Preemption Threshold](https://ieeexplore.ieee.org/document/811269) (Планирование задач с фиксированным приоритетом с использованием порога вытеснения), написанной Юнь Ванем (Yun Wang) из университета Конкордия и Манасом Саксеной (Manas Saksena) из Питтсбургского университета.

Ниже приведены основные возможности ОСРВ Azure ThreadX.

* Полные и исчерпывающие средства многозадачности:
  * потоки, таймеры приложений, очереди сообщений, семафоры со счетчиком, мьютексы, флаги событий, пулы блоков и байтов памяти.
* Планирование с вытеснением на основе приоритета.
* Гибкость приоритетов — до 1024 уровней приоритета.
* Координированное планирование.
* Порог вытеснения — уникальная особенность ОСРВ Azure ThreadX, которая помогает сократить число переключений контекста и гарантировать работу по расписанию (согласно научным исследованиям).
* Защита памяти с помощью модулей ОСРВ Azure ThreadX.
* Полностью детерминированные операции.
* Трассировка событий — запись *n* последних событий системы или приложения.
* Цепочки событий позволяют зарегистрировать функцию обратного вызова уведомления, зависящую от приложения, для каждого объекта связи или синхронизации ОСРВ Azure ThreadX.
* Модули ОСРВ Azure ThreadX с необязательной защитой памяти.
* Метрики производительности времени выполнения:
  * число возобновлений потоков;
  * число приостановок потоков;
  * число запрашиваемых вытеснений потоков;
  * число асинхронных прерываний с вытеснением потоков;
  * число инверсий приоритета потоков;
  * число освобождений потоков.
* Набор профилей выполнения (EPK).
* Отдельный с стек прерываний.
* Анализ стека во время выполнения.
* Оптимизированная обработка прерываний таймера.

## <a name="multicore-support-amp--smp"></a>Поддержка многоядерных платформ (AMP и SMP)

Стандартная версия ОСРВ Azure ThreadX часто используется для асимметричной многопроцессорной обработки (AMP), где отдельная копия ОСРВ Azure ThreadX и приложение (или ОС Linux) выполняются на каждом ядре и взаимодействуют друг с другом через общую память либо какой-либо механизм межпроцессорного взаимодействия, например OpenAMP (ОСРВ Azure ThreadX поддерживает OpenAMP).

В средах, где загрузка процессоров отличается высокой динамичностью, доступна ОСРВ Azure ThreadX Symmetric Multiprocessing (SMP) для симметричной многопроцессорной обработки, поддерживающая следующие семейства процессоров:

* ARM Cortex-Ax;
* ARM Cortex-Rx;
* ARM Cortex-A5x (64-разрядные версии);
* MIPS 34K, 1004K и interAptiv;
* PowerPC;
* Synopsys ARC HS;
* x86.

ОСРВ Azure ThreadX SMP выполняет динамическую балансировку нагрузки для *n* процессоров. Это позволяет любому потоку на любом ядре обращаться ко всем ресурсам ОСРВ Azure ThreadX (очереди, семафоры, флаги событий, пулы памяти и т. д.). ОСРВ Azure ThreadX SMP обеспечивает полный набор API ОСРВ Azure ThreadX на всех ядрах и предоставляет следующие новые API, предназначенные для операций SMP:

* `UINT tx_thread_smp_core_exclude(TX_THREAD *thread_ptr, ULONG exclusion_map);`
* `UINT tx_thread_smp_core_exclude_get(TX_THREAD *thread_ptr, ULONG *exclusion_map_ptr);`
* `UINT tx_thread_smp_core_get(void);`
* `UINT tx_timer_smp_core_exclude(TX_TIMER *timer_ptr, ULONG exclusion_map);`
* `UINT tx_timer_smp_core_exclude_get(TX_TIMER *timer_ptr, ULONG *exclusion_map_ptr);`

## <a name="memory-protection-via-azure-rtos-threadx-modules"></a>Защита памяти с помощью модулей ОСРВ Azure ThreadX

Дополнительный продукт, называемый модулями ОСРВ Azure ThreadX, позволяет объединить один или несколько потоков приложения в модуль, который можно динамически загружать и запускать (или выполнять на месте) на целевом оборудовании.

Модули позволяют выполнять обновление на месте, устранять ошибки и секционировать программы, чтобы большие приложения занимали только тот объем памяти, который необходимым для активных потоков.

Модули также используют диапазон адресов, отдельный от ОСРВ Azure ThreadX. Это позволяет ОСРВ Azure ThreadX применять защиту памяти (посредством MPU или MMU) для модуля, которая не позволяет непреднамеренному обращению извне модуля повредить какой-либо другой программный компонент.

## <a name="misra-compliant"></a>Соответствие требованиям MISRA

Исходный код ОСРВ Azure ThreadX и ОСРВ Azure ThreadX SMP соответствует требованиям MISRA-C:2004 и MISRA C:2012. MISRA C — это набор руководств по программированию критических систем с использованием языка программирования C. Первоначальные рекомендации MISRA C главным образом были нацелены на приложения для автомобилестроения, но теперь MISRA C широко признается стандартом, применимым к любому приложению со строгими требованиями к безопасности. ОСРВ Azure SMP ThreadX соответствует всем требуемым и обязательным правилам стандартов MISRA-C:2004 и MISRA C:2012.

:::image type="content" source="media/overview-threadx/misra-logo-certification.png" alt-text="Сертификация MISRA":::

## <a name="supports-most-popular-tools"></a>Поддержка большинства популярных инструментов

ОСРВ Azure ThreadX поддерживает большинство популярных внедряемых инструментов разработки, включая решение Embedded Workbench от IAR, которое также лучше всего совместимо с ядром ОСРВ Azure ThreadX. Возможна интеграция с другими средствами, включая GNU (GCC), ARM DS-5/uVision®, Green Hills MULTI®, Wind River Workbench, Imagination Codescape, Renesas e2studio, Metaware SeeCode, NXP CodeWarrior, Lauterbach TRACE32®, TI Code-Composer Studio, CrossCore и все устройства Analog Devices.

## <a name="adaptation-layer-for-threadx"></a>Уровень адаптации для ThreadX

Упростить перенос приложений в ОСРВ Azure можно с помощью [уровней адаптации](https://github.com/azure-rtos/threadx/tree/master/utility/rtos_compatibility_layers) ThreadX для различных устаревших API ОСРВ (FreeRTOS, POSIX, OSEK и т. д.).

> [!div class="nextstepaction"]
> [Знакомство с ThreadX в ОСРВ Azure](chapter1.md)